
/* --- FILE: 1 All working pine script.txt --- */

##-- File Name: PineScript-main/[Indicator] Magnetic Zones - Multi Timeframe.txt | File No: 1 | Started --##
// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/

//@version=5
indicator(title='Magnetic Zones - Multi Timeframe', shorttitle='Magnetic Zones', overlay=true)

//_____________________________ Menu Magnetic Zones 1 Start

g_mz_1 = 'Magnetic Zones 1'
string i_mz_1_tf = input.timeframe(defval='D', title='Timeframe', inline='1', group=g_mz_1)
int i_mz_1_showlast = input.int(defval=1, minval=0, title='Show Last', inline='1', group=g_mz_1) + 1

bool i_mz_1_pdhl_show = input.bool(defval=true, title='PDHL', inline='sr_1', group=g_mz_1)
bool i_mz_1_p_show = input.bool(defval=true, title='P', inline='sr_1', group=g_mz_1)
bool i_mz_1_sr_1_show = input.bool(defval=true, title='SR1', inline='sr_1', group=g_mz_1)
bool i_mz_1_sr_2_show = input.bool(defval=true, title='SR2', inline='sr_1', group=g_mz_1)
bool i_mz_1_sr_3_show = input.bool(defval=false, title='SR3', inline='sr_1', group=g_mz_1)
bool i_mz_1_sr_4_show = input.bool(defval=false, title='SR4', inline='sr_1', group=g_mz_1)
bool i_mz_1_sr_5_show = input.bool(defval=false, title='SR5', inline='sr_1', group=g_mz_1)
bool i_mz_1_sr_6_show = input.bool(defval=false, title='SR6', inline='sr_1', group=g_mz_1)

color i_mz_1_r_t_ln_color = input.color(defval=#00BCF2, title='', inline='4', group=g_mz_1)
color i_mz_1_s_ln_color = input.color(defval=#009E49, title='', inline='4', group=g_mz_1)
color i_mz_1_sub_color = input.color(defval=#9598A1, title='', inline='4', group=g_mz_1)
color i_mz_1_r_ln_color = input.color(defval=#E81123, title='', inline='4', group=g_mz_1)
color i_mz_1_s_t_ln_color = input.color(defval=#FF8C00, title='', inline='4', group=g_mz_1)

string i_mz_1_ln_style = input.string(defval=line.style_solid, title='', options=[line.style_solid, line.style_dashed, line.style_dotted], inline='4', group=g_mz_1)
int i_mz_1_ln_width = input.int(defval=1, title='', inline='4', group=g_mz_1)

//_____________________________ Menu Magnetic Zones 1 End

//_____________________________ Menu Magnetic Zones 2 Start

g_mz_2 = 'Magnetic Zones 2'
string i_mz_2_tf = input.timeframe(defval='W', title='Timeframe', inline='1', group=g_mz_2)
int i_mz_2_showlast = input.int(defval=0, minval=0, title='Show Last', inline='1', group=g_mz_2) + 1

bool i_mz_2_pdhl_show = input.bool(defval=true, title='PDHL', inline='sr_1', group=g_mz_2)
bool i_mz_2_p_show = input.bool(defval=true, title='P', inline='sr_1', group=g_mz_2)
bool i_mz_2_sr_1_show = input.bool(defval=true, title='SR1', inline='sr_1', group=g_mz_2)
bool i_mz_2_sr_2_show = input.bool(defval=true, title='SR2', inline='sr_1', group=g_mz_2)

color i_mz_2_s_ln_color = input.color(defval=#009E49, title='', inline='4', group=g_mz_2)
color i_mz_2_sub_color = input.color(defval=#9598A1, title='', inline='4', group=g_mz_2)
color i_mz_2_r_ln_color = input.color(defval=#E81123, title='', inline='4', group=g_mz_2)

string i_mz_2_ln_style = input.string(defval=line.style_dashed, title='', options=[line.style_solid, line.style_dashed, line.style_dotted], inline='4', group=g_mz_2)
int i_mz_2_ln_width = input.int(defval=1, title='', inline='4', group=g_mz_2)

//_____________________________ Menu Magnetic Zones 2 End

//_____________________________ Menu Magnetic Zones 3 Start

g_mz_3 = 'Magnetic Zones 3'
string i_mz_3_tf = input.timeframe(defval='M', title='Timeframe', inline='1', group=g_mz_3)
int i_mz_3_showlast = input.int(defval=0, minval=0, title='Show Last', inline='1', group=g_mz_3) + 1

bool i_mz_3_pdhl_show = input.bool(defval=true, title='PDHL', inline='sr_1', group=g_mz_3)
bool i_mz_3_p_show = input.bool(defval=true, title='P', inline='sr_1', group=g_mz_3)
bool i_mz_3_sr_1_show = input.bool(defval=true, title='SR1', inline='sr_1', group=g_mz_3)
bool i_mz_3_sr_2_show = input.bool(defval=true, title='SR2', inline='sr_1', group=g_mz_3)

color i_mz_3_s_ln_color = input.color(defval=#009E49, title='', inline='4', group=g_mz_3)
color i_mz_3_sub_color = input.color(defval=#9598A1, title='', inline='4', group=g_mz_3)
color i_mz_3_r_ln_color = input.color(defval=#E81123, title='', inline='4', group=g_mz_3)

string i_mz_3_ln_style = input.string(defval=line.style_dotted, title='', options=[line.style_solid, line.style_dashed, line.style_dotted], inline='4', group=g_mz_3)
int i_mz_3_ln_width = input.int(defval=1, title='', inline='4', group=g_mz_3)

//_____________________________ Menu Magnetic Zones 3 End

//_____________________________ Menu General Inputs Start

g_gi = 'Magnetic Zones General Inputs'
int i_mz_bx_transp = input.int(defval=70, minval=0, maxval=100, title='Box Transp', inline='1', group=g_gi)
string i_mz_bx_style = input.string(defval=line.style_solid, title='', options=[line.style_solid, line.style_dashed, line.style_dotted], inline='1', group=g_gi)
string i_mz_bx_txt_size = input.string(defval=size.auto, title='Text?????', options=[size.auto, size.tiny, size.small, size.normal, size.large, size.huge], inline='2', group=g_gi)
string i_mz_bx_txt_align = input.string(defval=text.align_right, title='', options=[text.align_left, text.align_center, text.align_right], inline='2', group=g_gi)

//_____________________________ Menu General Inputs End

//__________________________ Menu Moving Average Start

g_ma = 'Moving Average'
bool i_ma_1_show = input.bool(defval=false, title='', inline='ma_1_1', group=g_ma)
int i_ma_1_length = input.int(defval=20, title='', inline='ma_1_1', group=g_ma)
string i_ma_1_type = input.string(defval="EMA", title='', options=["EMA", "SMA"], inline='ma_1_1', group=g_ma)
color i_ma_1_color = input.color(defval=#22AB94, title='', inline='ma_1_1', group=g_ma)
float i_ma_1_source = input.source(defval=close, title='?????', inline='ma_1_2', group=g_ma)
string i_ma_1_timeframe = input.timeframe(defval='', title='', inline='ma_1_2', group=g_ma)

bool i_ma_2_show = input.bool(defval=false, title='', inline='ma_2_1', group=g_ma)
int i_ma_2_length = input.int(defval=200, title='', inline='ma_2_1', group=g_ma)
string i_ma_2_type = input.string(defval="EMA", title='', options=["EMA", "SMA"], inline='ma_2_1', group=g_ma)
color i_ma_2_color = input.color(defval=#F7525F, title='', inline='ma_2_1', group=g_ma)
float i_ma_2_source = input.source(defval=close, title='?????', inline='ma_2_2', group=g_ma)
string i_ma_2_timeframe = input.timeframe(defval='', title='', inline='ma_2_2', group=g_ma)

int i_ma_offset = input.int(defval=0, minval=0, title='Offset', inline='6', group=g_ma)

bool i_ma_lb_length_show = input.bool(defval=false, title='Label: Length', inline='7', group=g_ma)
bool i_ma_lb_type_show = input.bool(defval=false, title='Type', inline='7', group=g_ma)
bool i_ma_lb_htf_show = input.bool(defval=false, title='Timeframe', inline='7', group=g_ma)

//__________________________ Menu Moving Average End

//_____________________________ Menu VWAP Start

g_vwap = 'VWAP (Volume Weighted Average Price)'
bool i_vwap_show = input.bool(defval=false, title='', inline='1', group=g_vwap)
var i_vwap_timeframe = input.string(defval = "Day", title="", options=["Day", "Week", "Month"], inline='1', group=g_vwap)
float i_vwap_source = input.source(title = "", defval = hlc3, inline='1', group=g_vwap)
color i_vwap_color = input.color(defval=#2962FF, title='', inline='1', group=g_vwap)

//_____________________________ Menu VWAP End

//_____________________________ Menu Supertrend Start

g_st = 'Supertrend'
bool i_st_show = input.bool(defval=false, title='Show', inline='', group=g_st)
int i_st_atr_period = input.int(defval=7, title='ATR Length', minval=1, inline='', group=g_st)
float i_st_factor = input.float(defval=2, title='Factor', minval=0.01, step=0.01, inline='', group=g_st)
color i_st_up_color = input.color(defval=#22AB94, title='Color???????????', inline='st_c', group=g_st)
color i_st_dn_color = input.color(defval=#F7525F, title='', inline='st_c', group=g_st)

//_____________________________ Menu Supertrend End

//_____________________________ Menu Screener Formula Start

txt_scr =
 'Formula for price Near R2:\n\n'+
 'Line 1.\n'+
 '5 minute Close <= 1 day ago High + ( ( 1 day ago High - 1 day ago Low ) / 2 )\n\n'+
 'Line 2.\n'+
 '5 minute Close >= 1 day ago High + ( ( 1 day ago High - 1 day ago Low ) / 3 )\n\n\n'+

 'Formula for price Near S2:\n\n'+
 'Line 1.\n'+
 '5 minute Close >= 1 day ago Low - ( ( 1 day ago High - 1 day ago Low ) / 2 )\n\n'+ 
 'Line 2.\n'+
 '5 minute Close <= 1 day ago Low - ( ( 1 day ago High - 1 day ago Low ) / 3 )'

string i_adr_screener_formula = input.text_area(defval=txt_scr, title='', group='Magnetic Zones Screener Formula')

//_____________________________ Menu Screener Formula End

//_____________________________ Menu GitHub Start

txt_git =
 'Source Code is available at GitHub:\n'+
 'Link: https://github.com/ArunKBhaskar/PineScript'

string github = input.text_area(defval=txt_git, title='', group='Source Code')

//_____________________________ Menu GitHub End

//_____________________________ Get Data Start

get_time(timeframe) =>
    [_time, _time_close] = request.security(symbol=syminfo.tickerid, timeframe=timeframe, expression=[time, time_close], gaps=barmerge.gaps_off, lookahead=barmerge.lookahead_on)
    [_time, _time_close]

[mz_1_time, mz_1_time_close] = get_time(i_mz_1_tf)
[mz_2_time, mz_2_time_close] = get_time(i_mz_2_tf)
[mz_3_time, mz_3_time_close] = get_time(i_mz_3_tf)

//_____________________________ Get Data End

//_____________________________ MZ Calculations Start

// MZ Function
magnetic_zones(float multiplier) =>
    prev_hl_diff = high[1] - low[1]
    r = hl2[1] + multiplier * prev_hl_diff
    s = hl2[1] - multiplier * prev_hl_diff
    [r, s]

buffer_zone(float level, float level_top, float level_bot) =>
    top = level + ((level_top - level_bot) / 8)
    bottom = level - ((level_top - level_bot) / 8)
    [top, bottom]

// Calculate Magnetic Zones
[r_1, s_1] = magnetic_zones(0.236)
[r_2, s_2] = magnetic_zones(0.786)
[r_3, s_3] = magnetic_zones(1.618)
[r_4, s_4] = magnetic_zones(2.618)
[r_5, s_5] = magnetic_zones(4.236)
[r_6, s_6] = magnetic_zones(6.618)

//_____________________________ Get Data Function

data(timeframe, price) =>
  request.security(symbol=syminfo.tickerid, timeframe=timeframe, expression=price, lookahead=barmerge.lookahead_on)

/// MZ 1
// PDHL
mz_1_ph = data(i_mz_1_tf, high[1])
mz_1_pl = data(i_mz_1_tf, low[1])

// Pivot
mz_1_p = data(i_mz_1_tf, hl2[1])

// MZ 1 SR
mz_1_r_1 = data(i_mz_1_tf, r_1)
mz_1_r_2 = data(i_mz_1_tf, r_2)
mz_1_r_3 = data(i_mz_1_tf, r_3)
mz_1_r_4 = data(i_mz_1_tf, r_4)
mz_1_r_5 = data(i_mz_1_tf, r_5)
mz_1_r_6 = data(i_mz_1_tf, r_6)

mz_1_s_1 = data(i_mz_1_tf, s_1)
mz_1_s_2 = data(i_mz_1_tf, s_2)
mz_1_s_3 = data(i_mz_1_tf, s_3)
mz_1_s_4 = data(i_mz_1_tf, s_4)
mz_1_s_5 = data(i_mz_1_tf, s_5)
mz_1_s_6 = data(i_mz_1_tf, s_6)

// Buffer
[mz_1_r_1_top, mz_1_r_1_bot] = buffer_zone(mz_1_r_1, mz_1_r_1, mz_1_s_1)
[mz_1_s_1_top, mz_1_s_1_bot] = buffer_zone(mz_1_s_1, mz_1_r_1, mz_1_s_1)
[mz_1_r_2_top, mz_1_r_2_bot] = buffer_zone(mz_1_r_2, mz_1_r_2, mz_1_r_1)
[mz_1_s_2_top, mz_1_s_2_bot] = buffer_zone(mz_1_s_2, mz_1_s_1, mz_1_s_2)
//[mz_1_r_3_top, mz_1_r_3_bot] = buffer_zone(mz_1_r_3, mz_1_r_3, mz_1_r_2)
//[mz_1_s_3_top, mz_1_s_3_bot] = buffer_zone(mz_1_s_3, mz_1_s_2, mz_1_s_3)
[mz_1_r_4_top, mz_1_r_4_bot] = buffer_zone(mz_1_r_4, mz_1_r_4, mz_1_r_3)
[mz_1_s_4_top, mz_1_s_4_bot] = buffer_zone(mz_1_s_4, mz_1_s_3, mz_1_s_4)
//[mz_1_r_5_top, mz_1_r_5_bot] = buffer_zone(mz_1_r_5, mz_1_r_5, mz_1_r_4)
//[mz_1_s_5_top, mz_1_s_5_bot] = buffer_zone(mz_1_s_5, mz_1_s_4, mz_1_s_5)
[mz_1_r_6_top, mz_1_r_6_bot] = buffer_zone(mz_1_r_6, mz_1_r_6, mz_1_r_5)
[mz_1_s_6_top, mz_1_s_6_bot] = buffer_zone(mz_1_s_6, mz_1_s_5, mz_1_s_6)

/// MZ 2
// PDHL
mz_2_ph = data(i_mz_2_tf, high[1])
mz_2_pl = data(i_mz_2_tf, low[1])

// Pivot
mz_2_p = data(i_mz_2_tf, hl2[1])

// MZ 2 SR
mz_2_r_1 = data(i_mz_2_tf, r_1)
mz_2_r_2 = data(i_mz_2_tf, r_2)

mz_2_s_1 = data(i_mz_2_tf, s_1)
mz_2_s_2 = data(i_mz_2_tf, s_2)

// Buffer
[mz_2_r_1_top, mz_2_r_1_bot] = buffer_zone(mz_2_r_1, mz_2_r_1, mz_2_s_1)
[mz_2_s_1_top, mz_2_s_1_bot] = buffer_zone(mz_2_s_1, mz_2_r_1, mz_2_s_1)
[mz_2_r_2_top, mz_2_r_2_bot] = buffer_zone(mz_2_r_2, mz_2_r_2, mz_2_r_1)
[mz_2_s_2_top, mz_2_s_2_bot] = buffer_zone(mz_2_s_2, mz_2_s_1, mz_2_s_2)

/// MZ 3
// PDHL
mz_3_ph = data(i_mz_3_tf, high[1])
mz_3_pl = data(i_mz_3_tf, low[1])

// Pivot
mz_3_p = data(i_mz_3_tf, hl2[1])

// MZ 3 SR
mz_3_r_1 = data(i_mz_3_tf, r_1)
mz_3_r_2 = data(i_mz_3_tf, r_2)

mz_3_s_1 = data(i_mz_3_tf, s_1)
mz_3_s_2 = data(i_mz_3_tf, s_2)

// Buffer
[mz_3_r_1_top, mz_3_r_1_bot] = buffer_zone(mz_3_r_1, mz_3_r_1, mz_3_s_1)
[mz_3_s_1_top, mz_3_s_1_bot] = buffer_zone(mz_3_s_1, mz_3_r_1, mz_3_s_1)
[mz_3_r_2_top, mz_3_r_2_bot] = buffer_zone(mz_3_r_2, mz_3_r_2, mz_3_r_1)
[mz_3_s_2_top, mz_3_s_2_bot] = buffer_zone(mz_3_s_2, mz_3_s_1, mz_3_s_2)

//_____________________________ MZ Calculations End

//_____________________________ Draw Functions Start

draw_line(left_time, right_time, float price, color _color, string _style, int _width) =>
    _line = line.new(x1=left_time, y1=price, x2=right_time, y2=price, xloc=xloc.bar_time, color=_color, style=_style, width=_width)

draw_box(left_time, right_time, float top_price, float bottom_price, color _color, int _border_width, string _border_style, string _text, string _text_size, color _text_color, string _text_halign) =>
    _box = box.new(left=left_time, top=top_price, right=right_time, bottom=bottom_price, border_color=_color, border_width=_border_width, border_style=_border_style, xloc=xloc.bar_time, bgcolor=_color, text=_text, text_size=_text_size, text_color=_text_color, text_halign=_text_halign, text_valign=text.align_center)//, text_wrap=text.wrap_auto)

//_____________________________ Draw Functions End

//_____________________________ Draw MZ 1 Levels Start

var mz_1_ph_ln_arr = array.new_line(), var mz_1_pl_ln_arr = array.new_line()
var mz_1_p_ln_arr = array.new_line()
var mz_1_r_1_ln_arr = array.new_line(), var mz_1_s_1_ln_arr = array.new_line()
var mz_1_r_2_ln_arr = array.new_line(), var mz_1_s_2_ln_arr = array.new_line()
var mz_1_r_3_ln_arr = array.new_line(), var mz_1_s_3_ln_arr = array.new_line()
var mz_1_r_4_ln_arr = array.new_line(), var mz_1_s_4_ln_arr = array.new_line()
var mz_1_r_5_ln_arr = array.new_line(), var mz_1_s_5_ln_arr = array.new_line()
var mz_1_r_6_ln_arr = array.new_line(), var mz_1_s_6_ln_arr = array.new_line()

var mz_1_r_1_s_1_bx_arr = array.new_box()
var mz_1_r_1_bx_arr = array.new_box(), var mz_1_s_1_bx_arr = array.new_box()
var mz_1_r_2_bx_arr = array.new_box(), var mz_1_s_2_bx_arr = array.new_box()
//var mz_1_r_3_bx_arr = array.new_box(), var mz_1_s_3_bx_arr = array.new_box()
var mz_1_r_4_bx_arr = array.new_box(), var mz_1_s_4_bx_arr = array.new_box()
//var mz_1_r_5_bx_arr = array.new_box(), var mz_1_s_5_bx_arr = array.new_box()
var mz_1_r_6_bx_arr = array.new_box(), var mz_1_s_6_bx_arr = array.new_box()

if(timeframe.change(i_mz_1_tf))
    if i_mz_1_pdhl_show
        mz_1_ph_ln = draw_line(mz_1_time, mz_1_time_close, mz_1_ph, i_mz_1_sub_color, i_mz_1_ln_style, i_mz_1_ln_width)
        array.push(mz_1_ph_ln_arr, mz_1_ph_ln)
        mz_1_pl_ln = draw_line(mz_1_time, mz_1_time_close, mz_1_pl, i_mz_1_sub_color, i_mz_1_ln_style, i_mz_1_ln_width)
        array.push(mz_1_pl_ln_arr, mz_1_pl_ln)

    if i_mz_1_p_show
        mz_1_p_ln = draw_line(mz_1_time, mz_1_time_close, mz_1_p, i_mz_1_sub_color, i_mz_1_ln_style, i_mz_1_ln_width)
        array.push(mz_1_p_ln_arr, mz_1_p_ln)

    if i_mz_1_sr_1_show
        mz_1_r_1_ln = draw_line(mz_1_time, mz_1_time_close, mz_1_r_1, i_mz_1_sub_color, i_mz_1_ln_style, i_mz_1_ln_width)
        array.push(mz_1_r_1_ln_arr, mz_1_r_1_ln)
        mz_1_s_1_ln = draw_line(mz_1_time, mz_1_time_close, mz_1_s_1, i_mz_1_sub_color, i_mz_1_ln_style, i_mz_1_ln_width)
        array.push(mz_1_s_1_ln_arr, mz_1_s_1_ln)

        mz_1_r_bx = draw_box(mz_1_time, mz_1_time_close, mz_1_r_1_top, mz_1_r_1_bot, color.new(i_mz_1_sub_color, i_mz_bx_transp + 10), 1, i_mz_bx_style, str.tostring(math.round_to_mintick(mz_1_r_1)) + ' : ' + str.tostring(i_mz_1_tf) + '\n' + '\n', i_mz_bx_txt_size, i_mz_1_sub_color, i_mz_bx_txt_align)
        array.push(mz_1_r_1_bx_arr, mz_1_r_bx)
        mz_1_s_bx = draw_box(mz_1_time, mz_1_time_close, mz_1_s_1_top, mz_1_s_1_bot, color.new(i_mz_1_sub_color, i_mz_bx_transp + 10), 1, i_mz_bx_style, '\n' + str.tostring(math.round_to_mintick(mz_1_s_1)) + ' : ' + str.tostring(i_mz_1_tf), i_mz_bx_txt_size, i_mz_1_sub_color, i_mz_bx_txt_align)
        array.push(mz_1_s_1_bx_arr, mz_1_s_bx)

        mz_1_r_1_s_1_bx = draw_box(mz_1_time, mz_1_time_close, mz_1_r_1_top, mz_1_s_1_bot, color.new(i_mz_1_sub_color, i_mz_bx_transp), 1, i_mz_bx_style, '', i_mz_bx_txt_size, i_mz_1_sub_color, i_mz_bx_txt_align)
        array.push(mz_1_r_1_s_1_bx_arr, mz_1_r_1_s_1_bx)

    if i_mz_1_sr_2_show
        mz_1_r_2_ln = draw_line(mz_1_time, mz_1_time_close, mz_1_r_2, i_mz_1_s_ln_color, i_mz_1_ln_style, i_mz_1_ln_width)
        array.push(mz_1_r_2_ln_arr, mz_1_r_2_ln)
        mz_1_s_2_ln = draw_line(mz_1_time, mz_1_time_close, mz_1_s_2, i_mz_1_r_ln_color, i_mz_1_ln_style, i_mz_1_ln_width)
        array.push(mz_1_s_2_ln_arr, mz_1_s_2_ln)

        mz_1_r_2_bx = draw_box(mz_1_time, mz_1_time_close, mz_1_r_2_top, mz_1_r_2_bot, color.new(i_mz_1_s_ln_color, i_mz_bx_transp), 1, i_mz_bx_style, str.tostring(math.round_to_mintick(mz_1_r_2)) + '\n' + '\n', i_mz_bx_txt_size, i_mz_1_s_ln_color, i_mz_bx_txt_align)
        array.push(mz_1_r_2_bx_arr, mz_1_r_2_bx)
        mz_1_s_2_bx = draw_box(mz_1_time, mz_1_time_close, mz_1_s_2_top, mz_1_s_2_bot, color.new(i_mz_1_r_ln_color, i_mz_bx_transp), 1, i_mz_bx_style, '\n' + str.tostring(math.round_to_mintick(mz_1_s_2)), i_mz_bx_txt_size, i_mz_1_r_ln_color, i_mz_bx_txt_align)
        array.push(mz_1_s_2_bx_arr, mz_1_s_2_bx)

    if i_mz_1_sr_3_show
        mz_1_r_3_ln = draw_line(mz_1_time, mz_1_time_close, mz_1_r_3, i_mz_1_r_t_ln_color, i_mz_1_ln_style, i_mz_1_ln_width)
        array.push(mz_1_r_3_ln_arr, mz_1_r_3_ln)
        mz_1_s_3_ln = draw_line(mz_1_time, mz_1_time_close, mz_1_s_3, i_mz_1_s_t_ln_color, i_mz_1_ln_style, i_mz_1_ln_width)
        array.push(mz_1_s_3_ln_arr, mz_1_s_3_ln)
//    if i_mz_1_sr_3_show 
//        mz_1_r_3_bx = draw_box(mz_1_time, mz_1_time_close, mz_1_r_3_top, mz_1_r_3_bot, color.new(i_mz_1_r_ln_color, i_mz_bx_transp), 1, i_mz_bx_style, str.tostring(math.round_to_mintick(mz_1_r_3)) + '\n' + '\n', i_mz_bx_txt_size, i_mz_1_r_ln_color, i_mz_bx_txt_align)
//        array.push(mz_1_r_3_bx_arr, mz_1_r_3_bx)
//       mz_1_s_3_bx = draw_box(mz_1_time, mz_1_time_close, mz_1_s_3_top, mz_1_s_3_bot, color.new(i_mz_1_s_ln_color, i_mz_bx_transp), 1, i_mz_bx_style, '\n' + str.tostring(math.round_to_mintick(mz_1_s_3)), i_mz_bx_txt_size, i_mz_1_s_ln_color, i_mz_bx_txt_align)
//        array.push(mz_1_s_3_bx_arr, mz_1_s_3_bx)

    if i_mz_1_sr_4_show
        mz_1_r_4_ln = draw_line(mz_1_time, mz_1_time_close, mz_1_r_4, i_mz_1_r_t_ln_color, i_mz_1_ln_style, i_mz_1_ln_width)
        array.push(mz_1_r_4_ln_arr, mz_1_r_4_ln)
        mz_1_s_4_ln = draw_line(mz_1_time, mz_1_time_close, mz_1_s_4, i_mz_1_s_t_ln_color, i_mz_1_ln_style, i_mz_1_ln_width)
        array.push(mz_1_s_4_ln_arr, mz_1_s_4_ln)

        mz_1_r_4_bx = draw_box(mz_1_time, mz_1_time_close, mz_1_r_4_top, mz_1_r_4_bot, color.new(i_mz_1_r_t_ln_color, i_mz_bx_transp), 1, i_mz_bx_style, str.tostring(math.round_to_mintick(mz_1_r_4)) + '\n' + '\n', i_mz_bx_txt_size, i_mz_1_r_t_ln_color, i_mz_bx_txt_align)
        array.push(mz_1_r_4_bx_arr, mz_1_r_4_bx)
        mz_1_s_4_bx = draw_box(mz_1_time, mz_1_time_close, mz_1_s_4_top, mz_1_s_4_bot, color.new(i_mz_1_s_t_ln_color, i_mz_bx_transp), 1, i_mz_bx_style, '\n' + str.tostring(math.round_to_mintick(mz_1_s_4)), i_mz_bx_txt_size, i_mz_1_s_t_ln_color, i_mz_bx_txt_align)
        array.push(mz_1_s_4_bx_arr, mz_1_s_4_bx)

    if i_mz_1_sr_5_show
        mz_1_r_5_ln = draw_line(mz_1_time, mz_1_time_close, mz_1_r_5, i_mz_1_r_t_ln_color, i_mz_1_ln_style, i_mz_1_ln_width)
        array.push(mz_1_r_5_ln_arr, mz_1_r_5_ln)
        mz_1_s_5_ln = draw_line(mz_1_time, mz_1_time_close, mz_1_s_5, i_mz_1_s_t_ln_color, i_mz_1_ln_style, i_mz_1_ln_width)
        array.push(mz_1_s_5_ln_arr, mz_1_s_5_ln)
//    if i_mz_1_sr_5_show
//        mz_1_r_5_bx = draw_box(mz_1_time, mz_1_time_close, mz_1_r_5_top, mz_1_r_5_bot, color.new(i_mz_1_r_t_ln_color, i_mz_bx_transp), 1, i_mz_bx_style, str.tostring(math.round_to_mintick(mz_1_r_5)) + '\n' + '\n', i_mz_bx_txt_size, i_mz_1_r_t_ln_color, i_mz_bx_txt_align)
//        array.push(mz_1_r_5_bx_arr, mz_1_r_5_bx)
//        mz_1_s_5_bx = draw_box(mz_1_time, mz_1_time_close, mz_1_s_5_top, mz_1_s_5_bot, color.new(i_mz_1_s_t_ln_color, i_mz_bx_transp), 1, i_mz_bx_style, '\n' + str.tostring(math.round_to_mintick(mz_1_s_5)), i_mz_bx_txt_size, i_mz_1_s_t_ln_color, i_mz_bx_txt_align)
//        array.push(mz_1_s_5_bx_arr, mz_1_s_5_bx)

    if i_mz_1_sr_6_show
        mz_1_r_6_ln = draw_line(mz_1_time, mz_1_time_close, mz_1_r_6, i_mz_1_r_t_ln_color, i_mz_1_ln_style, i_mz_1_ln_width)
        array.push(mz_1_r_6_ln_arr, mz_1_r_6_ln)
        mz_1_s_6_ln = draw_line(mz_1_time, mz_1_time_close, mz_1_s_6, i_mz_1_s_t_ln_color, i_mz_1_ln_style, i_mz_1_ln_width)
        array.push(mz_1_s_6_ln_arr, mz_1_s_6_ln)

        mz_1_r_6_bx = draw_box(mz_1_time, mz_1_time_close, mz_1_r_6_top, mz_1_r_6_bot, color.new(i_mz_1_r_t_ln_color, i_mz_bx_transp), 1, i_mz_bx_style, str.tostring(math.round_to_mintick(mz_1_r_6)) + '\n' + '\n', i_mz_bx_txt_size, i_mz_1_r_t_ln_color, i_mz_bx_txt_align)
        array.push(mz_1_r_6_bx_arr, mz_1_r_6_bx)
        mz_1_s_6_bx = draw_box(mz_1_time, mz_1_time_close, mz_1_s_6_top, mz_1_s_6_bot, color.new(i_mz_1_s_t_ln_color, i_mz_bx_transp), 1, i_mz_bx_style, '\n' + str.tostring(math.round_to_mintick(mz_1_s_6)), i_mz_bx_txt_size, i_mz_1_s_t_ln_color, i_mz_bx_txt_align)
        array.push(mz_1_s_6_bx_arr, mz_1_s_6_bx)

// Function to delete past lines & boxes
show_last_boxes(arr, int showlast) =>
    if array.size(arr) >= showlast
        box = array.get(arr, 0)
        box.delete(box)
        array.remove(arr, 0)

show_last_lines(arr, int showlast) =>
    if array.size(arr) >= showlast
        line = array.get(arr, 0)
        line.delete(line)
        array.remove(arr, 0)

show_last_lines(mz_1_ph_ln_arr, i_mz_1_showlast)
show_last_lines(mz_1_pl_ln_arr, i_mz_1_showlast)
show_last_lines(mz_1_p_ln_arr, i_mz_1_showlast)
show_last_lines(mz_1_r_1_ln_arr, i_mz_1_showlast)
show_last_lines(mz_1_s_1_ln_arr, i_mz_1_showlast)
show_last_lines(mz_1_r_2_ln_arr, i_mz_1_showlast)
show_last_lines(mz_1_s_2_ln_arr, i_mz_1_showlast)
show_last_lines(mz_1_r_3_ln_arr, i_mz_1_showlast)
show_last_lines(mz_1_s_3_ln_arr, i_mz_1_showlast)
show_last_lines(mz_1_r_4_ln_arr, i_mz_1_showlast)
show_last_lines(mz_1_s_4_ln_arr, i_mz_1_showlast)
show_last_lines(mz_1_r_5_ln_arr, i_mz_1_showlast)
show_last_lines(mz_1_s_5_ln_arr, i_mz_1_showlast)
show_last_lines(mz_1_r_6_ln_arr, i_mz_1_showlast)
show_last_lines(mz_1_s_6_ln_arr, i_mz_1_showlast)

show_last_boxes(mz_1_r_1_s_1_bx_arr, i_mz_1_showlast)
show_last_boxes(mz_1_r_1_bx_arr, i_mz_1_showlast)
show_last_boxes(mz_1_s_1_bx_arr, i_mz_1_showlast)
show_last_boxes(mz_1_r_2_bx_arr, i_mz_1_showlast)
show_last_boxes(mz_1_s_2_bx_arr, i_mz_1_showlast)
//show_last_boxes(mz_1_r_3_bx_arr, i_mz_1_showlast)
//show_last_boxes(mz_1_s_3_bx_arr, i_mz_1_showlast)
show_last_boxes(mz_1_r_4_bx_arr, i_mz_1_showlast)
show_last_boxes(mz_1_s_4_bx_arr, i_mz_1_showlast)
//show_last_boxes(mz_1_r_5_bx_arr, i_mz_1_showlast)
//show_last_boxes(mz_1_s_5_bx_arr, i_mz_1_showlast)
show_last_boxes(mz_1_r_6_bx_arr, i_mz_1_showlast)
show_last_boxes(mz_1_s_6_bx_arr, i_mz_1_showlast)

//_____________________________ Draw MZ 1 Levels End

//_____________________________ Draw MZ 2 Levels Start

var mz_2_ph_ln_arr = array.new_line(), var mz_2_pl_ln_arr = array.new_line()
var mz_2_p_ln_arr = array.new_line()
var mz_2_r_1_ln_arr = array.new_line(), var mz_2_s_1_ln_arr = array.new_line()
var mz_2_r_2_ln_arr = array.new_line(), var mz_2_s_2_ln_arr = array.new_line()

var mz_2_r_1_s_1_bx_arr = array.new_box()
var mz_2_r_1_bx_arr = array.new_box(), var mz_2_s_1_bx_arr = array.new_box()
var mz_2_r_2_bx_arr = array.new_box(), var mz_2_s_2_bx_arr = array.new_box()

if(timeframe.change(i_mz_2_tf))
    if i_mz_2_pdhl_show
        mz_2_ph_ln = draw_line(mz_2_time, mz_2_time_close, mz_2_ph, i_mz_2_sub_color, i_mz_2_ln_style, i_mz_2_ln_width)
        array.push(mz_2_ph_ln_arr, mz_2_ph_ln)
        mz_2_pl_ln = draw_line(mz_2_time, mz_2_time_close, mz_2_pl, i_mz_2_sub_color, i_mz_2_ln_style, i_mz_2_ln_width)
        array.push(mz_2_pl_ln_arr, mz_2_pl_ln)

    if i_mz_2_p_show
        mz_2_p_ln = draw_line(mz_2_time, mz_2_time_close, mz_2_p, i_mz_2_sub_color, i_mz_2_ln_style, i_mz_2_ln_width)
        array.push(mz_2_p_ln_arr, mz_2_p_ln)

    if i_mz_2_sr_1_show
        mz_2_r_1_ln = draw_line(mz_2_time, mz_2_time_close, mz_2_r_1, i_mz_2_sub_color, i_mz_2_ln_style, i_mz_2_ln_width)
        array.push(mz_2_r_1_ln_arr, mz_2_r_1_ln)
        mz_2_s_1_ln = draw_line(mz_2_time, mz_2_time_close, mz_2_s_1, i_mz_2_sub_color, i_mz_2_ln_style, i_mz_2_ln_width)
        array.push(mz_2_s_1_ln_arr, mz_2_s_1_ln)

        mz_2_r_bx = draw_box(mz_2_time, mz_2_time_close, mz_2_r_1_top, mz_2_r_1_bot, color.new(i_mz_2_sub_color, i_mz_bx_transp + 10), 1, i_mz_bx_style, str.tostring(math.round_to_mintick(mz_2_r_1)) + ' : ' + str.tostring(i_mz_2_tf) + '\n' + '\n', i_mz_bx_txt_size, i_mz_2_sub_color, i_mz_bx_txt_align)
        array.push(mz_2_r_1_bx_arr, mz_2_r_bx)
        mz_2_s_bx = draw_box(mz_2_time, mz_2_time_close, mz_2_s_1_top, mz_2_s_1_bot, color.new(i_mz_2_sub_color, i_mz_bx_transp + 10), 1, i_mz_bx_style, '\n' + str.tostring(math.round_to_mintick(mz_2_s_1)) + ' : ' + str.tostring(i_mz_2_tf), i_mz_bx_txt_size, i_mz_2_sub_color, i_mz_bx_txt_align)
        array.push(mz_2_s_1_bx_arr, mz_2_s_bx)

        mz_2_r_1_s_1_bx = draw_box(mz_2_time, mz_2_time_close, mz_2_r_1_top, mz_2_s_1_bot, color.new(i_mz_2_sub_color, i_mz_bx_transp), 1, i_mz_bx_style, '', i_mz_bx_txt_size, i_mz_2_sub_color, i_mz_bx_txt_align)
        array.push(mz_2_r_1_s_1_bx_arr, mz_2_r_1_s_1_bx)

    if i_mz_2_sr_2_show
        mz_2_r_2_ln = draw_line(mz_2_time, mz_2_time_close, mz_2_r_2, i_mz_2_s_ln_color, i_mz_2_ln_style, i_mz_2_ln_width)
        array.push(mz_2_r_2_ln_arr, mz_2_r_2_ln)
        mz_2_s_2_ln = draw_line(mz_2_time, mz_2_time_close, mz_2_s_2, i_mz_2_r_ln_color, i_mz_2_ln_style, i_mz_2_ln_width)
        array.push(mz_2_s_2_ln_arr, mz_2_s_2_ln)

        mz_2_r_2_bx = draw_box(mz_2_time, mz_2_time_close, mz_2_r_2_top, mz_2_r_2_bot, color.new(i_mz_2_s_ln_color, i_mz_bx_transp), 1, i_mz_bx_style, str.tostring(math.round_to_mintick(mz_2_r_2)) + '\n' + '\n', i_mz_bx_txt_size, i_mz_2_s_ln_color, i_mz_bx_txt_align)
        array.push(mz_2_r_2_bx_arr, mz_2_r_2_bx)
        mz_2_s_2_bx = draw_box(mz_2_time, mz_2_time_close, mz_2_s_2_top, mz_2_s_2_bot, color.new(i_mz_2_r_ln_color, i_mz_bx_transp), 1, i_mz_bx_style, '\n' + str.tostring(math.round_to_mintick(mz_2_s_2)), i_mz_bx_txt_size, i_mz_2_r_ln_color, i_mz_bx_txt_align)
        array.push(mz_2_s_2_bx_arr, mz_2_s_2_bx)

show_last_lines(mz_2_ph_ln_arr, i_mz_2_showlast)
show_last_lines(mz_2_pl_ln_arr, i_mz_2_showlast)
show_last_lines(mz_2_p_ln_arr, i_mz_2_showlast)
show_last_lines(mz_2_r_1_ln_arr, i_mz_2_showlast)
show_last_lines(mz_2_s_1_ln_arr, i_mz_2_showlast)
show_last_lines(mz_2_r_2_ln_arr, i_mz_2_showlast)
show_last_lines(mz_2_s_2_ln_arr, i_mz_2_showlast)

show_last_boxes(mz_2_r_1_s_1_bx_arr, i_mz_2_showlast)
show_last_boxes(mz_2_r_1_bx_arr, i_mz_2_showlast)
show_last_boxes(mz_2_s_1_bx_arr, i_mz_2_showlast)
show_last_boxes(mz_2_r_2_bx_arr, i_mz_2_showlast)
show_last_boxes(mz_2_s_2_bx_arr, i_mz_2_showlast)

//_____________________________ Draw MZ 2 Levels End

//_____________________________ Draw MZ 3 Levels Start

var mz_3_ph_ln_arr = array.new_line(), var mz_3_pl_ln_arr = array.new_line()
var mz_3_p_ln_arr = array.new_line()
var mz_3_r_1_ln_arr = array.new_line(), var mz_3_s_1_ln_arr = array.new_line()
var mz_3_r_2_ln_arr = array.new_line(), var mz_3_s_2_ln_arr = array.new_line()

var mz_3_r_1_s_1_bx_arr = array.new_box()
var mz_3_r_1_bx_arr = array.new_box(), var mz_3_s_1_bx_arr = array.new_box()
var mz_3_r_2_bx_arr = array.new_box(), var mz_3_s_2_bx_arr = array.new_box()

if(timeframe.change(i_mz_3_tf))
    if i_mz_3_pdhl_show
        mz_3_ph_ln = draw_line(mz_3_time, mz_3_time_close, mz_3_ph, i_mz_3_sub_color, i_mz_3_ln_style, i_mz_3_ln_width)
        array.push(mz_3_ph_ln_arr, mz_3_ph_ln)
        mz_3_pl_ln = draw_line(mz_3_time, mz_3_time_close, mz_3_pl, i_mz_3_sub_color, i_mz_3_ln_style, i_mz_3_ln_width)
        array.push(mz_3_pl_ln_arr, mz_3_pl_ln)

    if i_mz_3_p_show
        mz_3_p_ln = draw_line(mz_3_time, mz_3_time_close, mz_3_p, i_mz_3_sub_color, i_mz_3_ln_style, i_mz_3_ln_width)
        array.push(mz_3_p_ln_arr, mz_3_p_ln)

    if i_mz_3_sr_1_show
        mz_3_r_1_ln = draw_line(mz_3_time, mz_3_time_close, mz_3_r_1, i_mz_3_sub_color, i_mz_3_ln_style, i_mz_3_ln_width)
        array.push(mz_3_r_1_ln_arr, mz_3_r_1_ln)
        mz_3_s_1_ln = draw_line(mz_3_time, mz_3_time_close, mz_3_s_1, i_mz_3_sub_color, i_mz_3_ln_style, i_mz_3_ln_width)
        array.push(mz_3_s_1_ln_arr, mz_3_s_1_ln)

        mz_3_r_bx = draw_box(mz_3_time, mz_3_time_close, mz_3_r_1_top, mz_3_r_1_bot, color.new(i_mz_3_sub_color, i_mz_bx_transp + 10), 1, i_mz_bx_style, str.tostring(math.round_to_mintick(mz_3_r_1)) + ' : ' + str.tostring(i_mz_3_tf) + '\n' + '\n', i_mz_bx_txt_size, i_mz_3_sub_color, i_mz_bx_txt_align)
        array.push(mz_3_r_1_bx_arr, mz_3_r_bx)
        mz_3_s_bx = draw_box(mz_3_time, mz_3_time_close, mz_3_s_1_top, mz_3_s_1_bot, color.new(i_mz_3_sub_color, i_mz_bx_transp + 10), 1, i_mz_bx_style, '\n' + str.tostring(math.round_to_mintick(mz_3_s_1)) + ' : ' + str.tostring(i_mz_3_tf), i_mz_bx_txt_size, i_mz_3_sub_color, i_mz_bx_txt_align)
        array.push(mz_3_s_1_bx_arr, mz_3_s_bx)

        mz_3_r_1_s_1_bx = draw_box(mz_3_time, mz_3_time_close, mz_3_r_1_top, mz_3_s_1_bot, color.new(i_mz_3_sub_color, i_mz_bx_transp), 1, i_mz_bx_style, '', i_mz_bx_txt_size, i_mz_3_sub_color, i_mz_bx_txt_align)
        array.push(mz_3_r_1_s_1_bx_arr, mz_3_r_1_s_1_bx)

    if i_mz_3_sr_2_show
        mz_3_r_2_ln = draw_line(mz_3_time, mz_3_time_close, mz_3_r_2, i_mz_3_s_ln_color, i_mz_3_ln_style, i_mz_3_ln_width)
        array.push(mz_3_r_2_ln_arr, mz_3_r_2_ln)
        mz_3_s_2_ln = draw_line(mz_3_time, mz_3_time_close, mz_3_s_2, i_mz_3_r_ln_color, i_mz_3_ln_style, i_mz_3_ln_width)
        array.push(mz_3_s_2_ln_arr, mz_3_s_2_ln)

        mz_3_r_2_bx = draw_box(mz_3_time, mz_3_time_close, mz_3_r_2_top, mz_3_r_2_bot, color.new(i_mz_3_s_ln_color, i_mz_bx_transp), 1, i_mz_bx_style, str.tostring(math.round_to_mintick(mz_3_r_2)) + '\n' + '\n', i_mz_bx_txt_size, i_mz_3_s_ln_color, i_mz_bx_txt_align)
        array.push(mz_3_r_2_bx_arr, mz_3_r_2_bx)
        mz_3_s_2_bx = draw_box(mz_3_time, mz_3_time_close, mz_3_s_2_top, mz_3_s_2_bot, color.new(i_mz_3_r_ln_color, i_mz_bx_transp), 1, i_mz_bx_style, '\n' + str.tostring(math.round_to_mintick(mz_3_s_2)), i_mz_bx_txt_size, i_mz_3_r_ln_color, i_mz_bx_txt_align)
        array.push(mz_3_s_2_bx_arr, mz_3_s_2_bx)

show_last_lines(mz_3_ph_ln_arr, i_mz_3_showlast)
show_last_lines(mz_3_pl_ln_arr, i_mz_3_showlast)
show_last_lines(mz_3_p_ln_arr, i_mz_3_showlast)
show_last_lines(mz_3_r_1_ln_arr, i_mz_3_showlast)
show_last_lines(mz_3_s_1_ln_arr, i_mz_3_showlast)
show_last_lines(mz_3_r_2_ln_arr, i_mz_3_showlast)
show_last_lines(mz_3_s_2_ln_arr, i_mz_3_showlast)

show_last_boxes(mz_3_r_1_s_1_bx_arr, i_mz_3_showlast)
show_last_boxes(mz_3_r_1_bx_arr, i_mz_3_showlast)
show_last_boxes(mz_3_s_1_bx_arr, i_mz_3_showlast)
show_last_boxes(mz_3_r_2_bx_arr, i_mz_3_showlast)
show_last_boxes(mz_3_s_2_bx_arr, i_mz_3_showlast)

//_____________________________ Draw MZ 3 Levels End

//_____________________________ Moving Average Multi Timeframe Start

// Acknowledgement & Reference:
// Indicator Name: "Multi Timeframe Moving Average [xdecow]" By "xdecow"
// Indicator Link: https://www.tradingview.com/script/IzmSs7Ma-Multi-Timeframe-Moving-Average-xdecow/

// Functions
// Resolution to String
res_to_str(_res) =>
    if _res == ''
        ''
    else if _res == '1'
        '1m'
    else if _res == '3'
        '3m'
    else if _res == '5'
        '5m'
    else if _res == '15'
        '15m'
    else if _res == '30'
        '30m'
    else if _res == '45'
        '45m'
    else if _res == '60'
        '1h'
    else if _res == '120'
        '2h'
    else if _res == '180'
        '3h'
    else if _res == '240'
        '4h'
    else if _res == '1D'
        'D'
    else if _res == '1W'
        'W'
    else if _res == '1M'
        'M'
    else if _res == '3M'
        '3M'
    else if _res == '6M'
        '6M'
    else if _res == '12M'
        '12M'
    else
        _res

ma_offset() =>
    offset_spaces = ''
    if i_ma_offset > 0
        for i = 1 to i_ma_offset by 1
            offset_spaces += '    '
    offset_spaces

moving_average(_type, _source, _length) =>
    float result = na
    if _type == "EMA"
        result := ta.ema(_source, _length)
    if _type == "SMA" 
        result := ta.sma(_source, _length)
    result

add_label(show_label, _value, _res, _type, _length, _color) =>
    label lbl = na
    if show_label
        label_text = ''
        if i_ma_lb_length_show
            label_text := str.tostring(_length)
        if i_ma_lb_type_show
            label_text += (label_text != '' ? ' ' : '') + _type
        if i_ma_lb_htf_show and _res != ''
            label_text += (label_text != '' ? ' (' : '') + res_to_str(_res) + ')'
        if label_text != ''
            lbl := label.new(bar_index, na(_value) ? close : _value, text=ma_offset() + label_text, color=#00000000, textcolor=_color, style=label.style_label_left, textalign=text.align_left)
            label.delete(lbl[1])

moving_average_htf(_res, _type, _source, _length) =>
    _value  = moving_average(_type, _source, _length)
    [ma_sec, ma_bindex] = request.security(syminfo.tickerid, _res, [_value , bar_index])
    var int last_barindex = na
    last_barindex := na(last_barindex[1]) or ma_bindex > last_barindex[1] ? ma_bindex : last_barindex[1]
    last_barindex != last_barindex[1] or barstate.islast ? ma_sec : na

ma_1 = moving_average_htf(i_ma_1_timeframe, i_ma_1_type, i_ma_1_source, i_ma_1_length)
ma_2 = moving_average_htf(i_ma_2_timeframe, i_ma_2_type, i_ma_2_source, i_ma_2_length)

plot(series=i_ma_1_show ? ma_1 : na, title='MA 1', color=i_ma_1_color, linewidth=1, offset=i_ma_offset, join=true)
add_label(i_ma_1_show, ma_1, i_ma_1_timeframe, i_ma_1_type, i_ma_1_length, i_ma_1_color)
plot(series=i_ma_2_show ? ma_2 : na, title='MA 2', color=i_ma_2_color, linewidth=1, offset=i_ma_offset, join=true)
add_label(i_ma_2_show, ma_2, i_ma_2_timeframe, i_ma_2_type, i_ma_2_length, i_ma_2_color)

//_____________________________ Moving Average Multi Timeframe End

//_____________________________ Volume Weighted Average price Start

if barstate.islast and ta.cum(volume) == 0
    runtime.error("No volume is provided by the data vendor.")

isNewPeriod = switch i_vwap_timeframe
	"Day"   => timeframe.change("D")
	"Week"      => timeframe.change("W")
	"Month"     => timeframe.change("M")
	=> false

float vwap_value = na

[_vwap, _stdevUpper, _] = ta.vwap(i_vwap_source, isNewPeriod, 1)
vwap_value := _vwap

plot(i_vwap_show ? vwap_value : na, title="VWAP", color=i_vwap_color, linewidth=1)

//_____________________________ Volume Weighted Average price End

//_____________________________ Supertrend Start

// Supertrend Calculation
dir_up = hl2 - i_st_factor * ta.atr(i_st_atr_period)
dir_dn = hl2 + i_st_factor * ta.atr(i_st_atr_period)

trend_up = 0.0
trend_up := close[1] > trend_up[1] ? math.max(dir_up, trend_up[1]) : dir_up
trend_down = 0.0
trend_down := close[1] < trend_down[1] ? math.min(dir_dn, trend_down[1]) : dir_dn
trend = 0.0
trend := close > trend_down[1] ? 1 : close < trend_up[1] ? -1 : nz(trend[1], 1)
supertrend = trend == 1 ? trend_up : trend_down

// Color
st_ln_col = trend == 1 ? i_st_up_color : i_st_dn_color

plot(i_st_show ? supertrend : na, color=st_ln_col, style=plot.style_line, linewidth=1, title="Supertrend")

//_____________________________ Supertrend End

//_____________________________ CODE END

##-- File Name: PineScript-main/[Indicator] Magnetic Zones - Multi Timeframe.txt | File No: 1 | Ended --##

##-- File Name: PineScript-main/[Screener] ICT Retracement to Order Block with Screener.txt | File No: 2 | Started --##
// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © Arun_K_Bhaskar

//@version=5
indicator(title="ICT Retracement to Order Block with Screener", shorttitle="Retracement to OB", overlay=true)

tt_p = "• Period is the count of candles used to determine the highest high & lowest low." +
 "\n• Default period 30 works for all timeframes but is optimized for 15m & 1h." +
 "\n• Experiment with other values as needed."
int i_period = input.int(defval=30, title="Period", minval=1, tooltip=tt_p)

tt_vo = "• Vertical offset is like a buffer in case price doesn't hit the order block exactly." +
 "\n• Default is 0, meaning no buffer. The 3rd signal appears only on precise touch to the order block." +
 "\n• Example: If 'Vertical Offset (%)' is 50" +
 "\n• For Long: Calculate a price 50% higher than the 1st candle's high." +
 "\n• For Short: Calculate a price 50% lower than the 1st candle's low."
float i_vertical_offset = input.float(defval=0, title='Vertical Offset (%)', tooltip=tt_vo) / 100

//_____________________________ Menu Screener Start
g_tb = 'Screener'
tt_is = "• Input exactly 40 symbols, nothing more or less." +
     "\n• Total characters cannot exceed 4096." +
     "\n• Use comma as delimiter without any space." +
     "\n• Eg: EXCHANGE:SYMBOL_A,EXCHANGE:SYMBOL_B"

string i_symbols = input.text_area(
 defval="NSE:ABCAPITAL,NSE:ANANTRAJ,NSE:ASTERDM,NSE:BANKINDIA,NSE:BIOCON,NSE:CAPACITE,NSE:CESC,NSE:CGPOWER,NSE:DCBBANK,NSE:DELHIVERY,NSE:ELECTCAST,NSE:EXIDEIND,NSE:FINPIPE,NSE:FSL,NSE:GAIL,NSE:GENUSPOWER,NSE:GEPIL,NSE:GMDCLTD,NSE:GREAVESCOT,NSE:HEMIPROP,NSE:HITECH,NSE:HPL,NSE:HSCL,NSE:IIFLSEC,NSE:INDUSTOWER,NSE:IPL,NSE:JAGRAN,NSE:JWL,NSE:KALYANKJIL,NSE:KCP,NSE:L_TFH,NSE:MANINDS,NSE:MOTHERSON,NSE:NAVKARCORP,NSE:NTPC,NSE:ONGC,NSE:PAISALO,NSE:PENIND,NSE:POONAWALLA,NSE:PPLPHARMA",
 title="Paste Symbols", tooltip=tt_is, group=g_tb)

string i_scr_direction = input.string(defval='Both', title='Direction', options=['Both', 'Bullish', 'Bearish'], inline='tb_1', group=g_tb)
bool i_scr_show_bull_mc  = input.bool(defval=true, title='Only Bullish', inline='tb_2', group=g_tb)
bool i_scr_show_bear_mc  = input.bool(defval=true, title='Only Bearish', inline='tb_2', group=g_tb)

int i_tbl_disp_rows = input.int(defval=16, title='Display Rows', minval=0, maxval=100, group=g_tb)
string i_tbl_position = input.string(defval=position.bottom_left, title='Table Position', options=[position.top_left, position.top_center, position.top_right, position.middle_left, position.middle_center, position.middle_right, position.bottom_left, position.bottom_center, position.bottom_right], group=g_tb)
string i_tbl_text_size = input.string(defval=size.small, title='Table Size', options=[size.auto, size.tiny, size.small, size.normal, size.large, size.huge], group=g_tb)
//_____________________________ Menu Screener End

//_______________________ Menu Line Start
g_ln = "Line Settings"
string i_ln_style = input.string(defval=line.style_solid, title="Style", options=[line.style_solid, line.style_dashed, line.style_dotted], group=g_ln)
int i_ln_width = input.int(defval=1, title="Width", minval=1, group=g_ln)
//_______________________ Menu Line End

//_______________________ Menu Color Start
g_c = 'Colors'
color i_pos_col = input.color(defval=#22AB94, title='+', inline='c_1', group=g_c)
color i_neg_col = input.color(defval=#F7525F, title='-', inline='c_1', group=g_c)
color i_neu_col = input.color(defval=#B2B5BE, title='0', inline='c_1', group=g_c)
//_______________________ Menu Color End

//_______________________ Momentum Candle Start
body = math.abs(close - open)
wick = high - low
momentum_candle = body / wick > 0.66
//_______________________ Momentum Candle End

//_______________________ ATR Start
atr_support = wick >= ta.atr(14)
//_______________________ ATR End

//_______________________ Donchain Start
highest_high = ta.highest(high, i_period)[1]
lowest_low = ta.lowest(low, i_period)[1]

plot(series=highest_high, title="Highest High", color=i_neg_col, display=display.none)
plot(series=lowest_low, title="Lowest Low", color=i_pos_col, display=display.none)
//_______________________ Donchain End

//___________________________ Primary Signal Start
// Primary Signal Rules
primary_long_condition = barstate.isconfirmed and
 open > close and
 low < lowest_low and
 momentum_candle and 
 atr_support 

primary_short_condition = barstate.isconfirmed and
 open < close and
 high > highest_high and
 momentum_candle and 
 atr_support

// Primary Signal Function
exrem(condition_1, condition_2) =>
    var entry_signal = 0
    entry_signal := condition_1 ? 1 : condition_2 ? -1 : entry_signal[1]
    entry = entry_signal != entry_signal[1]
    buy = entry and entry_signal == 1
    sell = entry and entry_signal == -1
    [buy, sell]

// Primary Signals
[primary_long_signal, primary_short_signal] = exrem(primary_long_condition, primary_short_condition)
//___________________________ Primary Signal End

//___________________________ Secondary Signal Start
// Acknowledgement & Reference
// Title: 'how to get high of a candle which crossover moving average'
// Link: "https://stackoverflow.com/questions/74894187/how-to-get-high-of-a-candle-which-crossover-moving-average"

// Secondary Signal Function
trigger(primary_condition, secondary_condition) =>
    var current_state = 0
    previous_state = nz(current_state[1])
    current_state := previous_state == 2 ? 0 : previous_state
    if primary_condition and current_state == 0
        current_state := 1
    if secondary_condition and current_state == 1
        current_state := 2
    trigger_condition = current_state == 2 ? true : false
    [current_state, trigger_condition]

var prev_high_when_crossover = float(na)
if primary_long_signal
    prev_high_when_crossover := high

var prev_low_when_crossunder = float(na)
if primary_short_signal
    prev_low_when_crossunder := low

// Secondary Signal Rules
secondary_long_condition = barstate.isconfirmed and
 open < close and
 close > prev_high_when_crossover and
 //momentum_candle and
 atr_support

secondary_short_condition = barstate.isconfirmed and
 open > close and
 close < prev_low_when_crossunder and
 //momentum_candle and
 atr_support

// Secondary Signal
[secondary_long, secondary_long_signal] = trigger(primary_long_signal, secondary_long_condition)
[secondary_short, secondary_short_signal] = trigger(primary_short_signal, secondary_short_condition)
//___________________________ Secondary Signal End

//___________________________ Vertical Offset Start
vertical_offset(top_price, bottom_price, offset_value) =>
    diff = top_price - bottom_price
    top_level = top_price + (diff * offset_value)
    bottom_level = bottom_price - (diff * offset_value)
    [top_level, bottom_level]

[top_price, bottom_price] = vertical_offset(high, low, i_vertical_offset)
//___________________________ Vertical Offset End

//___________________________ Teritiary Signal Start
var primary_long_candle_high = float(na)
if primary_long_signal
    primary_long_candle_high := top_price

var primary_short_candle_low = float(na)
if primary_short_signal
    primary_short_candle_low := bottom_price

// Teritiary Signal Rules
teritiary_long_condition = barstate.isconfirmed and
 ta.crossunder(low, primary_long_candle_high)

teritiary_short_condition = barstate.isconfirmed and
 ta.crossover(high, primary_short_candle_low)

// Teritiary Signal
[teritiary_long, teritiary_long_signal] = trigger(secondary_long_signal, teritiary_long_condition)
[teritiary_short, teritiary_short_signal] = trigger(secondary_short_signal, teritiary_short_condition)
//___________________________ Secondary Signal End

//___________________________ Plot Alert & Break Start
// Plot Long Break & Break
plotshape(
         series = primary_long_signal,
         title = 'Long Break', 
         style = shape.circle, 
         location = location.belowbar, 
         color = i_pos_col, 
         text = "1", 
         textcolor = i_pos_col, 
         size = size.tiny 
         )

plot(series = primary_long_signal ? high : na, title = 'Past Long Break Line', color = i_pos_col, style = plot.style_stepline_diamond, display = display.none)

plotshape(
         series = secondary_long_signal,
         title = 'Long Retrace', 
         style = shape.circle, 
         location = location.belowbar, 
         color = i_pos_col, 
         text = '2', 
         textcolor = i_pos_col, 
         size = size.tiny
         )

plotshape(
         series = teritiary_long_signal,
         title = 'Long Retrace', 
         style = shape.circle, 
         location = location.belowbar, 
         color = i_pos_col, 
         text = '3', 
         textcolor = i_pos_col, 
         size = size.tiny
         )

// Plot Short Break & Break
plotshape(
         series = primary_short_signal,
         title = "Short Break", 
         style = shape.circle, 
         location = location.abovebar, 
         color = i_neg_col, 
         text = "1", 
         textcolor = i_neg_col, 
         size = size.tiny
         )

plot(series = primary_short_signal ? low : na, title = 'Past Short Break Line', color = i_neg_col, style = plot.style_stepline_diamond, display = display.none)

plotshape(
         series = secondary_short_signal,
         title = 'Short Retrace', 
         style = shape.circle, 
         location = location.abovebar, 
         color = i_neg_col, 
         text = '2', 
         textcolor = i_neg_col, 
         size = size.tiny
         )

plotshape(
         series = teritiary_short_signal,
         title = 'Short Retrace', 
         style = shape.circle, 
         location = location.abovebar, 
         color = i_neg_col, 
         text = '3', 
         textcolor = i_neg_col, 
         size = size.tiny
         )
//___________________________ Plot Alert & Break End 

//___________________________ Draw Alert Price Lines Start
// Acknowledgement & Reference
// Trader: "apozdnyakov"
// Indicator Title: "Three horizontal lines on condition"
// Indicator Link: "https://in.tradingview.com/script/hxogJn3E-Three-horizontal-lines-on-condition/"

var line alert_break_line = na

if primary_long_signal
    line.delete(alert_break_line)
    alert_break_line := line.new(x1=bar_index, y1=high, x2=bar_index+1, y2=high, extend=extend.right, color=i_pos_col, style=i_ln_style, width=i_ln_width)

else if primary_short_signal
    line.delete(alert_break_line)
    alert_break_line := line.new(x1=bar_index, y1=low, x2=bar_index+1, y2=low, extend=extend.right, color=i_neg_col, style=i_ln_style, width=i_ln_width)
//___________________________ Draw Alert Price Lines Start

// Plot Historical Breaks
// Acknowledgement & Reference
// Title: "How can I get a value since a condition happen? (Pinescript)"
// Link: "https://stackoverflow.com/questions/73009687/how-can-i-get-a-value-since-a-condition-happen-pinescript"

//_______________________ Get Symbols Start
// Acknowledgement & Reference
// Trader: 'allanster'
// Indicator Title: 'How To Input CSV List Of Symbol Data Used For Screener'
// Indicator Link: 'https://www.tradingview.com/script/KfqHqHUH-How-To-Input-CSV-List-Of-Symbol-Data-Used-For-Screener/'

feed(back) =>                                             // extract tickerid and decrement list of ticker IDs
    loop  = back                                          // declare string variable to hold content list
    getT  = string(na)                                    // declare string variable to hold tickerid
    if str.length(loop) == 0                              // if list is empty
        getT := string(na)                                // assign na to tickerid variable
        loop := string(na)                                // assign na to list of ticker Ids variable
    else                                                  // else extract first tickerid
        getP  = nz(str.pos(loop, ','), str.length(loop))  // get position of first comma or last character
        getT := str.substring(loop, 0, getP)              // get tickerid in first position of list
        loop := str.replace(loop, getT + ',', '')         // clear tickerid + delimiter character from list
    [getT, loop]                                          // return tickerid in first position & truncated list

[tid_001, out_001] = feed(i_symbols), [tid_002, out_002] = feed(out_001), [tid_003, out_003] = feed(out_002), [tid_004, out_004] = feed(out_003),
[tid_005, out_005] = feed(out_004), [tid_006, out_006] = feed(out_005), [tid_007, out_007] = feed(out_006), [tid_008, out_008] = feed(out_007),
[tid_009, out_009] = feed(out_008), [tid_010, out_010] = feed(out_009), [tid_011, out_011] = feed(out_010), [tid_012, out_012] = feed(out_011),
[tid_013, out_013] = feed(out_012), [tid_014, out_014] = feed(out_013), [tid_015, out_015] = feed(out_014), [tid_016, out_016] = feed(out_015),
[tid_017, out_017] = feed(out_016), [tid_018, out_018] = feed(out_017), [tid_019, out_019] = feed(out_018), [tid_020, out_020] = feed(out_019),
[tid_021, out_021] = feed(out_020), [tid_022, out_022] = feed(out_021), [tid_023, out_023] = feed(out_022), [tid_024, out_024] = feed(out_023),
[tid_025, out_025] = feed(out_024), [tid_026, out_026] = feed(out_025), [tid_027, out_027] = feed(out_026), [tid_028, out_028] = feed(out_027),
[tid_029, out_029] = feed(out_028), [tid_030, out_030] = feed(out_029), [tid_031, out_031] = feed(out_030), [tid_032, out_032] = feed(out_031),
[tid_033, out_033] = feed(out_032), [tid_034, out_034] = feed(out_033), [tid_035, out_035] = feed(out_034), [tid_036, out_036] = feed(out_035),
[tid_037, out_037] = feed(out_036), [tid_038, out_038] = feed(out_037), [tid_039, out_039] = feed(out_038), [tid_040, out_040] = feed(out_039)
//_______________________ Get Symbols End

// _____________________________ Screener Start
// Acknowledgement & Reference
// Trader: 'MUQWISHI'
// Indicator Title: 'Candlestick Patterns Screener [By MUQWISHI]'
// Indicator Link: 'https://www.tradingview.com/script/xiWQuGOq-Candlestick-Patterns-Screener-By-MUQWISHI/'

// Screener Conditions
bullish_cond = teritiary_long_signal
bearish_cond = teritiary_short_signal

// Define Bull and Bear Conditions
bull = not(i_scr_direction == "Bearish")
bear = not(i_scr_direction == "Bullish")

// Function for Screener Indicator Calculation
indicator_calculation() =>
    // Initialize variables
    price = float(na)
    _time = int(na)
    indicator = ""
    signal = int(na) 

    if barstate.isconfirmed
        // Check for Bearish Momentum Candle and conditions (Modify here to customize indicators)
        if i_scr_show_bear_mc and bearish_cond and bear 
            indicator := "▼"
            signal := -1

        // Check for Bullish Momentum Candle and conditions (Modify here to customize indicators)
        else if i_scr_show_bull_mc and bullish_cond and bull
            indicator := "▲"
            signal := 1

        // Update price and time if signal is not null
        if not na(signal)
            price := math.round_to_mintick(close)
            _time := time

    [_time, indicator, price, signal]

// Function to format time
format_time(x) =>
    timezone = syminfo.timezone
    timeframe.isintraday ? str.format_time(x, "HH:mm  dd-MM-yyyy", timezone) : str.format_time(x, "dd-MM-yyyy", timezone)

// Function to extract symbol name
symbol(s) => 
    array.get(str.split(s, ":"), 1)

// Matrix setup
var matrix = matrix.new<string>(0, 5, na)

// Function to add rows to the matrix
mtxFun(symbol, _time, indicator, price, signal) =>
    matrix.add_row(matrix, 0, array.from(symbol, _time, indicator, price, signal))

// Screener function to collect data
screener(s) =>
    sym = ticker.modify(s, syminfo.session)
    [_time, indicator, price, signal] = request.security(sym, timeframe.period, indicator_calculation())

    // Check if the signal is not na and the time matches
    if not na(signal) and _time == time
        symbolName = symbol(s)
        formattedTime = format_time(_time)
        strPrice = str.tostring(price)
        strSignal = str.tostring(signal)
        
        // Add data to the matrix
        mtxFun(symbolName, formattedTime, indicator, strPrice, strSignal)

// Call Screener function for multiple symbols
screener(tid_001), screener(tid_002), screener(tid_003), screener(tid_004), screener(tid_005), screener(tid_006), screener(tid_007),
screener(tid_008), screener(tid_009), screener(tid_010), screener(tid_011), screener(tid_012), screener(tid_013), screener(tid_014),
screener(tid_015), screener(tid_016), screener(tid_017), screener(tid_018), screener(tid_019), screener(tid_020), screener(tid_021),
screener(tid_022), screener(tid_023), screener(tid_024), screener(tid_025), screener(tid_026), screener(tid_027), screener(tid_028),
screener(tid_029), screener(tid_030), screener(tid_031), screener(tid_032), screener(tid_033), screener(tid_034), screener(tid_035),
screener(tid_036), screener(tid_037), screener(tid_038), screener(tid_039), screener(tid_040)

// Trim excess rows in the matrix
if matrix.rows(matrix) > i_tbl_disp_rows
    while matrix.rows(matrix) > i_tbl_disp_rows
        matrix.remove_row(matrix, matrix.rows(matrix)-1)

// Plot Table
// Create table with specified properties
var table tbl = table.new(position=i_tbl_position, columns=4, rows=102, border_width=1)

// Function to populate cells in the table
cell(col, row, txt, color) => 
    table.cell(tbl, col, row, text = txt, text_color = color, text_halign=text.align_left, bgcolor = color.new(color, 90), text_size=i_tbl_text_size)

// Check if it's the last bar
if barstate.islast
    // Clear existing data in the table
    table.clear(tbl, 0, 0, 3, 101)

    // Set headers for the table
    cell(0, 0, "Symbol", i_neu_col)
    cell(1, 0, "Time",   i_neu_col)
    cell(2, 0, "Dir" ,  i_neu_col)
    cell(3, 0, "Price",  i_neu_col)

    j = 1
    // Populate table with matrix data
    if matrix.rows(matrix) > 0
        for i = 0 to matrix.rows(matrix) - 1
            // Determine color based on the signal
            col = matrix.get(matrix, i, 4) ==  "1" ? i_pos_col :
                  matrix.get(matrix, i, 4) == "-1" ? i_neg_col : i_neu_col

            // Populate cells in the table
            cell(0, j, matrix.get(matrix, i, 0), col)
            cell(1, j, matrix.get(matrix, i, 1), col)
            cell(2, j, matrix.get(matrix, i, 2), col)
            cell(3, j, matrix.get(matrix, i, 3), col)

            j += 1
// _____________________________ Screener End
// _____________________________ Code End

// Read Me
//
// Title: Retracement to Order Block with Screener
// Date: Created on 14 January 2024
//
// One-liner:
// # The indicator aims to identify the candle returning to the order block through a screener.
//
// Important Notes:
// # This inicator does not strictly adhere to the 100% rules of ICT order block.
// # Due to coding limitations, only the core ideas of ICT concepts are implemented.
// # The screener won't identify the trend, so it is essential to confirm the direction independently.
// # The screener and the indicator may display inaccurate results.
// # Avoid blindly following the signals.
//
// Order Block identification (For those who are unfamiliar):
// # Identifying the lowest or highest candle that breaks the old lowest low or highest high, respectively.
// # If a candle closes above or below it, the lowest or highest candle can be considered as an order block.
// # Afterward, the price should move 2 or 3 times away from the order block candle.
// # After that, when the price returns to the close of the order block, it can be considered as an entry.
//
// Multi-timeframe Analysis for Trend Confirmation (For those who are unfamiliar):
// # Utilize three different timeframes for a comprehensive approach and trend confirmation.
// # For Positional use Monthly, Weekly, and Daily.
// # For Intraday or Swings use 1 Hour, 15 Minutes, and 5 Minutes.
//
// Learning Resource (For those who are unfamiliar):
// # For a more in-depth understanding, study the order block concept by Michael Joe Huddleston, popularly known as 'ICT' or 'The Inner Circle Trader'.
// # Due to the interrelated nature of various topics and jargon, it is recommended to watch the associated lessons for a more comprehensive understanding of entry and exit rules.
//
// How to Use the Indicator for Long:
// # Signal 1: This identifies the order block candle. It is a candle above 66% of the body that breaks the low of the past 30 candles.
// # Signal 2: It occurs when a momentum candle closes above the high of Signal 1 candle (order block).
// # Signal 3: Occurs when, after Signal 2 candle, the price returns to the high of the order block (Signal 1 candle).
//
// How to Use the Indicator for Short:
// # Signal 1: This identifies the order block candle. It is a candle above 66% of the body that breaks the high of the past 30 candles.
// # Signal 2: It occurs when a momentum candle closes below the low of Signal 1 candle (order block).
// # Signal 3: Occurs when, after Signal 2 candle, the price returns to the low of the order block (Signal 1 candle).
//
// Timeframe Considerations:
// # Period is the count of candles used to determine the highest high & lowest low.
// # The default period is set to 30, which works for all timeframes, but it is mainly optimized for 15m and 1h.
// # Experiment with other values as for different timeframes as per your requirement.
//
// How to use Vertical Offset:
// # Vertical offset acts as a buffer in case the price doesn't precisely hit the order block.
// # The default is 0, indicating no buffer. The 3rd signal appears only on a precise touch to the order block.
// # Example: If 'Vertical Offset (%)' is set to 50:
// # For Long it calculates a price 50% higher than the 1st candle's high.
// # For Short it calculates a price 50% lower than the 1st candle's low.
//
// The Screener and Its Limitations:
// # You can only upto 40 symbols in this format EXCHANGE:SYMBOL_A,EXCHANGE:SYMBOL_B
//
// # Note: Always exercise caution and discretion, considering market conditions and other factors, while using this indicator.

##-- File Name: PineScript-main/[Screener] ICT Retracement to Order Block with Screener.txt | File No: 2 | Ended --##

##-- File Name: PineScript-main/[Screener] Market Profile with Screener (Based on [RS]Market Profile by RicardoSantos).txt | File No: 3 | Started --##
// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © Arun_K_Bhaskar

// Acknowledgement & Reference
// Trader: 'RicardoSantos'
// Indicator Title: '[RS]Market Profile'
// Indicator Link: 'https://www.tradingview.com/script/uoysXxWM-RS-Market-Profile/'

//@version=5
indicator(title='Market Profile with Screener (Based on [RS]Market Profile by RicardoSantos)', shorttitle='Market Profile Screener', overlay=true, max_lines_count=300, max_boxes_count=300)

//_____________________________ Market Profile Start

//  ||--    Inputs:
g_mp='Market Profile'
string i_session_timeframe = input.string(defval='5D', title='Timeframe', group=g_mp)
float i_percent_of_tpo = input.float(defval=0.7, title='TPO %', group=g_mp)
int i_sessions = input.int(defval=1, title='Show Last', minval=0, maxval=40, group=g_mp)
color i_poc_col = input.color(defval=#EA738D, title='Point of Control', group=g_mp)
color i_va_col = input.color(defval=#89ABE3, title='Value Area', group=g_mp)
color i_open_col = input.color(defval=color.silver, title='Open', group=g_mp)
int i_mp_transp = input.int(defval=100, title='Transparency', minval=0, maxval=100, group=g_mp)

//  ||--    Extra Functions:
f_line_stack(_array, _max_elements, _new_element) =>
    int _size = array.size(_array)
    if _size >= _max_elements
        line.delete(array.pop(_array))
    array.unshift(_array, _new_element)
f_open_session_line(_x1, _y1, _x2, _y2) =>
    line.new(_x1, _y1, _x2, _y2, xloc=xloc.bar_time, color=i_open_col, style=line.style_dashed)

f_box_stack(_array, _max_elements, _new_element) =>
    int _size = array.size(_array)
    if _size >= _max_elements
        box.delete(array.pop(_array))
    array.unshift(_array, _new_element)

f_poc_box(_x1, _y1, _x2, _y2) =>
    box.new(_x1, _y1, _x2, _y2, border_color=i_poc_col, xloc=xloc.bar_time, bgcolor=color.new(i_poc_col, i_mp_transp))
f_vah_box(_x1, _y1, _x2, _y2) =>
    box.new(_x1, _y1, _x2, _y2, border_color=i_va_col, xloc=xloc.bar_time, bgcolor=color.new(i_va_col, i_mp_transp))

var line[] open_session_lines = array.new_line(0)
var box[] poc_boxes = array.new_box(0)
var box[] vah_boxes = array.new_box(0)

float tf_high = high
float tf_low = low
float tf_close = close

//  ||--    Bars since session started:
isnewsession = ta.change(time(i_session_timeframe)) != 0

var int session_bar_counter = 0
var int previous_session_start = na
var int previous_session_end = na
var int session_time_range = na

if isnewsession
    session_bar_counter := 0
    previous_session_start := previous_session_end
    previous_session_end := time
    session_time_range := previous_session_end - previous_session_start
    session_time_range
else
    session_bar_counter += 1
    session_bar_counter

//  ||--    session high, low, range:
var float session_high = tf_high
var float session_low = tf_low
var float session_range = tf_high - tf_low

//      ||--    recalculate session high, low and range:
if session_bar_counter == 0
    session_high := tf_high
    session_low := tf_low
    session_range := tf_high - tf_low
    session_range
if tf_high > session_high[1]
    session_high := tf_high
    session_range := session_high - session_low
    session_range
if tf_low < session_low[1]
    session_low := tf_low
    session_range := session_high - session_low
    session_range

//  ||--    define tpo section range:
tpo_section_range = session_range / 20

//  ||--    function to get the frequency a specified range is visited:
f_frequency_of_range(_src, _upper_range, _lower_range, _length) =>
    _adjusted_length = _length < 1 ? 1 : _length
    _frequency = 0
    for _i = 0 to _adjusted_length - 1 by 1
        if _src[_i] >= _lower_range and _src[_i] < _upper_range
            _frequency += 1
            _frequency
    _return = nz(_frequency, 0)  // _adjusted_length
    _return

//  ||--    frequency the tpo range is visited:
tpo_00 = f_frequency_of_range(tf_close, session_high, session_high - tpo_section_range * 1, session_bar_counter)
tpo_01 = f_frequency_of_range(tf_close, session_high - tpo_section_range * 1, session_high - tpo_section_range * 2, session_bar_counter)
tpo_02 = f_frequency_of_range(tf_close, session_high - tpo_section_range * 2, session_high - tpo_section_range * 3, session_bar_counter)
tpo_03 = f_frequency_of_range(tf_close, session_high - tpo_section_range * 3, session_high - tpo_section_range * 4, session_bar_counter)
tpo_04 = f_frequency_of_range(tf_close, session_high - tpo_section_range * 4, session_high - tpo_section_range * 5, session_bar_counter)
tpo_05 = f_frequency_of_range(tf_close, session_high - tpo_section_range * 5, session_high - tpo_section_range * 6, session_bar_counter)
tpo_06 = f_frequency_of_range(tf_close, session_high - tpo_section_range * 6, session_high - tpo_section_range * 7, session_bar_counter)
tpo_07 = f_frequency_of_range(tf_close, session_high - tpo_section_range * 7, session_high - tpo_section_range * 8, session_bar_counter)
tpo_08 = f_frequency_of_range(tf_close, session_high - tpo_section_range * 8, session_high - tpo_section_range * 9, session_bar_counter)
tpo_09 = f_frequency_of_range(tf_close, session_high - tpo_section_range * 9, session_high - tpo_section_range * 10, session_bar_counter)
tpo_10 = f_frequency_of_range(tf_close, session_high - tpo_section_range * 10, session_high - tpo_section_range * 11, session_bar_counter)
tpo_11 = f_frequency_of_range(tf_close, session_high - tpo_section_range * 11, session_high - tpo_section_range * 12, session_bar_counter)
tpo_12 = f_frequency_of_range(tf_close, session_high - tpo_section_range * 12, session_high - tpo_section_range * 13, session_bar_counter)
tpo_13 = f_frequency_of_range(tf_close, session_high - tpo_section_range * 13, session_high - tpo_section_range * 14, session_bar_counter)
tpo_14 = f_frequency_of_range(tf_close, session_high - tpo_section_range * 14, session_high - tpo_section_range * 15, session_bar_counter)
tpo_15 = f_frequency_of_range(tf_close, session_high - tpo_section_range * 15, session_high - tpo_section_range * 16, session_bar_counter)
tpo_16 = f_frequency_of_range(tf_close, session_high - tpo_section_range * 16, session_high - tpo_section_range * 17, session_bar_counter)
tpo_17 = f_frequency_of_range(tf_close, session_high - tpo_section_range * 17, session_high - tpo_section_range * 18, session_bar_counter)
tpo_18 = f_frequency_of_range(tf_close, session_high - tpo_section_range * 18, session_high - tpo_section_range * 19, session_bar_counter)
tpo_19 = f_frequency_of_range(tf_close, session_high - tpo_section_range * 19, session_high - tpo_section_range * 20, session_bar_counter)
tpo_20 = f_frequency_of_range(tf_close, session_high - tpo_section_range * 20, session_high - tpo_section_range * 21, session_bar_counter)

//  ||--    function to retrieve a specific tpo value
f_get_tpo_count(_value) =>
    _return = switch (_value)
        0 => tpo_00
        1 => tpo_01
        2 => tpo_02
        3 => tpo_03
        4 => tpo_04
        5 => tpo_05
        6 => tpo_06
        7 => tpo_07
        8 => tpo_08
        9 => tpo_09
        10 => tpo_10
        11 => tpo_11
        12 => tpo_12
        13 => tpo_13
        14 => tpo_14
        15 => tpo_15
        16 => tpo_16
        17 => tpo_17
        18 => tpo_18
        19 => tpo_19
        20 => tpo_20
        => 0.0

tpo_sum = 0.0
current_poc_position = 0.0
current_poc_value = 0.0

for _i = 0 to 20 by 1
    _get_tpo_value = f_get_tpo_count(_i)
    tpo_sum += _get_tpo_value
    if _get_tpo_value >= current_poc_value
        current_poc_position := _i
        current_poc_value := _get_tpo_value
        current_poc_value

poc_upper = session_high - tpo_section_range * current_poc_position
poc_lower = session_high - tpo_section_range * (current_poc_position + 1)

//  ||--    get value area high/low
vah_position = current_poc_position
val_position = current_poc_position
current_sum = current_poc_value

for _i = 0 to 20 by 1
    if current_sum < tpo_sum * i_percent_of_tpo
        vah_position := math.max(0, vah_position - 1)
        current_sum += f_get_tpo_count(math.round(vah_position))
        current_sum
    if current_sum < tpo_sum * i_percent_of_tpo
        val_position := math.min(20, val_position + 1)
        current_sum += f_get_tpo_count(math.round(val_position))
        current_sum

vah_value = session_high - tpo_section_range * vah_position
val_value = session_high - tpo_section_range * (val_position + 1)

if isnewsession
    f_box_stack(vah_boxes, i_sessions, f_vah_box(previous_session_end, vah_value[1], time_close(i_session_timeframe), val_value[1]))
    f_box_stack(poc_boxes, i_sessions, f_poc_box(previous_session_end, poc_upper[1], time_close(i_session_timeframe), poc_lower[1]))
    f_line_stack(open_session_lines, i_sessions, f_open_session_line(previous_session_end, open, time_close(i_session_timeframe), open))

// Function to get the pivot value
vahl_pivot_value(src) =>
    ta.valuewhen(session_bar_counter == 0, src[1], 0)

// Get VAH and VAL pivots
vah_pivot = vahl_pivot_value(vah_value)
val_pivot = vahl_pivot_value(val_value)
poc_pivot = vahl_pivot_value(math.avg(poc_upper, poc_lower))

// Calculate percentage between VAH and VAL
va_percent = ((vah_pivot - val_pivot) / val_pivot) * 100
poc_percent = ((close - poc_pivot) / poc_pivot) * 100
//_____________________________ Market Profile End


//_____________________________ Screener Start

// Note:
// - TradingView allows up to 40 requests per indicator, so keep the number of symbols below 40.
// - Too many requests and complex calculations may slow down the indicator.
// - You can combine multiple indicators in one script, like Close crossing above EMA 20, RSI crossing 60, etc.

//_____________________________ Menu Screener Table Start

g_tb = 'Screener : Table'
tt_is = //"• Input exactly 40 symbols, nothing more or less." +
     "• Total characters cannot exceed 4096." +
     "\n• Use comma as delimiter without any space." +
     "\n• Eg: 'EXCHANGE:SYMBOL_A,EXCHANGE:SYMBOL_B'"

string i_symbols = input.text_area(
 defval='NSE:ADANIPOWER,NSE:ARVIND,NSE:ASHOKA,NSE:BANKINDIA,NSE:BLS,NSE:BOMDYEING,NSE:CUB,NSE:DBL,NSE:DELTACORP,NSE:ENGINERSIN,NSE:GIPCL,NSE:GMDCLTD,NSE:GPPL,NSE:HINDCOPPER,NSE:INDIACEM,NSE:INOXWIND,NSE:IPL,NSE:IRCON,NSE:ITI,NSE:JAMNAAUTO,NSE:JKTYRE,NSE:KESORAMIND,NSE:LEMONTREE,NSE:MOIL,NSE:MRPL,NSE:NLCINDIA,NSE:ONMOBILE,NSE:PFC,NSE:PPLPHARMA,NSE:PTC,NSE:RAILTEL,NSE:RCF,NSE:RVNL,NSE:SHRIRAMPPS,NSE:TI,NSE:WELCORP,NSE:L_TFH,NSE:WOCKPHARMA,NSE:ZOMATO',
 title="Paste Symbols", tooltip=tt_is, group=g_tb)

float i_va_above = input.float(defval=0, title='VA % Between', minval=0, maxval=100, inline='1', group=g_tb)
float i_va_below = input.float(defval=3, title='', minval=0, maxval=100, inline='1', group=g_tb)

float i_ltp_above = input.float(defval=-10, title='LTP % Between', inline='2', group=g_tb)
float i_ltp_below = input.float(defval=10, title='', inline='2', group=g_tb)


int i_tbl_disp_rows = input.int(defval=15, title='Display Rows', minval=0, maxval=100, group=g_tb)
string i_tbl_position = input.string(defval=position.bottom_left, title='Position', options=[position.top_left, position.top_center, position.top_right, position.middle_left, position.middle_center, position.middle_right, position.bottom_left, position.bottom_center, position.bottom_right], group=g_tb)
string i_tbl_text_size = input.string(defval=size.small, title='Size', options=[size.auto, size.tiny, size.small, size.normal, size.large, size.huge], group=g_tb)

color i_tbl_neu_col = input.color(defval=#B2B5BE, title='Color', group=g_tb)

//_____________________________ Menu Screener Table End

//_______________________ Get Symbols Start

// Acknowledgement & Reference
// Trader: 'allanster'
// Indicator Title: 'How To Input CSV List Of Symbol Data Used For Screener'
// Indicator Link: 'https://www.tradingview.com/script/KfqHqHUH-How-To-Input-CSV-List-Of-Symbol-Data-Used-For-Screener/'

feed(back) =>                                             // extract tickerid and decrement list of ticker IDs
    loop  = back                                          // declare string variable to hold content list
    getT  = string(na)                                    // declare string variable to hold tickerid
    if str.length(loop) == 0                              // if list is empty
        getT := string(na)                                // assign na to tickerid variable
        loop := string(na)                                // assign na to list of ticker Ids variable
    else                                                  // else extract first tickerid
        getP  = nz(str.pos(loop, ','), str.length(loop))  // get position of first comma or last character
        getT := str.substring(loop, 0, getP)              // get tickerid in first position of list
        loop := str.replace(loop, getT + ',', '')         // clear tickerid + delimiter character from list
    [getT, loop]                                          // return tickerid in first position & truncated list

[tid_001, out_001] = feed(i_symbols), [tid_002, out_002] = feed(out_001), [tid_003, out_003] = feed(out_002), [tid_004, out_004] = feed(out_003),
[tid_005, out_005] = feed(out_004), [tid_006, out_006] = feed(out_005), [tid_007, out_007] = feed(out_006), [tid_008, out_008] = feed(out_007),
[tid_009, out_009] = feed(out_008), [tid_010, out_010] = feed(out_009), [tid_011, out_011] = feed(out_010), [tid_012, out_012] = feed(out_011),
[tid_013, out_013] = feed(out_012), [tid_014, out_014] = feed(out_013), [tid_015, out_015] = feed(out_014), [tid_016, out_016] = feed(out_015),
[tid_017, out_017] = feed(out_016), [tid_018, out_018] = feed(out_017), [tid_019, out_019] = feed(out_018), [tid_020, out_020] = feed(out_019),
[tid_021, out_021] = feed(out_020), [tid_022, out_022] = feed(out_021), [tid_023, out_023] = feed(out_022), [tid_024, out_024] = feed(out_023),
[tid_025, out_025] = feed(out_024), [tid_026, out_026] = feed(out_025), [tid_027, out_027] = feed(out_026), [tid_028, out_028] = feed(out_027),
[tid_029, out_029] = feed(out_028), [tid_030, out_030] = feed(out_029), [tid_031, out_031] = feed(out_030), [tid_032, out_032] = feed(out_031),
[tid_033, out_033] = feed(out_032), [tid_034, out_034] = feed(out_033), [tid_035, out_035] = feed(out_034), [tid_036, out_036] = feed(out_035),
[tid_037, out_037] = feed(out_036), [tid_038, out_038] = feed(out_037), [tid_039, out_039] = feed(out_038), [tid_040, out_040] = feed(out_039)

//_______________________ Get Symbols End

// _____________________________ Screener Start

// Acknowledgement & Reference
// Trader: 'MUQWISHI'
// Indicator Title: 'Candlestick Patterns Screener [By MUQWISHI]'
// Indicator Link: 'https://www.tradingview.com/script/xiWQuGOq-Candlestick-Patterns-Screener-By-MUQWISHI/'

// Function for Screener Indicator Calculation

screener_condition = va_percent > i_va_above and va_percent <= i_va_below and poc_percent <= i_ltp_below and poc_percent >= i_ltp_above

truncate(number, decimals) =>
    factor = math.pow(10, decimals)
    int(number * factor) / factor

indicator_calculation() =>
    // Initialize variables
    percent = float(na)
    _time = int(na)
    pchg = float(na)

    if screener_condition
        percent := truncate(va_percent, 2)
        _time := time
        pchg := truncate(poc_percent, 2)

    [_time, percent, pchg]

// Function to format time
format_time(x) =>
    timezone = syminfo.timezone
    timeframe.isintraday ? str.format_time(x, "HH:mm  dd-MM-yyyy", timezone) : str.format_time(x, "dd-MM-yyyy", timezone)

// Function to extract symbol name
symbol(s) => 
    array.get(str.split(s, ":"), 1)

// Matrix setup
var matrix = matrix.new<string>(0, 4, na)

// Function to add rows to the matrix
mtxFun(symbol, _time, percent, pchg) =>
    matrix.add_row(matrix, 0, array.from(symbol, _time, percent, pchg))

// Screener function to collect data
screener(s) =>
    sym = ticker.modify(s, syminfo.session)
    [_time, percent, pchg] = request.security(sym, timeframe.period, indicator_calculation())

    // Check if the signal is not na and the time matches
    if _time == time
        mtxFun(symbol(s), format_time(_time), str.tostring(percent), str.tostring(pchg))

// Call Screener function for multiple symbols
screener(tid_001), screener(tid_002), screener(tid_003), screener(tid_004), screener(tid_005), screener(tid_006), screener(tid_007),
screener(tid_008), screener(tid_009), screener(tid_010), screener(tid_011), screener(tid_012), screener(tid_013), screener(tid_014),
screener(tid_015), screener(tid_016), screener(tid_017), screener(tid_018), screener(tid_019), screener(tid_020), screener(tid_021),
screener(tid_022), screener(tid_023), screener(tid_024), screener(tid_025), screener(tid_026), screener(tid_027), screener(tid_028),
screener(tid_029), screener(tid_030), screener(tid_031), screener(tid_032), screener(tid_033), screener(tid_034), screener(tid_035),
screener(tid_036), screener(tid_037), screener(tid_038), screener(tid_039), screener(tid_040)

// Trim excess rows in the matrix
if matrix.rows(matrix) > i_tbl_disp_rows
    while matrix.rows(matrix) > i_tbl_disp_rows
        matrix.remove_row(matrix, matrix.rows(matrix)-1)

// Plot Table
// Create table with specified properties
var table tbl = table.new(position=i_tbl_position, columns=4, rows=102, border_width=1)

tt_tbl = "Time: Signal generation time.\n" +
     "% VAHL: Percentage between VAH & VAL.\n" +
     "% LTP: Percentage change from POC mid to LTP."

// Function to populate cells in the table
cell(col, row, txt, color) => 
    table.cell(tbl, col, row, text = txt, text_color = color, text_halign=text.align_left, bgcolor = color.new(color, 80), text_size=i_tbl_text_size, tooltip=tt_tbl)

// Check if it's the last bar
if barstate.islast
    // Clear existing data in the table
    table.clear(tbl, 0, 0, 3, 101)

    // Set headers for the table
    cell(0, 0, "Symbol", i_tbl_neu_col)
    cell(1, 0, "Time",   i_tbl_neu_col)
    cell(2, 0, "% VAHL" ,  i_tbl_neu_col)
    cell(3, 0, "% LTP" ,  i_tbl_neu_col)

    j = 1
    // Populate table with matrix data
    if matrix.rows(matrix) > 0
        for i = 0 to matrix.rows(matrix) - 1
            // Populate cells in the table
            cell(0, j, matrix.get(matrix, i, 0), i_tbl_neu_col)
            cell(1, j, matrix.get(matrix, i, 1), i_tbl_neu_col)
            cell(2, j, matrix.get(matrix, i, 2), i_tbl_neu_col)
            cell(3, j, matrix.get(matrix, i, 3), i_tbl_neu_col)

            j += 1

// _____________________________ Screener End
// _____________________________ Code End

##-- File Name: PineScript-main/[Screener] Market Profile with Screener (Based on [RS]Market Profile by RicardoSantos).txt | File No: 3 | Ended --##

##-- File Name: PineScript-main/ICT Displacement Candles/[Indicator] ICT Displacement Candles.txt | File No: 4 | Started --##
// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © Arun_K_Bhaskar

//@version=6
indicator(title = 'ICT Displacement Candles Indicator', shorttitle = 'ICTDC', overlay = true, max_lines_count = 500, max_labels_count = 500, behind_chart = false)

//___________________________ Menu Start

string g_scn_tb = '█████████████████ Scanner █████████████████'

string tt_ch = 
 "Displacement:" + 
 "\n• Strong, sudden price move (up/down) with long candles, minimal wicks." + 

 "\n\n Retracement:" + 
 "\n• Price retraces to a Fibonacci level of the displacement." +
 "\n• Potential entry point for trend continuation."

string tt_is = 
 "• Reads only the first 40 symbols." + 
 "\n• Max 4096 characters." + 
 "\n• Format: EXCHANGE:SYMBOL_A,EXCHANGE:SYMBOL_B"

string i_scn_choose = input.string(
 defval = 'Displacement', 
 title = 'Scanning Method', 
 options = ['Displacement', 'Retracement'], tooltip = tt_ch, group = g_scn_tb)

bool i_scn_show_long = input.bool(defval = true, title = 'Long Signals', inline = 'tb_2', group = g_scn_tb)
bool i_scn_show_short = input.bool(defval = true, title = 'Short Signals', inline = 'tb_2', group = g_scn_tb)

string g_dc = '████████████ Displacement Candles ████████████'

string tt_mb = "Shows if bars exceed the set value."
string tt_dev = "Specifies the minimal size of displament, as a percentage of the average high-low range for the last 14 bars."
string tt_ret_fib = 
 "• 0: Top of bullish & bottom of bearish displacement." + 
 "\n• 1: Bottom of bullish & top of bearish displacement." + 
 "\n• 0.5: 50% of the displacement."

int i_dc_min_bars = input.int(defval = 3, title = 'Minimum Bars', minval = 1, tooltip = tt_mb, group = g_dc)
float i_dc_dev_percent = nz(input.float(60.0, "Minimal Deviation (%)", minval=1, step = 10, tooltip = tt_dev, group = g_dc) / 100 * ta.sma(high-low, 14))
bool i_dc_close_filter = input.bool(defval = true, title = 'Apply Close Above/Below Prev Close', group = g_dc)
bool i_dc_hl_filter = input.bool(defval = false, title = 'Apply Close Above/Below Prev High/Low', group = g_dc)
float i_dc_fib_val = input.float(defval = 0.5, title = 'Fibonacci Value', step = 0.1, tooltip = tt_ret_fib, group = g_dc)

string g_af = '██████████████ Additional Fiters ██████████████'

string tt_atr = "• Filters out longer or more volatile displacement candles."
string tt_atr_mul = "• Higher values filter longer or more volatile candles."
string tt_bf = "• 80 means the body covers 80%+ of the displacement candle."
string tt_tf = "• Filter signals within a given time."
string tt_df = "• Filter signals on specified dates (for Retracement Candles only)."

bool i_atr_filter = input.bool(defval = false, title = 'Apply ATR Filter', tooltip = tt_atr, group = g_af)
int i_atr_length = input.int(defval = 14, minval = 1, title = 'ATR Length', group = g_af)
float i_atr_multi = input.float(defval = 1, title = 'ATR Multiplier', minval = 1, group = g_af)

bool i_body_filter = input.bool(defval = false, title = 'Apply Body % Filter', tooltip = tt_bf, group = g_af)
float i_body_percent = input.float(defval = 70, title = 'Body % Above', minval = 0, maxval = 100, group = g_af) / 100

bool i_time_filter = input.bool(defval = false, title = 'Apply Time Filter', tooltip = tt_tf, group = g_af)
int i_hour_1 = input.int(defval = 9, minval = 0, title = 'Time From', inline = 't_1', group = g_af)
int i_minute_1 = input.int(defval = 15, minval = 0, title = ':', inline = 't_1', group = g_af)
int i_hour_2 = input.int(defval = 10, minval = 0, title = 'Time To ', inline = 't_2', group = g_af)
int i_minute_2 = input.int(defval = 15, minval = 0, title = ':', inline = 't_2', group = g_af)

bool i_date_filter = input.bool(defval = false, title = 'Apply Date Filter', tooltip = tt_df, group = g_af)
int i_day = input.int(defval = 30, minval = 1, maxval = 31, title = 'Day', group = g_af)
int i_month = input.int(defval = 3, minval = 1, maxval = 12, title = 'Month', group = g_af)
int i_year = input.int(defval = 2025, minval = 0, title = 'Year', group = g_af)

string g_cum = '█████████████ Performance Table █████████████'

bool i_cum_tbl_disp = input.bool(defval = true, title = 'Display', group = g_cum)
string i_cum_tbl_pos = input.string(defval = position.bottom_right, title = 'Position', options = [position.top_left, position.top_center, position.top_right, position.middle_left, position.middle_center, position.middle_right, position.bottom_left, position.bottom_center, position.bottom_right], group = g_cum)
string i_cum_tbl_size = input.string(defval = size.normal, title = 'Size', options = [size.auto, size.tiny, size.small, size.normal, size.large, size.huge], group = g_cum)

//string g_ch = '█████████████████ Colors █████████████████'
color i_pos_color = #089981 //input.color(defval = #089981, title = 'Positive', group = g_ch)
color i_pos_light_color = #70CCBD //input.color(defval = #70CCBD, title = 'Positive Light', group = g_ch)
color i_neg_light_color = #FAA1A4 //input.color(defval = #FAA1A4, title = 'Negative Light', group = g_ch)
color i_neg_color = #F23645 //input.color(defval = #F23645, title = 'Negative', group = g_ch)
color i_neu_dark_color = #0F0F0F //input.color(defval = #0F0F0F, title = 'Neutral', group = g_ch)

//___________________________ Menu End

//___________________________ Performance Start

is_new_day = ta.change(time('D')) != 0

// Cumulative Percentage Change
var float cum_pchg = na
day_pchg = na(close[1]) ? 0 : (close - close[1]) / close[1] * 100
cum_pchg := is_new_day ? day_pchg : na(cum_pchg) ? day_pchg : cum_pchg + day_pchg

// Cumulative Volume and Volume Percentage Change
var float curr_cum_vol = na
var float prev_cum_vol = na
if is_new_day
    prev_cum_vol := curr_cum_vol
    curr_cum_vol := volume
    curr_cum_vol
else
    curr_cum_vol := na(curr_cum_vol) ? volume : curr_cum_vol + volume
    curr_cum_vol
prev_vol_safe = nz(prev_cum_vol, curr_cum_vol)
cum_vol_pchg = (curr_cum_vol - prev_vol_safe) / prev_vol_safe * 100

var table tbl_cum = table.new(position=i_cum_tbl_pos, columns=2, rows=4, border_width=1, force_overlay=true)

cell_perform(col, row, txt, txt_color, aligh) =>
    table.cell(tbl_cum, col, row, txt, text_color=txt_color, text_halign=aligh, bgcolor=i_neu_dark_color, text_size=i_cum_tbl_size)

if barstate.islast and i_cum_tbl_disp
    pchg_col = cum_pchg > 0 ? i_pos_color : i_neg_color
    vol_pchg_col = cum_vol_pchg > 0 ? i_pos_color : i_neg_color
    prev_vol_pchg_col = prev_vol_safe < curr_cum_vol ? i_neg_color : i_pos_color
    
    cell_perform(0, 0, '%Chg', chart.fg_color, text.align_left)
    cell_perform(1, 0, str.tostring(cum_pchg, '#.##') + ' %', pchg_col, text.align_right)
    cell_perform(0, 1, 'Vol %Chg', chart.fg_color, text.align_left)
    cell_perform(1, 1, str.tostring(cum_vol_pchg, '#.##') + ' %', vol_pchg_col, text.align_right)
    cell_perform(0, 2, 'Vol', chart.fg_color, text.align_left)
    cell_perform(1, 2, str.tostring(curr_cum_vol / 100000, '#.##') + ' L', vol_pchg_col, text.align_right)
    cell_perform(0, 3, 'PD Vol', chart.fg_color, text.align_left)
    cell_perform(1, 3, str.tostring(prev_vol_safe / 100000, '#.##') + ' L', prev_vol_pchg_col, text.align_right)

//___________________________ Performance End

//___________________________ Additional Filters Start

// Pre-calculate common values
candle_range = high - low
body_size = math.abs(close - open)

// ATR Filter
atr_filter = not i_atr_filter or candle_range > ta.atr(i_atr_length) * i_atr_multi

// Body Filters
body_filter = not i_body_filter or candle_range > 0 and body_size / candle_range >= i_body_percent

// Time Filter
time_filter = 
 not i_time_filter or 
 (hour > i_hour_1 or hour == i_hour_1 and minute >= i_minute_1) and 
 (hour < i_hour_2 or hour == i_hour_2 and minute < i_minute_2)

// Date Filter
date_filter = not i_date_filter or year == i_year and month == i_month and dayofmonth == i_day

//___________________________ Additional Filters End

//___________________________ Displacement Candles Start

// Combined tracking variables
var int bullCnt = 0
var int bearCnt = 0
var float bullHi = na
var float bullLo = na
var float bearHi = na
var float bearLo = na
var float bullFib = na
var float bearFib = na
var bullHighs = array.new_float()
var bullLows = array.new_float()
var bearHighs = array.new_float()
var bearLows = array.new_float()

// Conditions and filters combined
float priceChg = (high - low)
bool bullish = priceChg >= i_dc_dev_percent and close > open and (not i_dc_close_filter or close > close[1]) and (not i_dc_hl_filter or close > high[1]) and atr_filter
bool bearish = priceChg >= i_dc_dev_percent and close < open and (not i_dc_close_filter or close < close[1]) and (not i_dc_hl_filter or close < low[1]) and atr_filter

// Optimized counting and array management
if bullish
    bullCnt := bullCnt + 1
    bearCnt := 0
    array.push(bullHighs, high)
    array.push(bullLows, low)
    if bullCnt == 1
        array.clear(bearHighs)
        array.clear(bearLows)
else if bearish
    bearCnt := bearCnt + 1
    bullCnt := 0
    array.push(bearHighs, high)
    array.push(bearLows, low)
    if bearCnt == 1
        array.clear(bullHighs)
        array.clear(bullLows)
else
    bullCnt := 0
    bearCnt := 0
    array.clear(bullHighs)
    array.clear(bullLows)
    array.clear(bearHighs)
    array.clear(bearLows)

// Calculate high-low range and percentage
float bullRange = na
float bearRange = na
float bullRangePercent = na
float bearRangePercent = na

if bullCnt >= i_dc_min_bars
    bullHi := array.max(bullHighs)
    bullLo := array.min(bullLows)
    bullRange := bullHi - bullLo
    bullRangePercent := (bullRange / bullLo) * 100
    bullFib := bullHi - (bullHi - bullLo) * i_dc_fib_val
if bearCnt >= i_dc_min_bars
    bearHi := array.max(bearHighs)
    bearLo := array.min(bearLows)
    bearRange := bearHi - bearLo
    bearRangePercent := (bearRange / bearLo) * 100
    bearFib := bearLo + (bearHi - bearLo) * i_dc_fib_val

bearMaxCnt = bearCnt[1] >= i_dc_min_bars and bearCnt == 0
bullMaxCnt = bullCnt[1] >= i_dc_min_bars and bullCnt == 0

// Plot
if bearMaxCnt and i_scn_show_short
    label.new(x = bar_index[1], y = low[1], text = str.tostring(bearCnt[1]), color = na, textcolor = i_neg_light_color, size = size.small, style = label.style_label_up, yloc = yloc.belowbar)
//    label.new(x = bar_index[1], y = low[1], text = str.format("{0,number,#.##}%", bearRangePercent[1]), color = na, textcolor = i_neg_light_color, size = size.small, style = label.style_label_up, yloc = yloc.belowbar)

if bullMaxCnt and i_scn_show_long
    label.new(x = bar_index[1], y = high[1], text = str.tostring(bullCnt[1]), color = na, textcolor = i_pos_light_color, size = size.small, style = label.style_label_down, yloc = yloc.abovebar)
//    label.new(x = bar_index[1], y = high[1], text = str.format("{0,number,#.##}%", bullRangePercent[1]), color = na, textcolor = i_pos_light_color, size = size.small, style = label.style_label_down, yloc = yloc.abovebar)

// Plot counts
//if bearCnt >= i_dc_min_bars and i_scn_show_short
//    label.new(x = bar_index, y = low, text = str.tostring(bearCnt), color = na, textcolor = i_neg_light_color, size = size.small, style = label.style_label_up, yloc = yloc.belowbar)
//if bullCnt >= i_dc_min_barst and i_scn_show_long
//    label.new(x = bar_index, y = high, text = str.tostring(bullCnt), color = na, textcolor = i_pos_light_color, size = size.small, style = label.style_label_down, yloc = yloc.abovebar)

plot(series = bearFib, title = 'Bearish Fib Line', color = i_neg_color, style = plot.style_stepline, display = display.none)
plot(series = bullFib, title = 'Bullish Fib Line', color = i_pos_color, style = plot.style_stepline, display = display.none)

// Track the final count before reset
var int lastBullCnt = 0
var int lastBearCnt = 0

// Update when sequence ends
if bullMaxCnt
    lastBullCnt := bullCnt[1]
if bearMaxCnt
    lastBearCnt := bearCnt[1]

// Retracement tracking combined
var bool bullActive = false
var bool bearActive = false
var bool bullDone = false
var bool bearDone = false
var int bullBar = na
var int bearBar = na
var int bullStart = na
var int bearStart = na
var float bullLow = na
var float bearHigh = na
var line bullLine = na
var line bearLine = na

// Activate sequences
if bullCnt >= i_dc_min_bars and bullCnt[1] < i_dc_min_bars
    bullActive := true
    bearActive := false
    bullDone := false
    bearDone := false
    bullStart := bar_index - bullCnt + 1
if bearCnt >= i_dc_min_bars and bearCnt[1] < i_dc_min_bars
    bearActive := true
    bullActive := false
    bearDone := false
    bullDone := false
    bearStart := bar_index - bearCnt + 1

// Detect and mark retracements
bool bearRet = bearActive and not bearDone and ta.crossover(high, bearFib) and high[1] < bearFib and time_filter and date_filter
bool bullRet = bullActive and not bullDone and ta.crossunder(low, bullFib) and low[1] > bullFib and time_filter and date_filter
if bearRet and i_scn_choose == 'Retracement' and i_scn_show_short
    bearDone := true
    bearBar := bar_index
    bearHigh := high
    bearLine := line.new(x1 = bearStart, y1 = bearFib, x2 = bearBar, y2 = bearFib, color = i_neg_light_color, style = line.style_dotted)
if bullRet and i_scn_choose == 'Retracement' and i_scn_show_long
    bullDone := true
    bullBar := bar_index
    bullLow := low
    bullLine := line.new(x1 = bullStart, y1 = bullFib, x2 = bullBar, y2 = bullFib, color = i_pos_light_color, style = line.style_dotted)

// Plot signals
plotshape(i_scn_show_short and i_scn_choose == 'Retracement' ? bearRet : false, title = 'Bearish Retracement', style = shape.triangledown, location = location.abovebar, color = i_neg_light_color, size = size.tiny)
plotshape(i_scn_show_long and i_scn_choose == 'Retracement' ? bullRet : false, title = 'Bullish Retracement', style = shape.triangleup, location = location.belowbar, color = i_pos_light_color, size = size.tiny)
barcolor(i_scn_show_short and i_scn_choose == 'Retracement' and bearRet ? i_neg_light_color : i_scn_show_long and i_scn_choose == 'Retracement' and bullRet ? i_pos_light_color : na, title = 'Retracement Candle')

//___________________________ Displacement Candles End

//___________________________ Code End

// Readme
// 
// Indicator Title: "ICT Displacement Candles Scanner"
// 
// Overview
// - A price action trading method based on strong price moves (displacement).
// - Helps identify trend direction and potential trade entries.
//
// Features
// - Scanning Methods:
//   - Displacement: Strong, sudden price move (up/down) with long candles, minimal wicks.
//   - Retracement: Price retraces to a Fibonacci level of the displacement.
//
// How to Use?
// 1. Identify Displacement: Look for strong price movement after liquidity is taken.
// 2. Wait for Retracement: Use Fibonacci to find entry levels (e.g., 61.8%).
// 3. Confirm with Order Blocks or Fair Value Gap(FVG): Ensure price reacts at an institutional level.
// 4. Enter Trade: Buy or sell based on trend continuation signals.
// 5. Set Targets: Aim for the next liquidity zone.
//
// Note: Read tooltips for more clarity.
// 
// Questions?: Message the author on TradingView: https://www.tradingview.com/u/Arun_K_Bhaskar/
// 
// More Indicators: Free TradingView indicators and source code on GitHub: https://github.com/ArunKBhaskar/PineScript

##-- File Name: PineScript-main/ICT Displacement Candles/[Indicator] ICT Displacement Candles.txt | File No: 4 | Ended --##

##-- File Name: PineScript-main/ICT Displacement Candles/[Readme] ICT Displacement Candles.txt | File No: 5 | Started --##
// Readme
// 
// Indicator Title: "ICT Displacement Candles Scanner"
// 
// Overview
// - A price action trading method based on strong price moves (displacement).
// - Helps identify trend direction and potential trade entries.
//
// Features
// - Scanning Methods:
//   - Displacement: Strong, sudden price move (up/down) with long candles, minimal wicks.
//   - Retracement: Price retraces to a Fibonacci level of the displacement.
//
// How to Use?
// 1. Identify Displacement: Look for strong price movement after liquidity is taken.
// 2. Wait for Retracement: Use Fibonacci to find entry levels (e.g., 61.8%).
// 3. Confirm with Order Blocks or Fair Value Gap(FVG): Ensure price reacts at an institutional level.
// 4. Enter Trade: Buy or sell based on trend continuation signals.
// 5. Set Targets: Aim for the next liquidity zone.
//
// Note: Read tooltips for more clarity.
// 
// Questions?: Message the author on TradingView: https://www.tradingview.com/u/Arun_K_Bhaskar/
// 
// More Indicators: Free TradingView indicators and source code on GitHub: https://github.com/ArunKBhaskar/PineScript
##-- File Name: PineScript-main/ICT Displacement Candles/[Readme] ICT Displacement Candles.txt | File No: 5 | Ended --##

##-- File Name: PineScript-main/ICT Displacement Candles/[Scanner] ICT Displacement Candles.txt | File No: 6 | Started --##
// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © Arun_K_Bhaskar

//@version=6
indicator(title = 'ICT Displacement Candles Scanner', shorttitle = 'ICTDCScan', overlay = true, max_lines_count = 500, max_labels_count = 500, behind_chart = false)

//___________________________ Menu Start

string g_scn_tb = '█████████████████ Scanner █████████████████'

string tt_ch = 
 "Displacement:" + 
 "\n• Strong, sudden price move (up/down) with long candles, minimal wicks." + 

 "\n\n Retracement:" + 
 "\n• Price retraces to a Fibonacci level of the displacement." +
 "\n• Potential entry point for trend continuation."

string tt_is = 
 "• Reads only the first 40 symbols." + 
 "\n• Max 4096 characters." + 
 "\n• Format: EXCHANGE:SYMBOL_A,EXCHANGE:SYMBOL_B"

string i_scn_choose = input.string(
 defval = 'Displacement', 
 title = 'Scanning Method', 
 options = ['Displacement', 'Retracement'], tooltip = tt_ch, group = g_scn_tb)

string i_symbols = input.text_area(
 defval = 'NSE:ABCAPITAL,NSE:ABFRL,NSE:ASHOKLEY,NSE:BANDHANBNK,NSE:BANKBARODA,NSE:BANKINDIA,NSE:BEL,NSE:BHEL,NSE:BIOCON,NSE:BPCL,NSE:CESC,NSE:DELHIVERY,NSE:FEDERALBNK,NSE:GAIL,NSE:HINDCOPPER,NSE:HUDCO,NSE:IEX,NSE:IGL,NSE:IIFL,NSE:INDUSTOWER,NSE:IOC,NSE:IREDA,NSE:IRFC,NSE:JIOFIN,NSE:LTF,NSE:MANAPPURAM,NSE:MOTHERSON,NSE:M_MFIN,NSE:NATIONALUM,NSE:NCC,NSE:NYKAA,NSE:ONGC,NSE:PETRONET,NSE:POWERGRID,NSE:RBLBANK,NSE:SAIL,NSE:TATASTEEL,NSE:UNIONBANK,NSE:WIPRO,NSE:ZOMATO', 
 title = 'Paste Symbols', tooltip = tt_is, group = g_scn_tb)

bool i_scn_show_table = input.bool(defval = true, title = 'Display Table', group = g_scn_tb)
bool i_scn_show_long = input.bool(defval = true, title = 'Long Signals', inline = 'tb_2', group = g_scn_tb)
bool i_scn_show_short = input.bool(defval = true, title = 'Short Signals', inline = 'tb_2', group = g_scn_tb)

int i_scn_tbl_show_rows = input.int(defval = 12, title = 'Display Rows', minval = 0, maxval = 100, group = g_scn_tb)
string i_scn_tbl_pos = input.string(defval = position.bottom_left, title = 'Table Position', options = [position.top_left, position.top_center, position.top_right, position.middle_left, position.middle_center, position.middle_right, position.bottom_left, position.bottom_center, position.bottom_right], group = g_scn_tb)
string i_scn_tbl_txt_size = input.string(defval = size.small, title = 'Table Size', options = [size.auto, size.tiny, size.small, size.normal, size.large, size.huge], group = g_scn_tb)

string g_dc = '████████████ Displacement Candles ████████████'

string tt_mb = "Shows if bars exceed the set value."
string tt_dev = "Specifies the minimal size of displament, as a percentage of the average high-low range for the last 14 bars."
string tt_ret_fib = 
 "• 0: Top of bullish & bottom of bearish displacement." + 
 "\n• 1: Bottom of bullish & top of bearish displacement." + 
 "\n• 0.5: 50% of the displacement."

int i_dc_min_bars = input.int(defval = 3, title = 'Minimum Bars', minval = 1, tooltip = tt_mb, group = g_dc)
float i_dc_dev_percent = nz(input.float(60.0, "Minimal Deviation (%)", minval=1, step = 10, tooltip = tt_dev, group = g_dc) / 100 * ta.sma(high-low, 14))
bool i_dc_close_filter = input.bool(defval = true, title = 'Apply Close Above/Below Prev Close', group = g_dc)
bool i_dc_hl_filter = input.bool(defval = false, title = 'Apply Close Above/Below Prev High/Low', group = g_dc)
float i_dc_fib_val = input.float(defval = 0.5, title = 'Fibonacci Value', step = 0.1, tooltip = tt_ret_fib, group = g_dc)

string g_af = '██████████████ Additional Fiters ██████████████'

string tt_atr = "• Filters out longer or more volatile displacement candles."
string tt_atr_mul = "• Higher values filter longer or more volatile candles."
string tt_bf = "• 80 means the body covers 80%+ of the displacement candle."
string tt_tf = "• Filter signals within a given time."
string tt_df = "• Filter signals on specified dates (for Retracement Candles only)."

bool i_atr_filter = input.bool(defval = false, title = 'Apply ATR Filter', tooltip = tt_atr, group = g_af)
int i_atr_length = input.int(defval = 14, minval = 1, title = 'ATR Length', group = g_af)
float i_atr_multi = input.float(defval = 1, title = 'ATR Multiplier', minval = 1, group = g_af)

bool i_body_filter = input.bool(defval = false, title = 'Apply Body % Filter', tooltip = tt_bf, group = g_af)
float i_body_percent = input.float(defval = 70, title = 'Body % Above', minval = 0, maxval = 100, group = g_af) / 100

bool i_time_filter = input.bool(defval = false, title = 'Apply Time Filter', tooltip = tt_tf, group = g_af)
int i_hour_1 = input.int(defval = 9, minval = 0, title = 'Time From', inline = 't_1', group = g_af)
int i_minute_1 = input.int(defval = 15, minval = 0, title = ':', inline = 't_1', group = g_af)
int i_hour_2 = input.int(defval = 10, minval = 0, title = 'Time To ', inline = 't_2', group = g_af)
int i_minute_2 = input.int(defval = 15, minval = 0, title = ':', inline = 't_2', group = g_af)

bool i_date_filter = input.bool(defval = false, title = 'Apply Date Filter', tooltip = tt_df, group = g_af)
int i_day = input.int(defval = 30, minval = 1, maxval = 31, title = 'Day', group = g_af)
int i_month = input.int(defval = 3, minval = 1, maxval = 12, title = 'Month', group = g_af)
int i_year = input.int(defval = 2025, minval = 0, title = 'Year', group = g_af)

string g_cum = '█████████████ Performance Table █████████████'

bool i_cum_tbl_disp = input.bool(defval = true, title = 'Display', group = g_cum)
string i_cum_tbl_pos = input.string(defval = position.bottom_right, title = 'Position', options = [position.top_left, position.top_center, position.top_right, position.middle_left, position.middle_center, position.middle_right, position.bottom_left, position.bottom_center, position.bottom_right], group = g_cum)
string i_cum_tbl_size = input.string(defval = size.normal, title = 'Size', options = [size.auto, size.tiny, size.small, size.normal, size.large, size.huge], group = g_cum)

//string g_ch = '█████████████████ Colors █████████████████'
color i_pos_color = #089981 //input.color(defval = #089981, title = 'Positive', group = g_ch)
color i_pos_light_color = #70CCBD //input.color(defval = #70CCBD, title = 'Positive Light', group = g_ch)
color i_neg_light_color = #FAA1A4 //input.color(defval = #FAA1A4, title = 'Negative Light', group = g_ch)
color i_neg_color = #F23645 //input.color(defval = #F23645, title = 'Negative', group = g_ch)
color i_neu_color = #D1D4DC //input.color(defval = #D1D4DC, title = 'Neutral Light', group = g_ch)
color i_neu_dark_color = #0F0F0F //input.color(defval = #0F0F0F, title = 'Neutral', group = g_ch)

//___________________________ Menu End

//___________________________ Performance Start

is_new_day = ta.change(time('D')) != 0

// Cumulative Percentage Change
var float cum_pchg = na
day_pchg = na(close[1]) ? 0 : (close - close[1]) / close[1] * 100
cum_pchg := is_new_day ? day_pchg : na(cum_pchg) ? day_pchg : cum_pchg + day_pchg

// Cumulative Volume and Volume Percentage Change
var float curr_cum_vol = na
var float prev_cum_vol = na
if is_new_day
    prev_cum_vol := curr_cum_vol
    curr_cum_vol := volume
    curr_cum_vol
else
    curr_cum_vol := na(curr_cum_vol) ? volume : curr_cum_vol + volume
    curr_cum_vol
prev_vol_safe = nz(prev_cum_vol, curr_cum_vol)
cum_vol_pchg = (curr_cum_vol - prev_vol_safe) / prev_vol_safe * 100

var table tbl_cum = table.new(position=i_cum_tbl_pos, columns=2, rows=4, border_width=1, force_overlay=true)

cell_perform(col, row, txt, txt_color, aligh) =>
    table.cell(tbl_cum, col, row, txt, text_color=txt_color, text_halign=aligh, bgcolor=i_neu_dark_color, text_size=i_cum_tbl_size)

if barstate.islast and i_cum_tbl_disp
    pchg_col = cum_pchg > 0 ? i_pos_color : i_neg_color
    vol_pchg_col = cum_vol_pchg > 0 ? i_pos_color : i_neg_color
    prev_vol_pchg_col = prev_vol_safe < curr_cum_vol ? i_neg_color : i_pos_color
    
    cell_perform(0, 0, '%Chg', chart.fg_color, text.align_left)
    cell_perform(1, 0, str.tostring(cum_pchg, '#.##') + ' %', pchg_col, text.align_right)
    cell_perform(0, 1, 'Vol %Chg', chart.fg_color, text.align_left)
    cell_perform(1, 1, str.tostring(cum_vol_pchg, '#.##') + ' %', vol_pchg_col, text.align_right)
    cell_perform(0, 2, 'Vol', chart.fg_color, text.align_left)
    cell_perform(1, 2, str.tostring(curr_cum_vol / 100000, '#.##') + ' L', vol_pchg_col, text.align_right)
    cell_perform(0, 3, 'PD Vol', chart.fg_color, text.align_left)
    cell_perform(1, 3, str.tostring(prev_vol_safe / 100000, '#.##') + ' L', prev_vol_pchg_col, text.align_right)

//___________________________ Performance End

//___________________________ Additional Filters Start

// Pre-calculate common values
candle_range = high - low
body_size = math.abs(close - open)

// ATR Filter
atr_filter = not i_atr_filter or candle_range > ta.atr(i_atr_length) * i_atr_multi

// Body Filters
body_filter = not i_body_filter or candle_range > 0 and body_size / candle_range >= i_body_percent

// Time Filter
time_filter = 
 not i_time_filter or 
 (hour > i_hour_1 or hour == i_hour_1 and minute >= i_minute_1) and 
 (hour < i_hour_2 or hour == i_hour_2 and minute < i_minute_2)

// Date Filter
date_filter = not i_date_filter or year == i_year and month == i_month and dayofmonth == i_day

//___________________________ Additional Filters End

//___________________________ Displacement Candles Start

// Combined tracking variables
var int bullCnt = 0
var int bearCnt = 0
var float bullHi = na
var float bullLo = na
var float bearHi = na
var float bearLo = na
var float bullFib = na
var float bearFib = na
var bullHighs = array.new_float()
var bullLows = array.new_float()
var bearHighs = array.new_float()
var bearLows = array.new_float()

// Conditions and filters combined
float priceChg = (high - low)
bool bullish = priceChg >= i_dc_dev_percent and close > open and (not i_dc_close_filter or close > close[1]) and (not i_dc_hl_filter or close > high[1]) and atr_filter
bool bearish = priceChg >= i_dc_dev_percent and close < open and (not i_dc_close_filter or close < close[1]) and (not i_dc_hl_filter or close < low[1]) and atr_filter

// Optimized counting and array management
if bullish
    bullCnt := bullCnt + 1
    bearCnt := 0
    array.push(bullHighs, high)
    array.push(bullLows, low)
    if bullCnt == 1
        array.clear(bearHighs)
        array.clear(bearLows)
else if bearish
    bearCnt := bearCnt + 1
    bullCnt := 0
    array.push(bearHighs, high)
    array.push(bearLows, low)
    if bearCnt == 1
        array.clear(bullHighs)
        array.clear(bullLows)
else
    bullCnt := 0
    bearCnt := 0
    array.clear(bullHighs)
    array.clear(bullLows)
    array.clear(bearHighs)
    array.clear(bearLows)

// Calculate high-low range and percentage
float bullRange = na
float bearRange = na
float bullRangePercent = na
float bearRangePercent = na

if bullCnt >= i_dc_min_bars
    bullHi := array.max(bullHighs)
    bullLo := array.min(bullLows)
    bullRange := bullHi - bullLo
    bullRangePercent := (bullRange / bullLo) * 100
    bullFib := bullHi - (bullHi - bullLo) * i_dc_fib_val
if bearCnt >= i_dc_min_bars
    bearHi := array.max(bearHighs)
    bearLo := array.min(bearLows)
    bearRange := bearHi - bearLo
    bearRangePercent := (bearRange / bearLo) * 100
    bearFib := bearLo + (bearHi - bearLo) * i_dc_fib_val

bearMaxCnt = bearCnt[1] >= i_dc_min_bars and bearCnt == 0
bullMaxCnt = bullCnt[1] >= i_dc_min_bars and bullCnt == 0

// Plot
if bearMaxCnt and i_scn_show_short
    label.new(x = bar_index[1], y = low[1], text = str.tostring(bearCnt[1]), color = na, textcolor = i_neg_light_color, size = size.small, style = label.style_label_up, yloc = yloc.belowbar)
//    label.new(x = bar_index[1], y = low[1], text = str.format("{0,number,#.##}%", bearRangePercent[1]), color = na, textcolor = i_neg_light_color, size = size.small, style = label.style_label_up, yloc = yloc.belowbar)

if bullMaxCnt and i_scn_show_long
    label.new(x = bar_index[1], y = high[1], text = str.tostring(bullCnt[1]), color = na, textcolor = i_pos_light_color, size = size.small, style = label.style_label_down, yloc = yloc.abovebar)
//    label.new(x = bar_index[1], y = high[1], text = str.format("{0,number,#.##}%", bullRangePercent[1]), color = na, textcolor = i_pos_light_color, size = size.small, style = label.style_label_down, yloc = yloc.abovebar)

// Plot counts
//if bearCnt >= i_dc_min_bars and i_scn_show_short
//    label.new(x = bar_index, y = low, text = str.tostring(bearCnt), color = na, textcolor = i_neg_light_color, size = size.small, style = label.style_label_up, yloc = yloc.belowbar)
//if bullCnt >= i_dc_min_barst and i_scn_show_long
//    label.new(x = bar_index, y = high, text = str.tostring(bullCnt), color = na, textcolor = i_pos_light_color, size = size.small, style = label.style_label_down, yloc = yloc.abovebar)

plot(series = bearFib, title = 'Bearish Fib Line', color = i_neg_color, style = plot.style_stepline, display = display.none)
plot(series = bullFib, title = 'Bullish Fib Line', color = i_pos_color, style = plot.style_stepline, display = display.none)

// Track the final count before reset
var int lastBullCnt = 0
var int lastBearCnt = 0

// Update when sequence ends
if bullMaxCnt
    lastBullCnt := bullCnt[1]
if bearMaxCnt
    lastBearCnt := bearCnt[1]

// Retracement tracking combined
var bool bullActive = false
var bool bearActive = false
var bool bullDone = false
var bool bearDone = false
var int bullBar = na
var int bearBar = na
var int bullStart = na
var int bearStart = na
var float bullLow = na
var float bearHigh = na
var line bullLine = na
var line bearLine = na

// Activate sequences
if bullCnt >= i_dc_min_bars and bullCnt[1] < i_dc_min_bars
    bullActive := true
    bearActive := false
    bullDone := false
    bearDone := false
    bullStart := bar_index - bullCnt + 1
if bearCnt >= i_dc_min_bars and bearCnt[1] < i_dc_min_bars
    bearActive := true
    bullActive := false
    bearDone := false
    bullDone := false
    bearStart := bar_index - bearCnt + 1

// Detect and mark retracements
bool bearRet = bearActive and not bearDone and ta.crossover(high, bearFib) and high[1] < bearFib and time_filter and date_filter
bool bullRet = bullActive and not bullDone and ta.crossunder(low, bullFib) and low[1] > bullFib and time_filter and date_filter
if bearRet and i_scn_choose == 'Retracement' and i_scn_show_short
    bearDone := true
    bearBar := bar_index
    bearHigh := high
    bearLine := line.new(x1 = bearStart, y1 = bearFib, x2 = bearBar, y2 = bearFib, color = i_neg_light_color, style = line.style_dotted)
if bullRet and i_scn_choose == 'Retracement' and i_scn_show_long
    bullDone := true
    bullBar := bar_index
    bullLow := low
    bullLine := line.new(x1 = bullStart, y1 = bullFib, x2 = bullBar, y2 = bullFib, color = i_pos_light_color, style = line.style_dotted)

// Plot signals
plotshape(i_scn_show_short and i_scn_choose == 'Retracement' ? bearRet : false, title = 'Bearish Retracement', style = shape.triangledown, location = location.abovebar, color = i_neg_light_color, size = size.tiny)
plotshape(i_scn_show_long and i_scn_choose == 'Retracement' ? bullRet : false, title = 'Bullish Retracement', style = shape.triangleup, location = location.belowbar, color = i_pos_light_color, size = size.tiny)
barcolor(i_scn_show_short and i_scn_choose == 'Retracement' and bearRet ? i_neg_light_color : i_scn_show_long and i_scn_choose == 'Retracement' and bullRet ? i_pos_light_color : na, title = 'Retracement Candle')

//___________________________ Displacement Candles End

//___________________________ Get Symbols List for Screener Start

// Acknowledgement & Reference
// Trader: 'allanster'
// Indicator Title: 'How To Input CSV List Of Symbol Data Used For Screener'
// Indicator Link: 'https://www.tradingview.com/script/KfqHqHUH-How-To-Input-CSV-List-Of-Symbol-Data-Used-For-Screener/'

// Feed Function
feed(input_string) =>
    if na(input_string) or str.length(input_string) == 0
        [string(na), string(na)]
    else
        result = str.split(input_string, ',')
        first_item = ''
        for i = 0 to array.size(result) - 1 by 1
            trimmed = str.trim(array.get(result, i))
            if trimmed != ''
                first_item := trimmed
                break
        remaining = str.replace(input_string, first_item + ',', '', 1)
        [first_item, remaining]

// Flexible Symbol Extraction
sym_split_arr = str.split(i_symbols, ',')
new_sym_arr = array.new_string(array.size(sym_split_arr), na)
for i = 0 to array.size(sym_split_arr) - 1 by 1
    trimmed = str.trim(array.get(sym_split_arr, i))
    if trimmed != ''
        array.set(new_sym_arr, i, trimmed)

// Assign symbols dynamically
t_01 = array.size(new_sym_arr) > 0 ? array.get(new_sym_arr, 0) : na
t_02 = array.size(new_sym_arr) > 1 ? array.get(new_sym_arr, 1) : na
t_03 = array.size(new_sym_arr) > 2 ? array.get(new_sym_arr, 2) : na
t_04 = array.size(new_sym_arr) > 3 ? array.get(new_sym_arr, 3) : na
t_05 = array.size(new_sym_arr) > 4 ? array.get(new_sym_arr, 4) : na
t_06 = array.size(new_sym_arr) > 5 ? array.get(new_sym_arr, 5) : na
t_07 = array.size(new_sym_arr) > 6 ? array.get(new_sym_arr, 6) : na
t_08 = array.size(new_sym_arr) > 7 ? array.get(new_sym_arr, 7) : na
t_09 = array.size(new_sym_arr) > 8 ? array.get(new_sym_arr, 8) : na
t_10 = array.size(new_sym_arr) > 9 ? array.get(new_sym_arr, 9) : na
t_11 = array.size(new_sym_arr) > 10 ? array.get(new_sym_arr, 10) : na
t_12 = array.size(new_sym_arr) > 11 ? array.get(new_sym_arr, 11) : na
t_13 = array.size(new_sym_arr) > 12 ? array.get(new_sym_arr, 12) : na
t_14 = array.size(new_sym_arr) > 13 ? array.get(new_sym_arr, 13) : na
t_15 = array.size(new_sym_arr) > 14 ? array.get(new_sym_arr, 14) : na
t_16 = array.size(new_sym_arr) > 15 ? array.get(new_sym_arr, 15) : na
t_17 = array.size(new_sym_arr) > 16 ? array.get(new_sym_arr, 16) : na
t_18 = array.size(new_sym_arr) > 17 ? array.get(new_sym_arr, 17) : na
t_19 = array.size(new_sym_arr) > 18 ? array.get(new_sym_arr, 18) : na
t_20 = array.size(new_sym_arr) > 19 ? array.get(new_sym_arr, 19) : na
t_21 = array.size(new_sym_arr) > 20 ? array.get(new_sym_arr, 20) : na
t_22 = array.size(new_sym_arr) > 21 ? array.get(new_sym_arr, 21) : na
t_23 = array.size(new_sym_arr) > 22 ? array.get(new_sym_arr, 22) : na
t_24 = array.size(new_sym_arr) > 23 ? array.get(new_sym_arr, 23) : na
t_25 = array.size(new_sym_arr) > 24 ? array.get(new_sym_arr, 24) : na
t_26 = array.size(new_sym_arr) > 25 ? array.get(new_sym_arr, 25) : na
t_27 = array.size(new_sym_arr) > 26 ? array.get(new_sym_arr, 26) : na
t_28 = array.size(new_sym_arr) > 27 ? array.get(new_sym_arr, 27) : na
t_29 = array.size(new_sym_arr) > 28 ? array.get(new_sym_arr, 28) : na
t_30 = array.size(new_sym_arr) > 29 ? array.get(new_sym_arr, 29) : na
t_31 = array.size(new_sym_arr) > 30 ? array.get(new_sym_arr, 30) : na
t_32 = array.size(new_sym_arr) > 31 ? array.get(new_sym_arr, 31) : na
t_33 = array.size(new_sym_arr) > 32 ? array.get(new_sym_arr, 32) : na
t_34 = array.size(new_sym_arr) > 33 ? array.get(new_sym_arr, 33) : na
t_35 = array.size(new_sym_arr) > 34 ? array.get(new_sym_arr, 34) : na
t_36 = array.size(new_sym_arr) > 35 ? array.get(new_sym_arr, 35) : na
t_37 = array.size(new_sym_arr) > 36 ? array.get(new_sym_arr, 36) : na
t_38 = array.size(new_sym_arr) > 37 ? array.get(new_sym_arr, 37) : na
t_39 = array.size(new_sym_arr) > 38 ? array.get(new_sym_arr, 38) : na
t_40 = array.size(new_sym_arr) > 39 ? array.get(new_sym_arr, 39) : na

//___________________________ Get Symbols List for Screener End

//___________________________ Scanner Start

// Acknowledgement & Reference
// Trader: 'MUQWISHI'
// Indicator Title: 'Candlestick Patterns Screener [By MUQWISHI]'
// Indicator Link: 'https://www.tradingview.com/script/xiWQuGOq-Candlestick-Patterns-Screener-By-MUQWISHI/'

// Scanner Conditions
bool short_cond =  
 i_scn_choose == 'Displacement' ? bearMaxCnt : bearRet

bool long_cond = 
 i_scn_choose == 'Displacement' ? bullMaxCnt : bullRet

// Indicator Calculation Function 
indicator_calculation() =>
    // Declare variables with var for persistence
    var int _time = na
    var int bars = na
    var float _range = na
    var float pchg = na
    var int signal = na

    if barstate.isconfirmed
        // Single-line signal assignment
        signal := i_scn_show_long and long_cond ? 1 : i_scn_show_short and short_cond ? -1 : na

        if not na(signal)
            _time := time
            bars := bearMaxCnt ? bearCnt[1] : bullMaxCnt ? bullCnt[1] : na //math.round_to_mintick(close)
            _range := bearMaxCnt ? bearRangePercent[1] : bullMaxCnt ? bullRangePercent[1] : na
            pchg := cum_pchg

    [_time, bars, _range, pchg, signal]

// Time Formatting Function
format_time(x) =>
    str.format_time(x, timeframe.isintraday ? 'HH:mm dd-MM-yyyy' : 'dd-MM-yyyy', syminfo.timezone)

// Symbol Extraction Function
ticker_extract(s) =>
    array.get(str.split(s, ':'), 1)

// Matrix setup
var matrix = matrix.new<string>(0, 6, na)

// Add Rows Function
rows_to_matix(symbol, _time, bars, _range, pchg, signal) =>
    matrix.add_row(matrix, 0, array.from(symbol, _time, bars, _range, pchg, signal))

// Scanner Function
scan(new_sym_arr) =>
    for i = 0 to array.size(new_sym_arr) - 1 by 1
        sym = ticker.modify(array.get(new_sym_arr, i), syminfo.session)
        [_time, bars, _range, pchg, signal] = request.security(sym, timeframe.period, indicator_calculation())
        if not na(signal) and _time == time
            rows_to_matix(
                 ticker_extract(array.get(new_sym_arr, i)), 
                 format_time(_time), 
                 str.tostring(bars), 
                 str.tostring(_range, '#.##'), 
                 str.tostring(pchg, '#.##'), 
                 str.tostring(signal))

// Scan Symbols Array
scan(new_sym_arr)

// Trim excess rows in the matrix
if matrix.rows(matrix) > i_scn_tbl_show_rows
    while matrix.rows(matrix) > i_scn_tbl_show_rows
        matrix.remove_row(matrix, matrix.rows(matrix) - 1)

// Draw Table
var table tbl_scan = table.new(position = i_scn_tbl_pos, columns = 5, rows = 102, border_width = 1, force_overlay = true)

// Cells Function
cell_scan_title(int _column, int _row, string _title, string tool_tip) =>
    table.cell(table_id = tbl_scan, column = _column, row = _row, text = _title, text_color = i_neu_color, text_halign = text.align_center, bgcolor = i_neu_dark_color, text_size = i_scn_tbl_txt_size, tooltip = tool_tip)

cell_scan(col, row, txt, _text_color) =>
    table.cell(tbl_scan, col, row, text = txt, text_color = _text_color, text_halign = text.align_left, bgcolor = i_neu_dark_color, text_size = i_scn_tbl_txt_size)

string tt_bar = "Number of displacement candles."
string tt_pRng = "Percentage between the displacement candles."
string tt_pChg = "Percentage change of the day."

// Scanner Table
if barstate.islast and i_scn_show_table
    // Clear existing data in the table
    table.clear(table_id = tbl_scan, start_column = 0, start_row = 0, end_column = 2, end_row = 101)
    
    cell_scan_title(0, 0, i_scn_choose, '')
    table.merge_cells(table_id = tbl_scan, start_column = 0, start_row = 0, end_column = 4, end_row = 0)
    cell_scan_title(0, 1, 'Symbol', '')
    cell_scan_title(1, 1, 'Time', '')
    cell_scan_title(2, 1, 'Bar', tt_bar)
    cell_scan_title(3, 1, '%Rng', tt_pRng)
    cell_scan_title(4, 1, '%Chg', tt_pChg)
    j = 4

    // Populate table with matrix data
    if matrix.rows(matrix) > 0
        for i = 0 to matrix.rows(matrix) - 1 by 1
            color txt_color = matrix.get(matrix, i, 5) == '1' ? i_pos_color : matrix.get(matrix, i, 5) == '-1' ? i_neg_color : na

            cell_scan(0, j, matrix.get(matrix, i, 0), txt_color)
            cell_scan(1, j, matrix.get(matrix, i, 1), txt_color)
            cell_scan(2, j, matrix.get(matrix, i, 2), txt_color)
            cell_scan(3, j, matrix.get(matrix, i, 3), txt_color)
            cell_scan(4, j, matrix.get(matrix, i, 4), txt_color)
            j := j + 1

//___________________________ Scanner End

//___________________________ Code End

// Readme
// 
// Indicator Title: "ICT Displacement Candles Scanner"
// 
// Overview
// - A price action trading method based on strong price moves (displacement).
// - Helps identify trend direction and potential trade entries.
//
// Features
// - Scanning Methods:
//   - Displacement: Strong, sudden price move (up/down) with long candles, minimal wicks.
//   - Retracement: Price retraces to a Fibonacci level of the displacement.
//
// How to Use?
// 1. Identify Displacement: Look for strong price movement after liquidity is taken.
// 2. Wait for Retracement: Use Fibonacci to find entry levels (e.g., 61.8%).
// 3. Confirm with Order Blocks or Fair Value Gap(FVG): Ensure price reacts at an institutional level.
// 4. Enter Trade: Buy or sell based on trend continuation signals.
// 5. Set Targets: Aim for the next liquidity zone.
//
// Note: Read tooltips for more clarity.
// 
// Questions?: Message the author on TradingView: https://www.tradingview.com/u/Arun_K_Bhaskar/
// 
// More Indicators: Free TradingView indicators and source code on GitHub: https://github.com/ArunKBhaskar/PineScript

##-- File Name: PineScript-main/ICT Displacement Candles/[Scanner] ICT Displacement Candles.txt | File No: 6 | Ended --##

##-- File Name: PineScript-main/ICT Equal Highs and Lows/ICT Equal Highs and Lows Indicator.txt | File No: 7 | Started --##
// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © Arun_K_Bhaskar

//@version=5
i_max_bars_back = 300
indicator(title="ICT Equal Highs and Lows", shorttitle="Equal HL", overlay=true, max_bars_back=i_max_bars_back, max_lines_count=500, max_labels_count=500)

//____________________________ Menu Pivot High Low Start

g_phl_eq = '███████████████ Equal High Low ███████████████'
int i_phl_1_left = input.int(defval=60, title='Left', group=g_phl_eq)
int i_phl_1_right = input.int(defval=30, title='Right', group=g_phl_eq)
tt_eq = "Lower values mean highs and lows are closer."
float i_phl_eq_percent = input.float(defval=0.05, minval=0, step=0.01, title='Equal HL %', tooltip=tt_eq, group=g_phl_eq) 
string i_phl_1_source = input.string(defval='High/Low', title='Source', options=['High/Low', 'Open/Close'], group=g_phl_eq)
color i_phl_1_h_ln_color = input.color(defval=#F7525F, title='Bearish Color', group=g_phl_eq)
color i_phl_1_l_ln_color = input.color(defval=#22AB94, title='Bullish Color', group=g_phl_eq)
int i_phl_eq_transp = input.int(defval=25, minval=0, title='Transparency', group=g_phl_eq) 

//____________________________ Menu Pivot High Low End

//____________________________ Equal High Low Start

// Get Source
float _high = i_phl_1_source == 'Open/Close' ? math.max(open, close) : high
float _low = i_phl_1_source == 'Open/Close' ? math.min(open, close) : low

// Arrays to store the last 2 pivot highs and lows
var float[] ph_arr = array.new_float(2)
var int[] ph_bi_arr = array.new_int(2)
var float[] pl_arr = array.new_float(2)
var int[] pl_bi_arr = array.new_int(2)

// Pivot calculations
int prev_ph_bi = na, int prev_pl_bi = na
bool ph = false, bool pl = false

phl_1_ph = ta.pivothigh(_high, i_phl_1_left, i_phl_1_right)
phl_1_pl = ta.pivotlow(_low, i_phl_1_left, i_phl_1_right)

// Update the arrays with the last 2 pivot highs and lows
if not na(phl_1_ph)
    ph := true
    prev_ph_bi := bar_index - i_phl_1_right
    array.unshift(ph_bi_arr, bar_index)
    array.pop(ph_bi_arr)

if not na(phl_1_pl)
    pl := true
    prev_pl_bi := bar_index - i_phl_1_right
    array.unshift(pl_bi_arr, bar_index)
    array.pop(pl_bi_arr)

// Function to update the arrays with the last 2 values
update_arrays(value, array_ref) =>
    array.unshift(array_ref, value)
    array.pop(array_ref)

// Update arrays with the last 2 pivot highs and lows
if ph
    update_arrays(phl_1_ph, ph_arr)
if pl
    update_arrays(phl_1_pl, pl_arr)

// Get last two pivot highs and lows
ph_price_0 = array.get(ph_arr, 0), ph_price_1 = array.get(ph_arr, 1)
ph_bi_0 = array.get(ph_bi_arr, 0), ph_bi_1 = array.get(ph_bi_arr, 1)

pl_price_0 = array.get(pl_arr, 0), pl_price_1 = array.get(pl_arr, 1)
pl_bi_0 = array.get(pl_bi_arr, 0), pl_bi_1 = array.get(pl_bi_arr, 1)

// Function to calculate percentage change
pchg(price_1, price_2) =>
    change = price_1 - price_2
    percent_change = math.abs((change / price_2) * 100)
    percent_change

// Calculate percentage change between the last two pivot highs and lows
var float ph_pchg = na
var float pl_pchg = na

if array.size(ph_arr) >= 2
    ph_pchg := pchg(array.get(ph_arr, 0), array.get(ph_arr, 1))

if array.size(pl_arr) >= 2
    pl_pchg := pchg(array.get(pl_arr, 0), array.get(pl_arr, 1))

// Draw Equals Box
var levelBoxes_equal = array.new_box()

ph_condition = ph and ph_pchg < i_phl_eq_percent and barstate.isconfirmed
pl_condition = pl and pl_pchg < i_phl_eq_percent and barstate.isconfirmed

if ph_condition
    ph_box = box.new(left=ph_bi_1 - i_phl_1_right, top=ph_price_1, right=ph_bi_0 - i_phl_1_right, bottom=ph_price_0, border_color=color.new(i_phl_1_h_ln_color, i_phl_eq_transp), bgcolor=color.new(i_phl_1_h_ln_color, i_phl_eq_transp))
    array.push(levelBoxes_equal, ph_box)

if pl_condition
    pl_box = box.new(left=pl_bi_1 - i_phl_1_right, top=pl_price_1, right=pl_bi_0 - i_phl_1_right, bottom=pl_price_0, border_color=color.new(i_phl_1_l_ln_color, i_phl_eq_transp), bgcolor=color.new(i_phl_1_l_ln_color, i_phl_eq_transp))
    array.push(levelBoxes_equal, pl_box)

// Plot Equal Labels
plotshape(ph_condition ? high[i_phl_1_right] : na, style=shape.xcross, location=location.absolute, offset=-i_phl_1_right, color=color.new(i_phl_1_h_ln_color, i_phl_eq_transp), size=size.small)
plotshape(pl_condition ? low[i_phl_1_right] : na, style=shape.xcross, location=location.absolute, offset=-i_phl_1_right, color=color.new(i_phl_1_l_ln_color, i_phl_eq_transp), size=size.small)

//____________________________ Equal High Low End

// _____________________________ Code End
##-- File Name: PineScript-main/ICT Equal Highs and Lows/ICT Equal Highs and Lows Indicator.txt | File No: 7 | Ended --##

##-- File Name: PineScript-main/ICT Equal Highs and Lows/ICT Equal Highs and Lows with Screener.txt | File No: 8 | Started --##
// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © Arun_K_Bhaskar

//@version=5
i_max_bars_back = 300
indicator(title="ICT Equal Highs and Lows with Screener", shorttitle="Equal HL Scr", overlay=true, max_bars_back=i_max_bars_back, max_lines_count=500, max_labels_count=500)

//_____________________________ Menu Screener Start

g_tb = '█████████████████ Screener █████████████████'

string i_scr_choose = input.string(defval='Equals', title='Screening Method', options=['Equals', 'Equals Sweep'], group=g_tb)

tt_is = "• Input exactly 40 symbols, nothing more or less." +
     "\n• Total characters cannot exceed 4096." +
     "\n• Use comma as delimiter without any space." +
     "\n• Eg: EXCHANGE:SYMBOL_A,EXCHANGE:SYMBOL_B"
string i_symbols = input.text_area(
 defval="NSE:AEGISCHEM,NSE:BANKINDIA,NSE:BHEL,NSE:BLS,NSE:CASTROLIND,NSE:CESC,NSE:ENGINERSIN,NSE:EQUITASBNK,NSE:FSL,NSE:GICRE,NSE:GPPL,NSE:GSPL,NSE:HFCL,NSE:HINDCOPPER,NSE:HUDCO,NSE:IBULHSGFIN,NSE:INDIACEM,NSE:INDUSTOWER,NSE:IOC,NSE:IRCON,NSE:IRFC,NSE:KARURVYSYA,NSE:NATIONALUM,NSE:NETWORK18,NSE:NIACL,NSE:NLCINDIA,NSE:PCBL,NSE:PFC,NSE:PNB,NSE:PNCINFRA,NSE:RVNL,NSE:SAIL,NSE:SJVN,NSE:TTML,NSE:UNIONBANK,NSE:USHAMART,NSE:VAIBHAVGBL,NSE:WELSPUNLIV,NSE:ZEEL,NSE:ZOMATO,",
 title="Paste Symbols", tooltip=tt_is, group=g_tb)

string i_scr_direction = input.string(defval='Both', title='Direction', options=['Both', 'Bullish', 'Bearish'], inline='tb_1', group=g_tb)
bool i_scr_show_bull  = input.bool(defval=true, title='Only Bullish', inline='tb_2', group=g_tb)
bool i_scr_show_bear  = input.bool(defval=true, title='Only Bearish', inline='tb_2', group=g_tb)

int i_tbl_disp_rows = input.int(defval=16, title='Display Rows', minval=0, maxval=100, group=g_tb)
string i_tbl_position = input.string(defval=position.bottom_left, title='Table Position', options=[position.top_left, position.top_center, position.top_right, position.middle_left, position.middle_center, position.middle_right, position.bottom_left, position.bottom_center, position.bottom_right], group=g_tb)
string i_tbl_text_size = input.string(defval=size.small, title='Table Size', options=[size.auto, size.tiny, size.small, size.normal, size.large, size.huge], group=g_tb)

//_____________________________ Menu Screener End

//____________________________ Menu Pivot High Low Start

g_phl_eq = '███████████████ Equal High Low ███████████████'
int i_phl_1_left = input.int(defval=60, title='Left', group=g_phl_eq)
int i_phl_1_right = input.int(defval=30, title='Right', group=g_phl_eq)
tt_eq = "Lower values mean highs and lows are closer."
float i_phl_eq_percent = input.float(defval=0.05, minval=0, step=0.01, title='Equal HL %', tooltip=tt_eq, group=g_phl_eq) 
string i_phl_1_source = input.string(defval='High/Low', title='Source', options=['High/Low', 'Open/Close'], group=g_phl_eq)
color i_phl_1_h_ln_color = input.color(defval=#F7525F, title='Bearish Color', group=g_phl_eq)
color i_phl_1_l_ln_color = input.color(defval=#22AB94, title='Bullish Color', group=g_phl_eq)
color i_phl_txt_color = input.color(defval=#B2B5BE, title='Neutral Color', group=g_phl_eq)
int i_phl_eq_transp = input.int(defval=25, minval=0, title='Transparency', group=g_phl_eq) 

//____________________________ Menu Pivot High Low End

//____________________________ Equal High Low Start

// Get Source
float _high = i_phl_1_source == 'Open/Close' ? math.max(open, close) : high
float _low = i_phl_1_source == 'Open/Close' ? math.min(open, close) : low

// Arrays to store the last 2 pivot highs and lows
var float[] ph_arr = array.new_float(2)
var int[] ph_bi_arr = array.new_int(2)
var float[] pl_arr = array.new_float(2)
var int[] pl_bi_arr = array.new_int(2)

// Pivot calculations
int prev_ph_bi = na, int prev_pl_bi = na
bool ph = false, bool pl = false

phl_1_ph = ta.pivothigh(_high, i_phl_1_left, i_phl_1_right)
phl_1_pl = ta.pivotlow(_low, i_phl_1_left, i_phl_1_right)

// Update the arrays with the last 2 pivot highs and lows
if not na(phl_1_ph)
    ph := true
    prev_ph_bi := bar_index - i_phl_1_right
    array.unshift(ph_bi_arr, bar_index)
    array.pop(ph_bi_arr)

if not na(phl_1_pl)
    pl := true
    prev_pl_bi := bar_index - i_phl_1_right
    array.unshift(pl_bi_arr, bar_index)
    array.pop(pl_bi_arr)

// Function to update the arrays with the last 2 values
update_arrays(value, array_ref) =>
    array.unshift(array_ref, value)
    array.pop(array_ref)

// Update arrays with the last 2 pivot highs and lows
if ph
    update_arrays(phl_1_ph, ph_arr)
if pl
    update_arrays(phl_1_pl, pl_arr)

// Get last two pivot highs and lows
ph_price_0 = array.get(ph_arr, 0), ph_price_1 = array.get(ph_arr, 1)
ph_bi_0 = array.get(ph_bi_arr, 0), ph_bi_1 = array.get(ph_bi_arr, 1)

pl_price_0 = array.get(pl_arr, 0), pl_price_1 = array.get(pl_arr, 1)
pl_bi_0 = array.get(pl_bi_arr, 0), pl_bi_1 = array.get(pl_bi_arr, 1)

// Function to calculate percentage change
pchg(price_1, price_2) =>
    change = price_1 - price_2
    percent_change = math.abs((change / price_2) * 100)
    percent_change

// Calculate percentage change between the last two pivot highs and lows
var float ph_pchg = na
var float pl_pchg = na

if array.size(ph_arr) >= 2
    ph_pchg := pchg(array.get(ph_arr, 0), array.get(ph_arr, 1))

if array.size(pl_arr) >= 2
    pl_pchg := pchg(array.get(pl_arr, 0), array.get(pl_arr, 1))

// Draw Equals Box
var levelBoxes_equal = array.new_box()

ph_condition = ph and ph_pchg < i_phl_eq_percent and barstate.isconfirmed
pl_condition = pl and pl_pchg < i_phl_eq_percent and barstate.isconfirmed

if ph_condition
    ph_box = box.new(left=ph_bi_1 - i_phl_1_right, top=ph_price_1, right=ph_bi_0 - i_phl_1_right, bottom=ph_price_0, border_color=color.new(i_phl_1_h_ln_color, i_phl_eq_transp), bgcolor=color.new(i_phl_1_h_ln_color, i_phl_eq_transp))
    array.push(levelBoxes_equal, ph_box)

if pl_condition
    pl_box = box.new(left=pl_bi_1 - i_phl_1_right, top=pl_price_1, right=pl_bi_0 - i_phl_1_right, bottom=pl_price_0, border_color=color.new(i_phl_1_l_ln_color, i_phl_eq_transp), bgcolor=color.new(i_phl_1_l_ln_color, i_phl_eq_transp))
    array.push(levelBoxes_equal, pl_box)

// Plot Equal Labels
plotshape(ph_condition ? high[i_phl_1_right] : na, style=shape.xcross, location=location.absolute, offset=-i_phl_1_right, color=color.new(i_phl_1_h_ln_color, i_phl_eq_transp), size=size.small)
plotshape(pl_condition ? low[i_phl_1_right] : na, style=shape.xcross, location=location.absolute, offset=-i_phl_1_right, color=color.new(i_phl_1_l_ln_color, i_phl_eq_transp), size=size.small)

//____________________________ Equal High Low End

//____________________________ Get Symbols for Screener Start

// Acknowledgement & Reference
// Trader: 'allanster'
// Indicator Title: 'How To Input CSV List Of Symbol Data Used For Screener'
// Indicator Link: 'https://www.tradingview.com/script/KfqHqHUH-How-To-Input-CSV-List-Of-Symbol-Data-Used-For-Screener/'

feed(back) =>                                             // extract tickerid and decrement list of ticker IDs
    loop  = back                                          // declare string variable to hold content list
    getT  = string(na)                                    // declare string variable to hold tickerid
    if str.length(loop) == 0                              // if list is empty
        getT := string(na)                                // assign na to tickerid variable
        loop := string(na)                                // assign na to list of ticker Ids variable
    else                                                  // else extract first tickerid
        getP  = nz(str.pos(loop, ','), str.length(loop))  // get position of first comma or last character
        getT := str.substring(loop, 0, getP)              // get tickerid in first position of list
        loop := str.replace(loop, getT + ',', '')         // clear tickerid + delimiter character from list
    [getT, loop]                                          // return tickerid in first position & truncated list

[tid_001, out_001] = feed(i_symbols), [tid_002, out_002] = feed(out_001), [tid_003, out_003] = feed(out_002), [tid_004, out_004] = feed(out_003),
[tid_005, out_005] = feed(out_004), [tid_006, out_006] = feed(out_005), [tid_007, out_007] = feed(out_006), [tid_008, out_008] = feed(out_007),
[tid_009, out_009] = feed(out_008), [tid_010, out_010] = feed(out_009), [tid_011, out_011] = feed(out_010), [tid_012, out_012] = feed(out_011),
[tid_013, out_013] = feed(out_012), [tid_014, out_014] = feed(out_013), [tid_015, out_015] = feed(out_014), [tid_016, out_016] = feed(out_015),
[tid_017, out_017] = feed(out_016), [tid_018, out_018] = feed(out_017), [tid_019, out_019] = feed(out_018), [tid_020, out_020] = feed(out_019),
[tid_021, out_021] = feed(out_020), [tid_022, out_022] = feed(out_021), [tid_023, out_023] = feed(out_022), [tid_024, out_024] = feed(out_023),
[tid_025, out_025] = feed(out_024), [tid_026, out_026] = feed(out_025), [tid_027, out_027] = feed(out_026), [tid_028, out_028] = feed(out_027),
[tid_029, out_029] = feed(out_028), [tid_030, out_030] = feed(out_029), [tid_031, out_031] = feed(out_030), [tid_032, out_032] = feed(out_031),
[tid_033, out_033] = feed(out_032), [tid_034, out_034] = feed(out_033), [tid_035, out_035] = feed(out_034), [tid_036, out_036] = feed(out_035),
[tid_037, out_037] = feed(out_036), [tid_038, out_038] = feed(out_037), [tid_039, out_039] = feed(out_038), [tid_040, out_040] = feed(out_039)

//____________________________ Get Symbols for Screener End

// _____________________________ Screener Start

// Acknowledgement & Reference
// Trader: 'MUQWISHI'
// Indicator Title: 'Candlestick Patterns Screener [By MUQWISHI]'
// Indicator Link: 'https://www.tradingview.com/script/xiWQuGOq-Candlestick-Patterns-Screener-By-MUQWISHI/'

// Choose Screening Method
bull_method =
 i_scr_choose == 'Equals' ? ph_condition :
 ph_pchg < i_phl_eq_percent and ta.crossover(high, ph_price_0) and barstate.isconfirmed

bear_method =
 i_scr_choose == 'Equals' ? pl_condition :
 pl_pchg < i_phl_eq_percent and ta.crossunder(low, pl_price_0) and barstate.isconfirmed

// Screener Conditions
bullish_cond = bull_method
bearish_cond = bear_method

// Define Bull and Bear Conditions
bull = not(i_scr_direction == "Bearish")
bear = not(i_scr_direction == "Bullish")

// Function for Screener Indicator Calculation
indicator_calculation() =>
    // Initialize variables
    price = float(na)
    _time = int(na)
    indicator = ""
    signal = int(na) 

    if barstate.isconfirmed
        // Check for Bearish Momentum Candle and conditions (Modify here to customize indicators)
        if i_scr_show_bull and bearish_cond and bear 
            indicator := "L"
            signal := -1

        // Check for Bullish Momentum Candle and conditions (Modify here to customize indicators)
        else if i_scr_show_bear and bullish_cond and bull
            indicator := "H"
            signal := 1

        // Update price and time if signal is not null
        if not na(signal)
            price := math.round_to_mintick(close)
            _time := time

    [_time, indicator, price, signal]

// Function to format time
format_time(x) =>
    timezone = syminfo.timezone
    timeframe.isintraday ? str.format_time(x, "HH:mm  dd-MM-yyyy", timezone) : str.format_time(x, "dd-MM-yyyy", timezone)

// Function to extract symbol name
symbol(s) => 
    array.get(str.split(s, ":"), 1)

// Matrix setup
var matrix = matrix.new<string>(0, 5, na)

// Function to add rows to the matrix
mtxFun(symbol, _time, indicator, price, signal) =>
    matrix.add_row(matrix, 0, array.from(symbol, _time, indicator, price, signal))

// Screener function to collect data
screener(s) =>
    sym = ticker.modify(s, syminfo.session)
    [_time, indicator, price, signal] = request.security(sym, timeframe.period, indicator_calculation())

    // Check if the signal is not na and the time matches
    if not na(signal) and _time == time
        symbolName = symbol(s)
        formattedTime = format_time(_time)
        strPrice = str.tostring(price)
        strSignal = str.tostring(signal)
        
        // Add data to the matrix
        mtxFun(symbolName, formattedTime, indicator, strPrice, strSignal)

// Call Screener function for multiple symbols
screener(tid_001), screener(tid_002), screener(tid_003), screener(tid_004), screener(tid_005), screener(tid_006), screener(tid_007),
screener(tid_008), screener(tid_009), screener(tid_010), screener(tid_011), screener(tid_012), screener(tid_013), screener(tid_014),
screener(tid_015), screener(tid_016), screener(tid_017), screener(tid_018), screener(tid_019), screener(tid_020), screener(tid_021),
screener(tid_022), screener(tid_023), screener(tid_024), screener(tid_025), screener(tid_026), screener(tid_027), screener(tid_028),
screener(tid_029), screener(tid_030), screener(tid_031), screener(tid_032), screener(tid_033), screener(tid_034), screener(tid_035),
screener(tid_036), screener(tid_037), screener(tid_038), screener(tid_039), screener(tid_040)

// Trim excess rows in the matrix
if matrix.rows(matrix) > i_tbl_disp_rows
    while matrix.rows(matrix) > i_tbl_disp_rows
        matrix.remove_row(matrix, matrix.rows(matrix)-1)

// Plot Table
// Create table with specified properties
var table tbl = table.new(position=i_tbl_position, columns=4, rows=102, border_width=1)

// Function to populate cells in the table
cell(col, row, txt, color) => 
    table.cell(tbl, col, row, text = txt, text_color = color, text_halign=text.align_left, bgcolor = color.new(color, 90), text_size=i_tbl_text_size)

// Check if it's the last bar
if barstate.islast
    // Clear existing data in the table
    table.clear(tbl, 0, 0, 3, 101)

    // Set headers for the table
    cell(0, 0, "Symbol", i_phl_txt_color)
    cell(1, 0, "Time",   i_phl_txt_color)
    cell(2, 0, "Dir" ,  i_phl_txt_color)
    cell(3, 0, "Price",  i_phl_txt_color)

    j = 1
    // Populate table with matrix data
    if matrix.rows(matrix) > 0
        for i = 0 to matrix.rows(matrix) - 1
            // Determine color based on the signal
            col = matrix.get(matrix, i, 4) ==  "1" ? i_phl_1_h_ln_color :
                  matrix.get(matrix, i, 4) == "-1" ? i_phl_1_l_ln_color : i_phl_txt_color

            // Populate cells in the table
            cell(0, j, matrix.get(matrix, i, 0), col)
            cell(1, j, matrix.get(matrix, i, 1), col)
            cell(2, j, matrix.get(matrix, i, 2), col)
            cell(3, j, matrix.get(matrix, i, 3), col)

            j += 1

// _____________________________ Screener End

// _____________________________ Code End

##-- File Name: PineScript-main/ICT Equal Highs and Lows/ICT Equal Highs and Lows with Screener.txt | File No: 8 | Ended --##

##-- File Name: PineScript-main/ICT Equal Highs and Lows/Readme First.txt | File No: 9 | Started --##
Indicator:
ICT Equal Highs and Lows Indicator: Only the indicator without Screener

Screener:
ICT Equal Highs and Lows with Screener:
Two screening methods are available.
One screens the equal levels.
The other screens when price cross the equal levels.

##-- File Name: PineScript-main/ICT Equal Highs and Lows/Readme First.txt | File No: 9 | Ended --##

##-- File Name: PineScript-main/ICT External and Internal Range Liquidity/ICT External and Internal Range Liquidity Multi-timeframe.txt | File No: 10 | Started --##
// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © Arun_K_Bhaskar

//@version=5
i_max_bars_back = 4999
indicator(title="ICT External and Internal Range Liquidity Multi-timeframe", shorttitle="ICT Liquidity", overlay=true, max_bars_back=i_max_bars_back, max_lines_count=500, max_labels_count=500)

//____________________________ ICT Fair Value Gap (FVG) Multi-timeframe Start

// Acknowledgement & Reference
// Trader: "fadizeidan"
// Indicator Title: "ICT HTF FVGs (fadi)"
// Indicator Link: "https://www.tradingview.com/script/Cti9P1Ww-ICT-HTF-FVGs-fadi/"

//____________________________ Types

type Settings 
    bool    CE_show
    string  CE_style
    bool    Border_show
    bool    mitigated_show
    string  mitigated_type
    color   mitigated_color_bull
    color   mitigated_color_bear
    bool    ltf_hide
    bool    text_show
    color   label_color
    color   label_bgcolor
    string  label_size
    int     padding
    int     buffer
    int     bgcolor_transp
    int     color_transp
    string  text_size

type Imbalance_Settings
    bool    show
    string  htf
    color   color_bull
    color   color_bear
    int     max_count

type Imbalance
    int     open_time
    int     close_time
    float   open
    float   middle
    float   close
    bool    mitigated
    int     mitigated_time
    line    line_middle
    label   lbl
    box     box

type ImbalanceStructure
    Imbalance[]         imbalance
    Imbalance_Settings  settings

type Helper
    string name         = "Helper"

//____________________________ Settings                                                                                             ---+//

Settings_Group                      = "Global Settings"

Settings settings                   = Settings.new()
Imbalance_Settings htf_1_Settings   = Imbalance_Settings.new()
Imbalance_Settings htf_2_Settings   = Imbalance_Settings.new()
Imbalance_Settings htf_3_Settings   = Imbalance_Settings.new()

//____________________________ Menu Fair Value Gap Start

g_fvg = "██████████ Internal Range Liquidity (FVG) ██████████"

htf_1_Settings.show         := input.bool(defval=true, title="", inline="htf1", group=g_fvg)
htf_1                        = input.timeframe("", title="", inline="htf1", group=g_fvg)
htf_1_Settings.htf          := htf_1
htf_1_Settings.color_bull   := input.color(defval=color.green, title="", inline="htf1", group=g_fvg)
htf_1_Settings.color_bear   := input.color(defval=color.yellow, title="", inline="htf1", group=g_fvg)
htf_1_Settings.max_count    := input.int(defval=20, title="", inline="htf1", group=g_fvg)

htf_2_Settings.show         := input.bool(defval=true, title="", inline="htf2", group=g_fvg)
htf_2                        = input.timeframe("5", title="", inline="htf2", group=g_fvg)
htf_2_Settings.htf          := htf_2
htf_2_Settings.color_bull   := input.color(defval=color.aqua, title="", inline="htf2", group=g_fvg)
htf_2_Settings.color_bear   := input.color(defval=color.orange, title="", inline="htf2", group=g_fvg)
htf_2_Settings.max_count    := input.int(defval=20, title="", inline="htf2", group=g_fvg)

htf_3_Settings.show         := input.bool(defval=true, title="", inline="htf3", group=g_fvg)
htf_3                        = input.timeframe("15", title="", inline="htf3", group=g_fvg)
htf_3_Settings.htf          := htf_3
htf_3_Settings.color_bull   := input.color(defval=color.blue, title="", inline="htf3", group=g_fvg)
htf_3_Settings.color_bear   := input.color(defval=color.red, title="", inline="htf3", group=g_fvg)
htf_3_Settings.max_count    := input.int(defval=20, title="", inline="htf3", group=g_fvg)

settings.ltf_hide               := input.bool(defval=true, title="Hide Lower Timeframes", group=g_fvg)

g_f = "███ Filled Settings"
settings.mitigated_show         := input.bool(defval=true, title="Display Filled", group=g_f)
settings.mitigated_type         := input.string(defval='50% Wick Fill', title='Filling Method', options = ['None', 'Wick Fill', 'Body Fill', '50% Wick Fill', '50% Body Fill'], group=g_f)
settings.mitigated_color_bull   := input.color(defval=color.white, title="Color Support", group=g_f)
settings.mitigated_color_bear   := input.color(defval=color.white, title="Color Resistance", group=g_f)

g_bx = "███ Box Settings"
settings.bgcolor_transp         := input.int(defval=90, title="Box Transparency", group=g_bx)
settings.padding                := input.int(defval=4, title="Offset", minval=0, group=g_bx)
tt_fvg_s = "Spacing Between Timeframes"
settings.buffer                 := input.int(defval=6, title="Spacing", minval=0, tooltip=tt_fvg_s, group=g_bx)

g_50 = "███ 50% Line Settings"
settings.CE_show                := input.bool(defval=true, title="Display 50%", group=g_50)
settings.CE_style               := input.string(defval=line.style_dashed, title='Line Style', options=[line.style_solid, line.style_dashed, line.style_dotted], group=g_50)
settings.color_transp           := input.int(defval=0, title="Line Transparency", group=g_50)

g_txt = "███ Text Settings"
settings.text_show              := input.bool(defval=true, title="Display Text", group=g_txt)
settings.text_size              := input.string(defval=size.auto, title='Size', options=[size.auto, size.tiny, size.small, size.normal, size.large, size.huge], group=g_txt)

//____________________________ Menu Fair Value Gap End

//____________________________ Variables

color color_transparent             = #00000000

Helper helper                       = Helper.new()

var ImbalanceStructure FVG_1        = ImbalanceStructure.new()
var ImbalanceStructure FVG_2        = ImbalanceStructure.new()
var ImbalanceStructure FVG_3        = ImbalanceStructure.new()

var Imbalance[] FVGs_1              = array.new<Imbalance>()
var Imbalance[] FVGs_2              = array.new<Imbalance>()
var Imbalance[] FVGs_3              = array.new<Imbalance>()

FVG_1.imbalance                     := FVGs_1
FVG_1.settings                      := htf_1_Settings
FVG_2.imbalance                     := FVGs_2
FVG_2.settings                      := htf_2_Settings
FVG_3.imbalance                     := FVGs_3
FVG_3.settings                      := htf_3_Settings

// Used internally for padding
var int TF_1        = 0
var int TF_2        = 0
var int TF_3        = 0

var float daily     = 0
var float monthly   = 0

//____________________________ Methods

method Gethtftext(Helper helper, string htf) =>
    helper.name := htf

    formatted = htf
    seconds = timeframe.in_seconds(htf)

    if seconds < 60
        formatted := str.tostring(seconds) + "s\n\n"
    else if (seconds / 60) < 60
        formatted := str.tostring((seconds/60)) + "m\n\n"
    else if (seconds/60/60) < 24
        formatted := str.tostring((seconds/60/60)) + "H\n\n"
    
    formatted

method Validtimeframe(Helper helper, tf) =>
    helper.name := tf
    n1 = timeframe.in_seconds()
    n2 = timeframe.in_seconds(tf)

    n1 < n2

method ProximityRange(Helper helper, tf) =>
    helper.name := tf
    float range_high    = 0
    float range_low   = 0
    if timeframe.isseconds or timeframe.isminutes
        range_high := close + daily
        range_low  := close - daily
    if timeframe.isdaily
        range_high := close + monthly*3
        range_low  := close - monthly*3
    if timeframe.isweekly
        range_high := close + monthly*12
        range_low  := close - monthly*12

    [range_low, range_high]

//____________________________ Imbalances Methods

// AddZone is used to display and manage imbalance related boxes
method AddZone(ImbalanceStructure IS, Imbalance imb, int step) =>
    bool visible = true
    if IS.settings.show
        int buffer = time+((time-time[1])*(settings.padding+1+(settings.buffer*(step-1)))) 

        if na(imb.box)
            _bgcolor = imb.open < imb.close ? color.new(IS.settings.color_bull, settings.bgcolor_transp) : color.new(IS.settings.color_bear, settings.bgcolor_transp)
            _text = helper.Gethtftext(IS.settings.htf)
            _text_color = settings.text_show ? _bgcolor : na   
            imb.box := box.new(imb.open_time, imb.open, buffer, imb.close, _bgcolor, bgcolor = _bgcolor, xloc=xloc.bar_time, text=_text, text_size=settings.text_size, text_color=_text_color, text_halign=text.align_center, text_valign=text.align_center)

            if settings.CE_show
                _line_color = imb.open < imb.close ? color.new(IS.settings.color_bull, settings.color_transp) : color.new(IS.settings.color_bear, settings.color_transp)
                imb.line_middle := line.new(imb.open_time, imb.middle, buffer, imb.middle, xloc=xloc.bar_time, style=settings.CE_style, color=_line_color)
        else
            box.set_right(imb.box, imb.mitigated ? imb.mitigated_time : buffer)
            mitigated_text_color = imb.open < imb.close ? imb.mitigated ? color.new(settings.mitigated_color_bull, settings.bgcolor_transp) : color.new(IS.settings.color_bull, settings.bgcolor_transp) : imb.mitigated ? color.new(settings.mitigated_color_bear, settings.bgcolor_transp) : color.new(IS.settings.color_bear, settings.bgcolor_transp)
            box.set_bgcolor(imb.box, mitigated_text_color)
            box.set_border_color(imb.box, mitigated_text_color)
            box.set_text_color(imb.box, settings.text_show ? mitigated_text_color : na)
            line.set_color(imb.line_middle, imb.open < imb.close ? imb.mitigated ? color.new(settings.mitigated_color_bull, settings.bgcolor_transp) : color.new(IS.settings.color_bull, settings.color_transp) : imb.mitigated ? color.new(settings.mitigated_color_bear, settings.bgcolor_transp) : color.new(IS.settings.color_bear, settings.color_transp))

            if settings.CE_show
                line.set_x2(imb.line_middle, imb.mitigated ? imb.mitigated_time : buffer)

        if imb.mitigated and not settings.mitigated_show
            if not na(imb.box)
                box.delete(imb.box)
                line.delete(imb.line_middle)
                visible := false
    visible

// AddImbalance adds a newly discovered imbalance. this applies for both FVG and Volume Imbalance
method AddImbalance(ImbalanceStructure IS, float o, float c, int o_time) =>
    Imbalance imb = Imbalance.new()
    imb.open_time           := o_time
    imb.open                := o
    imb.middle              := (o+c)/2
    imb.close               := c

    IS.imbalance.unshift(imb)
    //IS.AddZone(imb)

    if IS.imbalance.size() > 100 //IS.settings.max_count
        temp = IS.imbalance.pop()
        if not na(temp.box)
            box.delete(temp.box)
            line.delete(temp.line_middle)
            label.delete(temp.lbl)
    IS

// CheckMitigated checks if the imbalance has been mitigated based on the settings
method CheckMitigated(ImbalanceStructure IS, o, h, l, c) =>
    if IS.imbalance.size() > 0
        for i = IS.imbalance.size() - 1 to 0
            imb = IS.imbalance.get(i)

            if not imb.mitigated
                switch settings.mitigated_type
                    "None" =>
                        imb.mitigated       := false
                    'Wick Fill' =>
                        imb.mitigated       := imb.open <= imb.close ? low <= imb.open : high >= imb.open
                    'Body Fill' =>
                        imb.mitigated       := imb.open < imb.close ? math.min(o, c) <= imb.open : math.max(o, c) >= imb.open
                    '50% Wick Fill' =>
                        imb.mitigated       := imb.open <= imb.close ? low <= imb.middle : high >= imb.middle
                    '50% Body Fill' =>
                        imb.mitigated       := imb.open <= imb.close ? math.min(o, c) <= imb.middle : math.max(o, c) >= imb.middle
                if imb.mitigated
                    if not settings.mitigated_show
                        if not na(imb.box)
                            box.delete(imb.box)
                            line.delete(imb.line_middle)
                            label.delete(imb.lbl)
                        IS.imbalance.remove(i)
                    else
                        imb.mitigated_time  := time
    IS

method AdjustMargins(ImbalanceStructure IS, int step) =>
    int count = 0
    if IS.imbalance.size() > 0
        int buffer = time+((time-time[1])*(settings.padding+1+(settings.buffer*(step-1))))
        
        [rl, rh] = helper.ProximityRange(IS.settings.htf)

        for i = 0 to IS.imbalance.size() - 1
            imb = IS.imbalance.get(i)
            if ((math.max(imb.open, imb.close) > rl) and (math.min(imb.open, imb.close) < rh)) and count < IS.settings.max_count
                if IS.AddZone(imb, step)
                    count := count+1
            else
                if not na(imb.box)
                    box.delete(imb.box)
                    label.delete(imb.lbl)
                    line.delete((imb.line_middle))
    IS

// FindImbalance looks for imbalances and, if found, adds it to the list
method FindImbalance(ImbalanceStructure IS, o, h, l, c, t, o1, h1, l1, c1, t1, o2, h2, l2, c2, t2) =>
    if IS.settings.show and (h < l2 or l > h2) 
        o = h < l2 ? l2 : h2
        c = h < l2 ? h : l
        if IS.imbalance.size() == 0 
            IS.AddImbalance(o, c, t2)
        else
            if IS.imbalance.first().open_time < t2
                IS.AddImbalance(o, c, t2)
    IS

method Process(ImbalanceStructure IS, float o, float h, float l, float c, int t, float o1, float h1, float l1, float c1, int t1, float o2, float h2, float l2, float c2, int t2) =>
    var int visible = 0
    if IS.settings.show
        if not settings.ltf_hide or (settings.ltf_hide and helper.Validtimeframe(IS.settings.htf))
            if IS.settings.show
                IS.FindImbalance(o, h, l, c, t, o1, h1, l1, c1, t1, o2, h2, l2, c2, t2)
                visible := 1
        IS.CheckMitigated(o, h, l, c)
    visible

//____________________________ Main call to start the process

daily                                   := request.security(syminfo.tickerid, "1D", ta.atr(14))
monthly                                 := request.security(syminfo.tickerid, "1M", ta.atr(14))

[o_1, h_1, l_1, c_1, t_1]               = request.security(syminfo.tickerid, htf_1, [open[1], high[1], low[1], close[1], time[1]])
[o1_1, h1_1, l1_1, c1_1, t1_1]          = request.security(syminfo.tickerid, htf_1, [open[2], high[2], low[2], close[2], time[2]])
[o2_1, h2_1, l2_1, c2_1, t2_1]          = request.security(syminfo.tickerid, htf_1, [open[3], high[3], low[3], close[3], time[3]])
TF_1 := FVG_1.Process(o_1, h_1, l_1, c_1, t_1, o1_1, h1_1, l1_1, c1_1, t1_1, o2_1, h2_1, l2_1, c2_1, t2_1)
FVG_1.AdjustMargins(TF_1)

[o_2, h_2, l_2, c_2, t_2]               = request.security(syminfo.tickerid, htf_2, [open[1], high[1], low[1], close[1], time[1]])
[o1_2, h1_2, l1_2, c1_2, t1_2]          = request.security(syminfo.tickerid, htf_2, [open[2], high[2], low[2], close[2], time[2]])
[o2_2, h2_2, l2_2, c2_2, t2_2]          = request.security(syminfo.tickerid, htf_2, [open[3], high[3], low[3], close[3], time[3]])
TF_2 := TF_1 + FVG_2.Process(o_2, h_2, l_2, c_2, t_2, o1_2, h1_2, l1_2, c1_2, t1_2, o2_2, h2_2, l2_2, c2_2, t2_2)
FVG_2.AdjustMargins(TF_2)

[o_3, h_3, l_3, c_3, t_3]               = request.security(syminfo.tickerid, htf_3, [open[1], high[1], low[1], close[1], time[1]])
[o1_3, h1_3, l1_3, c1_3, t1_3]          = request.security(syminfo.tickerid, htf_3, [open[2], high[2], low[2], close[2], time[2]])
[o2_3, h2_3, l2_3, c2_3, t2_3]          = request.security(syminfo.tickerid, htf_3, [open[3], high[3], low[3], close[3], time[3]])
TF_3 := TF_2 + FVG_3.Process(o_3, h_3, l_3, c_3, t_3, o1_3, h1_3, l1_3, c1_3, t1_3, o2_3, h2_3, l2_3, c2_3, t2_3)
FVG_3.AdjustMargins(TF_3)

//____________________________ ICT Fair Value Gap (FVG) Multi-timeframe End


//____________________________ ICT Pivot High Low Multi-timeframe Start

//____________________________ Menu Pivot High Low Start

g_phl_qd = "█████████ External Range Liquidity (Swings) █████████"
bool i_phl_1_show = input.bool(defval=true, title='Pivot High Low 1', group=g_phl_qd)
bool i_phl_2_show = input.bool(defval=true, title='Pivot High Low 2', group=g_phl_qd)
bool i_phl_3_show = input.bool(defval=true, title='Pivot High Low 3', group=g_phl_qd)
bool i_phl_eq_show = input.bool(defval=true, title='Equal Pivot High Low', group=g_phl_qd)

g_phl_co = "███ Common Settings"
string i_phl_1_source = input.string(defval='High/Low', title='Source', options=['High/Low', 'Open/Close'], group=g_phl_co)

g_phl_1 = "███ Pivot High Low 1"
string i_phl_1_tf = input.timeframe(defval="15", title='Timeframe', group=g_phl_1)
int i_phl_1_left = input.int(defval=2, title='Left', group=g_phl_1)
int i_phl_1_right = input.int(defval=2, title='Right', group=g_phl_1)
int i_phl_1_showlast = input.int(defval=2, title='Show Last', minval=0, group=g_phl_1)
bool i_phl_1_ln_extend = input.bool(defval=false, title='Line Extend', group=g_phl_1)
color i_phl_1_h_ln_color = input.color(defval=#F7525F, title='High Color', group=g_phl_1)
color i_phl_1_l_ln_color = input.color(defval=#22AB94, title='Low Color', group=g_phl_1)
string i_phl_1_ln_stye = input.string(defval=line.style_solid, title='Line style', options=[line.style_solid, line.style_dashed, line.style_dotted], group=g_phl_1)
int i_phl_1_ln_width = input.int(defval=2, title='Line Width', minval=1, group=g_phl_1)
bool i_phl_1_lbl_show = input.bool(defval=false, title='Label', group=g_phl_1)

g_phl_2 = "███ Pivot High Low 2"
string i_phl_2_tf = input.timeframe(defval="60", title='Timeframe', group=g_phl_2)
int i_phl_2_left = input.int(defval=2, title='Left', group=g_phl_2)
int i_phl_2_right = input.int(defval=2, title='Right', group=g_phl_2)
int i_phl_2_showlast = input.int(defval=2, title='Show Last', minval=0, group=g_phl_2)
bool i_phl_2_ln_extend = input.bool(defval=false, title='Line Extend', group=g_phl_2)
color i_phl_2_h_ln_color = input.color(defval=#F7525F, title='High Color', group=g_phl_2)
color i_phl_2_l_ln_color = input.color(defval=#22AB94, title='Low Color', group=g_phl_2)
string i_phl_2_ln_stye = input.string(defval=line.style_solid, title='Line style', options=[line.style_solid, line.style_dashed, line.style_dotted], group=g_phl_2)
int i_phl_2_ln_width = input.int(defval=2, title='Line Width', minval=1, group=g_phl_2)
bool i_phl_2_lbl_show = input.bool(defval=false, title='Label', group=g_phl_2)

g_phl_3 = "███ Pivot High Low 3"
string i_phl_3_tf = input.timeframe(defval="240", title='Timeframe', group=g_phl_3)
int i_phl_3_left = input.int(defval=2, title='Left', group=g_phl_3)
int i_phl_3_right = input.int(defval=2, title='Right', group=g_phl_3)
int i_phl_3_showlast = input.int(defval=2, title='Show Last', minval=0, group=g_phl_3)
bool i_phl_3_ln_extend = input.bool(defval=false, title='Line Extend', group=g_phl_3)
color i_phl_3_h_ln_color = input.color(defval=#F7525F, title='High Color', group=g_phl_3)
color i_phl_3_l_ln_color = input.color(defval=#22AB94, title='Low Color', group=g_phl_3)
string i_phl_3_ln_stye = input.string(defval=line.style_solid, title='Line style', options=[line.style_solid, line.style_dashed, line.style_dotted], group=g_phl_3)
int i_phl_3_ln_width = input.int(defval=2, title='Line Width', minval=1, group=g_phl_3)
bool i_phl_3_lbl_show = input.bool(defval=false, title='Label', group=g_phl_3)

g_phl_eq = "███ Equal High Low"
int i_phl_eq_left = input.int(defval=60, title='Left', group=g_phl_eq)
int i_phl_eq_right = input.int(defval=30, title='Right', group=g_phl_eq)
tt_eq = "Lower values mean highs and lows are closer."
float i_phl_eq_percent = input.float(defval=0.05, minval=0, step=0.01, title='Equal HL %', tooltip=tt_eq, group=g_phl_eq) 
color i_phl_eq_h_ln_color = input.color(defval=#F7525F, title='Bearish Color', group=g_phl_eq)
color i_phl_eq_l_ln_color = input.color(defval=#22AB94, title='Bullish Color', group=g_phl_eq)
int i_phl_eq_transp = input.int(defval=25, minval=0, title='Transparency', group=g_phl_eq) 

//____________________________ Menu Pivot High Low End

//____________________________ Pivot High Low Common Functions Start

// Acknowledgement & Reference
// Trader: "lmatl"
// Indicator Title: "Pivot mtf semaphore support&resistance [LM]"
// Indicator Link: "https://www.tradingview.com/script/OZDSeSQd-Pivot-mtf-semaphore-support-resistance-LM/"

f_offsetToP(_src, _pivotPrice, _maxBack) =>
    int _offset = na
    float _delta = 10e10
    if not na(_pivotPrice)
        for _i = 1 to _maxBack by 1
            _thisDelta = math.abs(_src[_i] - _pivotPrice)
            if _thisDelta < _delta
                _delta := _thisDelta
                _offset := _i
                _offset
    _offset

f_resInMinutes() =>
    _resInMinutes = timeframe.multiplier * (timeframe.isseconds ? 1. / 60. : timeframe.isminutes ? 1. : timeframe.isdaily ? 1440. : timeframe.isweekly ? 10080. : timeframe.ismonthly ? 43800. : na)
    _resInMinutes

f_tfResInMinutes(_resolution) =>
    request.security(syminfo.tickerid, _resolution, f_resInMinutes())

f_extendArray(_lineArray, _labelArray, _extendLines) =>
    if array.size(_lineArray) > 0
        for _i = array.size(_lineArray) - 1 to 0 by 1

            x2 = line.get_x2(array.get(_lineArray, _i))
            yValue = line.get_y1(array.get(_lineArray, _i))

            if _extendLines or bar_index - 1 == x2 and not(high > yValue and low < yValue)
                line.set_x2(array.get(_lineArray, _i), bar_index)
                label.set_x(array.get(_labelArray, _i), bar_index)
            float(na)

f_drawLine(_x1, _x2, _yValue, _lineColor, _lineThickness, _lineStyle) =>
    line.new(x1=_x1, y1=_yValue, x2=_x2, y2=_yValue, color=_lineColor, style=_lineStyle, width=_lineThickness)

f_drawLabel(label_show, _x, _y, _textColor) =>
    if label_show
        label.new(_x, _y, '      ' + str.tostring(_y), xloc.bar_index, yloc.price, #00000000, label.style_none, _textColor)

f_drawPivotLineAndLabel(label_show, _x1, _x2, _yValue, _colorLine, _lineCount, _lineThickness, _lineStyle, _pivotArray, _labelArray) =>
    line l = f_drawLine(_x1, _x2, _yValue, _colorLine, _lineThickness, _lineStyle)
    label lab = f_drawLabel(label_show, _x1, _yValue, _colorLine)

    if array.size(_pivotArray) == _lineCount
        line.delete(array.shift(_pivotArray))
        label.delete(array.shift(_labelArray))
    array.push(_pivotArray, l)
    array.push(_labelArray, lab)

f_addLines(label_show, _htfPH, _htfPL, _offsetToPH, _offsetToPL, _newPH, _newPL, h_color, l_color, _lineCount, _lineThickness, _lineStyle, _pivotArray, _pivotLabelArray) =>
    if _newPH
        int x1 = bar_index - _offsetToPH
        int x2 = bar_index
        float yValue = _htfPH
        f_drawPivotLineAndLabel(label_show, x1, x2, yValue, h_color, _lineCount, _lineThickness, _lineStyle, _pivotArray, _pivotLabelArray)
        
    if _newPL
        int x1 = bar_index - _offsetToPL
        int x2 = bar_index
        float yValue = _htfPL
        f_drawPivotLineAndLabel(label_show, x1, x2, yValue, l_color, _lineCount, _lineThickness, _lineStyle, _pivotArray, _pivotLabelArray)

//____________________________ Pivot High Low Common Functions End

// Common Calculations
var res_in_minutes = f_resInMinutes()

// Get Source
float _high = i_phl_1_source == 'Open/Close' ? math.max(open, close) : high
float _low = i_phl_1_source == 'Open/Close' ? math.min(open, close) : low

//____________________________ Pivot High Low 1 Get Data & Draw Start

// Arrays
var phl_1_ln_arr = array.new_line(i_phl_1_showlast)
var phl_1_lbl_arr = array.new_label(i_phl_1_showlast)

// Get Data
phl_1_bars_htf = int(f_tfResInMinutes(i_phl_1_tf) / res_in_minutes)
phl_1_bars_offset = int(i_phl_1_left * phl_1_bars_htf)

phl_1_ph = ta.pivothigh(_high, i_phl_1_left, i_phl_1_right)
phl_1_pl = ta.pivotlow(_low, i_phl_1_left, i_phl_1_right)

phl_1_ph_htf = request.security(syminfo.tickerid, i_phl_1_tf, phl_1_ph)
phl_1_pl_htf = request.security(syminfo.tickerid, i_phl_1_tf, phl_1_pl)
phl_1_ph_new = na(phl_1_ph_htf[1]) and not na(phl_1_ph_htf)
phl_1_pl_new = na(phl_1_pl_htf[1]) and not na(phl_1_pl_htf)

phl_1_ph_offset = f_offsetToP(_high, phl_1_ph_htf, math.min(i_max_bars_back, math.max(30, phl_1_bars_offset + phl_1_bars_htf + 1)))
phl_1_pl_offset = f_offsetToP(_low, phl_1_pl_htf, math.min(i_max_bars_back, math.max(30, phl_1_bars_offset + phl_1_bars_htf + 1)))

// Draw
if i_phl_1_show and phl_1_bars_offset <= i_max_bars_back
    f_addLines(i_phl_1_lbl_show, phl_1_ph_htf, phl_1_pl_htf, phl_1_ph_offset, phl_1_pl_offset, phl_1_ph_new, phl_1_pl_new, i_phl_1_h_ln_color, i_phl_1_l_ln_color, i_phl_1_showlast, i_phl_1_ln_width, i_phl_1_ln_stye, phl_1_ln_arr, phl_1_lbl_arr)   

if i_phl_1_show
    f_extendArray(phl_1_ln_arr, phl_1_lbl_arr, i_phl_1_ln_extend)

//____________________________ Pivot High Low 1 Get Data & Draw End

//____________________________ Pivot High Low 2 Get Data & Draw Start

// Arrays
var phl_2_ln_arr = array.new_line(i_phl_2_showlast)
var phl_2_lbl_arr = array.new_label(i_phl_2_showlast)

// Get Data
phl_2_bars_htf = int(f_tfResInMinutes(i_phl_2_tf) / res_in_minutes)
phl_2_bars_offset = int(i_phl_2_left * phl_2_bars_htf)

float phl_2_ph = ta.pivothigh(_high, i_phl_2_left, i_phl_2_right)
float phl_2_pl = ta.pivotlow(_low, i_phl_2_left, i_phl_2_right)

phl_2_ph_htf = request.security(syminfo.tickerid, i_phl_2_tf, phl_2_ph)
phl_2_pl_htf = request.security(syminfo.tickerid, i_phl_2_tf, phl_2_pl)
phl_2_ph_new = na(phl_2_ph_htf[1]) and not na(phl_2_ph_htf)
phl_2_pl_new = na(phl_2_pl_htf[1]) and not na(phl_2_pl_htf)

phl_2_ph_offset = f_offsetToP(_high, phl_2_ph_htf, math.min(i_max_bars_back, math.max(30, phl_2_bars_offset + phl_2_bars_htf + 1)))
phl_2_pl_offset = f_offsetToP(_low, phl_2_pl_htf, math.min(i_max_bars_back, math.max(30, phl_2_bars_offset + phl_2_bars_htf + 1)))

// Draw
if i_phl_2_show and phl_2_bars_offset <= i_max_bars_back
    f_addLines(i_phl_2_lbl_show, phl_2_ph_htf, phl_2_pl_htf, phl_2_ph_offset, phl_2_pl_offset, phl_2_ph_new, phl_2_pl_new, i_phl_2_h_ln_color, i_phl_2_l_ln_color, i_phl_2_showlast, i_phl_2_ln_width, i_phl_2_ln_stye, phl_2_ln_arr, phl_2_lbl_arr)   

if i_phl_2_show
    f_extendArray(phl_2_ln_arr, phl_2_lbl_arr, i_phl_2_ln_extend)

//____________________________ Pivot High Low 2 Get Data & Draw End

//____________________________ Pivot High Low 3 Get Data & Draw Start

// Arrays
var phl_3_ln_arr = array.new_line(i_phl_3_showlast)
var phl_3_lbl_arr = array.new_label(i_phl_3_showlast)

// Get Data
phl_3_bars_htf = int(f_tfResInMinutes(i_phl_3_tf) / res_in_minutes)
phl_3_bars_offset = int(i_phl_3_left * phl_3_bars_htf)

float phl_3_ph = ta.pivothigh(_high, i_phl_3_left, i_phl_3_right)
float phl_3_pl = ta.pivotlow(_low, i_phl_3_left, i_phl_3_right)

phl_3_ph_htf = request.security(syminfo.tickerid, i_phl_3_tf, phl_3_ph)
phl_3_pl_htf = request.security(syminfo.tickerid, i_phl_3_tf, phl_3_pl)
phl_3_ph_new = na(phl_3_ph_htf[1]) and not na(phl_3_ph_htf)
phl_3_pl_new = na(phl_3_pl_htf[1]) and not na(phl_3_pl_htf)

phl_3_ph_offset = f_offsetToP(_high, phl_3_ph_htf, math.min(i_max_bars_back, math.max(30, phl_3_bars_offset + phl_3_bars_htf + 1)))
phl_3_pl_offset = f_offsetToP(_low, phl_3_pl_htf, math.min(i_max_bars_back, math.max(30, phl_3_bars_offset + phl_3_bars_htf + 1)))

// Draw
if i_phl_3_show and phl_3_bars_offset <= i_max_bars_back
    f_addLines(i_phl_3_lbl_show, phl_3_ph_htf, phl_3_pl_htf, phl_3_ph_offset, phl_3_pl_offset, phl_3_ph_new, phl_3_pl_new, i_phl_3_h_ln_color, i_phl_3_l_ln_color, i_phl_3_showlast, i_phl_3_ln_width, i_phl_3_ln_stye, phl_3_ln_arr, phl_3_lbl_arr)   

if i_phl_3_show
    f_extendArray(phl_3_ln_arr, phl_3_lbl_arr, i_phl_3_ln_extend)

//____________________________ Pivot High Low 3 Get Data & Draw End

//____________________________ Equal High Low Start

phl_eq_ph = ta.pivothigh(_high, i_phl_eq_left, i_phl_eq_right)
phl_eq_pl = ta.pivotlow(_low, i_phl_eq_left, i_phl_eq_right)

i_phl_eq_tf = ""
phl_eq_ph_htf = request.security(syminfo.tickerid, i_phl_eq_tf, phl_eq_ph)
phl_eq_pl_htf = request.security(syminfo.tickerid, i_phl_eq_tf, phl_eq_pl)

// Arrays to store the last 2 pivot highs and lows
var float[] ph_arr = array.new_float(2)
var int[] ph_bi_arr = array.new_int(2)
var float[] pl_arr = array.new_float(2)
var int[] pl_bi_arr = array.new_int(2)

// Pivot calculations
int prev_ph_bi = na, int prev_pl_bi = na
bool active_ph = false, bool active_pl = false
bool ph = false, bool pl = false

// Update the arrays with the last 2 pivot highs and lows
if not na(phl_eq_ph_htf)
    ph := true
    prev_ph_bi := bar_index - i_phl_eq_right
    array.unshift(ph_bi_arr, bar_index)
    array.pop(ph_bi_arr)

if not na(phl_eq_pl_htf)
    pl := true
    prev_pl_bi := bar_index - i_phl_eq_right
    array.unshift(pl_bi_arr, bar_index)
    array.pop(pl_bi_arr)

// Function to update the arrays with the last 2 values
update_arrays(value, array_ref) =>
    array.unshift(array_ref, value)
    array.pop(array_ref)

// Update arrays with the last 2 pivot highs and lows
if ph
    update_arrays(phl_eq_ph_htf, ph_arr)
if pl
    update_arrays(phl_eq_pl_htf, pl_arr)

// Get last two pivot highs and lows
ph_price_0 = array.get(ph_arr, 0), ph_price_1 = array.get(ph_arr, 1)
ph_bi_0 = array.get(ph_bi_arr, 0), ph_bi_1 = array.get(ph_bi_arr, 1)

pl_price_0 = array.get(pl_arr, 0), pl_price_1 = array.get(pl_arr, 1)
pl_bi_0 = array.get(pl_bi_arr, 0), pl_bi_1 = array.get(pl_bi_arr, 1)

// Function to calculate percentage change
pchg(price_1, price_2) =>
    change = price_1 - price_2
    percent_change = math.abs((change / price_2) * 100)
    percent_change

// Calculate percentage change between the last two pivot highs and lows
var float ph_pchg = na
var float pl_pchg = na

if array.size(ph_arr) >= 2
    ph_pchg := pchg(array.get(ph_arr, 0), array.get(ph_arr, 1))

if array.size(pl_arr) >= 2
    pl_pchg := pchg(array.get(pl_arr, 0), array.get(pl_arr, 1))

// Draw Equals Box
var levelBoxes_equal=array.new_box()

if i_phl_eq_show and ph and ph_pchg < i_phl_eq_percent
    ph_box = box.new(left=ph_bi_1 - i_phl_eq_right, top=ph_price_1, right=ph_bi_0 - i_phl_eq_right, bottom=ph_price_0, border_color=color.new(i_phl_eq_h_ln_color, i_phl_eq_transp), bgcolor=color.new(i_phl_eq_h_ln_color, i_phl_eq_transp))
    array.push(levelBoxes_equal, ph_box)
if i_phl_eq_show and pl and pl_pchg < i_phl_eq_percent
    pl_box = box.new(left=pl_bi_1 - i_phl_eq_right, top=pl_price_1, right=pl_bi_0 - i_phl_eq_right, bottom=pl_price_0, border_color=color.new(i_phl_eq_l_ln_color, i_phl_eq_transp), bgcolor=color.new(i_phl_eq_l_ln_color, i_phl_eq_transp))
    array.push(levelBoxes_equal, pl_box)

// Plot Equal Labels
plotshape(i_phl_eq_show and pl and pl_pchg < i_phl_eq_percent ? low[i_phl_eq_right] : na, style=shape.xcross, location=location.absolute, offset=-i_phl_eq_right, color=color.new(i_phl_eq_l_ln_color, i_phl_eq_transp), size=size.small)
plotshape(i_phl_eq_show and ph and ph_pchg < i_phl_eq_percent ? high[i_phl_eq_right] : na, style=shape.xcross, location=location.absolute, offset=-i_phl_eq_right, color=color.new(i_phl_eq_h_ln_color, i_phl_eq_transp), size=size.small)

//____________________________ Equal High Low End

//____________________________ ICT Pivot High Low Multi-timeframe End

//____________________________ CODE END
##-- File Name: PineScript-main/ICT External and Internal Range Liquidity/ICT External and Internal Range Liquidity Multi-timeframe.txt | File No: 10 | Ended --##

##-- File Name: PineScript-main/ICT External and Internal Range Liquidity/Readme First.txt | File No: 11 | Started --##
Relevance of this indicator:
1. This indicator is useful because it keeps its levels the same, even when you change the chart's timeframe, making it reliable for analysis.
2. This indicator displays External Range Liquidity levels which are swing highs and lows.
3. This indicator displays Interal Range Liquidity levels which are Fair Value Gaps.
4. This indicator also displays equal highs and lows, which serve as crucial reference points for analysis.

Reference Videos: The indicator is developed based on the following video contents.

Original The Inner Circle Trader Video:
Video Title: ICT Mentorship Core Content - Month 04 - Reinforcing Liquidity Concepts & Price Delivery
Video Link: https://www.youtube.com/watch?v=npL3ZXJ5zOU

Video Title: ICT Mentorship Core Content - Month 04 - ICT Fair Value Gaps FVG
Video Link: https://www.youtube.com/watch?v=FgacYSN9QEo

A Simplified Explanation from TTrades:
Video Title: Internal & External Liquidity (Daily Bias) - ICT Concepts
Video Link: https://www.youtube.com/watch?v=3OivsP1j_UE&t=1s

The indicator is based on the following indicator:
Indicator Title: "Pivot mtf semaphore support&resistance [LM]"
Indicator Link: "https://www.tradingview.com/script/OZDSeSQd-Pivot-mtf-semaphore-support-resistance-LM/"

Indicator Title: "ICT HTF FVGs (fadi)"
Indicator Link: "https://www.tradingview.com/script/Cti9P1Ww-ICT-HTF-FVGs-fadi/"

ICT Private Mentorship Core Content Playlist Links:

2016 ICT Private Mentorship Core Content Month 01
https://www.youtube.com/playlist?list=PLVgHx4Z63paYzh3KwUFX0UHQUf31CAEXk

2016 ICT Private Mentorship Core Content Month 02
https://www.youtube.com/playlist?list=PLVgHx4Z63paZvjqerfbn320myZ06L1MOB

2016 ICT Private Mentorship Core Content Month 03
https://www.youtube.com/playlist?list=PLVgHx4Z63paaY69GotBJyZ7KN_U09ra2o

2016 ICT Private Mentorship Core Content Month 04
https://www.youtube.com/playlist?list=PLVgHx4Z63pabb9rl1nyG58TG8PG8yzuao

2017 ICT Private Mentorship Core Content Month 05
https://www.youtube.com/playlist?list=PLVgHx4Z63paYBN404Q2QZ7D4mOJz1IHAk

2017 ICT Private Mentorship Core Content Month 06
https://www.youtube.com/playlist?list=PLVgHx4Z63paaG-26YEf2svQ_EsdGXjws1

2017 ICT Private Mentorship Core Content Month 07
https://www.youtube.com/playlist?list=PLVgHx4Z63paYWV_3PDkYajv_oNznvK2aR

2017 ICT Private Mentorship Core Content Month 08
https://www.youtube.com/playlist?list=PLVgHx4Z63paZrCT5EaUhJ6sCVNaegCf_c

2017 ICT Private Mentorship Core Content Month 09
https://www.youtube.com/playlist?list=PLVgHx4Z63paZfDRSk94aEMoYKUBqQgj0b

2017 ICT Private Mentorship Core Content Month 10
https://www.youtube.com/playlist?list=PLVgHx4Z63paZdnxymLp2Ihj-Pc_-foVVV

2017 ICT Private Mentorship Core Content Month 11
https://www.youtube.com/playlist?list=PLVgHx4Z63paa4FfJ8zI_QpdJICSLkXTQO

2017 ICT Private Mentorship Core Content Month 12
https://www.youtube.com/playlist?list=PLVgHx4Z63paaQ-8s2wrhfi6N2O_lTPuAI

Note:
Please note that the information provided is purely suggested for educational purposes and not intended as promotion. There are no personal preferences involved, and no endorsement of any individual or entity is implied.
##-- File Name: PineScript-main/ICT External and Internal Range Liquidity/Readme First.txt | File No: 11 | Ended --##

##-- File Name: PineScript-main/ICT External Range Liquidity/ICT External Range Liquidity Static Multi-timeframe (Swing High and Low).txt | File No: 12 | Started --##
// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © Arun_K_Bhaskar

//@version=5
i_max_bars_back = 4999
indicator(title='ICT External Range Liquidity Static Multi-timeframe (Swing High and Low)', shorttitle='ICT ERL', overlay=true, max_bars_back=i_max_bars_back, max_lines_count=500, max_labels_count=500)

//____________________________ Menu Pivot High Low Start

g_phl_qd = '███████████████ Quick On/Off ███████████████'
bool i_phl_1_show = input.bool(defval=true, title='Pivot High Low 1', group=g_phl_qd)
bool i_phl_2_show = input.bool(defval=true, title='Pivot High Low 2', group=g_phl_qd)
bool i_phl_3_show = input.bool(defval=true, title='Pivot High Low 3', group=g_phl_qd)
bool i_phl_eq_show = input.bool(defval=true, title='Equal Pivot High Low', group=g_phl_qd)

g_phl_co = '██████████████ Common Settings ██████████████'
string i_phl_1_source = input.string(defval='High/Low', title='Source', options=['High/Low', 'Open/Close'], group=g_phl_co)

g_phl_1 = '██████████████ Pivot High Low 1 ██████████████'
string i_phl_1_tf = input.timeframe(defval="15", title='Timeframe', group=g_phl_1)
int i_phl_1_left = input.int(defval=2, title='Left', group=g_phl_1)
int i_phl_1_right = input.int(defval=2, title='Right', group=g_phl_1)
int i_phl_1_showlast = input.int(defval=2, title='Show Last', minval=0, group=g_phl_1)
bool i_phl_1_ln_extend = input.bool(defval=false, title='Line Extend', group=g_phl_1)
color i_phl_1_h_ln_color = input.color(defval=#F7525F, title='High Color', group=g_phl_1)
color i_phl_1_l_ln_color = input.color(defval=#22AB94, title='Low Color', group=g_phl_1)
string i_phl_1_ln_stye = input.string(defval=line.style_solid, title='Line style', options=[line.style_solid, line.style_dashed, line.style_dotted], group=g_phl_1)
int i_phl_1_ln_width = input.int(defval=2, title='Line Width', minval=1, group=g_phl_1)
bool i_phl_1_lbl_show = input.bool(defval=false, title='Label', group=g_phl_1)

g_phl_2 = '██████████████ Pivot High Low 2 ██████████████'
string i_phl_2_tf = input.timeframe(defval="60", title='Timeframe', group=g_phl_2)
int i_phl_2_left = input.int(defval=2, title='Left', group=g_phl_2)
int i_phl_2_right = input.int(defval=2, title='Right', group=g_phl_2)
int i_phl_2_showlast = input.int(defval=2, title='Show Last', minval=0, group=g_phl_2)
bool i_phl_2_ln_extend = input.bool(defval=false, title='Line Extend', group=g_phl_2)
color i_phl_2_h_ln_color = input.color(defval=#F7525F, title='High Color', group=g_phl_2)
color i_phl_2_l_ln_color = input.color(defval=#22AB94, title='Low Color', group=g_phl_2)
string i_phl_2_ln_stye = input.string(defval=line.style_solid, title='Line style', options=[line.style_solid, line.style_dashed, line.style_dotted], group=g_phl_2)
int i_phl_2_ln_width = input.int(defval=2, title='Line Width', minval=1, group=g_phl_2)
bool i_phl_2_lbl_show = input.bool(defval=false, title='Label', group=g_phl_2)

g_phl_3 = '██████████████ Pivot High Low 3 ██████████████'
string i_phl_3_tf = input.timeframe(defval="240", title='Timeframe', group=g_phl_3)
int i_phl_3_left = input.int(defval=2, title='Left', group=g_phl_3)
int i_phl_3_right = input.int(defval=2, title='Right', group=g_phl_3)
int i_phl_3_showlast = input.int(defval=2, title='Show Last', minval=0, group=g_phl_3)
bool i_phl_3_ln_extend = input.bool(defval=false, title='Line Extend', group=g_phl_3)
color i_phl_3_h_ln_color = input.color(defval=#F7525F, title='High Color', group=g_phl_3)
color i_phl_3_l_ln_color = input.color(defval=#22AB94, title='Low Color', group=g_phl_3)
string i_phl_3_ln_stye = input.string(defval=line.style_solid, title='Line style', options=[line.style_solid, line.style_dashed, line.style_dotted], group=g_phl_3)
int i_phl_3_ln_width = input.int(defval=2, title='Line Width', minval=1, group=g_phl_3)
bool i_phl_3_lbl_show = input.bool(defval=false, title='Label', group=g_phl_3)

g_phl_eq = '███████████████ Equal High Low ███████████████'
int i_phl_eq_left = input.int(defval=60, title='Left', group=g_phl_eq)
int i_phl_eq_right = input.int(defval=30, title='Right', group=g_phl_eq)
tt_eq = "Lower values mean highs and lows are closer."
float i_phl_eq_percent = input.float(defval=0.05, minval=0, step=0.01, title='Equal HL %', tooltip=tt_eq, group=g_phl_eq) 
color i_phl_eq_h_ln_color = input.color(defval=#F7525F, title='Bearish Color', group=g_phl_eq)
color i_phl_eq_l_ln_color = input.color(defval=#22AB94, title='Bullish Color', group=g_phl_eq)
int i_phl_eq_transp = input.int(defval=25, minval=0, title='Transparency', group=g_phl_eq) 

//____________________________ Menu Pivot High Low End


//____________________________ Pivot High Low Common Functions Start

// Acknowledgement & Reference
// Trader: "lmatl"
// Indicator Title: "Pivot mtf semaphore support&resistance [LM]"
// Indicator Link: "https://www.tradingview.com/script/OZDSeSQd-Pivot-mtf-semaphore-support-resistance-LM/"

f_offsetToP(_src, _pivotPrice, _maxBack) =>
    int _offset = na
    float _delta = 10e10
    if not na(_pivotPrice)
        for _i = 1 to _maxBack by 1
            _thisDelta = math.abs(_src[_i] - _pivotPrice)
            if _thisDelta < _delta
                _delta := _thisDelta
                _offset := _i
                _offset
    _offset

f_resInMinutes() =>
    _resInMinutes = timeframe.multiplier * (timeframe.isseconds ? 1. / 60. : timeframe.isminutes ? 1. : timeframe.isdaily ? 1440. : timeframe.isweekly ? 10080. : timeframe.ismonthly ? 43800. : na)
    _resInMinutes

f_tfResInMinutes(_resolution) =>
    request.security(syminfo.tickerid, _resolution, f_resInMinutes())

f_extendArray(_lineArray, _labelArray, _extendLines) =>
    if array.size(_lineArray) > 0
        for _i = array.size(_lineArray) - 1 to 0 by 1

            x2 = line.get_x2(array.get(_lineArray, _i))
            yValue = line.get_y1(array.get(_lineArray, _i))

            if _extendLines or bar_index - 1 == x2 and not(high > yValue and low < yValue)
                line.set_x2(array.get(_lineArray, _i), bar_index)
                label.set_x(array.get(_labelArray, _i), bar_index)
            float(na)

f_drawLine(_x1, _x2, _yValue, _lineColor, _lineThickness, _lineStyle) =>
    line.new(x1=_x1, y1=_yValue, x2=_x2, y2=_yValue, color=_lineColor, style=_lineStyle, width=_lineThickness)

f_drawLabel(label_show, _x, _y, _textColor) =>
    if label_show
        label.new(_x, _y, '      ' + str.tostring(_y), xloc.bar_index, yloc.price, #00000000, label.style_none, _textColor)

f_drawPivotLineAndLabel(label_show, _x1, _x2, _yValue, _colorLine, _lineCount, _lineThickness, _lineStyle, _pivotArray, _labelArray) =>
    line l = f_drawLine(_x1, _x2, _yValue, _colorLine, _lineThickness, _lineStyle)
    label lab = f_drawLabel(label_show, _x1, _yValue, _colorLine)

    if array.size(_pivotArray) == _lineCount
        line.delete(array.shift(_pivotArray))
        label.delete(array.shift(_labelArray))
    array.push(_pivotArray, l)
    array.push(_labelArray, lab)

f_addLines(label_show, _htfPH, _htfPL, _offsetToPH, _offsetToPL, _newPH, _newPL, h_color, l_color, _lineCount, _lineThickness, _lineStyle, _pivotArray, _pivotLabelArray) =>
    if _newPH
        int x1 = bar_index - _offsetToPH
        int x2 = bar_index
        float yValue = _htfPH
        f_drawPivotLineAndLabel(label_show, x1, x2, yValue, h_color, _lineCount, _lineThickness, _lineStyle, _pivotArray, _pivotLabelArray)
        
    if _newPL
        int x1 = bar_index - _offsetToPL
        int x2 = bar_index
        float yValue = _htfPL
        f_drawPivotLineAndLabel(label_show, x1, x2, yValue, l_color, _lineCount, _lineThickness, _lineStyle, _pivotArray, _pivotLabelArray)

//____________________________ Pivot High Low Common Functions End

// Common Calculations
var res_in_minutes = f_resInMinutes()

// Get Source
float _high = i_phl_1_source == 'Open/Close' ? math.max(open, close) : high
float _low = i_phl_1_source == 'Open/Close' ? math.min(open, close) : low


//____________________________ Pivot High Low 1 Get Data & Draw Start

// Arrays
var phl_1_ln_arr = array.new_line(i_phl_1_showlast)
var phl_1_lbl_arr = array.new_label(i_phl_1_showlast)

// Get Data
phl_1_bars_htf = int(f_tfResInMinutes(i_phl_1_tf) / res_in_minutes)
phl_1_bars_offset = int(i_phl_1_left * phl_1_bars_htf)

phl_1_ph = ta.pivothigh(_high, i_phl_1_left, i_phl_1_right)
phl_1_pl = ta.pivotlow(_low, i_phl_1_left, i_phl_1_right)

phl_1_ph_htf = request.security(syminfo.tickerid, i_phl_1_tf, phl_1_ph)
phl_1_pl_htf = request.security(syminfo.tickerid, i_phl_1_tf, phl_1_pl)
phl_1_ph_new = na(phl_1_ph_htf[1]) and not na(phl_1_ph_htf)
phl_1_pl_new = na(phl_1_pl_htf[1]) and not na(phl_1_pl_htf)

phl_1_ph_offset = f_offsetToP(_high, phl_1_ph_htf, math.min(i_max_bars_back, math.max(30, phl_1_bars_offset + phl_1_bars_htf + 1)))
phl_1_pl_offset = f_offsetToP(_low, phl_1_pl_htf, math.min(i_max_bars_back, math.max(30, phl_1_bars_offset + phl_1_bars_htf + 1)))

// Draw
if i_phl_1_show and phl_1_bars_offset <= i_max_bars_back
    f_addLines(i_phl_1_lbl_show, phl_1_ph_htf, phl_1_pl_htf, phl_1_ph_offset, phl_1_pl_offset, phl_1_ph_new, phl_1_pl_new, i_phl_1_h_ln_color, i_phl_1_l_ln_color, i_phl_1_showlast, i_phl_1_ln_width, i_phl_1_ln_stye, phl_1_ln_arr, phl_1_lbl_arr)   

if i_phl_1_show
    f_extendArray(phl_1_ln_arr, phl_1_lbl_arr, i_phl_1_ln_extend)
//____________________________ Pivot High Low 1 Get Data & Draw End


//____________________________ Pivot High Low 2 Get Data & Draw Start

// Arrays
var phl_2_ln_arr = array.new_line(i_phl_2_showlast)
var phl_2_lbl_arr = array.new_label(i_phl_2_showlast)

// Get Data
phl_2_bars_htf = int(f_tfResInMinutes(i_phl_2_tf) / res_in_minutes)
phl_2_bars_offset = int(i_phl_2_left * phl_2_bars_htf)

float phl_2_ph = ta.pivothigh(_high, i_phl_2_left, i_phl_2_right)
float phl_2_pl = ta.pivotlow(_low, i_phl_2_left, i_phl_2_right)

phl_2_ph_htf = request.security(syminfo.tickerid, i_phl_2_tf, phl_2_ph)
phl_2_pl_htf = request.security(syminfo.tickerid, i_phl_2_tf, phl_2_pl)
phl_2_ph_new = na(phl_2_ph_htf[1]) and not na(phl_2_ph_htf)
phl_2_pl_new = na(phl_2_pl_htf[1]) and not na(phl_2_pl_htf)

phl_2_ph_offset = f_offsetToP(_high, phl_2_ph_htf, math.min(i_max_bars_back, math.max(30, phl_2_bars_offset + phl_2_bars_htf + 1)))
phl_2_pl_offset = f_offsetToP(_low, phl_2_pl_htf, math.min(i_max_bars_back, math.max(30, phl_2_bars_offset + phl_2_bars_htf + 1)))

// Draw
if i_phl_2_show and phl_2_bars_offset <= i_max_bars_back
    f_addLines(i_phl_2_lbl_show, phl_2_ph_htf, phl_2_pl_htf, phl_2_ph_offset, phl_2_pl_offset, phl_2_ph_new, phl_2_pl_new, i_phl_2_h_ln_color, i_phl_2_l_ln_color, i_phl_2_showlast, i_phl_2_ln_width, i_phl_2_ln_stye, phl_2_ln_arr, phl_2_lbl_arr)   

if i_phl_2_show
    f_extendArray(phl_2_ln_arr, phl_2_lbl_arr, i_phl_2_ln_extend)

//____________________________ Pivot High Low 2 Get Data & Draw End


//____________________________ Pivot High Low 3 Get Data & Draw Start

// Arrays
var phl_3_ln_arr = array.new_line(i_phl_3_showlast)
var phl_3_lbl_arr = array.new_label(i_phl_3_showlast)

// Get Data
phl_3_bars_htf = int(f_tfResInMinutes(i_phl_3_tf) / res_in_minutes)
phl_3_bars_offset = int(i_phl_3_left * phl_3_bars_htf)

float phl_3_ph = ta.pivothigh(_high, i_phl_3_left, i_phl_3_right)
float phl_3_pl = ta.pivotlow(_low, i_phl_3_left, i_phl_3_right)

phl_3_ph_htf = request.security(syminfo.tickerid, i_phl_3_tf, phl_3_ph)
phl_3_pl_htf = request.security(syminfo.tickerid, i_phl_3_tf, phl_3_pl)
phl_3_ph_new = na(phl_3_ph_htf[1]) and not na(phl_3_ph_htf)
phl_3_pl_new = na(phl_3_pl_htf[1]) and not na(phl_3_pl_htf)

phl_3_ph_offset = f_offsetToP(_high, phl_3_ph_htf, math.min(i_max_bars_back, math.max(30, phl_3_bars_offset + phl_3_bars_htf + 1)))
phl_3_pl_offset = f_offsetToP(_low, phl_3_pl_htf, math.min(i_max_bars_back, math.max(30, phl_3_bars_offset + phl_3_bars_htf + 1)))

// Draw
if i_phl_3_show and phl_3_bars_offset <= i_max_bars_back
    f_addLines(i_phl_3_lbl_show, phl_3_ph_htf, phl_3_pl_htf, phl_3_ph_offset, phl_3_pl_offset, phl_3_ph_new, phl_3_pl_new, i_phl_3_h_ln_color, i_phl_3_l_ln_color, i_phl_3_showlast, i_phl_3_ln_width, i_phl_3_ln_stye, phl_3_ln_arr, phl_3_lbl_arr)   

if i_phl_3_show
    f_extendArray(phl_3_ln_arr, phl_3_lbl_arr, i_phl_3_ln_extend)

//____________________________ Pivot High Low 3 Get Data & Draw End


//____________________________ Equal High Low Start

phl_eq_ph = ta.pivothigh(_high, i_phl_eq_left, i_phl_eq_right)
phl_eq_pl = ta.pivotlow(_low, i_phl_eq_left, i_phl_eq_right)

i_phl_eq_tf = ""
phl_eq_ph_htf = request.security(syminfo.tickerid, i_phl_eq_tf, phl_eq_ph)
phl_eq_pl_htf = request.security(syminfo.tickerid, i_phl_eq_tf, phl_eq_pl)

// Arrays to store the last 2 pivot highs and lows
var float[] ph_arr = array.new_float(2)
var int[] ph_bi_arr = array.new_int(2)
var float[] pl_arr = array.new_float(2)
var int[] pl_bi_arr = array.new_int(2)

// Pivot calculations
int prev_ph_bi = na, int prev_pl_bi = na
bool active_ph = false, bool active_pl = false
bool ph = false, bool pl = false

// Update the arrays with the last 2 pivot highs and lows
if not na(phl_eq_ph_htf)
    ph := true
    prev_ph_bi := bar_index - i_phl_eq_right
    array.unshift(ph_bi_arr, bar_index)
    array.pop(ph_bi_arr)

if not na(phl_eq_pl_htf)
    pl := true
    prev_pl_bi := bar_index - i_phl_eq_right
    array.unshift(pl_bi_arr, bar_index)
    array.pop(pl_bi_arr)

// Function to update the arrays with the last 2 values
update_arrays(value, array_ref) =>
    array.unshift(array_ref, value)
    array.pop(array_ref)

// Update arrays with the last 2 pivot highs and lows
if ph
    update_arrays(phl_eq_ph_htf, ph_arr)
if pl
    update_arrays(phl_eq_pl_htf, pl_arr)

// Get last two pivot highs and lows
ph_price_0 = array.get(ph_arr, 0), ph_price_1 = array.get(ph_arr, 1)
ph_bi_0 = array.get(ph_bi_arr, 0), ph_bi_1 = array.get(ph_bi_arr, 1)

pl_price_0 = array.get(pl_arr, 0), pl_price_1 = array.get(pl_arr, 1)
pl_bi_0 = array.get(pl_bi_arr, 0), pl_bi_1 = array.get(pl_bi_arr, 1)

// Function to calculate percentage change
pchg(price_1, price_2) =>
    change = price_1 - price_2
    percent_change = math.abs((change / price_2) * 100)
    percent_change

// Calculate percentage change between the last two pivot highs and lows
var float ph_pchg = na
var float pl_pchg = na

if array.size(ph_arr) >= 2
    ph_pchg := pchg(array.get(ph_arr, 0), array.get(ph_arr, 1))

if array.size(pl_arr) >= 2
    pl_pchg := pchg(array.get(pl_arr, 0), array.get(pl_arr, 1))

// Draw Equals Box
var levelBoxes_equal=array.new_box()

if i_phl_eq_show and ph and ph_pchg < i_phl_eq_percent
    ph_box = box.new(left=ph_bi_1 - i_phl_eq_right, top=ph_price_1, right=ph_bi_0 - i_phl_eq_right, bottom=ph_price_0, border_color=color.new(i_phl_eq_h_ln_color, i_phl_eq_transp), bgcolor=color.new(i_phl_eq_h_ln_color, i_phl_eq_transp))
    array.push(levelBoxes_equal, ph_box)
if i_phl_eq_show and pl and pl_pchg < i_phl_eq_percent
    pl_box = box.new(left=pl_bi_1 - i_phl_eq_right, top=pl_price_1, right=pl_bi_0 - i_phl_eq_right, bottom=pl_price_0, border_color=color.new(i_phl_eq_l_ln_color, i_phl_eq_transp), bgcolor=color.new(i_phl_eq_l_ln_color, i_phl_eq_transp))
    array.push(levelBoxes_equal, pl_box)

// Plot Equal Labels
plotshape(i_phl_eq_show and pl and pl_pchg < i_phl_eq_percent ? low[i_phl_eq_right] : na, style=shape.xcross, location=location.absolute, offset=-i_phl_eq_right, color=color.new(i_phl_eq_l_ln_color, i_phl_eq_transp), size=size.small)
plotshape(i_phl_eq_show and ph and ph_pchg < i_phl_eq_percent ? high[i_phl_eq_right] : na, style=shape.xcross, location=location.absolute, offset=-i_phl_eq_right, color=color.new(i_phl_eq_h_ln_color, i_phl_eq_transp), size=size.small)

//____________________________ Equal High Low End

//____________________________ CODE END
##-- File Name: PineScript-main/ICT External Range Liquidity/ICT External Range Liquidity Static Multi-timeframe (Swing High and Low).txt | File No: 12 | Ended --##

##-- File Name: PineScript-main/ICT External Range Liquidity/Readme First.txt | File No: 13 | Started --##
Relevance of this indicator:
1. This indicator is useful because it keeps its levels the same, even when you change the chart's timeframe, making it reliable for analysis.
2. This indicator also displays equal highs and lows, which serve as crucial reference points for analysis.

Reference Videos: The indicator is developed based on the following video contents.

Original The Inner Circle Trader Video:
Video Title: ICT Mentorship Core Content - Month 04 - Reinforcing Liquidity Concepts & Price Delivery
Video Link: https://www.youtube.com/watch?v=npL3ZXJ5zOU

A Simplified Explanation from TTrades:
Video Title: Internal & External Liquidity (Daily Bias) - ICT Concepts
Video Link: https://www.youtube.com/watch?v=3OivsP1j_UE&t=1s

The indicator is based on the following indicator:
Indicator Title: "Pivot mtf semaphore support&resistance [LM]"
Indicator Link: "https://www.tradingview.com/script/OZDSeSQd-Pivot-mtf-semaphore-support-resistance-LM/"

Note:
Please note that the information provided is purely suggested for educational purposes and not intended as promotion. There are no personal preferences involved, and no endorsement of any individual or entity is implied.
##-- File Name: PineScript-main/ICT External Range Liquidity/Readme First.txt | File No: 13 | Ended --##

##-- File Name: PineScript-main/ICT Fair Value Gap (FVG) Scanner/Readme First.txt | File No: 14 | Started --##
// Readme First:

// ICT Fair Value Gap (FVG) Scanner

// Logic
//   - A fully filled Fair Value Gap (FVG) is more likely to bounce back with strong momentum.
//   - If the FVG is larger in height, the probability of a bounce back increases.
//   - In most live trading sessions by ICT, a large FVG is often filled slowly or with high resistance.
//   - This is similar to filling a Liquidity Void.

// Notes
//   - Use a higher timeframe, like 1 hour, for stock selection.
//   - The Scanner will generate wrong signals also.
##-- File Name: PineScript-main/ICT Fair Value Gap (FVG) Scanner/Readme First.txt | File No: 14 | Ended --##

##-- File Name: PineScript-main/ICT Fair Value Gap (FVG) Scanner/Scanner - ICT Fair Value Gap (FVG) Scanner.txt | File No: 15 | Started --##
// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © Arun_K_Bhaskar

//@version=6
indicator(title = 'ICT Fair Value Gap (FVG) Scanner v2', shorttitle = 'FVG Scan v2', overlay = true, max_boxes_count = 500)

//___________________________ Menu Screener Start

g_scrtb = '█████████████████ Scanner █████████████████'

string i_scr_choose = input.string(defval = 'First Touch Confirmed', title = 'Scanning Method', options = ['FVG %', 'First Touch', 'First Touch Confirmed',  'Full Fill', 'Full Fill Confirmed', 'Reversal'], group = g_scrtb)

string tt_is = 
 "• Reads only up to first 40 symbols." +
 "\n• Total characters cannot exceed 4096." +
 "\n• Eg: EXCHANGE:SYMBOL_A,EXCHANGE:SYMBOL_B"

string i_symbols = input.text_area(
 defval="NSE:ABFRL,NSE:BANDHANBNK,NSE:BHEL,NSE:BLS,NSE:CENTRALBK,NSE:CESC,NSE:ENGINERSIN,NSE:EXIDEIND,NSE:FINPIPE,NSE:HINDCOPPER,NSE:IEX,NSE:IGL,NSE:IIFL,NSE:INOXWIND,NSE:IOB,NSE:IRB,NSE:IRCON,NSE:IRFC,NSE:LTF,NSE:MAHABANK,NSE:MANAPPURAM,NSE:MMTC,NSE:MRPL,NSE:NATIONALUM,NSE:NETWORK18,NSE:NLCINDIA,NSE:NMDC,NSE:PPLPHARMA,NSE:RAILTEL,NSE:RBLBANK,NSE:RCF,NSE:RTNINDIA,NSE:SAIL,NSE:SAMMAANCAP,NSE:SBFC,NSE:SCI,NSE:SJVN,NSE:SUZLON,NSE:TTML,NSE:FSL", 
 title="Paste Symbols", tooltip=tt_is, group=g_scrtb)

bool i_scr_show_table = input.bool(defval = true, title = 'Display Table', group = g_scrtb)
bool i_scr_show_long = input.bool(defval = true, title = 'Long Signals', inline = 'tb_2', group = g_scrtb)
bool i_scr_show_short = input.bool(defval = true, title = 'Short Signals', inline = 'tb_2', group = g_scrtb)

int i_scr_tbl_disp_rows = input.int(defval = 12, title = 'Display Rows', minval = 0, maxval = 100, group = g_scrtb)
string i_scr_tbl_position = input.string(defval = position.bottom_left, title = 'Table Position', options = [position.top_left, position.top_center, position.top_right, position.middle_left, position.middle_center, position.middle_right, position.bottom_left, position.bottom_center, position.bottom_right], group = g_scrtb)
string i_scr_tbl_text_size = input.string(defval = size.small, title = 'Table Size', options = [size.auto, size.tiny, size.small, size.normal, size.large, size.huge], group = g_scrtb)

//___________________________ Menu Screener End

//___________________________ Menu Indicators Start

g_gap = '███████████████████ FVG ███████████████████'

bool closeGapsPartially = input.bool(defval = true, title = 'Close FVG Partially', group = g_gap)
int boxLimitInput = input.int(defval = 15, title = 'Max Number of FVG', minval = 1, maxval = 500, group = g_gap)
string minimalDeviationTooltip = 'Specifies the minimal size of detected gaps, as a percentage of the average high-low range for the last 14 bars.'
float minimalDeviationInput = nz(input.float(defval = 70.0, title = 'Minimal Deviation (%)', tooltip = minimalDeviationTooltip, minval = 1, maxval = 100, group = g_gap) / 100 * ta.sma(high - low, 14))
bool limitBoxLengthBoolInput = input.bool(defval = false, title = 'Max Bars', tooltip = 'Limit Max Gap Trail Length (bars)', inline = 'Length Limit', group = g_gap)
int limitBoxLengthIntInput = input.int(defval = 300, title = '', inline = 'Length Limit', minval = 1, group = g_gap)

//___________________________ Menu Indicators End

//___________________________ Menu Additional Fiters Start

g_af = '██████████████ Additional Fiters ██████████████'
tt_pchg = 
 "• If '% Change Above/Below +/-' is 4, it means relative volume is considered when the price change is above 4%." +
 "\n• A value of 4% is positive for bullish scenarios and negative for bearish scenarios." +
 "\n• The percentage change is calculated using cumulative percentage change, so there might be a minor difference between the actual and displayed percentage change."
tt_vpchg = 
 "• If 'Volume % Change Above' is 0, it means Relative Volume is considered when today's volume is greater than the previous day's volume." +
 "\n• For 'Screening Method' choice 'Retracement to EMA,' the 'Apply Volume % Change Filter' can be unchecked." +
 "\n• A 'Volume % Change Above' 300% or more often indicates a major breakout, which may happen today or the next day." +
 "\n• The volume percentage change is calculated using cumulative percentage change, so there might be a minor difference between the actual and displayed percentage change."
tt_atr = 
 "• ATR helps filter out longer or more volatile signal candles."
tt_atr_mul =
 "• Higher multiplier value filters a longer or more volatile signal candle."
tt_bf =
 "• If the input is '80', it means the body covers over 80% of the candle."
tt_bs =
 "• 2 means the candle is 2 times larger than the previous candle."
tt_vol =
 "• Filter out a candle when its volume is greater than the SMA of the volume."
tt_rv =
 "• Filter out a candle when its volume is greater than the Relative Volume."
tt_tf =
 "• Filter out a signals between the given Time."
tt_df =
 "• Filter out a signals on the given Date." +
  "\n• This Time Filter is applicable only for 'Displacement Candles'."

bool i_pchg_filter = input.bool(defval = false, title = 'Apply % Change Filter', tooltip = tt_pchg, group = g_af)
float i_pchg_above_below = input.float(defval = 2, title = '% Change Above/Below +/-', minval = 0, group = g_af)

bool i_vol_filter = input.bool(defval = false, title = 'Apply Volume Filter', tooltip = tt_vpchg, group = g_af)
int i_vol_above = input.int(defval = 500000, title = 'Volume Above', minval = 0, group = g_af)

bool i_vol_pchg_filter = input.bool(defval = false, title = 'Apply Volume % Change Filter', tooltip = tt_vpchg, group = g_af)
float i_vol_pchg_above = input.float(defval = 0, title = 'Volume % Change Above', minval = 0, group = g_af)

bool i_atr_filter = input.bool(defval = false, title = 'Apply ATR Filter', tooltip = tt_atr, group = g_af)
int i_atr_length = input.int(defval = 14, minval = 1, title = 'ATR Length', group = g_af)
float i_atr_multi = input.float(defval = 1, title = 'ATR Multiplier', minval = 1, group = g_af)

bool i_body_filter = input.bool(defval = false, title = 'Apply Body % Filter', tooltip = tt_bf, group = g_af)
float i_body_percent = input.float(defval = 70, title = 'Body % Above', minval = 0, maxval = 100, group = g_af) / 100

bool i_body_size_filter = input.bool(defval = false, title = 'Apply Body Size Filter', tooltip = tt_bs, group = g_af)
int i_body_size_multiplier = input.int(defval = 2, title = 'Body Size Multiplier (x)', minval = 0, group = g_af)

bool i_volume_filter = input.bool(defval = false, title = 'Apply Volume Filter', tooltip = tt_vol, group = g_af)
int i_vol_sma_length = input.int(defval = 20, minval = 1, title = 'Volume SMA Length', group = g_af)

bool i_rel_vol_filter = input.bool(defval = false, title = 'Apply Relative Volume Filter', tooltip = tt_rv, group = g_af)
int i_rel_vol_avg_vol_len = input.int(defval = 90, title = 'Relative Volume Length', minval = 2, group = g_af)
float i_rel_vol_avg_vol_multi = input.float(defval = 5, title = 'Rel Vol SMA Multiplier', minval = 0, group = g_af)

bool i_time_filter = input.bool(defval = false, title = 'Apply Time Filter', tooltip = tt_tf, group = g_af)
int i_hour_1 = input.int(defval = 9, minval = 0, title = 'Time From', inline = 't_1', group = g_af)
int i_minute_1 = input.int(defval = 15, minval = 0, title = ':', inline = 't_1', group = g_af)
int i_hour_2 = input.int(defval = 10, minval = 0, title = 'Time To ', inline = 't_2', group = g_af)
int i_minute_2 = input.int(defval = 15, minval = 0, title = ':', inline = 't_2', group = g_af)

bool i_date_filter = input.bool(defval = false, title = 'Apply Date Filter', tooltip = tt_df, group = g_af)
int i_day = input.int(defval = 25, minval = 1, maxval = 31, title = 'Day', group = g_af)
int i_month = input.int(defval = 10, minval = 1, maxval = 12, title = 'Month', group = g_af)
int i_year = input.int(defval = 2024, minval = 0, title = 'Year', group = g_af)

//___________________________ Menu Additional Fiters End

//___________________________ Menu Table Start

g_dtb = '█████████████████ Data Table █████████████████'
bool i_tbl_data_show = input.bool(defval = true, title = 'Display Table', group = g_dtb)
string i_tbl_data_pos = input.string(defval = position.bottom_right, title = 'Position', options = [position.top_left, position.top_center, position.top_right, position.middle_left, position.middle_center, position.middle_right, position.bottom_left, position.bottom_center, position.bottom_right], group = g_dtb)
string i_tbl_data_txt_size = input.string(defval = size.normal, title = 'Size', options = [size.auto, size.tiny, size.small, size.normal, size.large, size.huge], group = g_dtb)

//___________________________ Menu Table End

//___________________________ Chart Settings Start

g_ch = '███████████████ Chart Settings ███████████████'
color i_pos_dark_color = input.color(defval = #03110F, title = 'Positive Dark', group = g_ch)
color i_pos_color = input.color(defval = #089981, title = 'Positive Mid', group = g_ch)
color i_pos_light_color = input.color(defval = #ACE5DC, title = 'Positive Light', group = g_ch)
color i_neg_light_color = input.color(defval = #FCCBCD, title = 'Negative Light', group = g_ch)
color i_neg_color = input.color(defval = #F23645, title = 'Negative Mid', group = g_ch)
color i_neg_dark_color = input.color(defval = #180809, title = 'Negative Dark', group = g_ch)
color i_indicator_color = input.color(defval = #2962FF, title = 'Indicator', group = g_ch)
color i_signal_color = input.color(defval = #FB8C00, title = 'Signal', group = g_ch)
color i_neu_color = input.color(defval = #9598A1, title = 'Neutral Light', group = g_ch)
color i_neu_mid_color = input.color(defval = #2A2E39, title = 'Neutral Mid', group = g_ch)
color i_neu_dark_color = input.color(defval = #141516, title = 'Neutral Dark', group = g_ch)

float i_transp = input.float(defval=70, title="Transp", minval = 0, maxval = 100, group=g_ch)

//___________________________ Chart Settings End

//___________________________ FVG Start

type AlertInfo
    int countOpenGap
    int countClosedGap

method hasOpenedGap(AlertInfo this) =>
    this.countOpenGap > 0

method hasClosedGap(AlertInfo this) =>
    this.countClosedGap > 0

AlertInfo alertInfo = AlertInfo.new(0, 0)

//@type A representation of a chart gap and all box drawings that it consists of.
//@field isActive If 'true', the gap has not yet been closed and is still being extended on the chart.
//@field isBull The direction of the gap: 'true' for upward gaps and 'false' for downward ones.
//@field inactiveBoxes An array of all boxes that have been drawn for this gap. The last element of the array is the box on the chart that is currently extended further.
type Gap
    bool isActive
    bool isBull
    array<box> boxes

//@function Deletes all of the boxes that were drawn to represent the gap.
method delete(Gap this) =>
    for _box in this.boxes
        _box.delete()

add_transp = 20

//@function Closes the gap partially, stopping the previous box and creating a new, smaller box to continue the gap instead.
method partialClose(Gap this) =>
    activeBox = this.boxes.last()
    activeBox.set_extend(extend.none)

    top = this.isBull ? activeBox.get_top() : low
    bottom = this.isBull ? high : activeBox.get_bottom()

    this.boxes.push(box.new(
      bar_index,
      top,
      bar_index,
      bottom, 
      this.isBull ? color.new(i_neg_color, i_transp + add_transp) : color.new(i_pos_color, i_transp + add_transp), 
      bgcolor = this.isBull ? color.new(i_neg_color, i_transp) : color.new(i_pos_color, i_transp)))
    

//@function Closes the gap fully, stopping the box from being extended.
method fullClose(Gap this) =>
    alertInfo.countClosedGap += 1
    activeBox = this.boxes.last()
    activeBox.set_extend(extend.none)
    this.isActive := false
    if closeGapsPartially
        activeBox.delete()    

method checkForClose(Gap this) =>
    if this.isActive
        activeBox = this.boxes.last()
        top = activeBox.get_top() 
        bot = activeBox.get_bottom()
        isBull = this.isBull
        activeBox.set_right(bar_index)

        if (high > bot and isBull) or (low < top and not isBull)
            if closeGapsPartially
                this.partialClose()                
            else
                this.fullClose()

        bool forceCloseBoxExceededLengthLimit = (limitBoxLengthBoolInput and bar_index - activeBox.get_left() >= limitBoxLengthIntInput)
        if ((high > top and isBull) or (low < bot and not isBull)) or forceCloseBoxExceededLengthLimit
            this.fullClose()

var allGaps = array.new<Gap>()

// Detect gaps.
isFVGDown = high < low[2] and low[2] - high >= minimalDeviationInput
isFVGUp = low > high[2] and low - high[2] >= minimalDeviationInput
isFVG = isFVGDown or isFVGUp
boxBorderColor = isFVGDown ? color.new(i_neg_color, i_transp + add_transp) : color.new(i_pos_color, i_transp + add_transp)
boxBgcolor = isFVGDown ? color.new(i_neg_color, i_transp) : color.new(i_pos_color, i_transp)

registerNewGap(bool isFVGDown) => 
    alertInfo.countOpenGap += 1
    
    newBox = box.new(
      bar_index - 2,
      (isFVGDown ? low[2] : low),
      bar_index,
      (isFVGDown ? high : high[2]),
      border_color = boxBorderColor,
      bgcolor = boxBgcolor,
      extend = extend.right)

    allGaps.push(Gap.new(true, isFVGDown, array.from(newBox)))

    if allGaps.size() > boxLimitInput
        allGaps.shift().delete()

// Detect covering of gaps.
for gap in allGaps
    gap.checkForClose()

// Add a box for each new gap, removing the oldest one if needed.
if isFVG    
    registerNewGap(isFVGDown)
        
if barstate.islastconfirmedhistory and allGaps.size() == 0
    noGapText = "No gaps found on the current chart. \n The cause could be that some exchanges align the open of new bars on the close of the previous one, resulting in charts with no gaps. Alternatively, your Minimal Deviation might be too high."
    var infoTable = table.new(position.bottom_right, 1, 1)
    table.cell(infoTable, 0, 0, text = noGapText, text_color = chart.bg_color, bgcolor = chart.fg_color)

//alertcondition(alertInfo.hasOpenedGap(), "New Gap Appeared", "A new gap has appeared.")
//alertcondition(alertInfo.hasClosedGap(), "Gap Closed", "A gap was closed.")

// Define numeric values for plotting gaps
var isFVGDown_top = float(na)
var isFVGDown_bottom = float(na)
var float FVGDownPercent = na
if isFVGDown
    isFVGDown_top := low[2]
    isFVGDown_bottom := high
    FVGDownPercent := (low[2] - high) / low[2] * 100
    FVGDownPercent

var isFVGUp_top = float(na)
var isFVGUp_bottom = float(na)
var float FVGUpPercent = na
if isFVGUp
    isFVGUp_top := low
    isFVGUp_bottom := high[2]
    FVGUpPercent := (low - high[2]) / high[2] * 100
    FVGUpPercent

// Plot
plot(series = isFVGDown_top, title = 'FVG Down Top', color = i_neg_color, display = display.none)
plot(series = isFVGDown_bottom, title = 'FVG Down Bottom', color = i_neg_color, display = display.none)
plot(series = isFVGUp_top, title = 'FVG Up Top', color = i_pos_color, display = display.none)
plot(series = isFVGUp_bottom, title = 'FVG Up Bottom', color = i_pos_color, display = display.none)

//___________________________ FVG End

//___________________________ Cumulative Percentage Change Start

// Function to calculate Daily Cumulative Percentage Change of Close Price
cumulative_percentage_change() =>
    var float _cum_pct_change = na
    _is_new_day = ta.change(time('D')) != 0 ? 1 : 0
    _daily_pct_change = na(close[1]) ? 0 : (close - close[1]) / close[1] * 100
    _cum_pct_change := bool(_is_new_day) ? _daily_pct_change : na(_cum_pct_change) ? _daily_pct_change : _cum_pct_change + _daily_pct_change
    _cum_pct_change

// Calculate current cumulative percentage change
cum_pchg = cumulative_percentage_change()

//___________________________ Cumulative Percentage Change End

//___________________________ Cumulative Volume Percentage Change Start

// Function to calculate Daily Cumulative Volume
cumulative_volume() =>
    var float _cum_vol = na
    _is_new_day = ta.change(time('D')) != 0 ? 1 : 0
    _cum_vol := bool(_is_new_day) ? volume : na(_cum_vol) ? volume : _cum_vol + volume
    _cum_vol

// Calculate current and previous day cumulative volumes
var float current_cum_vol = na
var float prev_cum_vol = na

if ta.change(time('D')) != 0
    prev_cum_vol := current_cum_vol
    current_cum_vol := volume
    current_cum_vol
else
    current_cum_vol := current_cum_vol + volume
    current_cum_vol

// Calculate Cumulative Volume Percentage Change
cum_vol_pchg = (current_cum_vol - nz(prev_cum_vol, current_cum_vol)) / nz(prev_cum_vol, current_cum_vol) * 100

//___________________________ Cumulative Volume Percentage Change End

//___________________________ Additional Filters Start

// % Change Filter
bool pchg_above_filter = true
bool pchg_below_filter = true
if i_pchg_filter
    pchg_above_filter := cum_pchg > i_pchg_above_below
    pchg_below_filter := cum_pchg < -i_pchg_above_below
    pchg_below_filter

// Volume Filter
bool vol_filter = true
if i_vol_filter
    vol_filter := current_cum_vol >= i_vol_above
    vol_filter

// Volume % Change Filter
bool vol_pchg_filter = true
if i_vol_pchg_filter
    vol_pchg_filter := cum_vol_pchg >= i_vol_pchg_above
    vol_pchg_filter

// ATR Filter
bool atr_filter = true
if i_atr_filter
    atr_filter := high - low > ta.atr(i_atr_length) * i_atr_multi
    atr_filter

// Body Percent Filter
bool body_filter = true
if i_body_filter
    body_filter := math.abs(close - open) / (high - low) >= i_body_percent
    body_filter

// Body Size Filter
bool body_size_filter = true
if i_body_size_filter
    body_size_filter := math.abs(close - open) / (high - low) >= i_body_percent and high - low >= (high[1] - low[1]) * i_body_size_multiplier
    body_size_filter

// Volume SMA Filter
bool volume_filter = true
if i_volume_filter
    volume_filter := volume > ta.sma(volume, i_vol_sma_length)
    volume_filter

// Continuous Signals Filter
average_volume = ta.sma(volume, i_rel_vol_avg_vol_len)
relative_volume = volume / average_volume[1]
rel_vol_sma_multiplier = ta.sma(relative_volume, i_rel_vol_avg_vol_len) * i_rel_vol_avg_vol_multi

bool rel_vol_filter = true
if i_rel_vol_filter
    rel_vol_filter := relative_volume > rel_vol_sma_multiplier
    rel_vol_filter

// Time Filter
bool time_filter = true
if i_time_filter
    time_filter := (hour > i_hour_1 or hour == i_hour_1 and minute >= i_minute_1) and (hour < i_hour_2 or hour == i_hour_2 and minute < i_minute_2)
    time_filter

// Date Filter
bool date_filter = true
if i_date_filter
    date_filter := year == i_year and month == i_month and dayofmonth == i_day
    date_filter

//___________________________ Additional Filters End

//___________________________ Fibonacci Start

// Fibonacci Function
fibonacci(bool calc_from_high, high_value, low_value, float fib_value) =>
    if calc_from_high
        low_value + (high_value - low_value) * fib_value
    else
        high_value - (high_value - low_value) * fib_value

//___________________________ Fibonacci End

//___________________________ Signals Start

//___________________________ Continuous Signals Start

//___________________________ Short Continuous Signals Start

//___________________________ Short Continuous Break Signals

// Short Condition 1
short_cont_1 = 
 isFVGDown and 
 time_filter and
 date_filter and
 barstate.isconfirmed

// Short Condition 2
short_cont_2 = 
 ta.crossover(high, isFVGDown_bottom) and 
 time_filter and
 date_filter and
 barstate.isconfirmed

var short_cont_2_low = float(na)
if short_cont_2
    short_cont_2_low := low
    short_cont_2_low

// Short Condition 2 Confirmed
short_cont_2_conf = 
 ta.crossunder(close, short_cont_2_low) and 
 time_filter and
 date_filter and
 barstate.isconfirmed

// Short Condition 3
short_cont_3 = 
 ta.crossover(high, isFVGDown_top) and 
 close < isFVGDown_top and
 time_filter and
 date_filter and
 barstate.isconfirmed

var short_cont_3_low = float(na)
if short_cont_3
    short_cont_3_low := low
    short_cont_3_low

// Short Condition 3 Confirmed
short_cont_3_conf = 
 ta.crossunder(close, short_cont_3_low) and 
 time_filter and
 date_filter and
 barstate.isconfirmed

// Short Condition 4
short_cont_4 = 
 ta.crossover(close, isFVGDown_top) and 
 time_filter and
 date_filter and
 barstate.isconfirmed

// Short First Touch
var short_first_touch_current_state = 0
short_first_touch_prev_state = nz(short_first_touch_current_state[1])
short_first_touch_current_state := short_first_touch_prev_state == 2 ? 0 : short_first_touch_prev_state
if short_cont_1 and short_first_touch_current_state == 0
    short_first_touch_current_state := 1
    short_first_touch_current_state
if short_cont_2 and short_first_touch_current_state == 1
    short_first_touch_current_state := 2
    short_first_touch_current_state

short_first_touch_signal = short_first_touch_current_state == 2 ? true : false

// Short Confirmed First Touch
var short_first_touch_conf_current_state = 0
short_first_touch_conf_prev_state = nz(short_first_touch_conf_current_state[1])
short_first_touch_conf_current_state := short_first_touch_conf_prev_state == 3 ? 0 : short_first_touch_conf_prev_state
if short_cont_1 and short_first_touch_conf_current_state == 0
    short_first_touch_conf_current_state := 1
    short_first_touch_conf_current_state
if short_cont_2 and short_first_touch_conf_current_state == 1
    short_first_touch_conf_current_state := 2
    short_first_touch_conf_current_state
if short_cont_2_conf and short_first_touch_conf_current_state == 2
    short_first_touch_conf_current_state := 3
    short_first_touch_conf_current_state

short_first_touch_conf_signal = short_first_touch_conf_current_state == 3 ? true : false

// Short Full Fill
var short_full_fill_current_state = 0
short_full_fill_prev_state = nz(short_full_fill_current_state[1])
short_full_fill_current_state := short_full_fill_prev_state == 2 ? 0 : short_full_fill_prev_state
if short_cont_1 and short_full_fill_current_state == 0
    short_full_fill_current_state := 1
    short_full_fill_current_state
if short_cont_3 and short_full_fill_current_state == 1
    short_full_fill_current_state := 2
    short_full_fill_current_state

short_full_fill_signal = short_full_fill_current_state == 2 ? true : false

// Short Full Fill Confirmed
var short_full_fill_conf_current_state = 0
short_full_fill_conf_prev_state = nz(short_full_fill_conf_current_state[1])
short_full_fill_conf_current_state := short_full_fill_conf_prev_state == 3 ? 0 : short_full_fill_conf_prev_state
if short_cont_1 and short_full_fill_conf_current_state == 0
    short_full_fill_conf_current_state := 1
    short_full_fill_conf_current_state
if short_cont_3 and short_full_fill_conf_current_state == 1
    short_full_fill_conf_current_state := 2
    short_full_fill_conf_current_state
if short_cont_3_conf and short_full_fill_conf_current_state == 2
    short_full_fill_conf_current_state := 3
    short_full_fill_conf_current_state

short_full_fill_conf_signal = short_full_fill_conf_current_state == 3 ? true : false

// Short Reversal
var short_reversal_current_state = 0
short_reversal_prev_state = nz(short_reversal_current_state[1])
short_reversal_current_state := short_reversal_prev_state == 2 ? 0 : short_reversal_prev_state
if short_cont_1 and short_reversal_current_state == 0
    short_reversal_current_state := 1
    short_reversal_current_state
if short_cont_4 and short_reversal_current_state == 1
    short_reversal_current_state := 2
    short_reversal_current_state

short_reversal_signal = short_reversal_current_state == 2 ? true : false

//___________________________ Short Continuous Signals End

//___________________________ Long Continuous Signals Start

//___________________________ Long Continuous Break Signals

// Long Condition 1
long_cont_1 = 
 isFVGUp and 
 time_filter and
 date_filter and
 barstate.isconfirmed

// Long Condition 2
long_cont_2 = 
 ta.crossunder(low, isFVGUp_top) and 
 time_filter and
 date_filter and
 barstate.isconfirmed

var long_cont_2_high = float(na)
if long_cont_2
    long_cont_2_high := high
    long_cont_2_high

// Long Condition 2 Confirmed
long_cont_2_conf = 
 ta.crossover(close, long_cont_2_high) and 
 time_filter and
 date_filter and
 barstate.isconfirmed

// Long Condition 3
long_cont_3 = 
 ta.crossunder(low, isFVGUp_bottom) and 
 close > isFVGUp_bottom and
 time_filter and
 date_filter and
 barstate.isconfirmed

var long_cont_3_high = float(na)
if long_cont_3
    long_cont_3_high := high
    long_cont_3_high
    
// Long Condition 3 Confirmed
long_cont_3_conf = 
 ta.crossover(close, long_cont_3_high) and 
 time_filter and
 date_filter and
 barstate.isconfirmed
 
// Long Condition 4
long_cont_4 = 
 ta.crossunder(close, isFVGUp_bottom) and 
 time_filter and
 date_filter and
 barstate.isconfirmed

// Long First Touch
var long_first_touch_current_state = 0
long_first_touch_prev_state = nz(long_first_touch_current_state[1])
long_first_touch_current_state := long_first_touch_prev_state == 2 ? 0 : long_first_touch_prev_state
if long_cont_1 and long_first_touch_current_state == 0
    long_first_touch_current_state := 1
    long_first_touch_current_state
if long_cont_2 and long_first_touch_current_state == 1
    long_first_touch_current_state := 2
    long_first_touch_current_state

long_first_touch_signal = long_first_touch_current_state == 2 ? true : false

// Long First Touch Confirmed
var long_first_touch_conf_current_state = 0
long_first_touch_conf_prev_state = nz(long_first_touch_conf_current_state[1])
long_first_touch_conf_current_state := long_first_touch_conf_prev_state == 3 ? 0 : long_first_touch_conf_prev_state
if long_cont_1 and long_first_touch_conf_current_state == 0
    long_first_touch_conf_current_state := 1
    long_first_touch_conf_current_state
if long_cont_2 and long_first_touch_conf_current_state == 1
    long_first_touch_conf_current_state := 2
    long_first_touch_conf_current_state
if long_cont_2_conf and long_first_touch_conf_current_state == 2
    long_first_touch_conf_current_state := 3
    long_first_touch_conf_current_state

long_first_touch_conf_signal = long_first_touch_conf_current_state == 3 ? true : false

// Long Full Fill
var long_full_fill_current_state = 0
long_full_fill_prev_state = nz(long_full_fill_current_state[1])
long_full_fill_current_state := long_full_fill_prev_state == 2 ? 0 : long_full_fill_prev_state
if long_cont_1 and long_full_fill_current_state == 0
    long_full_fill_current_state := 1
    long_full_fill_current_state
if long_cont_3 and long_full_fill_current_state == 1
    long_full_fill_current_state := 2
    long_full_fill_current_state

long_full_fill_signal = long_full_fill_current_state == 2 ? true : false

// Long Full Fill Confirmed
var long_full_fill_conf_current_state = 0
long_full_fill_conf_prev_state = nz(long_full_fill_conf_current_state[1])
long_full_fill_conf_current_state := long_full_fill_conf_prev_state == 3 ? 0 : long_full_fill_conf_prev_state
if long_cont_1 and long_full_fill_conf_current_state == 0
    long_full_fill_conf_current_state := 1
    long_full_fill_conf_current_state
if long_cont_3 and long_full_fill_conf_current_state == 1
    long_full_fill_conf_current_state := 2
    long_full_fill_conf_current_state
if long_cont_3_conf and long_full_fill_conf_current_state == 2
    long_full_fill_conf_current_state := 3
    long_full_fill_conf_current_state

long_full_fill_conf_signal = long_full_fill_conf_current_state == 3 ? true : false

// Long Reversal
var long_reversal_current_state = 0
long_reversal_prev_state = nz(long_reversal_current_state[1])
long_reversal_current_state := long_reversal_prev_state == 2 ? 0 : long_reversal_prev_state
if long_cont_1 and long_reversal_current_state == 0
    long_reversal_current_state := 1
    long_reversal_current_state
if long_cont_4 and long_reversal_current_state == 1
    long_reversal_current_state := 2
    long_reversal_current_state

long_reversal_signal = long_reversal_current_state == 2 ? true : false

//___________________________ Long Continuous Signals End

//___________________________ Plot Continuous Signals

// 1
plotchar(series = i_scr_show_short and i_scr_choose == 'First Touch' and short_first_touch_signal ? 3 : na, title = 'Short First Touch', char = '↷', location = location.abovebar, color = i_neg_light_color, size = size.tiny, force_overlay = true)
plotchar(series = i_scr_show_long and i_scr_choose == 'First Touch' and long_first_touch_signal ? 3 : na, title = 'Long First Touch', char = '⤻', location = location.belowbar, color = i_pos_light_color, size = size.tiny, force_overlay = true)
barcolor(color = i_scr_show_short and i_scr_choose == 'First Touch' and short_first_touch_signal ? i_neg_light_color : i_scr_show_long and i_scr_choose == 'First Touch' and long_first_touch_signal ? i_pos_light_color : na, title = 'First Touch Candle')

// 2
plotshape(series = i_scr_show_short and i_scr_choose == 'First Touch Confirmed' and short_first_touch_conf_signal ? 4 : na, title = 'Short Confirmed First Touch', style = shape.triangledown, location = location.abovebar, color = i_neg_light_color, size = size.tiny, force_overlay = true)
plotshape(series = i_scr_show_long and i_scr_choose == 'First Touch Confirmed' and long_first_touch_conf_signal ? 4 : na, title = 'Long Confirmed First Touch', style = shape.triangleup, location = location.belowbar, color = i_pos_light_color, size = size.tiny, force_overlay = true)
barcolor(color = i_scr_show_short and i_scr_choose == 'First Touch Confirmed' and short_first_touch_conf_signal ? i_neg_light_color : i_scr_show_long and i_scr_choose == 'First Touch Confirmed' and long_first_touch_conf_signal ? i_pos_light_color : na, title = 'Confirmed First Touch Candle')

// 3
plotchar(series = i_scr_show_short and i_scr_choose == 'Full Fill' and short_full_fill_signal ? 3 : na, title = 'Short Full Fill', char = '↷', location = location.abovebar, color = i_neg_light_color, size = size.tiny, force_overlay = true)
plotchar(series = i_scr_show_long and i_scr_choose == 'Full Fill' and long_full_fill_signal ? 3 : na, title = 'Long Full Fill', char = '⤻', location = location.belowbar, color = i_pos_light_color, size = size.tiny, force_overlay = true)
barcolor(color = i_scr_show_short and i_scr_choose == 'Full Fill' and short_full_fill_signal ? i_pos_light_color : i_scr_show_long and i_scr_choose == 'Full Fill' and long_full_fill_signal ? i_neg_light_color : na, title = 'Full Fill Candle')

// 4
plotshape(series = i_scr_show_short and i_scr_choose == 'Full Fill Confirmed' and short_full_fill_conf_signal ? 4 : na, title = 'Short Confirmed Full Fill', style = shape.triangledown, location = location.abovebar, color = i_neg_light_color, size = size.tiny, force_overlay = true)
plotshape(series = i_scr_show_long and i_scr_choose == 'Full Fill Confirmed' and long_full_fill_conf_signal ? 4 : na, title = 'Long Confirmed Full Fill', style = shape.triangleup, location = location.belowbar, color = i_pos_light_color, size = size.tiny, force_overlay = true)
barcolor(color = i_scr_show_short and i_scr_choose == 'Full Fill Confirmed' and short_full_fill_conf_signal ? i_pos_light_color : i_scr_show_long and i_scr_choose == 'Full Fill Confirmed' and long_full_fill_conf_signal ? i_neg_light_color : na, title = 'Confirmed Full Fill Candle')

// 5
plotshape(series = i_scr_show_short and i_scr_choose == 'Reversal' and short_reversal_signal ? 3 : na, title = 'Long Reversal', style = shape.triangleup, location = location.belowbar, color = i_pos_light_color, size = size.tiny, force_overlay = true)
plotshape(series = i_scr_show_long and i_scr_choose == 'Reversal' and long_reversal_signal ? 3 : na, title = 'Short Reversal', style = shape.triangledown, location = location.abovebar, color = i_neg_light_color, size = size.tiny, force_overlay = true)
barcolor(color = i_scr_show_short and i_scr_choose == 'Reversal' and short_reversal_signal ? i_pos_light_color : i_scr_show_long and i_scr_choose == 'Reversal' and long_reversal_signal ? i_neg_light_color : na, title = 'Reversal Candle')

//___________________________ Continuous Signals End

//___________________________ Signals End

//___________________________ Data Table Start

// To String
day_pchg_str = str.tostring(cum_pchg, '#.##') + ' %'
volume_pchg_str = str.tostring(cum_vol_pchg, '#.##') + ' %'
day_volume_str = str.tostring(current_cum_vol / 100000, '#.##') + ' L'
prev_day_volume_str = str.tostring(prev_cum_vol / 100000, '#.##') + ' L'

// Color
bgcolor_1 = i_neu_dark_color
bgcolor_2 = i_neu_mid_color

pchg_col = cum_pchg > 0 ? i_pos_color : i_neg_color
vol_pchg_col = cum_vol_pchg > 0 ? i_pos_color : i_neg_color
prev_vol_pchg_col = prev_cum_vol < current_cum_vol ? i_neg_color : i_pos_color

// Plot Table
var table tbl_data = table.new(position = i_tbl_data_pos, columns = 2, rows = 4, border_width = 1, force_overlay = true)

if barstate.islast and i_tbl_data_show
    table.cell(table_id = tbl_data, column = 0, row = 0, text = '%Chg', text_color = i_neu_color, text_halign = text.align_left, bgcolor = bgcolor_1, text_size = i_tbl_data_txt_size)
    table.cell(table_id = tbl_data, column = 1, row = 0, text = day_pchg_str, text_color = pchg_col, text_halign = text.align_right, bgcolor = bgcolor_1, text_size = i_tbl_data_txt_size)

    table.cell(table_id = tbl_data, column = 0, row = 1, text = 'Vol %Chg', text_color = i_neu_color, text_halign = text.align_left, bgcolor = bgcolor_2, text_size = i_tbl_data_txt_size)
    table.cell(table_id = tbl_data, column = 1, row = 1, text = volume_pchg_str, text_color = vol_pchg_col, text_halign = text.align_right, bgcolor = bgcolor_2, text_size = i_tbl_data_txt_size)

    table.cell(table_id = tbl_data, column = 0, row = 2, text = 'Vol', text_color = i_neu_color, text_halign = text.align_left, bgcolor = bgcolor_1, text_size = i_tbl_data_txt_size)
    table.cell(table_id = tbl_data, column = 1, row = 2, text = day_volume_str, text_color = vol_pchg_col, text_halign = text.align_right, bgcolor = bgcolor_1, text_size = i_tbl_data_txt_size)

    table.cell(table_id = tbl_data, column = 0, row = 3, text = 'PD Vol', text_color = i_neu_color, text_halign = text.align_left, bgcolor = bgcolor_2, text_size = i_tbl_data_txt_size)
    table.cell(table_id = tbl_data, column = 1, row = 3, text = prev_day_volume_str, text_color = prev_vol_pchg_col, text_halign = text.align_right, bgcolor = bgcolor_2, text_size = i_tbl_data_txt_size)

//___________________________ Data Table End

//___________________________ Get Symbols for Screener Start

// Acknowledgement & Reference
// Trader: 'allanster'
// Indicator Title: 'How To Input CSV List Of Symbol Data Used For Screener'
// Indicator Link: 'https://www.tradingview.com/script/KfqHqHUH-How-To-Input-CSV-List-Of-Symbol-Data-Used-For-Screener/'

feed(back) => // extract tickerid and decrement list of ticker IDs
    loop = back // declare string variable to hold content list
    getT = string(na) // declare string variable to hold tickerid
    if str.length(loop) == 0 // if list is empty
        getT := string(na) // assign na to tickerid variable
        loop := string(na) // assign na to list of ticker Ids variable
        loop
    else // else extract first tickerid
        getP = nz(str.pos(loop, ','), str.length(loop)) // get position of first comma or last character
        getT := str.substring(loop, 0, getP) // get tickerid in first position of list
        loop := str.replace(loop, getT + ',', '') // clear tickerid + delimiter character from list
        loop
    [getT, loop] // return tickerid in first position & truncated list

[tid_01, out_01] = feed(i_symbols), [tid_02, out_02] = feed(out_01), [tid_03, out_03] = feed(out_02), [tid_04, out_04] = feed(out_03),
[tid_05, out_05] = feed(out_04), [tid_06, out_06] = feed(out_05), [tid_07, out_07] = feed(out_06), [tid_08, out_08] = feed(out_07),
[tid_09, out_09] = feed(out_08), [tid_10, out_10] = feed(out_09), [tid_11, out_11] = feed(out_10), [tid_12, out_12] = feed(out_11),
[tid_13, out_13] = feed(out_12), [tid_14, out_14] = feed(out_13), [tid_15, out_15] = feed(out_14), [tid_16, out_16] = feed(out_15),
[tid_17, out_17] = feed(out_16), [tid_18, out_18] = feed(out_17), [tid_19, out_19] = feed(out_18), [tid_20, out_20] = feed(out_19),
[tid_21, out_21] = feed(out_20), [tid_22, out_22] = feed(out_21), [tid_23, out_23] = feed(out_22), [tid_24, out_24] = feed(out_23),
[tid_25, out_25] = feed(out_24), [tid_26, out_26] = feed(out_25), [tid_27, out_27] = feed(out_26), [tid_28, out_28] = feed(out_27),
[tid_29, out_29] = feed(out_28), [tid_30, out_30] = feed(out_29), [tid_31, out_31] = feed(out_30), [tid_32, out_32] = feed(out_31),
[tid_33, out_33] = feed(out_32), [tid_34, out_34] = feed(out_33), [tid_35, out_35] = feed(out_34), [tid_36, out_36] = feed(out_35),
[tid_37, out_37] = feed(out_36), [tid_38, out_38] = feed(out_37), [tid_39, out_39] = feed(out_38), [tid_40, out_40] = feed(out_39)

//___________________________ Get Symbols for Screener End

//___________________________ Screener Start

// Acknowledgement & Reference
// Trader: 'MUQWISHI'
// Indicator Title: 'Candlestick Patterns Screener [By MUQWISHI]'
// Indicator Link: 'https://www.tradingview.com/script/xiWQuGOq-Candlestick-Patterns-Screener-By-MUQWISHI/'

// Scanner Conditions
short_cond = 
 i_scr_choose == 'FVG %' ? short_cont_1 : 
 i_scr_choose == 'First Touch' ? short_first_touch_signal : 
 i_scr_choose == 'First Touch Confirmed' ? short_first_touch_conf_signal : 
 i_scr_choose == 'Full Fill' ? short_full_fill_signal : 
 i_scr_choose == 'Full Fill Confirmed' ? short_full_fill_conf_signal : 
 short_reversal_signal

long_cond = 
 i_scr_choose == 'FVG %' ? long_cont_1 : 
 i_scr_choose == 'First Touch' ? long_first_touch_signal : 
 i_scr_choose == 'First Touch Confirmed' ? long_first_touch_conf_signal : 
 i_scr_choose == 'Full Fill' ? long_full_fill_signal : 
 i_scr_choose == 'Full Fill Confirmed' ? long_full_fill_conf_signal : 
 long_reversal_signal

// Function for Screener Indicator Calculation
indicator_calculation() =>
    // Initialize variables
    gap_percent = float(na)
    //price = float(na)
    _time = int(na)
    _cum_pchg = float(na)
    _cum_vol_pchg = float(na)
    signal = int(na)

    if barstate.isconfirmed
        // Check for Short Momentum Candle and conditions (Modify here to customize indicators)
        if i_scr_show_long and long_cond
            gap_percent := FVGUpPercent
            signal := 1
            signal

        // Check for Long Momentum Candle and conditions (Modify here to customize indicators)
        else if i_scr_show_short and short_cond
            gap_percent := FVGDownPercent
            signal := -1
            signal

        // Update price and time if signal is not null
        if not na(signal)
            //price := math.round_to_mintick(close)
            _time := time
            _cum_pchg := cum_pchg
            _cum_vol_pchg := cum_vol_pchg
            _cum_vol_pchg

    [_time, gap_percent, _cum_pchg, _cum_vol_pchg, signal]

// Function to format time
format_time(x) =>
    timezone = syminfo.timezone
    timeframe.isintraday ? str.format_time(x, 'HH:mm  dd-MM-yyyy', timezone) : str.format_time(x, 'dd-MM-yyyy', timezone)

// Function to extract symbol name
symbol(s) =>
    array.get(str.split(s, ':'), 1)

// Matrix setup
var matrix = matrix.new<string>(0, 6, na)

// Function to add rows to the matrix
mtxFun(symbol, _time, gap_percent, _cum_pchg, _cum_vol_pchg, signal) =>
    matrix.add_row(matrix, 0, array.from(symbol, _time, gap_percent, _cum_pchg, _cum_vol_pchg, signal))

// Screener function to collect data
screener(s) =>
    sym = ticker.modify(s, syminfo.session)
    [_time, gap_percent, _cum_pchg, _cum_vol_pchg, signal] = request.security(sym, timeframe.period, indicator_calculation())

    // Check if the signal is not na and the time matches
    if not na(signal) and _time == time
        symbolName = symbol(s)
        formattedTime = format_time(_time)
        str_gap_percent = str.tostring(gap_percent, '#.##')
        str_cum_pchg = str.tostring(_cum_pchg, '#.##')
        str_cum_vol_pchg = str.tostring(_cum_vol_pchg, '#.##')
        strSignal = str.tostring(signal)

        // Add data to the matrix
        mtxFun(symbolName, formattedTime, str_gap_percent, str_cum_pchg, str_cum_vol_pchg, strSignal)

// Call Screener function for multiple symbols
screener(tid_01), screener(tid_02), screener(tid_03), screener(tid_04), screener(tid_05), screener(tid_06), screener(tid_07),
screener(tid_08), screener(tid_09), screener(tid_10), screener(tid_11), screener(tid_12), screener(tid_13), screener(tid_14),
screener(tid_15), screener(tid_16), screener(tid_17), screener(tid_18), screener(tid_19), screener(tid_20), screener(tid_21),
screener(tid_22), screener(tid_23), screener(tid_24), screener(tid_25), screener(tid_26), screener(tid_27), screener(tid_28),
screener(tid_29), screener(tid_30), screener(tid_31), screener(tid_32), screener(tid_33), screener(tid_34), screener(tid_35),
screener(tid_36), screener(tid_37), screener(tid_38), screener(tid_39), screener(tid_40)

// Trim excess rows in the matrix
if matrix.rows(matrix) > i_scr_tbl_disp_rows
    while matrix.rows(matrix) > i_scr_tbl_disp_rows
        matrix.remove_row(matrix, matrix.rows(matrix) - 1)

// Plot Table
// Create table with specified properties
var table scr_tbl = table.new(position = i_scr_tbl_position, columns = 5, rows = 102, border_width = 1, force_overlay = true)

// Function to populate cells in the table
scr_cell_title(col, row, txt) =>
    table.cell(scr_tbl, col, row, text = txt, text_color = i_neu_color, text_halign = text.align_center, bgcolor = i_neu_dark_color, text_size = i_scr_tbl_text_size)

scr_cell(col, row, txt, _text_color, _bgcolor) =>
    table.cell(scr_tbl, col, row, text = txt, text_color = _text_color, text_halign = text.align_left, bgcolor = _bgcolor, text_size = i_scr_tbl_text_size)

// Check if it's the last bar
if barstate.islast and i_scr_show_table
    // Clear existing data in the table
    table.clear(scr_tbl, 0, 0, 2, 101)

    scr_cell_title(0, 0, i_scr_choose)
    table.merge_cells(table_id = scr_tbl, start_column = 0, start_row = 0, end_column = 4, end_row = 0)
    scr_cell_title(0, 1, 'Symbol')
    scr_cell_title(1, 1, 'Time')
    scr_cell_title(2, 1, 'FVG %')
    scr_cell_title(3, 1, '%Chg')
    scr_cell_title(4, 1, 'V %Chg')

    j = 4
    // Populate table with matrix data
    if matrix.rows(matrix) > 0
        for i = 0 to matrix.rows(matrix) - 1 by 1
        // Determine color based on the signal

            _textcolor = matrix.get(matrix, i, 5) == '1' ? i_pos_color : matrix.get(matrix, i, 5) == '-1' ? i_neg_color : i_neu_color

            _bg_color = matrix.get(matrix, i, 5) == '1' ? i_pos_dark_color : matrix.get(matrix, i, 5) == '-1' ? i_neg_dark_color : i_neu_color

            // Populate cells in the table
            scr_cell(0, j, matrix.get(matrix, i, 0), _textcolor, _bg_color)
            scr_cell(1, j, matrix.get(matrix, i, 1), _textcolor, _bg_color)
            scr_cell(2, j, matrix.get(matrix, i, 2), _textcolor, _bg_color)
            scr_cell(3, j, matrix.get(matrix, i, 3), _textcolor, _bg_color)
            scr_cell(4, j, matrix.get(matrix, i, 4), _textcolor, _bg_color)

            j := j + 1
            j

//___________________________ Screener End

//___________________________ Code End

##-- File Name: PineScript-main/ICT Fair Value Gap (FVG) Scanner/Scanner - ICT Fair Value Gap (FVG) Scanner.txt | File No: 15 | Ended --##

##-- File Name: PineScript-main/ICT Liquidity Sweep Pattern Scanner/Readme First.txt | File No: 16 | Started --##
// Readme First:

// ICT Liquidity Sweep Pattern Scanner

// Logic
//   - This generally identifies bullish or bearish liquidity sweeps of previous 1st, 2nd, or 3rd swings.

// Notes
//   - Use higher timeframes for stock selection and trade in lower timeframes.
//   - The scanner may also generate incorrect signals.
##-- File Name: PineScript-main/ICT Liquidity Sweep Pattern Scanner/Readme First.txt | File No: 16 | Ended --##

##-- File Name: PineScript-main/ICT Liquidity Sweep Pattern Scanner/Scanner - ICT Liquidity Sweep Pattern Scanner.txt | File No: 17 | Started --##
// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © Arun_K_Bhaskar

//@version=5
indicator(title='ICT Liquidity Sweep Pattern Scanner', shorttitle='ICT LSP Scan', overlay=true, max_bars_back=500, max_lines_count=500, max_boxes_count=500)

//_____________________________ Menu Screener Start

g_scrtb = '█████████████████ Scanner █████████████████'

string i_scr_choose = input.string(defval='Prev 2 Swing Sweep', title='Screening Method', options=['Prev 1 Swing Sweep', 'Prev 2 Swing Sweep', 'Prev 3 Swing Sweep'], group=g_scrtb)

tt_is = "• Reads only up to first 40 symbols." +
     "\n• Total characters cannot exceed 4096." +
     "\n• Eg: EXCHANGE:SYMBOL_A,EXCHANGE:SYMBOL_B"

string i_symbols = input.text_area(
 defval="NSE:ABCAPITAL,NSE:BIOCON,NSE:BLS,NSE:BOMDYEING,NSE:CAPACITE,NSE:CESC,NSE:CHAMBLFERT,NSE:DCBBANK,NSE:ENGINERSIN,NSE:GIPCL,NSE:GMDCLTD,NSE:GSFC,NSE:HINDCOPPER,NSE:HINDOILEXP,NSE:INDIACEM,NSE:IOC,NSE:IRCON,NSE:IRFC,NSE:LTFOODS,NSE:MANAPPURAM,NSE:M_MFIN,NSE:NATIONALUM,NSE:NBCC,NSE:NFL,NSE:NLCINDIA,NSE:NMDC,NSE:PNB,NSE:PRAKASH,NSE:PTC,NSE:RAILTEL,NSE:RAIN,NSE:RBLBANK,NSE:RCF,NSE:RELINFRA,NSE:SAIL,NSE:SARDAEN,NSE:SJVN,NSE:TATASTEEL,NSE:TIMETECHNO,NSE:VEDL", 
 title="Paste Symbols", tooltip=tt_is, group=g_scrtb)

bool i_scr_show_table  = input.bool(defval=true, title='Display Table', group=g_scrtb)
bool i_scr_show_long  = input.bool(defval=true, title='Long Signals', inline='tb_2', group=g_scrtb)
bool i_scr_show_short  = input.bool(defval=true, title='Short Signals', inline='tb_2', group=g_scrtb)

int i_scr_tbl_disp_rows = input.int(defval=12, title='Display Rows', minval=0, maxval=100, group=g_scrtb)
string i_scr_tbl_position = input.string(defval=position.bottom_left, title='Table Position', options=[position.top_left, position.top_center, position.top_right, position.middle_left, position.middle_center, position.middle_right, position.bottom_left, position.bottom_center, position.bottom_right], group=g_scrtb)
string i_scr_tbl_text_size = input.string(defval=size.small, title='Table Size', options=[size.auto, size.tiny, size.small, size.normal, size.large, size.huge], group=g_scrtb)

//_____________________________ Menu Screener End

//_____________________________ Menu Zig Zag Start 

g_zz = '██████████████████ Zig Zag ██████████████████'

bool i_zz_display = input.bool(defval=true, title='Display Zig Zag', group=g_zz)
int i_zz_period = input.int(defval=4, title='Zig Zag Length', minval=2, group=g_zz)
string i_zz_source = input.string(defval='High/Low', title='Source', options=['High/Low', 'Open/Close'], group=g_zz)
color i_zz_bull_color = input.color(defval=#1E53E5, title='Color Up', group=g_zz)
color i_zz_bear_color = input.color(defval=#1E53E5, title='Color Down', group=g_zz)
string i_zz_ln_style = input.string(defval=line.style_solid, title="Line Style", options=[line.style_solid, line.style_dashed, line.style_dotted], group=g_zz)

//_____________________________ Menu Zig Zag End 

//_____________________________ Menu Table Start

g_dtb = '█████████████████ Data Table █████████████████'
bool i_tbl_data_show  = input.bool(defval=true, title='Display Table', group=g_dtb)
string i_tbl_data_pos = input.string(defval=position.bottom_right, title='Position', options=[position.top_left, position.top_center, position.top_right, position.middle_left, position.middle_center, position.middle_right, position.bottom_left, position.bottom_center, position.bottom_right], group=g_dtb)
string i_tbl_data_txt_size = input.string(defval=size.normal, title='Size', options=[size.auto, size.tiny, size.small, size.normal, size.large, size.huge], group=g_dtb)

//_____________________________ Menu Table End

//_____________________________ Chart Settings Start

g_ch = '███████████████ Chart Settings ███████████████'
color i_pos_dark_color = input.color(defval=#03110F, title='Positive Dark', group=g_ch)
color i_pos_color = input.color(defval=#26A69A, title='Positive Mid', group=g_ch)
color i_pos_light_color = input.color(defval=#ACE5DC, title='Positive Light', group=g_ch)
color i_neg_light_color = input.color(defval=#FCCBCD, title='Negative Light', group=g_ch)
color i_neg_color = input.color(defval=#FF5252, title='Negative Mid', group=g_ch)
color i_neg_dark_color = input.color(defval=#180809, title='Negative Dark', group=g_ch)
//color i_indicator_color = input.color(defval=#2962FF, title='Indicator', group=g_ch)
//color i_signal_color = input.color(defval=#FF6D00, title='Signal', group=g_ch)
color i_neu_color = input.color(defval=#D1D4DC, title='Neutral Light', group=g_ch)
color i_neu_mid_color = input.color(defval=#2A2E39, title='Neutral Mid', group=g_ch)
color i_neu_dark_color = input.color(defval=#141516, title='Neutral Dark', group=g_ch)

//_____________________________ Chart Settings End

//_____________________________ Cumulative Percentage Change Start

// Function to calculate Daily Cumulative Percentage Change of Close Price
cumulative_percentage_change() =>
    var float _cum_pct_change = na
    _is_new_day = ta.change(time('D')) != 0 ? 1 : 0
    _daily_pct_change = na(close[1]) ? 0 : (close - close[1]) / close[1] * 100
    _cum_pct_change := _is_new_day ? _daily_pct_change : (na(_cum_pct_change) ? _daily_pct_change : (_cum_pct_change + _daily_pct_change))
    _cum_pct_change

// Calculate current cumulative percentage change
cum_pchg = cumulative_percentage_change()

//_____________________________ Cumulative Percentage Change End

//_____________________________ Cumulative Volume Percentage Change Start

// Function to calculate Daily Cumulative Volume
cumulative_volume() =>
    var float _cum_vol = na
    _is_new_day = ta.change(time('D')) != 0 ? 1 : 0
    _cum_vol := _is_new_day ? volume : (na(_cum_vol) ? volume : (_cum_vol + volume))
    _cum_vol

// Calculate current and previous day cumulative volumes
var float current_cum_vol = na
var float prev_cum_vol = na

if ta.change(time('D')) != 0
    prev_cum_vol := current_cum_vol
    current_cum_vol := volume
else
    current_cum_vol += volume

// Calculate Cumulative Volume Percentage Change
cum_vol_pchg = (current_cum_vol - nz(prev_cum_vol, current_cum_vol)) / nz(prev_cum_vol, current_cum_vol) * 100

//_____________________________ Cumulative Volume Percentage Change End

//_____________________________ Zig Zag Start 

// Acknowledgement & Reference
// Trader: 'RozaniGhani-RG'
// Indicator Title: 'Zig Zag Ratio Simplified'
// Indicator Link: 'https://www.tradingview.com/script/CIk186OY-Zig-Zag-Ratio-Simplified/'

//_____________________________ Get Source

float _high = i_zz_source == 'Open/Close' ? math.max(open, close) : high
float _low = i_zz_source == 'Open/Close' ? math.min(open, close) : low

//============================== 1.  Variables

//_____________________________ 1.1 Highest / Lowest
float ph = ta.highestbars(_high, i_zz_period) == 0 ? _high : na
float pl = ta.lowestbars(_low, i_zz_period) == 0 ? _low  : na

//_____________________________ 1.2 Dir
var int dir = 0, dir := pl and na(ph) ? -1 : ph and na(pl) ? 1 : dir

//_____________________________ 1.4 Array
var max_array_size = 14, var zigzag = array.new_float(0), oldzigzag = array.copy(zigzag)

//_____________________________ 1.5 Others
var line line_zz = na

//============================== 3.  Custom Functions

add_to_zigzag(float[] pointer, float value, int bindex) =>
    array.unshift(pointer, bindex)
    array.unshift(pointer, value)
    if array.size(pointer) > max_array_size
        array.pop(pointer)
        array.pop(pointer)
    
update_zigzag(float[] pointer, float value, int bindex, int dir) =>
    if array.size(pointer) == 0
        add_to_zigzag(pointer, value, bindex)
    else
        if dir == 1 and value > array.get(pointer, 0) or dir == -1 and value < array.get(pointer, 0)
            array.set(pointer, 0, value)
            array.set(pointer, 1, bindex)
        0.

//============================== 4.  Calculations

dirchanged = ta.change(dir)

if ph or pl
    if dirchanged
        add_to_zigzag(zigzag, dir == 1 ? ph : pl, bar_index)
    else
        update_zigzag(zigzag, dir == 1 ? ph : pl, bar_index, dir)

//============================== 5.  Constructs

if array.size(zigzag) >= 6
    if array.get(zigzag, 0) != array.get(oldzigzag, 0) or array.get(zigzag, 1) != array.get(oldzigzag, 1)
        if array.get(zigzag, 2) == array.get(oldzigzag, 2) and array.get(zigzag, 3) == array.get(oldzigzag, 3)
            line.delete(line_zz)
        if i_zz_display
            line_zz := line.new(x1 = math.round(array.get(zigzag, 1)), y1 = array.get(zigzag, 0), x2 = math.round(array.get(zigzag, 3)), y2 = array.get(zigzag, 2), color = dir == 1 ? i_zz_bull_color : i_zz_bear_color, width=1)

//_____________________________ Get Swing Price & Bar Index

//zz_0 = array.size(zigzag) > 15 ? array.get(zigzag, array.size(zigzag) - 16) : na
//bi_0 = array.size(zigzag) > 14 ? array.get(zigzag, array.size(zigzag) - 15) : na
zz_1 = array.size(zigzag) > 13 ? array.get(zigzag, array.size(zigzag) - 14) : na
//bi_1 = array.size(zigzag) > 12 ? array.get(zigzag, array.size(zigzag) - 13) : na
zz_2 = array.size(zigzag) > 11 ? array.get(zigzag, array.size(zigzag) - 12) : na
//bi_2 = array.size(zigzag) > 10 ? array.get(zigzag, array.size(zigzag) - 11) : na
zz_3 = array.size(zigzag) > 9 ? array.get(zigzag, array.size(zigzag) - 10) : na
bi_3 = array.size(zigzag) > 8 ? array.get(zigzag, array.size(zigzag) - 9) : na
zz_4 = array.size(zigzag) > 7 ? array.get(zigzag, array.size(zigzag) - 8) : na
//bi_4 = array.size(zigzag) > 6 ? array.get(zigzag, array.size(zigzag) - 7) : na
zz_5 = array.size(zigzag) > 5 ? array.get(zigzag, array.size(zigzag) - 6) : na
bi_5 = array.size(zigzag) > 4 ? array.get(zigzag, array.size(zigzag) - 5) : na
zz_6 = array.size(zigzag) > 3 ? array.get(zigzag, array.size(zigzag) - 4) : na
//bi_6 = array.size(zigzag) > 2 ? array.get(zigzag, array.size(zigzag) - 3) : na
zz_7 = array.size(zigzag) > 1 ? array.get(zigzag, array.size(zigzag) - 2) : na
bi_7 = array.size(zigzag) > 0 ? array.get(zigzag, array.size(zigzag) - 1) : na

// Create a single label for the last five zigzag values and their corresponding bar index
//label_text = str.tostring(zz_0) + "\n" + str.tostring(bi_0) + "\n" + str.tostring(zz_1) + "\n" + str.tostring(bi_1) + "\n" + str.tostring(zz_2) + 
// "\n" + str.tostring(bi_2) + "\n" + str.tostring(zz_3) + "\n" + str.tostring(bi_3) + "\n" + str.tostring(zz_4) + "\n" + str.tostring(bi_4)
//if barstate.islast
//    label.new(x = bar_index, y = high, text = label_text, color=color.white)

//_____________________________ Zig Zag End

//_____________________________ Signals Start

// Short Condition
short_condition_1 = 
 zz_2 < zz_3 and
 zz_2 < zz_4 and
 zz_2 < zz_6 and
 zz_2 < zz_7 and

 zz_3 < zz_5 and
 zz_3 > zz_4 and
 zz_3 > zz_2 and

 zz_4 < zz_3 and
 zz_4 < zz_5 and
 zz_4 < zz_6 and
 zz_4 < zz_7 and

 zz_5 > zz_3 and
 zz_5 > zz_4 and
 zz_5 > zz_6 and
 zz_5 < zz_7 and

 zz_6 < zz_5 and
 zz_6 < zz_7 and
 zz_6 > zz_4 and

 zz_7 > zz_2 and
 zz_7 > zz_3 and
 zz_7 > zz_4 and
 zz_7 > zz_5 and
 zz_7 > zz_6 and

 ta.crossover(zz_1, zz_3) and

 barstate.isconfirmed

short_condition_2 = 
 zz_2 < zz_3 and
 zz_2 < zz_4 and
 zz_2 < zz_6 and
 zz_2 < zz_7 and

 zz_3 < zz_5 and
 zz_3 > zz_4 and
 zz_3 > zz_2 and

 zz_4 < zz_3 and
 zz_4 < zz_5 and
 zz_4 < zz_6 and
 zz_4 < zz_7 and

 zz_5 > zz_3 and
 zz_5 > zz_4 and
 zz_5 > zz_6 and
 zz_5 < zz_7 and

 zz_6 < zz_5 and
 zz_6 < zz_7 and
 zz_6 > zz_4 and

 zz_7 > zz_2 and
 zz_7 > zz_3 and
 zz_7 > zz_4 and
 zz_7 > zz_5 and
 zz_7 > zz_6 and

 ta.crossover(zz_1, zz_5) and

 barstate.isconfirmed

short_condition_3 = 
 zz_2 < zz_3 and
 zz_2 < zz_4 and
 zz_2 < zz_6 and
 zz_2 < zz_7 and

 zz_3 < zz_5 and
 zz_3 > zz_4 and
 zz_3 > zz_2 and

 zz_4 < zz_3 and
 zz_4 < zz_5 and
 zz_4 < zz_6 and
 zz_4 < zz_7 and

 zz_5 > zz_3 and
 zz_5 > zz_4 and
 zz_5 > zz_6 and
 zz_5 < zz_7 and

 zz_6 < zz_5 and
 zz_6 < zz_7 and
 zz_6 > zz_4 and

 zz_7 > zz_2 and
 zz_7 > zz_3 and
 zz_7 > zz_4 and
 zz_7 > zz_5 and
 zz_7 > zz_6 and

 ta.crossover(zz_1, zz_7) and

 barstate.isconfirmed

// Long Condition
long_condition_1 = 
 zz_2 < zz_3 and
 zz_2 < zz_4 and
 zz_2 < zz_6 and
 zz_2 < zz_7 and

 zz_3 < zz_5 and
 zz_3 > zz_4 and
 zz_3 > zz_2 and

 zz_4 < zz_3 and
 zz_4 < zz_5 and
 zz_4 < zz_6 and
 zz_4 < zz_7 and

 zz_5 > zz_3 and
 zz_5 > zz_4 and
 zz_5 > zz_6 and
 zz_5 < zz_7 and

 zz_6 < zz_5 and
 zz_6 < zz_7 and
 zz_6 > zz_4 and

 zz_7 > zz_2 and
 zz_7 > zz_3 and
 zz_7 > zz_4 and
 zz_7 > zz_5 and
 zz_7 > zz_6 and

 ta.crossunder(zz_1, zz_3) and

 barstate.isconfirmed

long_condition_2 = 
 zz_2 > zz_3 and
 zz_2 > zz_4 and
 zz_2 > zz_6 and
 zz_2 > zz_7 and

 zz_3 > zz_5 and
 zz_3 < zz_4 and
 zz_3 < zz_2 and

 zz_4 > zz_3 and
 zz_4 > zz_5 and
 zz_4 > zz_6 and
 zz_4 > zz_7 and

 zz_5 < zz_3 and
 zz_5 < zz_4 and
 zz_5 < zz_6 and
 zz_5 > zz_7 and

 zz_6 > zz_5 and
 zz_6 > zz_7 and
 zz_6 < zz_4 and

 zz_7 < zz_2 and
 zz_7 < zz_3 and
 zz_7 < zz_4 and
 zz_7 < zz_5 and
 zz_7 < zz_6 and

 ta.crossunder(zz_1, zz_5) and

 barstate.isconfirmed

long_condition_3 = 
 zz_2 > zz_3 and
 zz_2 > zz_4 and
 zz_2 > zz_6 and
 zz_2 > zz_7 and

 zz_3 > zz_5 and
 zz_3 < zz_4 and
 zz_3 < zz_2 and

 zz_4 > zz_3 and
 zz_4 > zz_5 and
 zz_4 > zz_6 and
 zz_4 > zz_7 and

 zz_5 < zz_3 and
 zz_5 < zz_4 and
 zz_5 < zz_6 and
 zz_5 > zz_7 and

 zz_6 > zz_5 and
 zz_6 > zz_7 and
 zz_6 < zz_4 and

 zz_7 < zz_2 and
 zz_7 < zz_3 and
 zz_7 < zz_4 and
 zz_7 < zz_5 and
 zz_7 < zz_6 and

 ta.crossunder(zz_1, zz_7) and

 barstate.isconfirmed

// Plot Signals
plotshape(series=i_scr_show_short and i_scr_choose == 'Prev 1 Swing Sweep' ? short_condition_1 : na, title='Prev 1 Bearish Sweep', style=shape.triangledown, location=location.abovebar, color=i_neg_light_color, size=size.tiny)
plotshape(series=i_scr_show_long and i_scr_choose == 'Prev 1 Swing Sweep' ? long_condition_1 : na, title='Prev 1 Bullish Sweep', style=shape.triangleup, location=location.belowbar, color=i_pos_light_color, size=size.tiny)
barcolor(color=i_scr_show_short and i_scr_choose == 'Prev 1 Swing Sweep' and short_condition_1 ? i_neg_light_color : i_scr_show_long and i_scr_choose == 'Prev 1 Swing Sweep' and long_condition_1 ? i_pos_light_color : na, title='Prev 1 Candle')

plotshape(series=i_scr_show_short and i_scr_choose == 'Prev 2 Swing Sweep' ? short_condition_2 : na, title='Prev 2 Bearish Sweep', style=shape.triangledown, location=location.abovebar, color=i_neg_light_color, size=size.tiny)
plotshape(series=i_scr_show_long and i_scr_choose == 'Prev 2 Swing Sweep' ? long_condition_2 : na, title='Prev 2 Bullish Sweep', style=shape.triangleup, location=location.belowbar, color=i_pos_light_color, size=size.tiny)
barcolor(color=i_scr_show_short and i_scr_choose == 'Prev 2 Swing Sweep' and short_condition_2 ? i_neg_light_color : i_scr_show_long and i_scr_choose == 'Prev 2 Swing Sweep' and long_condition_2 ? i_pos_light_color : na, title='Prev 2 Candle')

plotshape(series=i_scr_show_short and i_scr_choose == 'Prev 3 Swing Sweep' ? short_condition_3 : na, title='Prev 3 Bearish Sweep', style=shape.triangledown, location=location.abovebar, color=i_neg_light_color, size=size.tiny)
plotshape(series=i_scr_show_long and i_scr_choose == 'Prev 3 Swing Sweep' ? long_condition_3 : na, title='Prev 3 Bullish Sweep', style=shape.triangleup, location=location.belowbar, color=i_pos_light_color, size=size.tiny)
barcolor(color=i_scr_show_short and i_scr_choose == 'Prev 3 Swing Sweep' and short_condition_3 ? i_neg_light_color : i_scr_show_long and i_scr_choose == 'Prev 3 Swing Sweep' and long_condition_3 ? i_pos_light_color : na, title='Prev 3 Candle')

//
var line_array = array.new_line()
// 1
if i_scr_show_short and i_scr_choose == 'Prev 1 Swing Sweep' and short_condition_1
    ph_line = line.new(x1=int(bi_3), y1=zz_3, x2=bar_index, y2=zz_3, color=i_neg_color, style=i_zz_ln_style)
    array.push(line_array, ph_line)

if i_scr_show_long and i_scr_choose == 'Prev 1 Swing Sweep' and long_condition_1
    pl_line = line.new(x1=int(bi_3), y1=zz_3, x2=bar_index, y2=zz_3, color=i_pos_color, style=i_zz_ln_style)
    array.push(line_array, pl_line)

// 2
if i_scr_show_short and i_scr_choose == 'Prev 2 Swing Sweep' and short_condition_2
    ph_line = line.new(x1=int(bi_5), y1=zz_5, x2=bar_index, y2=zz_5, color=i_neg_color, style=i_zz_ln_style)
    array.push(line_array, ph_line)

if i_scr_show_long and i_scr_choose == 'Prev 2 Swing Sweep' and long_condition_2
    pl_line = line.new(x1=int(bi_5), y1=zz_5, x2=bar_index, y2=zz_5, color=i_pos_color, style=i_zz_ln_style)
    array.push(line_array, pl_line)

// 3
if i_scr_show_short and i_scr_choose == 'Prev 3 Swing Sweep' and short_condition_3
    ph_line = line.new(x1=int(bi_7), y1=zz_7, x2=bar_index, y2=zz_7, color=i_neg_color, style=i_zz_ln_style)
    array.push(line_array, ph_line)

if i_scr_show_long and i_scr_choose == 'Prev 3 Swing Sweep' and long_condition_3
    pl_line = line.new(x1=int(bi_7), y1=zz_7, x2=bar_index, y2=zz_7, color=i_pos_color, style=i_zz_ln_style)
    array.push(line_array, pl_line)

//_____________________________ Signals End

//_____________________________ Data Table Start

// To String
day_pchg_str = str.tostring(cum_pchg,"#.##") + ' %'
volume_pchg_str = str.tostring(cum_vol_pchg,"#.##") + ' %'
day_volume_str = str.tostring(current_cum_vol/100000,"#.##") + ' L'
prev_day_volume_str = str.tostring(prev_cum_vol/100000,"#.##") + ' L'

// Color
bgcolor_1 = i_neu_dark_color
bgcolor_2 = i_neu_mid_color

pchg_col = cum_pchg > 0 ? i_pos_color : i_neg_color
vol_pchg_col = cum_vol_pchg > 0 ? i_pos_color : i_neg_color
prev_vol_pchg_col = prev_cum_vol < current_cum_vol ? i_neg_color : i_pos_color

// Plot Table
var table tbl_data = table.new(position=i_tbl_data_pos, columns=2, rows=4, border_width=1, force_overlay=true)

if barstate.islast and i_tbl_data_show
    table.cell(table_id=tbl_data, column=0, row=0, text="%Chg", text_color=i_neu_color, text_halign=text.align_left, bgcolor=bgcolor_1, text_size=i_tbl_data_txt_size)
    table.cell(table_id=tbl_data, column=1, row=0, text=day_pchg_str, text_color=pchg_col, text_halign=text.align_right, bgcolor=bgcolor_1, text_size=i_tbl_data_txt_size)

    table.cell(table_id=tbl_data, column=0, row=1, text="Vol %Chg", text_color=i_neu_color, text_halign=text.align_left, bgcolor=bgcolor_2, text_size=i_tbl_data_txt_size)
    table.cell(table_id=tbl_data, column=1, row=1, text=volume_pchg_str, text_color=vol_pchg_col, text_halign=text.align_right, bgcolor=bgcolor_2, text_size=i_tbl_data_txt_size)

    table.cell(table_id=tbl_data, column=0, row=2, text="Vol", text_color=i_neu_color, text_halign=text.align_left, bgcolor=bgcolor_1, text_size=i_tbl_data_txt_size)
    table.cell(table_id=tbl_data, column=1, row=2, text=day_volume_str, text_color=vol_pchg_col, text_halign=text.align_right, bgcolor=bgcolor_1, text_size=i_tbl_data_txt_size)

    table.cell(table_id=tbl_data, column=0, row=3, text="PD Vol", text_color=i_neu_color, text_halign=text.align_left, bgcolor=bgcolor_2, text_size=i_tbl_data_txt_size)
    table.cell(table_id=tbl_data, column=1, row=3, text=prev_day_volume_str, text_color=prev_vol_pchg_col, text_halign=text.align_right, bgcolor=bgcolor_2, text_size=i_tbl_data_txt_size)

//_____________________________ Data Table End

//_____________________________ Get Symbols for Screener Start

// Acknowledgement & Reference
// Trader: 'allanster'
// Indicator Title: 'How To Input CSV List Of Symbol Data Used For Screener'
// Indicator Link: 'https://www.tradingview.com/script/KfqHqHUH-How-To-Input-CSV-List-Of-Symbol-Data-Used-For-Screener/'

feed(back) =>                                             // extract tickerid and decrement list of ticker IDs
    loop  = back                                          // declare string variable to hold content list
    getT  = string(na)                                    // declare string variable to hold tickerid
    if str.length(loop) == 0                              // if list is empty
        getT := string(na)                                // assign na to tickerid variable
        loop := string(na)                                // assign na to list of ticker Ids variable
    else                                                  // else extract first tickerid
        getP  = nz(str.pos(loop, ','), str.length(loop))  // get position of first comma or last character
        getT := str.substring(loop, 0, getP)              // get tickerid in first position of list
        loop := str.replace(loop, getT + ',', '')         // clear tickerid + delimiter character from list
    [getT, loop]                                          // return tickerid in first position & truncated list

[tid_01, out_01] = feed(i_symbols), [tid_02, out_02] = feed(out_01), [tid_03, out_03] = feed(out_02), [tid_04, out_04] = feed(out_03),
[tid_05, out_05] = feed(out_04), [tid_06, out_06] = feed(out_05), [tid_07, out_07] = feed(out_06), [tid_08, out_08] = feed(out_07),
[tid_09, out_09] = feed(out_08), [tid_10, out_10] = feed(out_09), [tid_11, out_11] = feed(out_10), [tid_12, out_12] = feed(out_11),
[tid_13, out_13] = feed(out_12), [tid_14, out_14] = feed(out_13), [tid_15, out_15] = feed(out_14), [tid_16, out_16] = feed(out_15),
[tid_17, out_17] = feed(out_16), [tid_18, out_18] = feed(out_17), [tid_19, out_19] = feed(out_18), [tid_20, out_20] = feed(out_19),
[tid_21, out_21] = feed(out_20), [tid_22, out_22] = feed(out_21), [tid_23, out_23] = feed(out_22), [tid_24, out_24] = feed(out_23),
[tid_25, out_25] = feed(out_24), [tid_26, out_26] = feed(out_25), [tid_27, out_27] = feed(out_26), [tid_28, out_28] = feed(out_27),
[tid_29, out_29] = feed(out_28), [tid_30, out_30] = feed(out_29), [tid_31, out_31] = feed(out_30), [tid_32, out_32] = feed(out_31),
[tid_33, out_33] = feed(out_32), [tid_34, out_34] = feed(out_33), [tid_35, out_35] = feed(out_34), [tid_36, out_36] = feed(out_35),
[tid_37, out_37] = feed(out_36), [tid_38, out_38] = feed(out_37), [tid_39, out_39] = feed(out_38), [tid_40, out_40] = feed(out_39)

//_____________________________ Get Symbols for Screener End

//_____________________________ Screener Start

// Acknowledgement & Reference
// Trader: 'MUQWISHI'
// Indicator Title: 'Candlestick Patterns Screener [By MUQWISHI]'
// Indicator Link: 'https://www.tradingview.com/script/xiWQuGOq-Candlestick-Patterns-Screener-By-MUQWISHI/'

// Choose Screening Method
short_cond = 
 i_scr_choose == 'Prev 1 Swing Sweep' ? short_condition_1 :
 i_scr_choose == 'Prev 2 Swing Sweep' ? short_condition_2 : short_condition_3

long_cond =
 i_scr_choose == 'Prev 1 Swing Sweep' ? long_condition_1 :
 i_scr_choose == 'Prev 2 Swing Sweep' ? long_condition_2 : long_condition_3

// Function for Screener Indicator Calculation
indicator_calculation() =>
    // Initialize variables
    price = float(na)
    _time = int(na)
    _cum_pchg = float(na)
    _cum_vol_pchg = float(na)
    signal = int(na) 

    if barstate.isconfirmed
        // Check for Short Momentum Candle and conditions (Modify here to customize indicators)
        if i_scr_show_long and long_cond
            signal := 1

        // Check for Long Momentum Candle and conditions (Modify here to customize indicators)
        else if i_scr_show_short and short_cond
            signal := -1

        // Update price and time if signal is not null
        if not na(signal)
            price := math.round_to_mintick(close)
            _time := time
            _cum_pchg := cum_pchg
            _cum_vol_pchg := cum_vol_pchg

    [_time, price, _cum_pchg, _cum_vol_pchg, signal]

// Function to format time
format_time(x) =>
    timezone = syminfo.timezone
    timeframe.isintraday ? str.format_time(x, "HH:mm  dd-MM-yyyy", timezone) : str.format_time(x, "dd-MM-yyyy", timezone)

// Function to extract symbol name
symbol(s) => 
    array.get(str.split(s, ":"), 1)

// Matrix setup
var matrix = matrix.new<string>(0, 6, na)

// Function to add rows to the matrix
mtxFun(symbol, _time, price, _cum_pchg, _cum_vol_pchg, signal) =>
    matrix.add_row(matrix, 0, array.from(symbol, _time, price, _cum_pchg, _cum_vol_pchg, signal))

// Screener function to collect data
screener(s) =>
    sym = ticker.modify(s, syminfo.session)
    [_time, price, _cum_pchg, _cum_vol_pchg, signal] = request.security(sym, timeframe.period, indicator_calculation())

    // Check if the signal is not na and the time matches
    if not na(signal) and _time == time
        symbolName = symbol(s)
        formattedTime = format_time(_time)
        strPrice = str.tostring(price)
        str_cum_pchg = str.tostring(_cum_pchg, '#.##')
        str_cum_vol_pchg = str.tostring(_cum_vol_pchg, '#.##')
        strSignal = str.tostring(signal)
        
        // Add data to the matrix
        mtxFun(symbolName, formattedTime, strPrice, str_cum_pchg, str_cum_vol_pchg, strSignal)

// Call Screener function for multiple symbols
screener(tid_01), screener(tid_02), screener(tid_03), screener(tid_04), screener(tid_05), screener(tid_06), screener(tid_07),
screener(tid_08), screener(tid_09), screener(tid_10), screener(tid_11), screener(tid_12), screener(tid_13), screener(tid_14),
screener(tid_15), screener(tid_16), screener(tid_17), screener(tid_18), screener(tid_19), screener(tid_20), screener(tid_21),
screener(tid_22), screener(tid_23), screener(tid_24), screener(tid_25), screener(tid_26), screener(tid_27), screener(tid_28),
screener(tid_29), screener(tid_30), screener(tid_31), screener(tid_32), screener(tid_33), screener(tid_34), screener(tid_35),
screener(tid_36), screener(tid_37), screener(tid_38), screener(tid_39), screener(tid_40)

// Trim excess rows in the matrix
if matrix.rows(matrix) > i_scr_tbl_disp_rows
    while matrix.rows(matrix) > i_scr_tbl_disp_rows
        matrix.remove_row(matrix, matrix.rows(matrix)-1)

// Plot Table
// Create table with specified properties
var table scr_tbl = table.new(position=i_scr_tbl_position, columns=5, rows=102, border_width=1)

// Function to populate cells in the table
scr_cell_title(col, row, txt) => 
    table.cell(scr_tbl, col, row, text = txt, text_color = i_neu_color, text_halign=text.align_center, bgcolor=i_neu_dark_color, text_size=i_scr_tbl_text_size)

scr_cell(col, row, txt, _text_color, _bgcolor) => 
    table.cell(scr_tbl, col, row, text = txt, text_color = _text_color, text_halign=text.align_left, bgcolor=_bgcolor, text_size=i_scr_tbl_text_size)

// Check if it's the last bar
if barstate.islast and i_scr_show_table
    // Clear existing data in the table
    table.clear(scr_tbl, 0, 0, 2, 101)

    scr_cell_title(0, 0, i_scr_choose)
    table.merge_cells(table_id=scr_tbl, start_column=0, start_row=0, end_column=4, end_row=0)
    scr_cell_title(0, 1, "Symbol")
    scr_cell_title(1, 1, "Time")
    scr_cell_title(2, 1, "Price")
    scr_cell_title(3, 1, "%Chg")
    scr_cell_title(4, 1, "V %Chg")

    j = 4
    // Populate table with matrix data
    if matrix.rows(matrix) > 0
        for i = 0 to matrix.rows(matrix) - 1
            // Determine color based on the signal

            _textcolor = 
             matrix.get(matrix, i, 5) ==  "1" ? i_pos_color : 
             matrix.get(matrix, i, 5) == "-1" ? i_neg_color : i_neu_color

            _bg_color = 
             matrix.get(matrix, i, 5) ==  "1" ? i_pos_dark_color :
             matrix.get(matrix, i, 5) == "-1" ? i_neg_dark_color : i_neu_color

            // Populate cells in the table
            scr_cell(0, j, matrix.get(matrix, i, 0), _textcolor, _bg_color)
            scr_cell(1, j, matrix.get(matrix, i, 1), _textcolor, _bg_color)
            scr_cell(2, j, matrix.get(matrix, i, 2), _textcolor, _bg_color)
            scr_cell(3, j, matrix.get(matrix, i, 3), _textcolor, _bg_color)
            scr_cell(4, j, matrix.get(matrix, i, 4), _textcolor, _bg_color)

            j += 1

//_____________________________ Screener End

//_____________________________ Code End

// Readme First:

// ICT Liquidity Sweep Pattern Scanner

// Logic
//   - This generally identifies bullish or bearish liquidity sweeps of previous 1st, 2nd, or 3rd swings.

// Notes
//   - Use higher timeframes for stock selection and trade in lower timeframes.
//   - The scanner may also generate incorrect signals.
##-- File Name: PineScript-main/ICT Liquidity Sweep Pattern Scanner/Scanner - ICT Liquidity Sweep Pattern Scanner.txt | File No: 17 | Ended --##

##-- File Name: PineScript-main/ICT Liquidity Void Fill/[Indicator] ICT Liquidity Void Fill.txt | File No: 18 | Started --##
// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © Arun_K_Bhaskar

//@version=6
indicator(title = 'ICT Liquidity Void Fill', shorttitle = 'ICT LV Fill', overlay = true, max_lines_count = 500)

//_____________________________ Menu Start

string g_lv = '███████████████ Liquidity Void ███████████████'

string tt_lv_fib = 
 "• '0' → Bottom of a bullish candle, top of a bearish candle." + 
 "\n• '1' → Top of a bullish candle, bottom of a bearish candle." + 
 "\n• '0.5' → 50% level of the candle." + 
 "\n• Other Fibonacci/OTE values like 0.62, 0.705, 0.79, etc., are usable." + 
 "\n• Range: Min = 0, Max = 1."

bool i_scr_show_long = input.bool(defval = true, title = 'Long Signals', inline = 'tb_2', group = g_lv)
bool i_scr_show_short = input.bool(defval = true, title = 'Short Signals', inline = 'tb_2', group = g_lv)
float i_fib_val = input.float(defval = 0.5, title = 'Fib Value', minval = 0, maxval = 1, step = 0.1, tooltip = tt_lv_fib, group = g_lv)
string i_fvg_ln_style = input.string(defval = line.style_solid, title = 'Line Style', options = [line.style_solid, line.style_dashed, line.style_dotted], group = g_lv)

string g_af = '██████████████ Additional Fiters ██████████████'

string tt_atr = 
 "• Applicable only to 1st displacement, 80%, or momentum candles." + 
 "\n• ATR filters out longer or more volatile candles."+
 "\n• Higher multiplier value filters longer/volatile 1st candle."
string tt_bf =
 "• Applicable only to 1st displacement, 80%, or momentum candles." + 
 "\n• If the input is '80', the candle's body covers over 80% of its total length."
string tt_bs =
 "• Applicable only to 1st displacement, 80%, or momentum candles." + 
 "\n• If the input is '2', the candle is twice the size of the previous candle."
string tt_tf =
 "• Applicable only to the retracement candle." + 
 "\n• Filter out a signals between the given Time."
string tt_df =
 "• Applicable only to the retracement candle." +
  "\n• Filter out a signals on the given Date." +
  "\n• Turn this on and enter yesterday's date to generate signals for yesterday."

bool i_atr_filter = input.bool(defval = true, title = 'Apply ATR Filter', tooltip = tt_atr, group = g_af)
int i_atr_length = input.int(defval = 14, minval = 1, title = 'ATR Length', group = g_af)
float i_atr_multi = input.float(defval = 1, title = 'ATR Multiplier', minval = 1, group = g_af)

bool i_body_filter = input.bool(defval = true, title = 'Apply Body % Filter', tooltip = tt_bf, group = g_af)
float i_body_percent = input.float(defval = 80, title = 'Body % Above', minval = 0, maxval = 100, group = g_af) / 100

bool i_body_size_filter = input.bool(defval = false, title = 'Apply Body Size Filter', tooltip = tt_bs, group = g_af)
int i_body_size_multiplier = input.int(defval = 2, title = 'Body Size Multiplier (x)', minval = 0, group = g_af)

bool i_time_filter = input.bool(defval = false, title = 'Apply Time Filter', tooltip = tt_tf, group = g_af)
int i_hour_1 = input.int(defval = 9, minval = 0, title = 'Time From', inline = 't_1', group = g_af)
int i_minute_1 = input.int(defval = 15, minval = 0, title = ':', inline = 't_1', group = g_af)
int i_hour_2 = input.int(defval = 10, minval = 0, title = 'Time To ', inline = 't_2', group = g_af)
int i_minute_2 = input.int(defval = 15, minval = 0, title = ':', inline = 't_2', group = g_af)

bool i_date_filter = input.bool(defval = false, title = 'Apply Date Filter', tooltip = tt_df, group = g_af)
int i_day = input.int(defval = 13, minval = 1, maxval = 31, title = 'Day', group = g_af)
int i_month = input.int(defval = 03, minval = 1, maxval = 12, title = 'Month', group = g_af)
int i_year = input.int(defval = 2025, minval = 0, title = 'Year', group = g_af)

string g_ch = '███████████████ Chart Settings ███████████████'

color i_pos_color = input.color(defval = #089981, title = 'Positive Mid', group = g_ch)
color i_pos_light_color = input.color(defval = #ACE5DC, title = 'Positive Light', group = g_ch)
color i_neg_light_color = input.color(defval = #FCCBCD, title = 'Negative Light', group = g_ch)
color i_neg_color = input.color(defval = #F23645, title = 'Negative Mid', group = g_ch)
color i_neu_color = input.color(defval = #9C9C9C, title = 'Neutral Light', group = g_ch)
color i_neu_dark_color = input.color(defval = #0F0F0F, title = 'Neutral Dark', group = g_ch)

//_____________________________ Menu End

//_____________________________ Additional Filters Start

// ATR Filter
bool atr_filter = true
if i_atr_filter
    atr_filter := high - low > ta.atr(i_atr_length) * i_atr_multi

// Body Percent Filter
bool body_filter = true
if i_body_filter
    body_filter := math.abs(close - open) / (high - low) >= i_body_percent

// Body Size Filter
bool body_size_filter = true
if i_body_size_filter
    body_size_filter := math.abs(close - open) / (high - low) >= i_body_percent and high - low >= (high[1] - low[1]) * i_body_size_multiplier

// Time Filter
bool time_filter = true
if i_time_filter
    time_filter := (hour > i_hour_1 or hour == i_hour_1 and minute >= i_minute_1) and (hour < i_hour_2 or hour == i_hour_2 and minute < i_minute_2)

// Date Filter
bool date_filter = true
if i_date_filter
    date_filter := year == i_year and month == i_month and dayofmonth == i_day

//_____________________________ Additional Filters End

//_____________________________ Fibonacci Start

// Fibonacci Function
fibonacci(bool calc_from_high, float high_value, float low_value, float fib_value) =>
    if calc_from_high
        low_value + (high_value - low_value) * fib_value
    else
        high_value - (high_value - low_value) * fib_value

//_____________________________ Fibonacci End

//_____________________________ Signals Start

// Short Condition 1
short_cont_1 = 
 open > close and 
 atr_filter and 
 body_filter and
 body_size_filter

var short_cont_1_high = float(na)
var short_cont_1_low = float(na)
var short_cont_1_bi = int(na)
if short_cont_1
    short_cont_1_high := high
    short_cont_1_low := low
    short_cont_1_bi := bar_index

float bear_fib_val = fibonacci(false, short_cont_1_high, short_cont_1_low, i_fib_val)

// Short Condition 2
short_cont_2 = 
 ta.crossover(high, bear_fib_val) and 
 time_filter and
 date_filter and
 barstate.isconfirmed

// Short Retracement Signal
var short_curr_state = 0
short_prev_state = nz(short_curr_state[1])
short_curr_state := short_prev_state == 2 ? 0 : short_prev_state
if short_cont_1 and short_curr_state == 0
    short_curr_state := 1
if not short_cont_1 and short_cont_2 and short_curr_state == 1
    short_curr_state := 2

short_ret_signal = short_curr_state == 2 ? true : false


// Long Condition 1
long_cont_1 = 
 open < close and 
 atr_filter and 
 body_filter and
 body_size_filter

var long_cont_1_high = float(na)
var long_cont_1_low = float(na)
var long_cont_1_bi = int(na)
if long_cont_1
    long_cont_1_high := high
    long_cont_1_low := low
    long_cont_1_bi := bar_index

float bull_fib_val = fibonacci(true, long_cont_1_high, long_cont_1_low, i_fib_val)

// Long Condition 2
long_cont_2 = 
 ta.crossunder(low, bull_fib_val) and 
 time_filter and
 date_filter and
 barstate.isconfirmed

// Long  Retracement
var long_curr_state = 0
long_prev_state = nz(long_curr_state[1])
long_curr_state := long_prev_state == 2 ? 0 : long_prev_state
if long_cont_1 and long_curr_state == 0
    long_curr_state := 1
if not long_cont_1 and long_cont_2 and long_curr_state == 1
    long_curr_state := 2

long_ret_signal = long_curr_state == 2 ? true : false

//_____________________________ Signals End

//_____________________________ Plot Start

// Plot
plotshape(series = i_scr_show_short and short_ret_signal ? 3 : na, title = 'Short Signal', style = shape.triangledown, location = location.abovebar, color = i_neg_light_color, size = size.tiny, force_overlay = true)
plotshape(series = i_scr_show_long and long_ret_signal ? 3 : na, title = 'Long Signal', style = shape.triangleup, location = location.belowbar, color = i_pos_light_color, size = size.tiny, force_overlay = true)
barcolor(color = i_scr_show_short and short_cont_1 ? i_neg_light_color : i_scr_show_long and long_cont_1 ? i_pos_light_color : na, title = '80% Candle')

// Line
var line_array = array.new_line()

if i_scr_show_short and short_ret_signal
    array.push(line_array, line.new(x1 = short_cont_1_bi, y1 = bear_fib_val, x2 = bar_index, y2 = bear_fib_val, color = i_neg_color, style = i_fvg_ln_style))

if i_scr_show_long and long_ret_signal
    array.push(line_array, line.new(x1 = long_cont_1_bi, y1 = bull_fib_val, x2 = bar_index, y2 = bull_fib_val, color = i_pos_color, style = i_fvg_ln_style))

//_____________________________ Plot End

//_____________________________ Code End

// Readme First:

// ICT Liquidity Void Fill Scanner

// Logic
//   - This identifies a momentum candle, an 80% body candle with high volatility, or a displacement.
//   - A signal is generated when the price retraces to the candle body, void, or FVG, based on the Fibonacci value.

// Notes
//   - Use a higher timeframe, like 4 hour or 1 hour, for stock selection.
//   - The Scanner will generate wrong signals also.

##-- File Name: PineScript-main/ICT Liquidity Void Fill/[Indicator] ICT Liquidity Void Fill.txt | File No: 18 | Ended --##

##-- File Name: PineScript-main/ICT Liquidity Void Fill/[Scanner] ICT Liquidity Void Fill Scanner.txt | File No: 19 | Started --##
// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © Arun_K_Bhaskar

//@version=6
indicator(title = 'ICT Liquidity Void Fill Scanner', shorttitle = 'ICT LV Fill Scan', overlay = true, max_lines_count = 500)

//_____________________________ Menu Start

string g_scrtb = '█████████████████ Scanner █████████████████'

string tt_is = 
 "• Reads only up to first 40 symbols." +
 "\n• Total characters cannot exceed 4096." +
 "\n• Eg: EXCHANGE:SYMBOL_A,EXCHANGE:SYMBOL_B"

string i_symbols = input.text_area(
 defval="NSE:ABCAPITAL,NSE:ABFRL,NSE:ASHOKLEY,NSE:BANDHANBNK,NSE:BANKBARODA,NSE:BANKINDIA,NSE:BEL,NSE:BHEL,NSE:BPCL,NSE:CANBK,NSE:CESC,NSE:CUB,NSE:FEDERALBNK,NSE:GAIL,NSE:GMRAIRPORT,NSE:HFCL,NSE:HINDCOPPER,NSE:HUDCO,NSE:IDFCFIRSTB,NSE:IEX,NSE:IGL,NSE:IOC,NSE:IRFC,NSE:JIOFIN,NSE:LTF,NSE:MANAPPURAM,NSE:MOTHERSON,NSE:NATIONALUM,NSE:NBCC,NSE:NCC,NSE:NHPC,NSE:NMDC,NSE:NYKAA,NSE:ONGC,NSE:PNB,NSE:SAIL,NSE:SJVN,NSE:TATASTEEL,NSE:UNIONBANK,NSE:RBLBANK", 
 title="Paste Symbols", tooltip=tt_is, group=g_scrtb)

bool i_scr_show_table = input.bool(defval = true, title = 'Display Table', group = g_scrtb)
bool i_scr_show_long = input.bool(defval = true, title = 'Long Signals', inline = 'tb_2', group = g_scrtb)
bool i_scr_show_short = input.bool(defval = true, title = 'Short Signals', inline = 'tb_2', group = g_scrtb)

int i_scr_tbl_disp_rows = input.int(defval = 12, title = 'Display Rows', minval = 0, maxval = 100, group = g_scrtb)
string i_scr_tbl_position = input.string(defval = position.bottom_left, title = 'Table Position', options = [position.top_left, position.top_center, position.top_right, position.middle_left, position.middle_center, position.middle_right, position.bottom_left, position.bottom_center, position.bottom_right], group = g_scrtb)
string i_scr_tbl_text_size = input.string(defval = size.small, title = 'Table Size', options = [size.auto, size.tiny, size.small, size.normal, size.large, size.huge], group = g_scrtb)

string g_lv = '███████████████ Liquidity Void ███████████████'

string tt_lv_fib = 
 "• '0' → Bottom of a bullish candle, top of a bearish candle." + 
 "\n• '1' → Top of a bullish candle, bottom of a bearish candle." + 
 "\n• '0.5' → 50% level of the candle." + 
 "\n• Other Fibonacci/OTE values like 0.62, 0.705, 0.79, etc., are usable." + 
 "\n• Range: Min = 0, Max = 1."

float i_fib_val = input.float(defval = 0.5, title = 'Fib Value', minval = 0, maxval = 1, step = 0.1, tooltip = tt_lv_fib, group = g_lv)
string i_fvg_ln_style = input.string(defval = line.style_solid, title = 'Line Style', options = [line.style_solid, line.style_dashed, line.style_dotted], group = g_lv)

string g_af = '██████████████ Additional Fiters ██████████████'

string tt_atr = 
 "• Applicable only to 1st displacement, 80%, or momentum candles." + 
 "\n• ATR filters out longer or more volatile candles."+
 "\n• Higher multiplier value filters longer/volatile 1st candle."
string tt_bf =
 "• Applicable only to 1st displacement, 80%, or momentum candles." + 
 "\n• If the input is '80', the candle's body covers over 80% of its total length."
string tt_bs =
 "• Applicable only to 1st displacement, 80%, or momentum candles." + 
 "\n• If the input is '2', the candle is twice the size of the previous candle."
string tt_tf =
 "• Applicable only to the retracement candle." + 
 "\n• Filter out a signals between the given Time."
string tt_df =
 "• Applicable only to the retracement candle." +
  "\n• Filter out a signals on the given Date." +
  "\n• Turn this on and enter yesterday's date to generate signals for yesterday."

bool i_atr_filter = input.bool(defval = true, title = 'Apply ATR Filter', tooltip = tt_atr, group = g_af)
int i_atr_length = input.int(defval = 14, minval = 1, title = 'ATR Length', group = g_af)
float i_atr_multi = input.float(defval = 1, title = 'ATR Multiplier', minval = 1, group = g_af)

bool i_body_filter = input.bool(defval = true, title = 'Apply Body % Filter', tooltip = tt_bf, group = g_af)
float i_body_percent = input.float(defval = 80, title = 'Body % Above', minval = 0, maxval = 100, group = g_af) / 100

bool i_body_size_filter = input.bool(defval = false, title = 'Apply Body Size Filter', tooltip = tt_bs, group = g_af)
int i_body_size_multiplier = input.int(defval = 2, title = 'Body Size Multiplier (x)', minval = 0, group = g_af)

bool i_time_filter = input.bool(defval = false, title = 'Apply Time Filter', tooltip = tt_tf, group = g_af)
int i_hour_1 = input.int(defval = 9, minval = 0, title = 'Time From', inline = 't_1', group = g_af)
int i_minute_1 = input.int(defval = 15, minval = 0, title = ':', inline = 't_1', group = g_af)
int i_hour_2 = input.int(defval = 10, minval = 0, title = 'Time To ', inline = 't_2', group = g_af)
int i_minute_2 = input.int(defval = 15, minval = 0, title = ':', inline = 't_2', group = g_af)

bool i_date_filter = input.bool(defval = false, title = 'Apply Date Filter', tooltip = tt_df, group = g_af)
int i_day = input.int(defval = 13, minval = 1, maxval = 31, title = 'Day', group = g_af)
int i_month = input.int(defval = 03, minval = 1, maxval = 12, title = 'Month', group = g_af)
int i_year = input.int(defval = 2025, minval = 0, title = 'Year', group = g_af)

string g_dtb = '████████████████ Data Table ████████████████'

bool i_tbl_data_show = input.bool(defval = true, title = 'Display Table', group = g_dtb)
string i_tbl_data_pos = input.string(defval = position.bottom_right, title = 'Position', options = [position.top_left, position.top_center, position.top_right, position.middle_left, position.middle_center, position.middle_right, position.bottom_left, position.bottom_center, position.bottom_right], group = g_dtb)
string i_tbl_data_txt_size = input.string(defval = size.normal, title = 'Size', options = [size.auto, size.tiny, size.small, size.normal, size.large, size.huge], group = g_dtb)

string g_ch = '███████████████ Chart Settings ███████████████'

color i_pos_color = input.color(defval = #089981, title = 'Positive Mid', group = g_ch)
color i_pos_light_color = input.color(defval = #ACE5DC, title = 'Positive Light', group = g_ch)
color i_neg_light_color = input.color(defval = #FCCBCD, title = 'Negative Light', group = g_ch)
color i_neg_color = input.color(defval = #F23645, title = 'Negative Mid', group = g_ch)
color i_neu_color = input.color(defval = #9C9C9C, title = 'Neutral Light', group = g_ch)
color i_neu_dark_color = input.color(defval = #0F0F0F, title = 'Neutral Dark', group = g_ch)

//_____________________________ Menu End

//_____________________________ Cumulative Percentage Change Start

// Function to calculate Daily Cumulative Percentage Change of Close Price
cum_pchg() =>
    var float _cum_pct_change = na
    _is_new_day = ta.change(time('D')) != 0 ? 1 : 0
    _daily_pct_change = na(close[1]) ? 0 : (close - close[1]) / close[1] * 100
    _cum_pct_change := bool(_is_new_day) ? _daily_pct_change : na(_cum_pct_change) ? _daily_pct_change : _cum_pct_change + _daily_pct_change
    _cum_pct_change

// Calculate current cumulative percentage change
cum_pchg = cum_pchg()

//_____________________________ Cumulative Percentage Change End

//_____________________________ Cumulative Volume Percentage Change Start

// Function to calculate Daily Cumulative Volume
cum_vol() =>
    var float _cum_vol = na
    _is_new_day = ta.change(time('D')) != 0 ? 1 : 0
    _cum_vol := bool(_is_new_day) ? volume : na(_cum_vol) ? volume : _cum_vol + volume
    _cum_vol

// Calculate current and previous day cumulative volumes
var float curr_cum_vol = na
var float prev_cum_vol = na

if ta.change(time('D')) != 0
    prev_cum_vol := curr_cum_vol
    curr_cum_vol := volume
    curr_cum_vol
else
    curr_cum_vol := curr_cum_vol + volume
    curr_cum_vol

// Calculate Cumulative Volume Percentage Change
cum_vol_pchg = (curr_cum_vol - nz(prev_cum_vol, curr_cum_vol)) / nz(prev_cum_vol, curr_cum_vol) * 100

//_____________________________ Cumulative Volume Percentage Change End

//_____________________________ Additional Filters Start

// ATR Filter
bool atr_filter = true
if i_atr_filter
    atr_filter := high - low > ta.atr(i_atr_length) * i_atr_multi

// Body Percent Filter
bool body_filter = true
if i_body_filter
    body_filter := math.abs(close - open) / (high - low) >= i_body_percent

// Body Size Filter
bool body_size_filter = true
if i_body_size_filter
    body_size_filter := math.abs(close - open) / (high - low) >= i_body_percent and high - low >= (high[1] - low[1]) * i_body_size_multiplier

// Time Filter
bool time_filter = true
if i_time_filter
    time_filter := (hour > i_hour_1 or hour == i_hour_1 and minute >= i_minute_1) and (hour < i_hour_2 or hour == i_hour_2 and minute < i_minute_2)

// Date Filter
bool date_filter = true
if i_date_filter
    date_filter := year == i_year and month == i_month and dayofmonth == i_day

//_____________________________ Additional Filters End

//_____________________________ Fibonacci Start

// Fibonacci Function
fibonacci(bool calc_from_high, float high_value, float low_value, float fib_value) =>
    if calc_from_high
        low_value + (high_value - low_value) * fib_value
    else
        high_value - (high_value - low_value) * fib_value

//_____________________________ Fibonacci End

//_____________________________ Signals Start

// Short Condition 1
short_cont_1 = 
 open > close and 
 atr_filter and 
 body_filter and
 body_size_filter

var short_cont_1_high = float(na)
var short_cont_1_low = float(na)
var short_cont_1_bi = int(na)
if short_cont_1
    short_cont_1_high := high
    short_cont_1_low := low
    short_cont_1_bi := bar_index

float bear_fib_val = fibonacci(false, short_cont_1_high, short_cont_1_low, i_fib_val)

// Short Condition 2
short_cont_2 = 
 ta.crossover(high, bear_fib_val) and 
 time_filter and
 date_filter and
 barstate.isconfirmed

// Short Retracement Signal
var short_curr_state = 0
short_prev_state = nz(short_curr_state[1])
short_curr_state := short_prev_state == 2 ? 0 : short_prev_state
if short_cont_1 and short_curr_state == 0
    short_curr_state := 1
if not short_cont_1 and short_cont_2 and short_curr_state == 1
    short_curr_state := 2

short_ret_signal = short_curr_state == 2 ? true : false

// Long Condition 1
long_cont_1 = 
 open < close and 
 atr_filter and 
 body_filter and
 body_size_filter

var long_cont_1_high = float(na)
var long_cont_1_low = float(na)
var long_cont_1_bi = int(na)
if long_cont_1
    long_cont_1_high := high
    long_cont_1_low := low
    long_cont_1_bi := bar_index

float bull_fib_val = fibonacci(true, long_cont_1_high, long_cont_1_low, i_fib_val)

// Long Condition 2
long_cont_2 = 
 ta.crossunder(low, bull_fib_val) and 
 time_filter and
 date_filter and
 barstate.isconfirmed

// Long  Retracement
var long_curr_state = 0
long_prev_state = nz(long_curr_state[1])
long_curr_state := long_prev_state == 2 ? 0 : long_prev_state
if long_cont_1 and long_curr_state == 0
    long_curr_state := 1
if not long_cont_1 and long_cont_2 and long_curr_state == 1
    long_curr_state := 2

long_ret_signal = long_curr_state == 2 ? true : false

//_____________________________ Signals End

//_____________________________ Plot Start

// Plot
plotshape(series = i_scr_show_short and short_ret_signal ? 3 : na, title = 'Short Signal', style = shape.triangledown, location = location.abovebar, color = i_neg_light_color, size = size.tiny, force_overlay = true)
plotshape(series = i_scr_show_long and long_ret_signal ? 3 : na, title = 'Long Signal', style = shape.triangleup, location = location.belowbar, color = i_pos_light_color, size = size.tiny, force_overlay = true)
barcolor(color = i_scr_show_short and short_cont_1 ? i_neg_light_color : i_scr_show_long and long_cont_1 ? i_pos_light_color : na, title = '80% Candle')

// Line
var line_array = array.new_line()

if i_scr_show_short and short_ret_signal
    array.push(line_array, line.new(x1 = short_cont_1_bi, y1 = bear_fib_val, x2 = bar_index, y2 = bear_fib_val, color = i_neg_color, style = i_fvg_ln_style))

if i_scr_show_long and long_ret_signal
    array.push(line_array, line.new(x1 = long_cont_1_bi, y1 = bull_fib_val, x2 = bar_index, y2 = bull_fib_val, color = i_pos_color, style = i_fvg_ln_style))

//_____________________________ Plot End

//_____________________________ Data Table Start

// To String
day_pchg_str = str.tostring(cum_pchg, '#.##') + ' %'
volume_pchg_str = str.tostring(cum_vol_pchg, '#.##') + ' %'
day_volume_str = str.tostring(curr_cum_vol / 100000, '#.##') + ' L'
prev_day_volume_str = str.tostring(prev_cum_vol / 100000, '#.##') + ' L'

// Color
bgcolor_1 = i_neu_dark_color
bgcolor_2 = i_neu_dark_color

pchg_col = cum_pchg > 0 ? i_pos_color : i_neg_color
vol_pchg_col = cum_vol_pchg > 0 ? i_pos_color : i_neg_color
prev_vol_pchg_col = prev_cum_vol < curr_cum_vol ? i_neg_color : i_pos_color

// Plot Table
var table tbl_data = table.new(position = i_tbl_data_pos, columns = 2, rows = 4, border_width = 1, force_overlay = true)

if barstate.islast and i_tbl_data_show
    table.cell(table_id = tbl_data, column = 0, row = 0, text = '%Chg', text_color = i_neu_color, text_halign = text.align_left, bgcolor = bgcolor_1, text_size = i_tbl_data_txt_size)
    table.cell(table_id = tbl_data, column = 1, row = 0, text = day_pchg_str, text_color = pchg_col, text_halign = text.align_right, bgcolor = bgcolor_1, text_size = i_tbl_data_txt_size)

    table.cell(table_id = tbl_data, column = 0, row = 1, text = 'Vol %Chg', text_color = i_neu_color, text_halign = text.align_left, bgcolor = bgcolor_2, text_size = i_tbl_data_txt_size)
    table.cell(table_id = tbl_data, column = 1, row = 1, text = volume_pchg_str, text_color = vol_pchg_col, text_halign = text.align_right, bgcolor = bgcolor_2, text_size = i_tbl_data_txt_size)

    table.cell(table_id = tbl_data, column = 0, row = 2, text = 'Vol', text_color = i_neu_color, text_halign = text.align_left, bgcolor = bgcolor_1, text_size = i_tbl_data_txt_size)
    table.cell(table_id = tbl_data, column = 1, row = 2, text = day_volume_str, text_color = vol_pchg_col, text_halign = text.align_right, bgcolor = bgcolor_1, text_size = i_tbl_data_txt_size)

    table.cell(table_id = tbl_data, column = 0, row = 3, text = 'PD Vol', text_color = i_neu_color, text_halign = text.align_left, bgcolor = bgcolor_2, text_size = i_tbl_data_txt_size)
    table.cell(table_id = tbl_data, column = 1, row = 3, text = prev_day_volume_str, text_color = prev_vol_pchg_col, text_halign = text.align_right, bgcolor = bgcolor_2, text_size = i_tbl_data_txt_size)

//_____________________________ Data Table End

//_____________________________ Get Symbols for Screener Start

// Acknowledgement & Reference
// Trader: 'allanster'
// Indicator Title: 'How To Input CSV List Of Symbol Data Used For Screener'
// Indicator Link: 'https://www.tradingview.com/script/KfqHqHUH-How-To-Input-CSV-List-Of-Symbol-Data-Used-For-Screener/'

feed(back) =>                                             // extract tickerid and decrement list of ticker IDs
    loop  = back                                          // declare string variable to hold content list
    getT  = string(na)                                    // declare string variable to hold tickerid
    if str.length(loop) == 0                              // if list is empty
        getT := string(na)                                // assign na to tickerid variable
        loop := string(na)                                // assign na to list of ticker Ids variable
    else                                                  // else extract first tickerid
        getP  = nz(str.pos(loop, ','), str.length(loop))  // get position of first comma or last character
        getT := str.substring(loop, 0, getP)              // get tickerid in first position of list
        loop := str.replace(loop, getT + ',', '')         // clear tickerid + delimiter character from list
    [getT, loop]                                          // return tickerid in first position & truncated list

[t_01, o_01] = feed(i_symbols), [t_02, o_02] = feed(o_01), [t_03, o_03] = feed(o_02), [t_04, o_04] = feed(o_03), [t_05, o_05] = feed(o_04), 
[t_06, o_06] = feed(o_05), [t_07, o_07] = feed(o_06), [t_08, o_08] = feed(o_07), [t_09, o_09] = feed(o_08), [t_10, o_10] = feed(o_09), 
[t_11, o_11] = feed(o_10), [t_12, o_12] = feed(o_11), [t_13, o_13] = feed(o_12), [t_14, o_14] = feed(o_13), [t_15, o_15] = feed(o_14),
[t_16, o_16] = feed(o_15), [t_17, o_17] = feed(o_16), [t_18, o_18] = feed(o_17), [t_19, o_19] = feed(o_18), [t_20, o_20] = feed(o_19),
[t_21, o_21] = feed(o_20), [t_22, o_22] = feed(o_21), [t_23, o_23] = feed(o_22), [t_24, o_24] = feed(o_23), [t_25, o_25] = feed(o_24), 
[t_26, o_26] = feed(o_25), [t_27, o_27] = feed(o_26), [t_28, o_28] = feed(o_27), [t_29, o_29] = feed(o_28), [t_30, o_30] = feed(o_29), 
[t_31, o_31] = feed(o_30), [t_32, o_32] = feed(o_31), [t_33, o_33] = feed(o_32), [t_34, o_34] = feed(o_33), [t_35, o_35] = feed(o_34), 
[t_36, o_36] = feed(o_35), [t_37, o_37] = feed(o_36), [t_38, o_38] = feed(o_37), [t_39, o_39] = feed(o_38), [t_40, o_40] = feed(o_39)

//_____________________________ Get Symbols for Screener End

//_____________________________ Screener Start

// Acknowledgement & Reference
// Trader: 'MUQWISHI'
// Indicator Title: 'Candlestick Patterns Screener [By MUQWISHI]'
// Indicator Link: 'https://www.tradingview.com/script/xiWQuGOq-Candlestick-Patterns-Screener-By-MUQWISHI/'

// Scanner Conditions
short_cond = short_ret_signal
long_cond = long_ret_signal

// Function for Screener Indicator Calculation
indicator_calculation() =>
    // Initialize variables
    price = float(na)
    _time = int(na)
    _cum_pchg = float(na)
    _cum_vol_pchg = float(na)
    signal = int(na)

    if barstate.isconfirmed
        // Check for Short Momentum Candle and conditions (Modify here to customize indicators)
        if i_scr_show_long and long_cond
            signal := 1

        // Check for Long Momentum Candle and conditions (Modify here to customize indicators)
        else if i_scr_show_short and short_cond
            signal := -1

        // Update price and time if signal is not null
        if not na(signal)
            price := math.round_to_mintick(close)
            _time := time
            _cum_pchg := cum_pchg
            _cum_vol_pchg := cum_vol_pchg

    [_time, price, _cum_pchg, _cum_vol_pchg, signal]

// Function to format time
format_time(x) =>
    timezone = syminfo.timezone
    timeframe.isintraday ? str.format_time(x, 'HH:mm  dd-MM-yyyy', timezone) : str.format_time(x, 'dd-MM-yyyy', timezone)

// Function to extract symbol name
symbol(s) =>
    array.get(str.split(s, ':'), 1)

// Matrix setup
var matrix = matrix.new<string>(0, 6, na)

// Function to add rows to the matrix
mtxFun(symbol, _time, price, _cum_pchg, _cum_vol_pchg, signal) =>
    matrix.add_row(matrix, 0, array.from(symbol, _time, price, _cum_pchg, _cum_vol_pchg, signal))

// Screener function to collect data
scan(s) =>
    sym = ticker.modify(s, syminfo.session)
    [_time, price, _cum_pchg, _cum_vol_pchg, signal] = request.security(sym, timeframe.period, indicator_calculation())

    // Check if the signal is not na and the time matches
    if not na(signal) and _time == time
        symbolName = symbol(s)
        formattedTime = format_time(_time)
        strPrice = str.tostring(price)
        str_cum_pchg = str.tostring(_cum_pchg, '#.##')
        str_cum_vol_pchg = str.tostring(_cum_vol_pchg, '#.##')
        strSignal = str.tostring(signal)

        // Add data to the matrix
        mtxFun(symbolName, formattedTime, strPrice, str_cum_pchg, str_cum_vol_pchg, strSignal)

// Call Screener function for multiple symbols
scan(t_01), scan(t_02), scan(t_03), scan(t_04), scan(t_05), scan(t_06), scan(t_07), scan(t_08), scan(t_09), scan(t_10), scan(t_11), scan(t_12), 
scan(t_13), scan(t_14), scan(t_15), scan(t_16), scan(t_17), scan(t_18), scan(t_19), scan(t_20), scan(t_21), scan(t_22), scan(t_23), scan(t_24), 
scan(t_25), scan(t_26), scan(t_27), scan(t_28), scan(t_29), scan(t_30), scan(t_31), scan(t_32), scan(t_33), scan(t_34), scan(t_35), scan(t_36), 
scan(t_37), scan(t_38), scan(t_39), scan(t_40)

// Trim excess rows in the matrix
if matrix.rows(matrix) > i_scr_tbl_disp_rows
    while matrix.rows(matrix) > i_scr_tbl_disp_rows
        matrix.remove_row(matrix, matrix.rows(matrix) - 1)

// Plot Table
// Create table with specified properties
var table scr_tbl = table.new(position = i_scr_tbl_position, columns = 5, rows = 102, border_width = 1, force_overlay = true)

// Function to populate cells in the table
scr_cell_title(col, row, txt) =>
    table.cell(scr_tbl, col, row, text = txt, text_color = i_neu_color, text_halign = text.align_center, bgcolor = i_neu_dark_color, text_size = i_scr_tbl_text_size)

scr_cell(col, row, txt, _text_color, _bgcolor) =>
    table.cell(scr_tbl, col, row, text = txt, text_color = _text_color, text_halign = text.align_left, bgcolor = _bgcolor, text_size = i_scr_tbl_text_size)

// Check if it's the last bar
if barstate.islast and i_scr_show_table
    // Clear existing data in the table
    table.clear(scr_tbl, 0, 0, 2, 101)

    scr_cell_title(0, 0, 'Fill to ' + str.tostring(i_fib_val) + '%')
    table.merge_cells(table_id = scr_tbl, start_column = 0, start_row = 0, end_column = 4, end_row = 0)
    scr_cell_title(0, 1, 'Symbol')
    scr_cell_title(1, 1, 'Time')
    scr_cell_title(2, 1, 'Price')
    scr_cell_title(3, 1, '%Chg')
    scr_cell_title(4, 1, 'V %Chg')

    j = 4
    // Populate table with matrix data
    if matrix.rows(matrix) > 0
        for i = 0 to matrix.rows(matrix) - 1 by 1
        // Determine color based on the signal

            _textcolor = matrix.get(matrix, i, 5) == '1' ? i_pos_color : matrix.get(matrix, i, 5) == '-1' ? i_neg_color : i_neu_color

            _bg_color = matrix.get(matrix, i, 5) == '1' ? i_neu_dark_color : matrix.get(matrix, i, 5) == '-1' ? i_neu_dark_color : i_neu_color

            // Populate cells in the table
            scr_cell(0, j, matrix.get(matrix, i, 0), _textcolor, _bg_color)
            scr_cell(1, j, matrix.get(matrix, i, 1), _textcolor, _bg_color)
            scr_cell(2, j, matrix.get(matrix, i, 2), _textcolor, _bg_color)
            scr_cell(3, j, matrix.get(matrix, i, 3), _textcolor, _bg_color)
            scr_cell(4, j, matrix.get(matrix, i, 4), _textcolor, _bg_color)

            j := j + 1

//_____________________________ Screener End

//_____________________________ Code End

// Readme First:

// ICT Liquidity Void Fill Scanner

// Logic
//   - This identifies a momentum candle, an 80% body candle with high volatility, or a displacement.
//   - A signal is generated when the price retraces to the candle body, void, or FVG, based on the Fibonacci value.

// Notes
//   - Use a higher timeframe, like 4 hour or 1 hour, for stock selection.
//   - The Scanner will generate wrong signals also.

##-- File Name: PineScript-main/ICT Liquidity Void Fill/[Scanner] ICT Liquidity Void Fill Scanner.txt | File No: 19 | Ended --##

##-- File Name: PineScript-main/ICT Liquidity Void Fill/Readme First.txt | File No: 20 | Started --##
// Readme First:

// ICT Liquidity Void Fill Scanner

// Logic
//   - This identifies a momentum candle, an 80% body candle with high volatility, or a displacement.
//   - A signal is generated when the price retraces to the candle body, void, or FVG, based on the Fibonacci value.

// Notes
//   - Use a higher timeframe, like 4 hour or 1 hour, for stock selection.
//   - The Scanner will generate wrong signals also.

##-- File Name: PineScript-main/ICT Liquidity Void Fill/Readme First.txt | File No: 20 | Ended --##

##-- File Name: PineScript-main/ICT Liquidity Void/ICT Liquidity Void Multi-timeframe.txt | File No: 21 | Started --##
// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © Arun_K_Bhaskar

//@version=5
indicator(title="ICT Liquidity Void Multi-timeframe", shorttitle="ICT LV", overlay=true)

//_____________________________ Menu Liquidity Void Start

g_lv = '███████████████ Liquidity Void ███████████████'
string i_lv_htf = input.timeframe(defval='', title='Timeframe', group=g_lv)
int i_lv_show_last = input.int(defval=2, title='Show Last', minval=0, group=g_lv)
string i_lv_line = input.string(defval='High/Low', title='Source', options=['High/Low', 'OTE 0.79%', '50%'], group=g_lv)
bool i_lv_bear_show = input.bool(defval=true, title='Bearish', group=g_lv)
bool i_lv_bull_show = input.bool(defval=true, title='Bullish', group=g_lv)
bool i_lv_hide_crossed = input.bool(defval=false, title='Hide Crossed', group=g_lv)

g_lv_f = "Void Height Filter"
tt_lv_f = "• Filters remove narrow liquidity voids." +
 "\n• ATR filtering adjusts automatically when the timeframe changes." +
 "\n• Percentage filter will be constant across all timeframes." +
 "\n• If you don't want any filtering, choose 'Percentage' and then change Percentage to 0."
string i_lv_additional = input.string(defval='ATR', title='Filter Using', options=['ATR', 'Percentage'], tooltip=tt_lv_f, group=g_lv_f)
tt_lv_atr = "Applicable only if 'Filter Using' is 'ATR'"
int i_lv_atr_length = input.int(defval=14, minval=1, title='ATR Period', tooltip=tt_lv_atr, group=g_lv_f)
tt_lv_atr_m = "Higher the number, filters higher void height."
float i_lv_atr_multi = input.float(defval=4, minval=1, title='ATR Multiplier', tooltip=tt_lv_atr_m, group=g_lv_f)
tt_lv_p = "Filters liquidity void above the given percentage."
float i_lv_percentage = input.float(defval=2.5, minval=0, step=0.1, title='Percentage Above', tooltip=tt_lv_p, group=g_lv_f)

g_lv_ds = "Display Settings"
color i_lv_bear_color = input.color(defval=#F7525F, title='Bearish Color', group=g_lv_ds)
color i_lv_bull_color = input.color(defval=#22AB94, title='Bullish Color', group=g_lv_ds)
string i_lv_ln_style = input.string(defval=line.style_solid, title="Line Style", options=[line.style_solid, line.style_dashed, line.style_dotted], group=g_lv_ds)
int i_lv_ln_width = input.int(defval=2, title='Width', group=g_lv_ds)
int i_lv_box_trans = input.int(defval=75, title='Box Transparency', group=g_lv_ds)

//_____________________________ Menu Liquidity Void End

//_____________________________ Get Data Start

[open_htf, high_htf, low_htf, close_htf, time_htf, atr_htf, bc_htf] =
 request.security(symbol=syminfo.tickerid, timeframe=i_lv_htf, expression=[open, high, low, close, time, ta.atr(i_lv_atr_length), barstate.isconfirmed], lookahead=barmerge.lookahead_on)

//_____________________________ Get Data End

//_____________________________ Functions Start

// Function to calculate filter based on ATR or percentage
filter(prev_value, other_value, _atr_htf, _atr_multi, _percentage, _additional) =>
    filter_atr = math.abs(prev_value - other_value) > _atr_htf * _atr_multi
    filter_percent = math.abs((prev_value - other_value) / prev_value * 100) > _percentage
    _additional == 'ATR' ? filter_atr : filter_percent

// Function to determine line type
price_source(float prev_value, float other_value, string price_source) =>
    price_source == 'High/Low' ? prev_value : 
     price_source == 'OTE 0.79%' ? other_value + ((prev_value - other_value) * 0.79) : 
     price_source == 'OTE 0.79%' ? other_value - ((prev_value - other_value) * 0.79) : 
     math.avg(prev_value, other_value)

draw_line(int x1_time, float y1_price, color _color)=>
    line.new(x1=x1_time, y1=y1_price, x2=time_htf, y2=y1_price, xloc=xloc.bar_time, color=_color, style=i_lv_ln_style, width=i_lv_ln_width)

draw_box(int left_time, float top_price, float bottom_price, color _color)=>
    box.new(left=left_time, top=top_price, right=time_htf, bottom=bottom_price, xloc=xloc.bar_time, border_color=color.new(_color, i_lv_box_trans), bgcolor=color.new(_color, i_lv_box_trans))

// Function to handle array operations and cleanup
clean_arrays(_all_lines, _keep_lines, _all_boxes, _keep_boxes, _lv_line, _lv_box) =>

    array.push(_all_lines, _lv_line)
    array.push(_all_boxes, _lv_box)

    if array.size(_all_lines) > i_lv_show_last
        removed_line = array.shift(_all_lines)
        if array.includes(_keep_lines, removed_line)
            index_of_removed_line = array.indexof(_keep_lines, removed_line)
            array.remove(_keep_lines, index_of_removed_line)
        line.delete(removed_line)
        
    if array.size(_all_boxes) > i_lv_show_last
        removed_box = array.shift(_all_boxes)
        if array.includes(_keep_boxes, removed_box)
            index_of_removed_box = array.indexof(_keep_boxes, removed_box)
            array.remove(_keep_boxes, index_of_removed_box)
        box.delete(removed_box)

break_object(float price) =>
    high_htf >= price and low_htf <= price 

update_lines(lines, keep_lines, int _time) =>
    for current_line in lines
        if not array.includes(keep_lines, current_line)
            line.set_x2(current_line, _time)
            line_price = line.get_y1(current_line)
            if break_object(line_price)
                array.push(keep_lines, current_line)

update_boxes(boxes, keep_boxes, int _time) =>
    for current_box in boxes
        if not array.includes(keep_boxes, current_box)
            box.set_right(current_box, _time)
            box_price = box.get_top(current_box)
            if break_object(box_price)
                array.push(keep_boxes, current_box)

clean_lines(keep_lines, all_lines) =>
    for keep_line in keep_lines
        line_price = line.get_y1(keep_line)
        if i_lv_hide_crossed and break_object(line_price)
            line.delete(keep_line)
            index = array.indexof(all_lines, keep_line)
            if not na(index)
                array.remove(all_lines, index)

clean_boxes(keep_boxes, all_boxes) =>
    for keep_box in keep_boxes
        box_price = box.get_bottom(keep_box)
        if i_lv_hide_crossed and break_object(box_price)
            box.delete(keep_box)
            index = array.indexof(all_boxes, keep_box)
            if not na(index)
                array.remove(all_boxes, index)

//_____________________________ Functions End

//_____________________________ Liquidity Void Bearish Start

var float bear_prev_low = na, var int bear_prev_low_time = na
var bear_keep_lines = array.new_line(), var bear_all_lines = array.new_line()
var bear_keep_boxes = array.new_box(), var bear_all_boxes = array.new_box()

if i_lv_bear_show and bc_htf and (close_htf > open_htf)
    bear_filter = filter(bear_prev_low, high_htf, atr_htf, i_lv_atr_multi, i_lv_percentage, i_lv_additional)
    bear_price_source = price_source(bear_prev_low, high_htf, i_lv_line)

    if (na(bear_prev_low) or high_htf <= bear_prev_low) and bear_filter
        lv_bear_line = draw_line(bear_prev_low_time, bear_price_source, i_lv_bear_color)
        lv_bear_box = draw_box(bear_prev_low_time, high_htf, bear_prev_low, i_lv_bear_color)
        clean_arrays(bear_all_lines, bear_keep_lines, bear_all_boxes, bear_keep_boxes, lv_bear_line, lv_bear_box)

    bear_prev_low := low_htf
    bear_prev_low_time := time_htf

// Update
update_lines(bear_all_lines, bear_keep_lines, time_htf)
update_boxes(bear_all_boxes, bear_keep_boxes, time_htf)

// Clean
clean_lines(bear_keep_lines, bear_all_lines)
clean_boxes(bear_keep_boxes, bear_all_boxes)

//_____________________________ Liquidity Void Bearish End

//_____________________________ Liquidity Void Bullish Start

var float bull_prev_high = na, var int bull_prev_high_time = na
var bull_keep_lines = array.new_line(), var bull_all_lines = array.new_line()
var bull_keep_boxes = array.new_box(), var bull_all_boxes = array.new_box()

if i_lv_bull_show and bc_htf and (close_htf < open_htf)
    bull_filter = filter(bull_prev_high, low_htf, atr_htf, i_lv_atr_multi, i_lv_percentage, i_lv_additional)
    bull_price_source = price_source(bull_prev_high, low_htf, i_lv_line)

    if (na(bull_prev_high) or low_htf >= bull_prev_high) and bull_filter
        lv_bull_line = draw_line(bull_prev_high_time, bull_price_source, i_lv_bull_color)
        lv_bull_box = draw_box(bull_prev_high_time, low_htf, bull_prev_high, i_lv_bull_color)
        clean_arrays(bull_all_lines, bull_keep_lines, bull_all_boxes, bull_keep_boxes, lv_bull_line, lv_bull_box)

    bull_prev_high := high_htf
    bull_prev_high_time := time_htf

// Update
update_lines(bull_all_lines, bull_keep_lines, time_htf)
update_boxes(bull_all_boxes, bull_keep_boxes, time_htf)

// Clean
clean_lines(bull_keep_lines, bull_all_lines)
clean_boxes(bull_keep_boxes, bull_all_boxes)

//_____________________________ Liquidity Void Bullish End

//_____________________________ Code End

##-- File Name: PineScript-main/ICT Liquidity Void/ICT Liquidity Void Multi-timeframe.txt | File No: 21 | Ended --##

##-- File Name: PineScript-main/ICT Liquidity Void/ICT Liquidity Void Screener.txt | File No: 22 | Started --##
// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © Arun_K_Bhaskar

//@version=5
indicator(title="ICT Liquidity Void Screener", shorttitle="ICT LV Scr", overlay=true)

//_____________________________ Menu Screener Start

g_tb = '█████████████████ Screener █████████████████'

tt_is = "• Input exactly 40 symbols, nothing more or less." +
     "\n• Total characters cannot exceed 4096." +
     "\n• Use comma as delimiter without any space." +
     "\n• Eg: EXCHANGE:SYMBOL_A,EXCHANGE:SYMBOL_B"
string i_symbols = input.text_area(
 defval="NSE:AEGISCHEM,NSE:BANKINDIA,NSE:BHEL,NSE:BLS,NSE:CASTROLIND,NSE:CESC,NSE:CGPOWER,NSE:CHAMBLFERT,NSE:DELTACORP,NSE:DEVYANI,NSE:EQUITASBNK,NSE:GAEL,NSE:GPPL,NSE:GSFC,NSE:HUDCO,NSE:IBULHSGFIN,NSE:INDIACEM,NSE:INDUSTOWER,NSE:IRCON,NSE:JKPAPER,NSE:JMFINANCIL,NSE:JYOTHYLAB,NSE:KARURVYSYA,NSE:NAM_INDIA,NSE:NATIONALUM,NSE:NCC,NSE:NETWORK18,NSE:NYKAA,NSE:PNB,NSE:RAIN,NSE:RALLIS,NSE:RBA,NSE:RBLBANK,NSE:RCF,NSE:REDINGTON,NSE:TRITURBINE,NSE:UNIONBANK,NSE:VAIBHAVGBL,NSE:WELSPUNLIV,NSE:ZEEL",
 title="Paste Symbols", tooltip=tt_is, group=g_tb)

string i_scr_direction = input.string(defval='Both', title='Direction', options=['Both', 'Bullish', 'Bearish'], inline='tb_1', group=g_tb)
bool i_scr_show_bull  = input.bool(defval=true, title='Only Bullish', inline='tb_2', group=g_tb)
bool i_scr_show_bear  = input.bool(defval=true, title='Only Bearish', inline='tb_2', group=g_tb)

int i_scr_disp_rows = input.int(defval=16, title='Display Rows', minval=0, maxval=100, group=g_tb)
string i_scr_position = input.string(defval=position.bottom_left, title='Table Position', options=[position.top_left, position.top_center, position.top_right, position.middle_left, position.middle_center, position.middle_right, position.bottom_left, position.bottom_center, position.bottom_right], group=g_tb)
string i_scr_text_size = input.string(defval=size.small, title='Table Size', options=[size.auto, size.tiny, size.small, size.normal, size.large, size.huge], group=g_tb)

color i_scr_neg_col = input.color(defval=#F7525F, title='-', inline='c', group=g_tb)
color i_scr_pos_col = input.color(defval=#22AB94, title='+', inline='c', group=g_tb)
color i_scr_neu_col = input.color(defval=#B2B5BE, title='0', inline='c', group=g_tb)

//_____________________________ Menu Screener End

//_____________________________ Menu Liquidity Void Start

g_lv = '███████████████ Liquidity Void ███████████████'

int i_lv_show_last = input.int(defval=2, title='Show Last', minval=0, group=g_lv)
string i_lv_line = input.string(defval='High/Low', title='Source', options=['High/Low', 'OTE 0.79%', '50%'], group=g_lv)
bool i_lv_bear_show = input.bool(defval=true, title='Bearish', group=g_lv)
bool i_lv_bull_show = input.bool(defval=true, title='Bullish', group=g_lv)
bool i_lv_hide_crossed = input.bool(defval=false, title='Hide Crossed', group=g_lv)

g_lv_f = "Void Height Filter"
tt_lv_f = "• Filters remove narrow liquidity voids." +
 "\n• ATR filtering adjusts automatically when the timeframe changes." +
 "\n• Percentage filter will be constant across all timeframes." +
 "\n• If you don't want any filtering, choose 'Percentage' and then change Percentage to 0."
string i_lv_additional = input.string(defval='ATR', title='Filter Using', options=['ATR', 'Percentage'], tooltip=tt_lv_f, group=g_lv_f)
tt_lv_atr = "Applicable only if 'Filter Using' is 'ATR'"
int i_lv_atr_length = input.int(defval=14, minval=1, title='ATR Period', tooltip=tt_lv_atr, group=g_lv_f)
tt_lv_atr_m = "Higher the number, filters higher void height."
float i_lv_atr_multi = input.float(defval=4, minval=1, title='ATR Multiplier', tooltip=tt_lv_atr_m, group=g_lv_f)
tt_lv_p = "Filters liquidity void above the given percentage."
float i_lv_percentage = input.float(defval=2.5, minval=0, step=0.1, title='Percentage Above', tooltip=tt_lv_p, group=g_lv_f)

g_lv_ds = "Display Settings"
color i_lv_bear_color = input.color(defval=#F7525F, title='Bearish Color', group=g_lv_ds)
color i_lv_bull_color = input.color(defval=#22AB94, title='Bullish Color', group=g_lv_ds)
string i_lv_ln_style = input.string(defval=line.style_solid, title="Line Style", options=[line.style_solid, line.style_dashed, line.style_dotted], group=g_lv_ds)
int i_lv_ln_width = input.int(defval=2, title='Width', group=g_lv_ds)
int i_lv_box_trans = input.int(defval=75, title='Box Transparency', group=g_lv_ds)

//_____________________________ Menu Liquidity Void End

//_____________________________ Functions Start

// Function to calculate filter based on ATR or percentage
filter(prev_value, other_value, _atr_htf, _atr_multi, _percentage, _additional) =>
    filter_atr = math.abs(prev_value - other_value) > _atr_htf * _atr_multi
    filter_percent = math.abs((prev_value - other_value) / prev_value * 100) > _percentage
    _additional == 'ATR' ? filter_atr : filter_percent

// Function to determine line type
price_source(float prev_value, float other_value, string price_source) =>
    price_source == 'High/Low' ? prev_value : 
     price_source == 'OTE 0.79%' ? other_value + ((prev_value - other_value) * 0.79) : 
     price_source == 'OTE 0.79%' ? other_value - ((prev_value - other_value) * 0.79) : 
     math.avg(prev_value, other_value)

draw_line(int x1_time, float y1_price, color _color)=>
    line.new(x1=x1_time, y1=y1_price, x2=time, y2=y1_price, xloc=xloc.bar_time, color=_color, style=i_lv_ln_style, width=i_lv_ln_width)

draw_box(int left_time, float top_price, float bottom_price, color _color)=>
    box.new(left=left_time, top=top_price, right=time, bottom=bottom_price, xloc=xloc.bar_time, border_color=color.new(_color, i_lv_box_trans), bgcolor=color.new(_color, i_lv_box_trans))

// Function to handle array operations and cleanup
clean_arrays(_all_lines, _keep_lines, _all_boxes, _keep_boxes, _lv_line, _lv_box) =>

    array.push(_all_lines, _lv_line)
    array.push(_all_boxes, _lv_box)

    if array.size(_all_lines) > i_lv_show_last
        removed_line = array.shift(_all_lines)
        if array.includes(_keep_lines, removed_line)
            index_of_removed_line = array.indexof(_keep_lines, removed_line)
            array.remove(_keep_lines, index_of_removed_line)
        line.delete(removed_line)
        
    if array.size(_all_boxes) > i_lv_show_last
        removed_box = array.shift(_all_boxes)
        if array.includes(_keep_boxes, removed_box)
            index_of_removed_box = array.indexof(_keep_boxes, removed_box)
            array.remove(_keep_boxes, index_of_removed_box)
        box.delete(removed_box)

break_object(float price) =>
    high >= price and low <= price 

update_lines(lines, keep_lines, int _time) =>
    for current_line in lines
        if not array.includes(keep_lines, current_line)
            line.set_x2(current_line, _time)
            line_price = line.get_y1(current_line)
            if break_object(line_price)
                array.push(keep_lines, current_line)

update_boxes(boxes, keep_boxes, int _time) =>
    for current_box in boxes
        if not array.includes(keep_boxes, current_box)
            box.set_right(current_box, _time)
            box_price = box.get_top(current_box)
            if break_object(box_price)
                array.push(keep_boxes, current_box)

clean_lines(keep_lines, all_lines) =>
    for keep_line in keep_lines
        line_price = line.get_y1(keep_line)
        if i_lv_hide_crossed and break_object(line_price)
            line.delete(keep_line)
            index = array.indexof(all_lines, keep_line)
            if not na(index)
                array.remove(all_lines, index)

clean_boxes(keep_boxes, all_boxes) =>
    for keep_box in keep_boxes
        box_price = box.get_bottom(keep_box)
        if i_lv_hide_crossed and break_object(box_price)
            box.delete(keep_box)
            index = array.indexof(all_boxes, keep_box)
            if not na(index)
                array.remove(all_boxes, index)

//_____________________________ Functions End

//_____________________________ Liquidity Void Bearish Start

var float bear_prev_low = na, var int bear_prev_low_time = na
var float bear_price_source_val = na, var float bear_high_val = na
var bear_keep_lines = array.new_line(), var bear_all_lines = array.new_line()
var bear_keep_boxes = array.new_box(), var bear_all_boxes = array.new_box()

if i_lv_bear_show and barstate.isconfirmed and (close > open)
    bear_filter = filter(bear_prev_low, high, ta.atr(i_lv_atr_length), i_lv_atr_multi, i_lv_percentage, i_lv_additional)
    bear_price_source = price_source(bear_prev_low, high, i_lv_line)

    if (na(bear_prev_low) or high <= bear_prev_low) and bear_filter
        lv_bear_line = draw_line(bear_prev_low_time, bear_price_source, i_lv_bear_color)
        lv_bear_box = draw_box(bear_prev_low_time, high, bear_prev_low, i_lv_bear_color)
        clean_arrays(bear_all_lines, bear_keep_lines, bear_all_boxes, bear_keep_boxes, lv_bear_line, lv_bear_box)

        bear_high_val := high
        bear_price_source_val := bear_price_source

    bear_prev_low := low
    bear_prev_low_time := time

// Update
update_lines(bear_all_lines, bear_keep_lines, time)
update_boxes(bear_all_boxes, bear_keep_boxes, time)

// Clean
clean_lines(bear_keep_lines, bear_all_lines)
clean_boxes(bear_keep_boxes, bear_all_boxes)

//_____________________________ Liquidity Void Bearish End

//_____________________________ Liquidity Void Bullish Start

var float bull_prev_high = na, var int bull_prev_high_time = na
var float bull_price_source_val = na, var float bull_low_val = na
var bull_keep_lines = array.new_line(), var bull_all_lines = array.new_line()
var bull_keep_boxes = array.new_box(), var bull_all_boxes = array.new_box()

if i_lv_bull_show and barstate.isconfirmed and (close < open)
    bull_filter = filter(bull_prev_high, low, ta.atr(i_lv_atr_length), i_lv_atr_multi, i_lv_percentage, i_lv_additional)
    bull_price_source = price_source(bull_prev_high, low, i_lv_line)

    if (na(bull_prev_high) or low >= bull_prev_high) and bull_filter
        lv_bull_line = draw_line(bull_prev_high_time, bull_price_source, i_lv_bull_color)
        lv_bull_box = draw_box(bull_prev_high_time, low, bull_prev_high, i_lv_bull_color)
        clean_arrays(bull_all_lines, bull_keep_lines, bull_all_boxes, bull_keep_boxes, lv_bull_line, lv_bull_box)

        bull_low_val := high
        bull_price_source_val := bull_price_source

    bull_prev_high := high
    bull_prev_high_time := time

// Update
update_lines(bull_all_lines, bull_keep_lines, time)
update_boxes(bull_all_boxes, bull_keep_boxes, time)

// Clean
clean_lines(bull_keep_lines, bull_all_lines)
clean_boxes(bull_keep_boxes, bull_all_boxes)

//_____________________________ Liquidity Void Bullish End

//____________________________ Get Symbols for Screener Start

// Acknowledgement & Reference
// Trader: 'allanster'
// Indicator Title: 'How To Input CSV List Of Symbol Data Used For Screener'
// Indicator Link: 'https://www.tradingview.com/script/KfqHqHUH-How-To-Input-CSV-List-Of-Symbol-Data-Used-For-Screener/'

feed(back) =>                                             // extract tickerid and decrement list of ticker IDs
    loop  = back                                          // declare string variable to hold content list
    getT  = string(na)                                    // declare string variable to hold tickerid
    if str.length(loop) == 0                              // if list is empty
        getT := string(na)                                // assign na to tickerid variable
        loop := string(na)                                // assign na to list of ticker Ids variable
    else                                                  // else extract first tickerid
        getP  = nz(str.pos(loop, ','), str.length(loop))  // get position of first comma or last character
        getT := str.substring(loop, 0, getP)              // get tickerid in first position of list
        loop := str.replace(loop, getT + ',', '')         // clear tickerid + delimiter character from list
    [getT, loop]                                          // return tickerid in first position & truncated list

[tid_01, out_01] = feed(i_symbols), [tid_02, out_02] = feed(out_01), [tid_03, out_03] = feed(out_02), [tid_04, out_04] = feed(out_03),
[tid_05, out_05] = feed(out_04), [tid_06, out_06] = feed(out_05), [tid_07, out_07] = feed(out_06), [tid_08, out_08] = feed(out_07),
[tid_09, out_09] = feed(out_08), [tid_10, out_10] = feed(out_09), [tid_11, out_11] = feed(out_10), [tid_12, out_12] = feed(out_11),
[tid_13, out_13] = feed(out_12), [tid_14, out_14] = feed(out_13), [tid_15, out_15] = feed(out_14), [tid_16, out_16] = feed(out_15),
[tid_17, out_17] = feed(out_16), [tid_18, out_18] = feed(out_17), [tid_19, out_19] = feed(out_18), [tid_20, out_20] = feed(out_19),
[tid_21, out_21] = feed(out_20), [tid_22, out_22] = feed(out_21), [tid_23, out_23] = feed(out_22), [tid_24, out_24] = feed(out_23),
[tid_25, out_25] = feed(out_24), [tid_26, out_26] = feed(out_25), [tid_27, out_27] = feed(out_26), [tid_28, out_28] = feed(out_27),
[tid_29, out_29] = feed(out_28), [tid_30, out_30] = feed(out_29), [tid_31, out_31] = feed(out_30), [tid_32, out_32] = feed(out_31),
[tid_33, out_33] = feed(out_32), [tid_34, out_34] = feed(out_33), [tid_35, out_35] = feed(out_34), [tid_36, out_36] = feed(out_35),
[tid_37, out_37] = feed(out_36), [tid_38, out_38] = feed(out_37), [tid_39, out_39] = feed(out_38), [tid_40, out_40] = feed(out_39)

//____________________________ Get Symbols for Screener End

// _____________________________ Screener Start

// Acknowledgement & Reference
// Trader: 'MUQWISHI'
// Indicator Title: 'Candlestick Patterns Screener [By MUQWISHI]'
// Indicator Link: 'https://www.tradingview.com/script/xiWQuGOq-Candlestick-Patterns-Screener-By-MUQWISHI/'

// Screener Conditions
bearish_cond = ta.crossunder(low, bull_price_source_val) and barstate.isconfirmed
bullish_cond = ta.crossover(high, bear_price_source_val) and barstate.isconfirmed

// Define Bull and Bear Conditions
bull = not(i_scr_direction == "Bearish")
bear = not(i_scr_direction == "Bullish")

// Function for Screener Indicator Calculation
indicator_calculation() =>
    // Initialize variables
    price = float(na)
    _time = int(na)
    indicator = ""
    signal = int(na) 

    if barstate.isconfirmed
        // Check for Bearish Momentum Candle and conditions (Modify here to customize indicators)
        if i_scr_show_bull and bearish_cond and bear 
            indicator := "L"
            signal := -1

        // Check for Bullish Momentum Candle and conditions (Modify here to customize indicators)
        else if i_scr_show_bear and bullish_cond and bull
            indicator := "H"
            signal := 1

        // Update price and time if signal is not null
        if not na(signal)
            price := math.round_to_mintick(close)
            _time := time

    [_time, indicator, price, signal]

// Function to format time
format_time(x) =>
    timezone = syminfo.timezone
    timeframe.isintraday ? str.format_time(x, "HH:mm  dd-MM-yyyy", timezone) : str.format_time(x, "dd-MM-yyyy", timezone)

// Function to extract symbol name
symbol(s) => 
    array.get(str.split(s, ":"), 1)

// Matrix setup
var matrix = matrix.new<string>(0, 5, na)

// Function to add rows to the matrix
mtxFun(symbol, _time, indicator, price, signal) =>
    matrix.add_row(matrix, 0, array.from(symbol, _time, indicator, price, signal))

// Screener function to collect data
screener(s) =>
    sym = ticker.modify(s, syminfo.session)
    [_time, indicator, price, signal] = request.security(sym, timeframe.period, indicator_calculation())

    // Check if the signal is not na and the time matches
    if not na(signal) and _time == time
        symbolName = symbol(s)
        formattedTime = format_time(_time)
        strPrice = str.tostring(price)
        strSignal = str.tostring(signal)
        
        // Add data to the matrix
        mtxFun(symbolName, formattedTime, indicator, strPrice, strSignal)

// Call Screener function for multiple symbols
screener(tid_01), screener(tid_02), screener(tid_03), screener(tid_04), screener(tid_05), screener(tid_06), screener(tid_07),
screener(tid_08), screener(tid_09), screener(tid_10), screener(tid_11), screener(tid_12), screener(tid_13), screener(tid_14),
screener(tid_15), screener(tid_16), screener(tid_17), screener(tid_18), screener(tid_19), screener(tid_20), screener(tid_21),
screener(tid_22), screener(tid_23), screener(tid_24), screener(tid_25), screener(tid_26), screener(tid_27), screener(tid_28),
screener(tid_29), screener(tid_30), screener(tid_31), screener(tid_32), screener(tid_33), screener(tid_34), screener(tid_35),
screener(tid_36), screener(tid_37), screener(tid_38), screener(tid_39), screener(tid_40)

// Trim excess rows in the matrix
if matrix.rows(matrix) > i_scr_disp_rows
    while matrix.rows(matrix) > i_scr_disp_rows
        matrix.remove_row(matrix, matrix.rows(matrix)-1)

// Plot Table
// Create table with specified properties
var table tbl = table.new(position=i_scr_position, columns=4, rows=102, border_width=1)

// Function to populate cells in the table
cell(col, row, txt, color) => 
    table.cell(tbl, col, row, text = txt, text_color = color, text_halign=text.align_left, bgcolor = color.new(color, 90), text_size=i_scr_text_size)

// Check if it's the last bar
if barstate.islast
    // Clear existing data in the table
    table.clear(tbl, 0, 0, 3, 101)

    // Set headers for the table
    cell(0, 0, "Symbol", i_scr_neu_col)
    cell(1, 0, "Time",   i_scr_neu_col)
    cell(2, 0, "Dir" ,  i_scr_neu_col)
    cell(3, 0, "Price",  i_scr_neu_col)

    j = 1
    // Populate table with matrix data
    if matrix.rows(matrix) > 0
        for i = 0 to matrix.rows(matrix) - 1
            // Determine color based on the signal
            col = matrix.get(matrix, i, 4) ==  "1" ? i_scr_neg_col :
                  matrix.get(matrix, i, 4) == "-1" ? i_scr_pos_col : i_scr_neu_col

            // Populate cells in the table
            cell(0, j, matrix.get(matrix, i, 0), col)
            cell(1, j, matrix.get(matrix, i, 1), col)
            cell(2, j, matrix.get(matrix, i, 2), col)
            cell(3, j, matrix.get(matrix, i, 3), col)

            j += 1

// _____________________________ Screener End

// _____________________________ Code End

##-- File Name: PineScript-main/ICT Liquidity Void/ICT Liquidity Void Screener.txt | File No: 22 | Ended --##

##-- File Name: PineScript-main/ICT Liquidity Void/Readme First.txt | File No: 23 | Started --##
About this indicator:
1. The application of liquidity voids is often noticed in ICT live trades, especially bearish voids.
2. Similar to equal highs and lows, liquidity voids are important reference points and easily identifiable.
3. The screener filters cross over or cross under to the high or low or the liquidity voids.
4. There are still minor issues existing in the indicator, which will be solved in the future.

Reference Videos: The indicator is developed based on the following video contents.

Original The Inner Circle Trader Video:

Video Title: ICT Mentorship Core Content - Month 04 - Liquidity Voids
Video Link: https://www.youtube.com/watch?v=HTQgH11W37o

Video Title: ICT Mentorship Core Content - Month 1 - Fair Valuation
Video Link: https://www.youtube.com/watch?v=SiVmoeyOWZE

Note:
Please note that the information provided is purely suggested for educational purposes and not intended as promotion.
There are no personal preferences involved, and no endorsement of any individual or entity is implied.
##-- File Name: PineScript-main/ICT Liquidity Void/Readme First.txt | File No: 23 | Ended --##

##-- File Name: PineScript-main/ICT Market Structure Shift (MSS)/ICT Market Structure Shift (MSS) Screener.txt | File No: 24 | Started --##
// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © Arun_K_Bhaskar

//@version=5
i_max_bars_back = 300
indicator(title="ICT Market Structure Shift (MSS) Screener", shorttitle="ICT MSS Scr", overlay=true, max_bars_back=i_max_bars_back, max_lines_count=500, max_boxes_count=500)

//_____________________________ Menu Screener Start

g_tb = '█████████████████ Screener █████████████████'

string i_scr_choose = input.string(defval='Market Structure Shift', title='Screening Method', options=['Market Structure Shift', 'Retracement to OTE / OB'], group=g_tb)

tt_is = "• Input exactly 40 symbols, nothing more or less." +
     "\n• Total characters cannot exceed 4096." +
     "\n• Use comma as delimiter without any space." +
     "\n• Eg: EXCHANGE:SYMBOL_A,EXCHANGE:SYMBOL_B"

string i_symbols = input.text_area(
 defval="NSE:ABCAPITAL,NSE:ABFRL,NSE:ASHOKLEY,NSE:BANDHANBNK,NSE:BANKBARODA,NSE:BEL,NSE:BHEL,NSE:BIOCON,NSE:CHAMBLFERT,NSE:COALINDIA,NSE:CUB,NSE:DELTACORP,NSE:EXIDEIND,NSE:GAIL,NSE:HINDCOPPER,NSE:IEX,NSE:IGL,NSE:INDIACEM,NSE:INDUSTOWER,NSE:IOC,NSE:JUBLFOOD,NSE:L_TFH,NSE:M_MFIN,NSE:MANAPPURAM,NSE:MOTHERSON,NSE:NATIONALUM,NSE:NMDC,NSE:NTPC,NSE:ONGC,NSE:PETRONET,NSE:PFC,NSE:PNB,NSE:POWERGRID,NSE:RBLBANK,NSE:RECLTD,NSE:SAIL,NSE:TATAPOWER,NSE:UPL,NSE:VEDL,NSE:ZEEL", 
 title="Paste Symbols", tooltip=tt_is, group=g_tb)

string i_scr_direction = input.string(defval='Both', title='Direction', options=['Both', 'Bullish', 'Bearish'], inline='tb_1', group=g_tb)
bool i_scr_show_bull  = input.bool(defval=true, title='Only Bullish', inline='tb_2', group=g_tb)
bool i_scr_show_bear  = input.bool(defval=true, title='Only Bearish', inline='tb_2', group=g_tb)

int i_tbl_disp_rows = input.int(defval=16, title='Display Rows', minval=0, maxval=100, group=g_tb)
color i_neu_color = input.color(defval=#B2B5BE, title='Text Color', group=g_tb)
string i_tbl_position = input.string(defval=position.bottom_left, title='Table Position', options=[position.top_left, position.top_center, position.top_right, position.middle_left, position.middle_center, position.middle_right, position.bottom_left, position.bottom_center, position.bottom_right], group=g_tb)
string i_tbl_text_size = input.string(defval=size.small, title='Table Size', options=[size.auto, size.tiny, size.small, size.normal, size.large, size.huge], group=g_tb)

//_____________________________ Menu Screener End

//_____________________________ Menu Zig Zag Start 

g_zz = '██████████████████ Zig Zag ██████████████████'

bool i_zz_bear_show = input.bool(defval=true, title='Bearish', inline='be', group=g_zz)
bool i_zz_bear_shift_show = input.bool(defval=true, title='Shift', inline='be', group=g_zz)
bool i_zz_bear_ret_show = input.bool(defval=true, title='Retracement', inline='be', group=g_zz)

bool i_zz_bull_show = input.bool(defval=true, title='Bullish ', inline='bu', group=g_zz)
bool i_zz_bull_shift_show = input.bool(defval=true, title='Shift', inline='bu', group=g_zz)
bool i_zz_bull_ret_show = input.bool(defval=true, title='Retracement', inline='bu', group=g_zz)

int i_zz_period = input.int(defval=4, title='Zig Zag Length', minval=2, group=g_zz)
string i_zz_source = input.string(defval='High/Low', title='Source', options=['High/Low', 'Open/Close'], group=g_zz)
tt_zz = "• Distance between swings." +
     "\n• Lower values mean highs and lows are closer."
float i_zz_percent = input.float(defval=0, minval=0, step=0.1, title='% Difference >', tooltip=tt_zz, group=g_zz)
bool i_zz_show = input.bool(defval=false, title='', inline='zz', group=g_zz)
color i_zz_bull_color = input.color(defval=#1E53E5, title='Zig Zag Colors: +', inline='zz', group=g_zz)
color i_zz_bear_color = input.color(defval=#1E53E5, title='-', inline='zz', group=g_zz)
color i_pos_color = input.color(defval=#22AB94, title='Colors:             +', inline='c_1', group=g_zz)
color i_neg_color = input.color(defval=#F7525F, title='-', inline='c_1', group=g_zz)
color i_zz_bull_signal_color = input.color(defval=#70CCBD, title='Signal Colors:       +', inline='c_2', group=g_zz)
color i_zz_bear_signal_color = input.color(defval=#FAA1A4, title='-', inline='c_2', group=g_zz)
int i_zz_bx_transp = input.int(defval=75, title='Box Transparency   ', minval=0, maxval=100, group=g_zz)

g_zz_f = "Additional Filters"
tt_zz_f = "• Filters remove narrow swing displacements." +
 "\n• Swing displacement means the distance between old swing high/low and new swing high/low." +
 "\n• Multiplier filtering adjusts automatically when the chart timeframe changes." +
 "\n• Percentage filter will be constant across all timeframes." +
 "\n• If you don't want any filtering, choose 'Percentage' and then change Percentage to 0."
string i_zz_filter_choice = input.string(defval='Percentage', title='Filter Using', options=['Multiplier', 'Percentage'], tooltip=tt_zz_f, group=g_zz_f)
tt_zz_m = "• Higher the number, filters higher swing displacement." +
 "\n• Eg: If 'Multiplier' is 2, swing displacement is 2 times than the previous swing."
float i_zz_multiplier = input.float(defval=2, minval=1, step=0.1, title='Multiplier', tooltip=tt_zz_m, group=g_zz_f)
tt_zz_p = "Filters liquidity displacement above the given percentage."
float i_zz_percentage = input.float(defval=0.7, minval=0, step=0.1, title='Percentage Above', tooltip=tt_zz_p, group=g_zz_f)

//_____________________________ Menu Zig Zag End 

//_____________________________ Zig Zag Start 

// Acknowledgement & Reference
// Trader: 'RozaniGhani-RG'
// Indicator Title: 'Zig Zag Ratio Simplified'
// Indicator Link: 'https://www.tradingview.com/script/CIk186OY-Zig-Zag-Ratio-Simplified/'

//_____________________________ Get Source

float _high = i_zz_source == 'Open/Close' ? math.max(open, close) : high
float _low = i_zz_source == 'Open/Close' ? math.min(open, close) : low

//============================== 1.  Variables

//_____________________________ 1.1 Highest / Lowest
float ph = ta.highestbars(_high, i_zz_period) == 0 ? _high : na
float pl = ta.lowestbars(_low, i_zz_period) == 0 ? _low  : na

//_____________________________ 1.2 Dir
var int dir = 0, dir := pl and na(ph) ? -1 : ph and na(pl) ? 1 : dir

//_____________________________ 1.4 Array
var max_array_size = 10, var zigzag = array.new_float(0), oldzigzag = array.copy(zigzag)

//_____________________________ 1.5 Others
var line line_zz = na

//============================== 3.  Custom Functions

add_to_zigzag(float[] pointer, float value, int bindex) =>
    array.unshift(pointer, bindex)
    array.unshift(pointer, value)
    if array.size(pointer) > max_array_size
        array.pop(pointer)
        array.pop(pointer)
    
update_zigzag(float[] pointer, float value, int bindex, int dir) =>
    if array.size(pointer) == 0
        add_to_zigzag(pointer, value, bindex)
    else
        if dir == 1 and value > array.get(pointer, 0) or dir == -1 and value < array.get(pointer, 0)
            array.set(pointer, 0, value)
            array.set(pointer, 1, bindex)
        0.

//============================== 4.  Calculations

dirchanged = ta.change(dir)

if ph or pl
    if dirchanged
        add_to_zigzag(zigzag, dir == 1 ? ph : pl, bar_index)
    else
        update_zigzag(zigzag, dir == 1 ? ph : pl, bar_index, dir)

//============================== 5.  Constructs

if array.size(zigzag) >= 6
    if array.get(zigzag, 0) != array.get(oldzigzag, 0) or array.get(zigzag, 1) != array.get(oldzigzag, 1)
        if array.get(zigzag, 2) == array.get(oldzigzag, 2) and array.get(zigzag, 3) == array.get(oldzigzag, 3)
            line.delete(line_zz)
        if i_zz_show
            line_zz := line.new(x1 = math.round(array.get(zigzag, 1)), y1 = array.get(zigzag, 0), x2 = math.round(array.get(zigzag, 3)), y2 = array.get(zigzag, 2), color = dir == 1 ? i_zz_bull_color : i_zz_bear_color, width=2)

//_____________________________ Get Swing Price & Bar Index

zz_1 = array.size(zigzag) > 7 ? array.get(zigzag, array.size(zigzag) - 8) : na
bi_1 = array.size(zigzag) > 6 ? array.get(zigzag, array.size(zigzag) - 7) : na
zz_2 = array.size(zigzag) > 5 ? array.get(zigzag, array.size(zigzag) - 6) : na
bi_2 = array.size(zigzag) > 4 ? array.get(zigzag, array.size(zigzag) - 5) : na
zz_3 = array.size(zigzag) > 3 ? array.get(zigzag, array.size(zigzag) - 4) : na
bi_3 = array.size(zigzag) > 2 ? array.get(zigzag, array.size(zigzag) - 3) : na

// Create a single label for the last five zigzag values and their corresponding bar index
//label_text = str.tostring(zz_0) + "\n" + str.tostring(bi_0) + "\n" + str.tostring(zz_1) + "\n" + str.tostring(bi_1) + "\n" + str.tostring(zz_2) + 
// "\n" + str.tostring(bi_2) + "\n" + str.tostring(zz_3) + "\n" + str.tostring(bi_3) + "\n" + str.tostring(zz_4) + "\n" + str.tostring(bi_4)
//if barstate.islast
//    label.new(x = bar_index, y = high, text = label_text, color=color.white)

// Function to calculate filter based on ATR or percentage
filter(float swing_3, float swing_2, float swing_1, float multiplier, float percentage, string choice) =>
    filter_x_times = math.abs(swing_1 - swing_2) > math.abs(swing_3 - swing_2) * multiplier
    filter_percent = math.abs((swing_3 - swing_1) / swing_3 * 100) > percentage
    choice == 'Multiplier' ? filter_x_times : filter_percent

bearish_filter = filter(zz_3, zz_2, zz_1, i_zz_multiplier, i_zz_percentage, i_zz_filter_choice)
bullish_filter = filter(zz_3, zz_2, zz_1, i_zz_multiplier, i_zz_percentage, i_zz_filter_choice)

//_____________________________ MSS Conditions

// Bearish Condition
bearish_condition = 
 zz_1 > zz_2 and
 zz_1 > zz_3 and
 zz_2 < zz_1 and
 zz_2 < zz_3 and
 zz_3 < zz_1 and
 zz_3 > zz_2 and
 close < zz_1 and
 close < zz_2 and
 close < zz_3 and
 ta.crossunder(close, zz_2) and
 bearish_filter and 
 barstate.isconfirmed

// Bullish Condition
bullish_condition = 
 zz_1 < zz_2 and
 zz_1 < zz_3 and
 zz_2 > zz_1 and
 zz_2 > zz_3 and
 zz_3 > zz_1 and
 zz_3 < zz_2 and
 close > zz_1 and
 close > zz_2 and
 close > zz_3 and
 ta.crossover(close, zz_2) and
 bullish_filter and 
 barstate.isconfirmed

//___________________________ Bearish Retracement

// Retracement Levels
float bearish_retracement_level = zz_1 - ((zz_1-zz_2)/3)
float bullish_retracement_level = zz_1 + ((zz_2-zz_1)/3)

// Get Bearish Retracement Price in Bearish Condition
var bearish_retracement_price = float(na)
var bearish_retracement_bi = float(na)
if bearish_condition
    bearish_retracement_price := bearish_retracement_level
    bearish_retracement_bi := bi_1

// Bearish Retracement Condition
bool bearish_retracement_condition = 
 ta.crossover(high, bearish_retracement_price) and
 barstate.isconfirmed

// Bearish Retracement in Sequential Order
var bear_current_state = 0
bear_previous_state = nz(bear_current_state[1])
bear_current_state := bear_previous_state == 2 ? 0 : bear_previous_state
if bearish_condition and bear_current_state == 0
    bear_current_state := 1
if bearish_retracement_condition and bear_current_state == 1
    bear_current_state := 2

bool bearish_retracement_trigger = bear_current_state == 2 ? true : false

//___________________________ Bullish Retracement

// Get Bullish Retracement Price in Bullish Condition
var bullish_retracement_price = float(na)
var bullish_retracement_bi = float(na)
if bullish_condition
    bullish_retracement_price := bullish_retracement_level
    bullish_retracement_bi := bi_1

// Bullish Retracement Condition
bool bullish_retracement_condition = 
 ta.crossunder(low, bullish_retracement_price) and
 barstate.isconfirmed

// Bullish Retracement in Sequential Order
var bull_current_state = 0
bull_previous_state = nz(bull_current_state[1])
bull_current_state := bull_previous_state == 2 ? 0 : bull_previous_state
if bullish_condition and bull_current_state == 0
    bull_current_state := 1
if bullish_retracement_condition and bull_current_state == 1
    bull_current_state := 2

bool bullish_retracement_trigger = bull_current_state == 2 ? true : false

//_____________________________ Plot

// Plot Break Signal
plotshape(series=i_zz_bear_show and i_zz_bear_shift_show ? bearish_condition : na, title='Bearish Shift', style=shape.triangledown, location=location.abovebar, color=i_zz_bear_signal_color, textcolor=i_zz_bear_signal_color, size=size.tiny)
plotshape(series=i_zz_bull_show and i_zz_bull_shift_show ? bullish_condition : na, title='Bullish Shift', style=shape.triangleup, location=location.belowbar, color=i_zz_bull_signal_color, textcolor=i_zz_bull_signal_color, size=size.tiny)
barcolor(color=i_zz_bear_show and i_zz_bear_shift_show and bearish_condition ? i_zz_bear_signal_color : i_zz_bull_show and i_zz_bull_shift_show and bullish_condition ? i_zz_bull_signal_color : na, title='Shift Candle')

//var box_array = array.new_box()
var line_array = array.new_line()

if i_zz_bear_show and bearish_condition
    ph_box = box.new(left=int(bi_3), top=zz_3, right=int(bi_1), bottom=zz_1, border_color=#00000000, bgcolor=color.new(i_neg_color, i_zz_bx_transp))
    if i_zz_bear_shift_show
        ph_line = line.new(x1=int(bi_2), y1=zz_2, x2=bar_index, y2=zz_2, color=i_neg_color, style=line.style_dashed)
        //array.push(box_array, ph_box)
        array.push(line_array, ph_line)

if i_zz_bull_show and bullish_condition
    pl_box = box.new(left=int(bi_3), top=zz_3, right=int(bi_1), bottom=zz_1, border_color=#00000000, bgcolor=color.new(i_pos_color, i_zz_bx_transp))
    if i_zz_bull_shift_show
        pl_line = line.new(x1=int(bi_2), y1=zz_2, x2=bar_index, y2=zz_2, color=i_pos_color, style=line.style_dashed)
        //array.push(box_array, pl_box)
        array.push(line_array, pl_line)

// Plot Retracement Signal
plotchar(series=i_zz_bear_show and i_zz_bear_ret_show and bearish_retracement_trigger ? 3 : na, title='Bear Retracement', char="↷", location=location.abovebar, color=i_zz_bear_signal_color, size=size.tiny)
plotchar(series=i_zz_bull_show and i_zz_bull_ret_show and bullish_retracement_trigger ? 3 : na, title='Bull Retracement', char="⤻", location=location.belowbar, color=i_zz_bull_signal_color, size=size.tiny)
barcolor(color=i_zz_bear_show and i_zz_bear_ret_show and bearish_retracement_trigger ? i_zz_bear_signal_color : i_zz_bull_show and i_zz_bull_ret_show and bullish_retracement_trigger ? i_zz_bull_signal_color : na, title='Retracement Candle')

//var line_array = array.new_line()

if i_zz_bear_show and i_zz_bear_ret_show and bearish_retracement_trigger
    bull_ret_ln = line.new(x1=int(bearish_retracement_bi), y1=bearish_retracement_price, x2=bar_index, y2=bearish_retracement_price, color=i_neg_color, style=line.style_dotted)
    array.push(line_array, bull_ret_ln)

if i_zz_bull_show and i_zz_bull_ret_show and bullish_retracement_trigger
    bear_ret_ln = line.new(x1=int(bullish_retracement_bi), y1=bullish_retracement_price, x2=bar_index, y2=bullish_retracement_price, color=i_pos_color, style=line.style_dotted)
    array.push(line_array, bear_ret_ln)

//_____________________________ Zig Zag End 

//_____________________________ Get Symbols for Screener Start

// Acknowledgement & Reference
// Trader: 'allanster'
// Indicator Title: 'How To Input CSV List Of Symbol Data Used For Screener'
// Indicator Link: 'https://www.tradingview.com/script/KfqHqHUH-How-To-Input-CSV-List-Of-Symbol-Data-Used-For-Screener/'

feed(back) =>                                             // extract tickerid and decrement list of ticker IDs
    loop  = back                                          // declare string variable to hold content list
    getT  = string(na)                                    // declare string variable to hold tickerid
    if str.length(loop) == 0                              // if list is empty
        getT := string(na)                                // assign na to tickerid variable
        loop := string(na)                                // assign na to list of ticker Ids variable
    else                                                  // else extract first tickerid
        getP  = nz(str.pos(loop, ','), str.length(loop))  // get position of first comma or last character
        getT := str.substring(loop, 0, getP)              // get tickerid in first position of list
        loop := str.replace(loop, getT + ',', '')         // clear tickerid + delimiter character from list
    [getT, loop]                                          // return tickerid in first position & truncated list

[tid_001, out_001] = feed(i_symbols), [tid_002, out_002] = feed(out_001), [tid_003, out_003] = feed(out_002), [tid_004, out_004] = feed(out_003),
[tid_005, out_005] = feed(out_004), [tid_006, out_006] = feed(out_005), [tid_007, out_007] = feed(out_006), [tid_008, out_008] = feed(out_007),
[tid_009, out_009] = feed(out_008), [tid_010, out_010] = feed(out_009), [tid_011, out_011] = feed(out_010), [tid_012, out_012] = feed(out_011),
[tid_013, out_013] = feed(out_012), [tid_014, out_014] = feed(out_013), [tid_015, out_015] = feed(out_014), [tid_016, out_016] = feed(out_015),
[tid_017, out_017] = feed(out_016), [tid_018, out_018] = feed(out_017), [tid_019, out_019] = feed(out_018), [tid_020, out_020] = feed(out_019),
[tid_021, out_021] = feed(out_020), [tid_022, out_022] = feed(out_021), [tid_023, out_023] = feed(out_022), [tid_024, out_024] = feed(out_023),
[tid_025, out_025] = feed(out_024), [tid_026, out_026] = feed(out_025), [tid_027, out_027] = feed(out_026), [tid_028, out_028] = feed(out_027),
[tid_029, out_029] = feed(out_028), [tid_030, out_030] = feed(out_029), [tid_031, out_031] = feed(out_030), [tid_032, out_032] = feed(out_031),
[tid_033, out_033] = feed(out_032), [tid_034, out_034] = feed(out_033), [tid_035, out_035] = feed(out_034), [tid_036, out_036] = feed(out_035),
[tid_037, out_037] = feed(out_036), [tid_038, out_038] = feed(out_037), [tid_039, out_039] = feed(out_038), [tid_040, out_040] = feed(out_039)

//_____________________________ Get Symbols for Screener End

//_____________________________ Screener Start

// Acknowledgement & Reference
// Trader: 'MUQWISHI'
// Indicator Title: 'Candlestick Patterns Screener [By MUQWISHI]'
// Indicator Link: 'https://www.tradingview.com/script/xiWQuGOq-Candlestick-Patterns-Screener-By-MUQWISHI/'

// Choose Screening Method
bear_method =
 i_scr_choose == 'Market Structure Shift' ? bearish_condition :
 bearish_retracement_trigger and bearish_retracement_condition

bull_method =
 i_scr_choose == 'Market Structure Shift' ? bullish_condition :
 bullish_retracement_trigger and bullish_retracement_condition

// Screener Conditions
bearish_cond = bear_method
bullish_cond = bull_method 

// Define Bull and Bear Conditions
bull = not(i_scr_direction == "Bearish")
bear = not(i_scr_direction == "Bullish")

// Function for Screener Indicator Calculation
indicator_calculation() =>
    // Initialize variables
    price = float(na)
    _time = int(na)
    signal = int(na) 

    if barstate.isconfirmed
        // Check for Bearish Momentum Candle and conditions (Modify here to customize indicators)
        if i_scr_show_bull and bearish_cond and bear 
            signal := -1

        // Check for Bullish Momentum Candle and conditions (Modify here to customize indicators)
        else if i_scr_show_bear and bullish_cond and bull
            signal := 1

        // Update price and time if signal is not null
        if not na(signal)
            price := math.round_to_mintick(close)
            _time := time

    [_time, price, signal]

// Function to format time
format_time(x) =>
    timezone = syminfo.timezone
    timeframe.isintraday ? str.format_time(x, "HH:mm  dd-MM-yyyy", timezone) : str.format_time(x, "dd-MM-yyyy", timezone)

// Function to extract symbol name
symbol(s) => 
    array.get(str.split(s, ":"), 1)

// Matrix setup
var matrix = matrix.new<string>(0, 4, na)

// Function to add rows to the matrix
mtxFun(symbol, _time, price, signal) =>
    matrix.add_row(matrix, 0, array.from(symbol, _time, price, signal))

// Screener function to collect data
screener(s) =>
    sym = ticker.modify(s, syminfo.session)
    [_time, price, signal] = request.security(sym, timeframe.period, indicator_calculation())

    // Check if the signal is not na and the time matches
    if not na(signal) and _time == time
        symbolName = symbol(s)
        formattedTime = format_time(_time)
        strPrice = str.tostring(price)
        strSignal = str.tostring(signal)
        
        // Add data to the matrix
        mtxFun(symbolName, formattedTime, strPrice, strSignal)

// Call Screener function for multiple symbols
screener(tid_001), screener(tid_002), screener(tid_003), screener(tid_004), screener(tid_005), screener(tid_006), screener(tid_007),
screener(tid_008), screener(tid_009), screener(tid_010), screener(tid_011), screener(tid_012), screener(tid_013), screener(tid_014),
screener(tid_015), screener(tid_016), screener(tid_017), screener(tid_018), screener(tid_019), screener(tid_020), screener(tid_021),
screener(tid_022), screener(tid_023), screener(tid_024), screener(tid_025), screener(tid_026), screener(tid_027), screener(tid_028),
screener(tid_029), screener(tid_030), screener(tid_031), screener(tid_032), screener(tid_033), screener(tid_034), screener(tid_035),
screener(tid_036), screener(tid_037), screener(tid_038), screener(tid_039), screener(tid_040)

// Trim excess rows in the matrix
if matrix.rows(matrix) > i_tbl_disp_rows
    while matrix.rows(matrix) > i_tbl_disp_rows
        matrix.remove_row(matrix, matrix.rows(matrix)-1)

// Plot Table
// Create table with specified properties
var table tbl = table.new(position=i_tbl_position, columns=3, rows=102, border_width=1)

// Function to populate cells in the table
cell_title(col, row, txt) => 
    table.cell(tbl, col, row, text = txt, text_color = i_neu_color, text_halign=text.align_center, bgcolor = color.new(i_neu_color, 90), text_size=i_tbl_text_size)

cell(col, row, txt, color) => 
    table.cell(tbl, col, row, text = txt, text_color = color, text_halign=text.align_left, bgcolor = color.new(color, 90), text_size=i_tbl_text_size)

// Check if it's the last bar
if barstate.islast
    // Clear existing data in the table
    table.clear(tbl, 0, 0, 2, 101)

    cell_title(0, 0, i_scr_choose)
    table.merge_cells(table_id=tbl, start_column=0, start_row=0, end_column=2, end_row=0)
    cell_title(0, 1, "Symbol")
    cell_title(1, 1, "Time")
    cell_title(2, 1, "Price")

    j = 2
    // Populate table with matrix data
    if matrix.rows(matrix) > 0
        for i = 0 to matrix.rows(matrix) - 1
            // Determine color based on the signal
            col = matrix.get(matrix, i, 3) ==  "1" ? i_pos_color :
                  matrix.get(matrix, i, 3) == "-1" ? i_neg_color : i_neu_color

            // Populate cells in the table
            cell(0, j, matrix.get(matrix, i, 0), col)
            cell(1, j, matrix.get(matrix, i, 1), col)
            cell(2, j, matrix.get(matrix, i, 2), col)

            j += 1

//_____________________________ Screener End

//_____________________________ Code End

##-- File Name: PineScript-main/ICT Market Structure Shift (MSS)/ICT Market Structure Shift (MSS) Screener.txt | File No: 24 | Ended --##

##-- File Name: PineScript-main/ICT Market Structure Shift (MSS)/ICT Market Structure Shift (MSS).txt | File No: 25 | Started --##
// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © Arun_K_Bhaskar

//@version=5
i_max_bars_back = 300
indicator(title="ICT Market Structure Shift (MSS)", shorttitle="ICT MSS", overlay=true, max_bars_back=i_max_bars_back, max_lines_count=500, max_boxes_count=500)

//_____________________________ Menu Zig Zag Start 

g_zz = '██████████████████ Zig Zag ██████████████████'

bool i_zz_bear_show = input.bool(defval=true, title='Bearish', inline='be', group=g_zz)
bool i_zz_bear_shift_show = input.bool(defval=true, title='Shift', inline='be', group=g_zz)
bool i_zz_bear_ret_show = input.bool(defval=true, title='Retracement', inline='be', group=g_zz)

bool i_zz_bull_show = input.bool(defval=true, title='Bullish ', inline='bu', group=g_zz)
bool i_zz_bull_shift_show = input.bool(defval=true, title='Shift', inline='bu', group=g_zz)
bool i_zz_bull_ret_show = input.bool(defval=true, title='Retracement', inline='bu', group=g_zz)

int i_zz_period = input.int(defval=4, title='Zig Zag Length', minval=2, group=g_zz)
string i_zz_source = input.string(defval='High/Low', title='Source', options=['High/Low', 'Open/Close'], group=g_zz)
tt_zz = "• Distance between swings." +
     "\n• Lower values mean highs and lows are closer."
float i_zz_percent = input.float(defval=0, minval=0, step=0.1, title='% Difference >', tooltip=tt_zz, group=g_zz)
bool i_zz_show = input.bool(defval=false, title='', inline='zz', group=g_zz)
color i_zz_bull_color = input.color(defval=#1E53E5, title='Zig Zag Colors: +', inline='zz', group=g_zz)
color i_zz_bear_color = input.color(defval=#1E53E5, title='-', inline='zz', group=g_zz)
color i_pos_color = input.color(defval=#22AB94, title='Colors:             +', inline='c_1', group=g_zz)
color i_neg_color = input.color(defval=#F7525F, title='-', inline='c_1', group=g_zz)
color i_zz_bull_signal_color = input.color(defval=#70CCBD, title='Signal Colors:       +', inline='c_2', group=g_zz)
color i_zz_bear_signal_color = input.color(defval=#FAA1A4, title='-', inline='c_2', group=g_zz)
int i_zz_bx_transp = input.int(defval=75, title='Box Transparency   ', minval=0, maxval=100, group=g_zz)

g_zz_f = "Additional Filters"
tt_zz_f = "• Filters remove narrow swing displacements." +
 "\n• Swing displacement means the distance between old swing high/low and new swing high/low." +
 "\n• Multiplier filtering adjusts automatically when the chart timeframe changes." +
 "\n• Percentage filter will be constant across all timeframes." +
 "\n• If you don't want any filtering, choose 'Percentage' and then change Percentage to 0."
string i_zz_filter_choice = input.string(defval='Percentage', title='Filter Using', options=['Multiplier', 'Percentage'], tooltip=tt_zz_f, group=g_zz_f)
tt_zz_m = "• Higher the number, filters higher swing displacement." +
 "\n• Eg: If 'Multiplier' is 2, swing displacement is 2 times than the previous swing."
float i_zz_multiplier = input.float(defval=2, minval=1, step=0.1, title='Multiplier', tooltip=tt_zz_m, group=g_zz_f)
tt_zz_p = "Filters liquidity displacement above the given percentage."
float i_zz_percentage = input.float(defval=0.7, minval=0, step=0.1, title='Percentage Above', tooltip=tt_zz_p, group=g_zz_f)

//_____________________________ Menu Zig Zag End 

//_____________________________ Zig Zag Start 

// Acknowledgement & Reference
// Trader: 'RozaniGhani-RG'
// Indicator Title: 'Zig Zag Ratio Simplified'
// Indicator Link: 'https://www.tradingview.com/script/CIk186OY-Zig-Zag-Ratio-Simplified/'

//_____________________________ Get Source

float _high = i_zz_source == 'Open/Close' ? math.max(open, close) : high
float _low = i_zz_source == 'Open/Close' ? math.min(open, close) : low

//============================== 1.  Variables

//_____________________________ 1.1 Highest / Lowest
float ph = ta.highestbars(_high, i_zz_period) == 0 ? _high : na
float pl = ta.lowestbars(_low, i_zz_period) == 0 ? _low  : na

//_____________________________ 1.2 Dir
var int dir = 0, dir := pl and na(ph) ? -1 : ph and na(pl) ? 1 : dir

//_____________________________ 1.4 Array
var max_array_size = 10, var zigzag = array.new_float(0), oldzigzag = array.copy(zigzag)

//_____________________________ 1.5 Others
var line line_zz = na

//============================== 3.  Custom Functions

add_to_zigzag(float[] pointer, float value, int bindex) =>
    array.unshift(pointer, bindex)
    array.unshift(pointer, value)
    if array.size(pointer) > max_array_size
        array.pop(pointer)
        array.pop(pointer)
    
update_zigzag(float[] pointer, float value, int bindex, int dir) =>
    if array.size(pointer) == 0
        add_to_zigzag(pointer, value, bindex)
    else
        if dir == 1 and value > array.get(pointer, 0) or dir == -1 and value < array.get(pointer, 0)
            array.set(pointer, 0, value)
            array.set(pointer, 1, bindex)
        0.

//============================== 4.  Calculations

dirchanged = ta.change(dir)

if ph or pl
    if dirchanged
        add_to_zigzag(zigzag, dir == 1 ? ph : pl, bar_index)
    else
        update_zigzag(zigzag, dir == 1 ? ph : pl, bar_index, dir)

//============================== 5.  Constructs

if array.size(zigzag) >= 6
    if array.get(zigzag, 0) != array.get(oldzigzag, 0) or array.get(zigzag, 1) != array.get(oldzigzag, 1)
        if array.get(zigzag, 2) == array.get(oldzigzag, 2) and array.get(zigzag, 3) == array.get(oldzigzag, 3)
            line.delete(line_zz)
        if i_zz_show
            line_zz := line.new(x1 = math.round(array.get(zigzag, 1)), y1 = array.get(zigzag, 0), x2 = math.round(array.get(zigzag, 3)), y2 = array.get(zigzag, 2), color = dir == 1 ? i_zz_bull_color : i_zz_bear_color, width=2)

//_____________________________ Get Swing Price & Bar Index

zz_1 = array.size(zigzag) > 7 ? array.get(zigzag, array.size(zigzag) - 8) : na
bi_1 = array.size(zigzag) > 6 ? array.get(zigzag, array.size(zigzag) - 7) : na
zz_2 = array.size(zigzag) > 5 ? array.get(zigzag, array.size(zigzag) - 6) : na
bi_2 = array.size(zigzag) > 4 ? array.get(zigzag, array.size(zigzag) - 5) : na
zz_3 = array.size(zigzag) > 3 ? array.get(zigzag, array.size(zigzag) - 4) : na
bi_3 = array.size(zigzag) > 2 ? array.get(zigzag, array.size(zigzag) - 3) : na

// Create a single label for the last five zigzag values and their corresponding bar index
//label_text = str.tostring(zz_0) + "\n" + str.tostring(bi_0) + "\n" + str.tostring(zz_1) + "\n" + str.tostring(bi_1) + "\n" + str.tostring(zz_2) + 
// "\n" + str.tostring(bi_2) + "\n" + str.tostring(zz_3) + "\n" + str.tostring(bi_3) + "\n" + str.tostring(zz_4) + "\n" + str.tostring(bi_4)
//if barstate.islast
//    label.new(x = bar_index, y = high, text = label_text, color=color.white)

// Function to calculate filter based on ATR or percentage
filter(float swing_3, float swing_2, float swing_1, float multiplier, float percentage, string choice) =>
    filter_x_times = math.abs(swing_1 - swing_2) > math.abs(swing_3 - swing_2) * multiplier
    filter_percent = math.abs((swing_3 - swing_1) / swing_3 * 100) > percentage
    choice == 'Multiplier' ? filter_x_times : filter_percent

bearish_filter = filter(zz_3, zz_2, zz_1, i_zz_multiplier, i_zz_percentage, i_zz_filter_choice)
bullish_filter = filter(zz_3, zz_2, zz_1, i_zz_multiplier, i_zz_percentage, i_zz_filter_choice)

//_____________________________ MSS Conditions

// Bearish Condition
bearish_condition = 
 zz_1 > zz_2 and
 zz_1 > zz_3 and
 zz_2 < zz_1 and
 zz_2 < zz_3 and
 zz_3 < zz_1 and
 zz_3 > zz_2 and
 close < zz_1 and
 close < zz_2 and
 close < zz_3 and
 ta.crossunder(close, zz_2) and
 bearish_filter and 
 barstate.isconfirmed

// Bullish Condition
bullish_condition = 
 zz_1 < zz_2 and
 zz_1 < zz_3 and
 zz_2 > zz_1 and
 zz_2 > zz_3 and
 zz_3 > zz_1 and
 zz_3 < zz_2 and
 close > zz_1 and
 close > zz_2 and
 close > zz_3 and
 ta.crossover(close, zz_2) and
 bullish_filter and 
 barstate.isconfirmed

//___________________________ Bearish Retracement

// Retracement Levels
float bearish_retracement_level = zz_1 - ((zz_1-zz_2)/3)
float bullish_retracement_level = zz_1 + ((zz_2-zz_1)/3)

// Get Bearish Retracement Price in Bearish Condition
var bearish_retracement_price = float(na)
var bearish_retracement_bi = float(na)
if bearish_condition
    bearish_retracement_price := bearish_retracement_level
    bearish_retracement_bi := bi_1

// Bearish Retracement Condition
bool bearish_retracement_condition = 
 ta.crossover(high, bearish_retracement_price) and
 barstate.isconfirmed

// Bearish Retracement in Sequential Order
var bear_current_state = 0
bear_previous_state = nz(bear_current_state[1])
bear_current_state := bear_previous_state == 2 ? 0 : bear_previous_state
if bearish_condition and bear_current_state == 0
    bear_current_state := 1
if bearish_retracement_condition and bear_current_state == 1
    bear_current_state := 2

bool bearish_retracement_trigger = bear_current_state == 2 ? true : false

//___________________________ Bullish Retracement

// Get Bullish Retracement Price in Bullish Condition
var bullish_retracement_price = float(na)
var bullish_retracement_bi = float(na)
if bullish_condition
    bullish_retracement_price := bullish_retracement_level
    bullish_retracement_bi := bi_1

// Bullish Retracement Condition
bool bullish_retracement_condition = 
 ta.crossunder(low, bullish_retracement_price) and
 barstate.isconfirmed

// Bullish Retracement in Sequential Order
var bull_current_state = 0
bull_previous_state = nz(bull_current_state[1])
bull_current_state := bull_previous_state == 2 ? 0 : bull_previous_state
if bullish_condition and bull_current_state == 0
    bull_current_state := 1
if bullish_retracement_condition and bull_current_state == 1
    bull_current_state := 2

bool bullish_retracement_trigger = bull_current_state == 2 ? true : false

//_____________________________ Plot

// Plot Break Signal
plotshape(series=i_zz_bear_show and i_zz_bear_shift_show ? bearish_condition : na, title='Bearish Shift', style=shape.triangledown, location=location.abovebar, color=i_zz_bear_signal_color, textcolor=i_zz_bear_signal_color, size=size.tiny)
plotshape(series=i_zz_bull_show and i_zz_bull_shift_show ? bullish_condition : na, title='Bullish Shift', style=shape.triangleup, location=location.belowbar, color=i_zz_bull_signal_color, textcolor=i_zz_bull_signal_color, size=size.tiny)
barcolor(color=i_zz_bear_show and i_zz_bear_shift_show and bearish_condition ? i_zz_bear_signal_color : i_zz_bull_show and i_zz_bull_shift_show and bullish_condition ? i_zz_bull_signal_color : na, title='Shift Candle')

//var box_array = array.new_box()
var line_array = array.new_line()

if i_zz_bear_show and bearish_condition
    ph_box = box.new(left=int(bi_3), top=zz_3, right=int(bi_1), bottom=zz_1, border_color=#00000000, bgcolor=color.new(i_neg_color, i_zz_bx_transp))
    if i_zz_bear_shift_show
        ph_line = line.new(x1=int(bi_2), y1=zz_2, x2=bar_index, y2=zz_2, color=i_neg_color, style=line.style_dashed)
        //array.push(box_array, ph_box)
        array.push(line_array, ph_line)

if i_zz_bull_show and bullish_condition
    pl_box = box.new(left=int(bi_3), top=zz_3, right=int(bi_1), bottom=zz_1, border_color=#00000000, bgcolor=color.new(i_pos_color, i_zz_bx_transp))
    if i_zz_bull_shift_show
        pl_line = line.new(x1=int(bi_2), y1=zz_2, x2=bar_index, y2=zz_2, color=i_pos_color, style=line.style_dashed)
        //array.push(box_array, pl_box)
        array.push(line_array, pl_line)

// Plot Retracement Signal
plotchar(series=i_zz_bear_show and i_zz_bear_ret_show and bearish_retracement_trigger ? 3 : na, title='Bear Retracement', char="↷", location=location.abovebar, color=i_zz_bear_signal_color, size=size.tiny)
plotchar(series=i_zz_bull_show and i_zz_bull_ret_show and bullish_retracement_trigger ? 3 : na, title='Bull Retracement', char="⤻", location=location.belowbar, color=i_zz_bull_signal_color, size=size.tiny)
barcolor(color=i_zz_bear_show and i_zz_bear_ret_show and bearish_retracement_trigger ? i_zz_bear_signal_color : i_zz_bull_show and i_zz_bull_ret_show and bullish_retracement_trigger ? i_zz_bull_signal_color : na, title='Retracement Candle')

//var line_array = array.new_line()

if i_zz_bear_show and i_zz_bear_ret_show and bearish_retracement_trigger
    bull_ret_ln = line.new(x1=int(bearish_retracement_bi), y1=bearish_retracement_price, x2=bar_index, y2=bearish_retracement_price, color=i_neg_color, style=line.style_dotted)
    array.push(line_array, bull_ret_ln)

if i_zz_bull_show and i_zz_bull_ret_show and bullish_retracement_trigger
    bear_ret_ln = line.new(x1=int(bullish_retracement_bi), y1=bullish_retracement_price, x2=bar_index, y2=bullish_retracement_price, color=i_pos_color, style=line.style_dotted)
    array.push(line_array, bear_ret_ln)

//_____________________________ Zig Zag End

//_____________________________ Code End

##-- File Name: PineScript-main/ICT Market Structure Shift (MSS)/ICT Market Structure Shift (MSS).txt | File No: 25 | Ended --##

##-- File Name: PineScript-main/ICT Market Structure Shift (MSS)/Readme First.txt | File No: 26 | Started --##
ICT Market Structure Shift (MSS): An Improved Market Structure Shift Indicator And Screener

Enhanced Signal Accuracy:
Unlike previous versions, this indicator provides more reliable signals, minimizing unnecessary or incorrect alerts.

Two Signal and Screening Options:
- Market Structure Shift: Detects when the close price surpasses an inside range liquidity level or swing point, signaling a potential trend change.
- Retracement to Order Block: Identifies retracements to Order Blocks or OTE levels after a Market Structure Shift occurs.

Cautionary Notes:
- Automated Signals:Since this indicator is automated, it may generate numerous unnecessary signals. Exercise caution when interpreting them.
- Signal Height Filter: Utilize the "% Difference" option to filter out signals based on their height, avoiding too closely spaced signals.
- Self-Evaluation: Perform a thorough self-assessment for each signal to gauge its validity and relevance to your trading strategy.

##-- File Name: PineScript-main/ICT Market Structure Shift (MSS)/Readme First.txt | File No: 26 | Ended --##

##-- File Name: PineScript-main/ICT Mitigation Block Scanner/[Scanner] ICT Mitigation Block Scanner.txt | File No: 27 | Started --##
// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © Arun_K_Bhaskar

//@version=5
indicator(title='ICT Mitigation Block Scanner', shorttitle='ICT MB Scan', overlay=true, max_bars_back=500, max_lines_count=500, max_boxes_count=500)

//_____________________________ Menu Screener Start

g_scrtb = '█████████████████ Scanner █████████████████'

string i_scr_choose = input.string(defval='Mitigation Block', title='Screening Method', options=['Mitigation Block', 'Retracement'], group=g_scrtb)

tt_is = "• Reads only up to first 40 symbols." +
     "\n• Total characters cannot exceed 4096." +
     "\n• Eg: EXCHANGE:SYMBOL_A,EXCHANGE:SYMBOL_B"

string i_symbols = input.text_area(
 defval="NSE:ASHOKA,NSE:BEPL,NSE:BIOCON,NSE:BLS,NSE:CAMPUS,NSE:CASTROLIND,NSE:CESC,NSE:EDELWEISS,NSE:EMBDL,NSE:ENGINERSIN,NSE:EPL,NSE:FSL,NSE:GAEL,NSE:GREAVESCOT,NSE:GSPL,NSE:HFCL,NSE:HONASA,NSE:HUDCO,NSE:INDUSTOWER,NSE:INOXWIND,NSE:IOLCP,NSE:JAMNAAUTO,NSE:JMFINANCIL,NSE:JTLIND,NSE:KALAMANDIR,NSE:LTFOODS,NSE:LXCHEM,NSE:MARKSANS,NSE:NFL,NSE:NLCINDIA,NSE:ORIENTCEM,NSE:PPLPHARMA,NSE:RAIN,NSE:RELIGARE,NSE:SAMMAANCAP,NSE:SEQUENT,NSE:TI,NSE:TRIVENI,NSE:TVSSCS,NSE:ZOMATO", 
 title="Paste Symbols", tooltip=tt_is, group=g_scrtb)

bool i_scr_show_table  = input.bool(defval=true, title='Display Table', group=g_scrtb)
bool i_scr_show_long  = input.bool(defval=true, title='Long Signals', inline='tb_2', group=g_scrtb)
bool i_scr_show_short  = input.bool(defval=true, title='Short Signals', inline='tb_2', group=g_scrtb)

int i_scr_tbl_disp_rows = input.int(defval=12, title='Display Rows', minval=0, maxval=100, group=g_scrtb)
string i_scr_tbl_position = input.string(defval=position.bottom_left, title='Table Position', options=[position.top_left, position.top_center, position.top_right, position.middle_left, position.middle_center, position.middle_right, position.bottom_left, position.bottom_center, position.bottom_right], group=g_scrtb)
string i_scr_tbl_text_size = input.string(defval=size.small, title='Table Size', options=[size.auto, size.tiny, size.small, size.normal, size.large, size.huge], group=g_scrtb)

//_____________________________ Menu Screener End

//_____________________________ Menu Zig Zag Start 

g_zz = '██████████████████ Zig Zag ██████████████████'

bool i_zz_display = input.bool(defval=true, title='Display Zig Zag', group=g_zz)
int i_zz_period = input.int(defval=3, title='Zig Zag Length', minval=2, group=g_zz)
string i_zz_source = input.string(defval='High/Low', title='Source', options=['High/Low', 'Open/Close', 'Close'], group=g_zz)
color i_zz_bull_color = input.color(defval=#26A69A, title='Color Up', group=g_zz)
color i_zz_bear_color = input.color(defval=#FF5252, title='Color Down', group=g_zz)
int i_zz_bx_transp = input.int(defval=85, title='Box Transparency', minval=0, maxval=100, group=g_zz)

//_____________________________ Menu Zig Zag End 

//_____________________________ Menu Additional Fiters Start

g_af = '███████████████ Additional Fiters ███████████████'
tt_pchg = 
 "• If '% Change Above/Below +/-' is 4, it means relative volume is considered when the price change is above 4%." +
 "\n• A value of 4% is positive for bullish scenarios and negative for bearish scenarios." +
 "\n• The percentage change is calculated using cumulative percentage change, so there might be a minor difference between the actual and displayed percentage change."
tt_vpchg = 
 "• If 'Volume % Change Above' is 0, it means Relative Volume is considered when today's volume is greater than the previous day's volume." +
 "\n• For 'Screening Method' choice 'Retracement to EMA,' the 'Apply Volume % Change Filter' can be unchecked." +
 "\n• A 'Volume % Change Above' 300% or more often indicates a major breakout, which may happen today or the next day." +
 "\n• The volume percentage change is calculated using cumulative percentage change, so there might be a minor difference between the actual and displayed percentage change."
tt_atr = 
 "• ATR helps filter out longer or more volatile signal candles."
tt_atr_mul =
 "• Higher multiplier value filters a longer or more volatile signal candle."
tt_bf =
 "• If the input is '80', it means the body covers over 80% of the candle."
tt_bs =
 "• 2 means the candle is 2 times larger than the previous candle."
tt_vol =
 "• Filter out a candle when its volume is greater than the SMA of the volume."
tt_rv =
 "• Filter out a candle when its volume is greater than the Relative Volume."
tt_tf =
 "• Filter out a signals between the given Time."
tt_df =
 "• Filter out a signals on the given Date." +
  "\n• This Time Filter is applicable only for 'Displacement Candles'."

bool i_pchg_filter = input.bool(defval=false, title='Apply % Change Filter', tooltip=tt_pchg, group=g_af)
float i_pchg_above_below = input.float(defval=2, title='% Change Above/Below +/-', minval=0, group=g_af)

bool i_vol_filter = input.bool(defval=false, title='Apply Volume Filter', tooltip=tt_vpchg, group=g_af)
int i_vol_above = input.int(defval=500000, title='Volume Above', minval=0, group=g_af)

bool i_vol_pchg_filter = input.bool(defval=false, title='Apply Volume % Change Filter', tooltip=tt_vpchg, group=g_af)
float i_vol_pchg_above = input.float(defval=0, title='Volume % Change Above', minval=0, group=g_af)

bool i_atr_filter = input.bool(defval=false, title='Apply ATR Filter', tooltip=tt_atr, group=g_af)
int i_atr_length = input.int(defval=14, minval=1, title='ATR Length', group=g_af)
float i_atr_multi = input.float(defval=1, title='ATR Multiplier', minval=1, group=g_af)

bool i_body_filter = input.bool(defval=false, title='Apply Body % Filter', tooltip=tt_bf, group=g_af)
float i_body_percent = input.float(defval=60, title='Body % Above', minval=0, maxval=100, group=g_af) / 100

bool i_body_size_filter = input.bool(defval=false, title='Apply Body Size Filter', tooltip=tt_bs, group=g_af)
int i_body_size_multiplier = input.int(defval=2, title='Body Size Multiplier (x)', minval=0,  group=g_af)

bool i_volume_filter = input.bool(defval=false, title='Apply Volume Filter', tooltip=tt_vol, group=g_af)
int i_vol_sma_length = input.int(defval=20, minval=1, title='Volume SMA Length', group=g_af)

bool i_rel_vol_filter = input.bool(defval=false, title='Apply FVG Retracement Filter', tooltip=tt_rv, group=g_af)
int i_rel_vol_avg_vol_len = input.int(defval=90, title='FVG Retracement Length', minval=2, group=g_af)
float i_rel_vol_avg_vol_multi = input.float(defval=5, title='Rel Vol SMA Multiplier', minval=0, group=g_af)

bool i_time_filter = input.bool(defval=false, title='Apply Time Filter', tooltip=tt_tf, group=g_af)
int i_hour_1 = input.int(defval=9, minval=0, title='Time From', inline='t_1', group=g_af)
int i_minute_1 = input.int(defval=15, minval=0, title=':', inline='t_1', group=g_af)
int i_hour_2 = input.int(defval=10, minval=0, title='Time To ', inline='t_2', group=g_af)
int i_minute_2 = input.int(defval=15, minval=0, title=':', inline='t_2', group=g_af)

bool i_date_filter = input.bool(defval=false, title='Apply Date Filter', tooltip=tt_df, group=g_af)
int i_day = input.int(defval=25, minval=1, maxval=31, title='Day', group=g_af)
int i_month = input.int(defval=10, minval=1, maxval=12, title='Month', group=g_af)
int i_year = input.int(defval=2024, minval=0, title='Year', group=g_af)

//_____________________________ Menu Additional Fiters End

//_____________________________ Menu Table Start

g_dtb = '█████████████████ Data Table █████████████████'
bool i_tbl_data_show  = input.bool(defval=true, title='Display Table', group=g_dtb)
string i_tbl_data_pos = input.string(defval=position.bottom_right, title='Position', options=[position.top_left, position.top_center, position.top_right, position.middle_left, position.middle_center, position.middle_right, position.bottom_left, position.bottom_center, position.bottom_right], group=g_dtb)
string i_tbl_data_txt_size = input.string(defval=size.normal, title='Size', options=[size.auto, size.tiny, size.small, size.normal, size.large, size.huge], group=g_dtb)

//_____________________________ Menu Table End

//_____________________________ Chart Settings Start

g_ch = '███████████████ Chart Settings ███████████████'
color i_pos_dark_color = input.color(defval=#03110F, title='Positive Dark', group=g_ch)
color i_pos_color = input.color(defval=#26A69A, title='Positive Mid', group=g_ch)
color i_pos_light_color = input.color(defval=#ACE5DC, title='Positive Light', group=g_ch)
color i_neg_light_color = input.color(defval=#FCCBCD, title='Negative Light', group=g_ch)
color i_neg_color = input.color(defval=#FF5252, title='Negative Mid', group=g_ch)
color i_neg_dark_color = input.color(defval=#180809, title='Negative Dark', group=g_ch)
//color i_indicator_color = input.color(defval=#2962FF, title='Indicator', group=g_ch)
//color i_signal_color = input.color(defval=#FF6D00, title='Signal', group=g_ch)
color i_neu_color = input.color(defval=#D1D4DC, title='Neutral Light', group=g_ch)
color i_neu_mid_color = input.color(defval=#2A2E39, title='Neutral Mid', group=g_ch)
color i_neu_dark_color = input.color(defval=#141516, title='Neutral Dark', group=g_ch)

//_____________________________ Chart Settings End

//_____________________________ Cumulative Percentage Change Start

// Function to calculate Daily Cumulative Percentage Change of Close Price
cumulative_percentage_change() =>
    var float _cum_pct_change = na
    _is_new_day = ta.change(time('D')) != 0 ? 1 : 0
    _daily_pct_change = na(close[1]) ? 0 : (close - close[1]) / close[1] * 100
    _cum_pct_change := _is_new_day ? _daily_pct_change : (na(_cum_pct_change) ? _daily_pct_change : (_cum_pct_change + _daily_pct_change))
    _cum_pct_change

// Calculate current cumulative percentage change
cum_pchg = cumulative_percentage_change()

//_____________________________ Cumulative Percentage Change End

//_____________________________ Cumulative Volume Percentage Change Start

// Function to calculate Daily Cumulative Volume
cumulative_volume() =>
    var float _cum_vol = na
    _is_new_day = ta.change(time('D')) != 0 ? 1 : 0
    _cum_vol := _is_new_day ? volume : (na(_cum_vol) ? volume : (_cum_vol + volume))
    _cum_vol

// Calculate current and previous day cumulative volumes
var float current_cum_vol = na
var float prev_cum_vol = na

if ta.change(time('D')) != 0
    prev_cum_vol := current_cum_vol
    current_cum_vol := volume
else
    current_cum_vol += volume

// Calculate Cumulative Volume Percentage Change
cum_vol_pchg = (current_cum_vol - nz(prev_cum_vol, current_cum_vol)) / nz(prev_cum_vol, current_cum_vol) * 100

//_____________________________ Cumulative Volume Percentage Change End

//_____________________________ Additional Filters Start

// % Change Filter
bool pchg_above_filter = true
bool pchg_below_filter = true
if i_pchg_filter
    pchg_above_filter := cum_pchg > i_pchg_above_below
    pchg_below_filter := cum_pchg < -i_pchg_above_below

// Volume Filter
bool vol_filter = true
if i_vol_filter
    vol_filter := current_cum_vol >= i_vol_above

// Volume % Change Filter
bool vol_pchg_filter = true
if i_vol_pchg_filter
    vol_pchg_filter := cum_vol_pchg >= i_vol_pchg_above

// ATR Filter
bool atr_filter = true
if i_atr_filter
    atr_filter := (high - low) > ta.atr(i_atr_length) * i_atr_multi

// Body Percent Filter
bool body_filter = true
if i_body_filter
    body_filter := (math.abs(close - open)) / (high - low) >= i_body_percent

// Body Size Filter
bool body_size_filter = true
if i_body_size_filter
    body_size_filter := (math.abs(close - open)) / (high - low) >= i_body_percent and (high - low) >= (high[1] - low[1]) * i_body_size_multiplier

// Volume SMA Filter
bool volume_filter = true
if i_volume_filter
    volume_filter := volume > ta.sma(volume, i_vol_sma_length)

// FVG Retracement Filter
average_volume = ta.sma(volume, i_rel_vol_avg_vol_len)
relative_volume = volume / average_volume[1]
rel_vol_sma_multiplier = ta.sma(relative_volume, i_rel_vol_avg_vol_len) * i_rel_vol_avg_vol_multi

bool rel_vol_filter = true
if i_rel_vol_filter
    rel_vol_filter := relative_volume > rel_vol_sma_multiplier

// Time Filter
bool time_filter = true
if i_time_filter
    time_filter := (hour > i_hour_1 or (hour == i_hour_1 and minute >= i_minute_1)) and (hour < i_hour_2 or (hour == i_hour_2 and minute < i_minute_2))

// Date Filter
bool date_filter = true
if i_date_filter
    date_filter := (year == i_year and month == i_month and dayofmonth == i_day)

//_____________________________ Additional Filters End

//_____________________________ Zig Zag Start 

// Acknowledgement & Reference
// Trader: 'RozaniGhani-RG'
// Indicator Title: 'Zig Zag Ratio Simplified'
// Indicator Link: 'https://www.tradingview.com/script/CIk186OY-Zig-Zag-Ratio-Simplified/'

//_____________________________ Get Source

float _high = 
 i_zz_source == 'Open/Close' ? math.max(open, close) : 
 i_zz_source == 'Close' ? close : 
 high

float _low = 
 i_zz_source == 'Open/Close' ? math.max(open, close) : 
 i_zz_source == 'Close' ? close : 
 low

//============================== 1.  Variables

//_____________________________ 1.1 Highest / Lowest
float ph = ta.highestbars(_high, i_zz_period) == 0 ? _high : na
float pl = ta.lowestbars(_low, i_zz_period) == 0 ? _low  : na

//_____________________________ 1.2 Dir
var int dir = 0, dir := pl and na(ph) ? -1 : ph and na(pl) ? 1 : dir

//_____________________________ 1.4 Array
var max_array_size = 18, var zigzag = array.new_float(0), oldzigzag = array.copy(zigzag)

//_____________________________ 1.5 Others
var line line_zz = na

//============================== 3.  Custom Functions

add_to_zigzag(float[] pointer, float value, int bindex) =>
    array.unshift(pointer, bindex)
    array.unshift(pointer, value)
    if array.size(pointer) > max_array_size
        array.pop(pointer)
        array.pop(pointer)
    
update_zigzag(float[] pointer, float value, int bindex, int dir) =>
    if array.size(pointer) == 0
        add_to_zigzag(pointer, value, bindex)
    else
        if dir == 1 and value > array.get(pointer, 0) or dir == -1 and value < array.get(pointer, 0)
            array.set(pointer, 0, value)
            array.set(pointer, 1, bindex)
        0.

//============================== 4.  Calculations

dirchanged = ta.change(dir)

if ph or pl
    if dirchanged
        add_to_zigzag(zigzag, dir == 1 ? ph : pl, bar_index)
    else
        update_zigzag(zigzag, dir == 1 ? ph : pl, bar_index, dir)

//============================== 5.  Constructs

if array.size(zigzag) >= 9
    if array.get(zigzag, 0) != array.get(oldzigzag, 0) or array.get(zigzag, 1) != array.get(oldzigzag, 1)
        if array.get(zigzag, 2) == array.get(oldzigzag, 2) and array.get(zigzag, 3) == array.get(oldzigzag, 3)
            line.delete(line_zz)
        if i_zz_display
            line_zz := line.new(x1 = math.round(array.get(zigzag, 1)), y1 = array.get(zigzag, 0), x2 = math.round(array.get(zigzag, 3)), y2 = array.get(zigzag, 2), color = dir == 1 ? i_zz_bull_color : i_zz_bear_color, width=1)

//_____________________________ Get Swing Price & Bar Index

zz_0 = array.size(zigzag) > 17 ? array.get(zigzag, array.size(zigzag) - 18) : na
bi_0 = array.size(zigzag) > 16 ? array.get(zigzag, array.size(zigzag) - 17) : na
zz_1 = array.size(zigzag) > 15 ? array.get(zigzag, array.size(zigzag) - 16) : na
bi_1 = array.size(zigzag) > 14 ? array.get(zigzag, array.size(zigzag) - 15) : na
zz_2 = array.size(zigzag) > 13 ? array.get(zigzag, array.size(zigzag) - 14) : na
bi_2 = array.size(zigzag) > 12 ? array.get(zigzag, array.size(zigzag) - 13) : na
zz_3 = array.size(zigzag) > 11 ? array.get(zigzag, array.size(zigzag) - 12) : na
//bi_3 = array.size(zigzag) > 10 ? array.get(zigzag, array.size(zigzag) - 11) : na
zz_4 = array.size(zigzag) > 9 ? array.get(zigzag, array.size(zigzag) - 10) : na
//bi_4 = array.size(zigzag) > 8 ? array.get(zigzag, array.size(zigzag) - 9) : na
zz_5 = array.size(zigzag) > 7 ? array.get(zigzag, array.size(zigzag) - 8) : na
//bi_5 = array.size(zigzag) > 6 ? array.get(zigzag, array.size(zigzag) - 7) : na
zz_6 = array.size(zigzag) > 5 ? array.get(zigzag, array.size(zigzag) - 6) : na
//bi_6 = array.size(zigzag) > 4 ? array.get(zigzag, array.size(zigzag) - 5) : na
zz_7 = array.size(zigzag) > 3 ? array.get(zigzag, array.size(zigzag) - 4) : na
//bi_7 = array.size(zigzag) > 2 ? array.get(zigzag, array.size(zigzag) - 3) : na
zz_8 = array.size(zigzag) > 1 ? array.get(zigzag, array.size(zigzag) - 2) : na
bi_8 = array.size(zigzag) > 0 ? array.get(zigzag, array.size(zigzag) - 1) : na

// Create a single label for the last five zigzag values and their corresponding bar index
//label_text = str.tostring(zz_0) + "\n" + str.tostring(bi_0) + "\n" + str.tostring(zz_1) + "\n" + str.tostring(bi_1) + "\n" + str.tostring(zz_2) + 
// "\n" + str.tostring(bi_2) + "\n" + str.tostring(zz_3) + "\n" + str.tostring(bi_3) + "\n" + str.tostring(zz_4) + "\n" + str.tostring(bi_4)
//if barstate.islast
//    label.new(x = bar_index, y = high, text = label_text, color=color.white)

//_____________________________ Retracement Signals Start

// Short Retracement Start

// Short Condition 1
short_ret_cont_1 = 
 zz_1 > zz_2 and
 zz_1 < zz_3 and

 zz_2 < zz_1 and
 zz_2 < zz_3 and

 zz_3 > zz_2 and
 zz_3 > zz_1 and
 zz_3 > zz_4 and
 zz_3 < zz_5 and

 zz_4 < zz_3 and
 zz_4 > zz_2 and
 zz_4 < zz_5 and
 //zz_4 > zz_6 and

 zz_5 > zz_3 and
 zz_5 > zz_4 and
 zz_5 > zz_6 and
 zz_5 > zz_7 and

 zz_6 < zz_5 and
 //zz_6 < zz_4 and
 zz_6 < zz_7 and
 //zz_6 > zz_8 and

 zz_7 > zz_6 and
 zz_7 < zz_5 and
 zz_7 > zz_8 and

 //zz_8 < zz_7 and
 //zz_8 < zz_6 and

 ta.crossunder(close, zz_2) and

 pchg_above_filter and
 pchg_below_filter and
 vol_filter and
 vol_pchg_filter and
 atr_filter and
 body_filter and
 body_size_filter and
 volume_filter and
 rel_vol_filter and
 time_filter and
 date_filter and
 barstate.isconfirmed

// Get Short Retracement Price
var short_break_price = float(na)
var short_break_bi = float(na)
if short_ret_cont_1
    short_break_price := zz_2
    short_break_bi := bi_2

// Short Condition 2
bool short_ret_cont_2 = 
 ta.crossover(high, short_break_price) and
 high[1] < short_break_price and

 pchg_above_filter and
 pchg_below_filter and
 vol_filter and
 vol_pchg_filter and
 atr_filter and
 body_filter and
 body_size_filter and
 volume_filter and
 rel_vol_filter and
 time_filter and
 date_filter and
 barstate.isconfirmed

// Short Retracement Trigger
var short_break_current_state = 0
short_break_previous_state = nz(short_break_current_state[1])
short_break_current_state := short_break_previous_state == 2 ? 0 : short_break_previous_state
if short_ret_cont_1 and short_break_current_state == 0
    short_break_current_state := 1
if short_ret_cont_2 and short_break_current_state == 1
    short_break_current_state := 2

bool short_ret_trigger = short_break_current_state == 2 ? true : false

//___________________________ Short Retracement End

//___________________________ Long Retracement Start

// Long Retracement Start

// Long Condition 1
long_ret_cont_1 = 
 zz_1 < zz_2 and
 zz_1 > zz_3 and

 zz_2 > zz_1 and
 zz_2 > zz_3 and

 zz_3 < zz_2 and
 zz_3 < zz_1 and
 zz_3 < zz_4 and
 zz_3 > zz_5 and

 zz_4 > zz_3 and
 zz_4 < zz_2 and
 zz_4 > zz_5 and
 //zz_4 < zz_6 and

 zz_5 < zz_3 and
 zz_5 < zz_4 and
 zz_5 < zz_6 and
 zz_5 < zz_7 and

 zz_6 > zz_5 and
 //zz_6 > zz_4 and
 zz_6 > zz_7 and
 //zz_6 < zz_8 and

 zz_7 < zz_6 and
 zz_7 > zz_5 and
 zz_7 < zz_8 and

 //zz_8 > zz_7 and
 //zz_8 > zz_6 and

 ta.crossover(close, zz_2) and

 pchg_above_filter and
 pchg_below_filter and
 vol_filter and
 vol_pchg_filter and
 atr_filter and
 body_filter and
 body_size_filter and
 volume_filter and
 rel_vol_filter and
 time_filter and
 date_filter and
 barstate.isconfirmed

// Get Long Retracement Price in Long Condition
var long_break_price = float(na)
var long_break_bi = float(na)
if long_ret_cont_1
    long_break_price := zz_2
    long_break_bi := bi_2

// Long Condition 2
bool long_ret_cont_2 = 
 ta.crossunder(low, long_break_price) and
 low[1] > long_break_price and
 pchg_above_filter and
 pchg_below_filter and
 vol_filter and
 vol_pchg_filter and
 atr_filter and
 body_filter and
 body_size_filter and
 volume_filter and
 rel_vol_filter and
 time_filter and
 date_filter and
 barstate.isconfirmed

// Long  Retracement Trigger
var long_break_current_state = 0
long_break_previous_state = nz(long_break_current_state[1])
long_break_current_state := long_break_previous_state == 2 ? 0 : long_break_previous_state
if long_ret_cont_1 and long_break_current_state == 0
    long_break_current_state := 1
if long_ret_cont_2 and long_break_current_state == 1
    long_break_current_state := 2

long_ret_trigger = long_break_current_state == 2 ? true : false

//___________________________ Long Retracement

//_____________________________ Plot

// Plot Break Signal
plotshape(series=i_scr_show_short and i_scr_choose == 'Mitigation Block' ? short_ret_cont_1 : na, title='Short Shift', style=shape.triangledown, location=location.abovebar, color=i_neg_light_color, textcolor=i_neg_light_color, size=size.tiny)
plotshape(series=i_scr_show_long and i_scr_choose == 'Mitigation Block' ? long_ret_cont_1 : na, title='Long Shift', style=shape.triangleup, location=location.belowbar, color=i_pos_light_color, textcolor=i_pos_light_color, size=size.tiny)
barcolor(color=i_scr_show_short and i_scr_choose == 'Mitigation Block' and short_ret_cont_1 ? i_neg_light_color : i_scr_show_long and i_scr_choose == 'Mitigation Block' and long_ret_cont_1 ? i_pos_light_color : na, title='Shift Candle')

//var box_array = array.new_box()
var line_array = array.new_line()

if i_scr_show_short and short_ret_cont_1// and not short_ret_cont_0[1]
    ph_box = box.new(left=int(bi_8), top=math.min(zz_8, zz_6, zz_4, zz_2), right=int(bi_0), bottom=zz_5, border_color=color.new(i_neg_color, i_zz_bx_transp), bgcolor=color.new(i_neg_color, i_zz_bx_transp))
    if i_scr_choose == 'Mitigation Block'
        ph_line = line.new(x1=int(bi_2), y1=zz_2, x2=bar_index, y2=zz_2, color=i_neg_color, style=line.style_dashed)
        //array.push(box_array, ph_box)
        array.push(line_array, ph_line)

if i_scr_show_long and long_ret_cont_1// and not long_ret_cont_0[1]
    pl_box = box.new(left=int(bi_8), top=math.max(zz_8, zz_6, zz_4, zz_2), right=int(bi_0), bottom=zz_5, border_color=color.new(i_pos_color, i_zz_bx_transp), bgcolor=color.new(i_pos_color, i_zz_bx_transp))
    if i_scr_choose == 'Mitigation Block'
        pl_line = line.new(x1=int(bi_2), y1=zz_2, x2=bar_index, y2=zz_2, color=i_pos_color, style=line.style_dashed)
        //array.push(box_array, pl_box)
        array.push(line_array, pl_line)

// Plot Retracement Signal
plotchar(series=i_scr_show_short and i_scr_choose == 'Retracement' and short_ret_trigger ? 3 : na, title='Bear Retracement', char="↷", location=location.abovebar, color=i_neg_light_color, size=size.tiny)
plotchar(series=i_scr_show_long and i_scr_choose == 'Retracement' and long_ret_trigger ? 3 : na, title='Bull Retracement', char="⤻", location=location.belowbar, color=i_pos_light_color, size=size.tiny)
barcolor(color=i_scr_show_short and i_scr_choose == 'Retracement' and short_ret_trigger ? i_neg_light_color : i_scr_show_long and i_scr_choose == 'Retracement' and long_ret_trigger ? i_pos_light_color : na, title='Retracement Candle')

//var line_array = array.new_line()

if i_scr_show_short and i_scr_choose == 'Retracement' and short_ret_trigger// and not short_ret_trigger[1]
    bull_ret_ln = line.new(x1=int(short_break_bi), y1=short_break_price, x2=bar_index, y2=short_break_price, color=i_neg_color, style=line.style_dotted)
    array.push(line_array, bull_ret_ln)

if i_scr_show_long and i_scr_choose == 'Retracement' and long_ret_trigger// and not long_ret_trigger[1]
    bear_ret_ln = line.new(x1=int(long_break_bi), y1=long_break_price, x2=bar_index, y2=long_break_price, color=i_pos_color, style=line.style_dotted)
    array.push(line_array, bear_ret_ln)

//_____________________________ Zig Zag End 

//_____________________________ Data Table Start

// To String
day_pchg_str = str.tostring(cum_pchg,"#.##") + ' %'
volume_pchg_str = str.tostring(cum_vol_pchg,"#.##") + ' %'
day_volume_str = str.tostring(current_cum_vol/100000,"#.##") + ' L'
prev_day_volume_str = str.tostring(prev_cum_vol/100000,"#.##") + ' L'

// Color
bgcolor_1 = i_neu_dark_color
bgcolor_2 = i_neu_mid_color

pchg_col = cum_pchg > 0 ? i_pos_color : i_neg_color
vol_pchg_col = cum_vol_pchg > 0 ? i_pos_color : i_neg_color
prev_vol_pchg_col = prev_cum_vol < current_cum_vol ? i_neg_color : i_pos_color

// Plot Table
var table tbl_data = table.new(position=i_tbl_data_pos, columns=2, rows=4, border_width=1, force_overlay=true)

if barstate.islast and i_tbl_data_show
    table.cell(table_id=tbl_data, column=0, row=0, text="%Chg", text_color=i_neu_color, text_halign=text.align_left, bgcolor=bgcolor_1, text_size=i_tbl_data_txt_size)
    table.cell(table_id=tbl_data, column=1, row=0, text=day_pchg_str, text_color=pchg_col, text_halign=text.align_right, bgcolor=bgcolor_1, text_size=i_tbl_data_txt_size)

    table.cell(table_id=tbl_data, column=0, row=1, text="Vol %Chg", text_color=i_neu_color, text_halign=text.align_left, bgcolor=bgcolor_2, text_size=i_tbl_data_txt_size)
    table.cell(table_id=tbl_data, column=1, row=1, text=volume_pchg_str, text_color=vol_pchg_col, text_halign=text.align_right, bgcolor=bgcolor_2, text_size=i_tbl_data_txt_size)

    table.cell(table_id=tbl_data, column=0, row=2, text="Vol", text_color=i_neu_color, text_halign=text.align_left, bgcolor=bgcolor_1, text_size=i_tbl_data_txt_size)
    table.cell(table_id=tbl_data, column=1, row=2, text=day_volume_str, text_color=vol_pchg_col, text_halign=text.align_right, bgcolor=bgcolor_1, text_size=i_tbl_data_txt_size)

    table.cell(table_id=tbl_data, column=0, row=3, text="PD Vol", text_color=i_neu_color, text_halign=text.align_left, bgcolor=bgcolor_2, text_size=i_tbl_data_txt_size)
    table.cell(table_id=tbl_data, column=1, row=3, text=prev_day_volume_str, text_color=prev_vol_pchg_col, text_halign=text.align_right, bgcolor=bgcolor_2, text_size=i_tbl_data_txt_size)

//_____________________________ Data Table End

//_____________________________ Get Symbols for Screener Start

// Acknowledgement & Reference
// Trader: 'allanster'
// Indicator Title: 'How To Input CSV List Of Symbol Data Used For Screener'
// Indicator Link: 'https://www.tradingview.com/script/KfqHqHUH-How-To-Input-CSV-List-Of-Symbol-Data-Used-For-Screener/'

feed(back) =>                                             // extract tickerid and decrement list of ticker IDs
    loop  = back                                          // declare string variable to hold content list
    getT  = string(na)                                    // declare string variable to hold tickerid
    if str.length(loop) == 0                              // if list is empty
        getT := string(na)                                // assign na to tickerid variable
        loop := string(na)                                // assign na to list of ticker Ids variable
    else                                                  // else extract first tickerid
        getP  = nz(str.pos(loop, ','), str.length(loop))  // get position of first comma or last character
        getT := str.substring(loop, 0, getP)              // get tickerid in first position of list
        loop := str.replace(loop, getT + ',', '')         // clear tickerid + delimiter character from list
    [getT, loop]                                          // return tickerid in first position & truncated list

[tid_01, out_01] = feed(i_symbols), [tid_02, out_02] = feed(out_01), [tid_03, out_03] = feed(out_02), [tid_04, out_04] = feed(out_03),
[tid_05, out_05] = feed(out_04), [tid_06, out_06] = feed(out_05), [tid_07, out_07] = feed(out_06), [tid_08, out_08] = feed(out_07),
[tid_09, out_09] = feed(out_08), [tid_10, out_10] = feed(out_09), [tid_11, out_11] = feed(out_10), [tid_12, out_12] = feed(out_11),
[tid_13, out_13] = feed(out_12), [tid_14, out_14] = feed(out_13), [tid_15, out_15] = feed(out_14), [tid_16, out_16] = feed(out_15),
[tid_17, out_17] = feed(out_16), [tid_18, out_18] = feed(out_17), [tid_19, out_19] = feed(out_18), [tid_20, out_20] = feed(out_19),
[tid_21, out_21] = feed(out_20), [tid_22, out_22] = feed(out_21), [tid_23, out_23] = feed(out_22), [tid_24, out_24] = feed(out_23),
[tid_25, out_25] = feed(out_24), [tid_26, out_26] = feed(out_25), [tid_27, out_27] = feed(out_26), [tid_28, out_28] = feed(out_27),
[tid_29, out_29] = feed(out_28), [tid_30, out_30] = feed(out_29), [tid_31, out_31] = feed(out_30), [tid_32, out_32] = feed(out_31),
[tid_33, out_33] = feed(out_32), [tid_34, out_34] = feed(out_33), [tid_35, out_35] = feed(out_34), [tid_36, out_36] = feed(out_35),
[tid_37, out_37] = feed(out_36), [tid_38, out_38] = feed(out_37), [tid_39, out_39] = feed(out_38), [tid_40, out_40] = feed(out_39)

//_____________________________ Get Symbols for Screener End

//_____________________________ Screener Start

// Acknowledgement & Reference
// Trader: 'MUQWISHI'
// Indicator Title: 'Candlestick Patterns Screener [By MUQWISHI]'
// Indicator Link: 'https://www.tradingview.com/script/xiWQuGOq-Candlestick-Patterns-Screener-By-MUQWISHI/'

// Choose Screening Method
short_cond = 
 i_scr_choose == 'Mitigation Block' ? short_ret_cont_1 :
 short_ret_trigger

long_cond =  
 i_scr_choose == 'Mitigation Block' ? long_ret_cont_1 :
 long_ret_trigger

// Function for Screener Indicator Calculation
indicator_calculation() =>
    // Initialize variables
    price = float(na)
    _time = int(na)
    _cum_pchg = float(na)
    _cum_vol_pchg = float(na)
    signal = int(na) 

    if barstate.isconfirmed
        // Check for Short Momentum Candle and conditions (Modify here to customize indicators)
        if i_scr_show_long and long_cond
            signal := 1

        // Check for Long Momentum Candle and conditions (Modify here to customize indicators)
        else if i_scr_show_short and short_cond
            signal := -1

        // Update price and time if signal is not null
        if not na(signal)
            price := math.round_to_mintick(close)
            _time := time
            _cum_pchg := cum_pchg
            _cum_vol_pchg := cum_vol_pchg

    [_time, price, _cum_pchg, _cum_vol_pchg, signal]

// Function to format time
format_time(x) =>
    timezone = syminfo.timezone
    timeframe.isintraday ? str.format_time(x, "HH:mm  dd-MM-yyyy", timezone) : str.format_time(x, "dd-MM-yyyy", timezone)

// Function to extract symbol name
symbol(s) => 
    array.get(str.split(s, ":"), 1)

// Matrix setup
var matrix = matrix.new<string>(0, 6, na)

// Function to add rows to the matrix
mtxFun(symbol, _time, price, _cum_pchg, _cum_vol_pchg, signal) =>
    matrix.add_row(matrix, 0, array.from(symbol, _time, price, _cum_pchg, _cum_vol_pchg, signal))

// Screener function to collect data
screener(s) =>
    sym = ticker.modify(s, syminfo.session)
    [_time, price, _cum_pchg, _cum_vol_pchg, signal] = request.security(sym, timeframe.period, indicator_calculation())

    // Check if the signal is not na and the time matches
    if not na(signal) and _time == time
        symbolName = symbol(s)
        formattedTime = format_time(_time)
        strPrice = str.tostring(price)
        str_cum_pchg = str.tostring(_cum_pchg, '#.##')
        str_cum_vol_pchg = str.tostring(_cum_vol_pchg, '#.##')
        strSignal = str.tostring(signal)
        
        // Add data to the matrix
        mtxFun(symbolName, formattedTime, strPrice, str_cum_pchg, str_cum_vol_pchg, strSignal)

// Call Screener function for multiple symbols
screener(tid_01), screener(tid_02), screener(tid_03), screener(tid_04), screener(tid_05), screener(tid_06), screener(tid_07),
screener(tid_08), screener(tid_09), screener(tid_10), screener(tid_11), screener(tid_12), screener(tid_13), screener(tid_14),
screener(tid_15), screener(tid_16), screener(tid_17), screener(tid_18), screener(tid_19), screener(tid_20), screener(tid_21),
screener(tid_22), screener(tid_23), screener(tid_24), screener(tid_25), screener(tid_26), screener(tid_27), screener(tid_28),
screener(tid_29), screener(tid_30), screener(tid_31), screener(tid_32), screener(tid_33), screener(tid_34), screener(tid_35),
screener(tid_36), screener(tid_37), screener(tid_38), screener(tid_39), screener(tid_40)

// Trim excess rows in the matrix
if matrix.rows(matrix) > i_scr_tbl_disp_rows
    while matrix.rows(matrix) > i_scr_tbl_disp_rows
        matrix.remove_row(matrix, matrix.rows(matrix)-1)

// Plot Table
// Create table with specified properties
var table scr_tbl = table.new(position=i_scr_tbl_position, columns=5, rows=102, border_width=1, force_overlay=true)

// Function to populate cells in the table
scr_cell_title(col, row, txt) => 
    table.cell(scr_tbl, col, row, text = txt, text_color = i_neu_color, text_halign=text.align_center, bgcolor=i_neu_dark_color, text_size=i_scr_tbl_text_size)

scr_cell(col, row, txt, _text_color, _bgcolor) => 
    table.cell(scr_tbl, col, row, text = txt, text_color = _text_color, text_halign=text.align_left, bgcolor=_bgcolor, text_size=i_scr_tbl_text_size)

// Check if it's the last bar
if barstate.islast and i_scr_show_table
    // Clear existing data in the table
    table.clear(scr_tbl, 0, 0, 2, 101)

    scr_cell_title(0, 0, i_scr_choose)
    table.merge_cells(table_id=scr_tbl, start_column=0, start_row=0, end_column=4, end_row=0)
    scr_cell_title(0, 1, "Symbol")
    scr_cell_title(1, 1, "Time")
    scr_cell_title(2, 1, "Price")
    scr_cell_title(3, 1, "%Chg")
    scr_cell_title(4, 1, "V %Chg")

    j = 4
    // Populate table with matrix data
    if matrix.rows(matrix) > 0
        for i = 0 to matrix.rows(matrix) - 1
            // Determine color based on the signal

            _textcolor = 
             matrix.get(matrix, i, 5) ==  "1" ? i_pos_color : 
             matrix.get(matrix, i, 5) == "-1" ? i_neg_color : i_neu_color

            _bg_color = 
             matrix.get(matrix, i, 5) ==  "1" ? i_pos_dark_color :
             matrix.get(matrix, i, 5) == "-1" ? i_neg_dark_color : i_neu_color

            // Populate cells in the table
            scr_cell(0, j, matrix.get(matrix, i, 0), _textcolor, _bg_color)
            scr_cell(1, j, matrix.get(matrix, i, 1), _textcolor, _bg_color)
            scr_cell(2, j, matrix.get(matrix, i, 2), _textcolor, _bg_color)
            scr_cell(3, j, matrix.get(matrix, i, 3), _textcolor, _bg_color)
            scr_cell(4, j, matrix.get(matrix, i, 4), _textcolor, _bg_color)

            j += 1

//_____________________________ Screener End

//_____________________________ Code End
##-- File Name: PineScript-main/ICT Mitigation Block Scanner/[Scanner] ICT Mitigation Block Scanner.txt | File No: 27 | Ended --##

##-- File Name: PineScript-main/ICT Mitigation Block Scanner/Readme First.txt | File No: 28 | Started --##
// Readme First:

// ICT Mitigation Block Scanner

// Reference
//   - Video Title: ICT Mentorship Core Content - Month 04 - Mitigation Blocks
//   - Video Link: https://www.youtube.com/watch?v=FOUzW0QmsfI

// Notes
//   - For intraday trading, a 3-minute timeframe works well.
//   - The Scanner will generate wrong signals also.
##-- File Name: PineScript-main/ICT Mitigation Block Scanner/Readme First.txt | File No: 28 | Ended --##

##-- File Name: PineScript-main/Momentum Setup - Ankush Bajaj Momentum Investing Setup/Momentum Setup - Ankush Bajaj Momentum Investing Setup with Scanner.txt | File No: 29 | Started --##
// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © Arun_K_Bhaskar

//@version=5
indicator(title='Momentum Setup - Ankush Bajaj Momentum Investing Setup with Scanner', shorttitle='AB Mom Scan', overlay=true, max_bars_back=500, max_lines_count=500, max_boxes_count=500)

//_____________________________ Menu Screener Start

g_scrtb = '██████████████████ Scanner ██████████████████'

tt_is = 
 "• Reads only up to first 40 symbols." +
 "\n• Total characters cannot exceed 4096." +
 "\n• Use comma as delimiter without any space." +
 "\n• Eg: EXCHANGE:SYMBOL_A,EXCHANGE:SYMBOL_B"

string i_symbols = input.text_area(
 defval="NSE:ABCAPITAL,NSE:ABFRL,NSE:AUROPHARMA,NSE:BANDHANBNK,NSE:BEL,NSE:BHEL,NSE:BPCL,NSE:BSOFT,NSE:COLPAL,NSE:CONCOR,NSE:CUB,NSE:DLF,NSE:EICHERMOT,NSE:GAIL,NSE:GNFC,NSE:GODREJCP,NSE:GODREJPROP,NSE:GRANULES,NSE:HINDCOPPER,NSE:HINDPETRO,NSE:IDEA,NSE:IGL,NSE:INDIACEM,NSE:INDUSTOWER,NSE:LAURUSLABS,NSE:MANAPPURAM,NSE:INDHOTEL,NSE:MUTHOOTFIN,NSE:NATIONALUM,NSE:NAUKRI,NSE:NMDC,NSE:OBEROIRLTY,NSE:PETRONET,NSE:PFC,NSE:RECLTD,NSE:SAIL,NSE:TATACHEM,NSE:VEDL,NSE:VOLTAS,NSE:ZEEL", 
 title="Paste Symbols", tooltip=tt_is, group=g_scrtb)

string i_scr_direction = input.string(defval='Both', title='Direction', options=['Both', 'Bullish', 'Bearish'], inline='tb_1', group=g_scrtb)
bool i_scr_show_bull  = input.bool(defval=true, title='Only Bullish', inline='tb_2', group=g_scrtb)
bool i_scr_show_bear  = input.bool(defval=true, title='Only Bearish', inline='tb_2', group=g_scrtb)

int i_scr_tbl_disp_rows = input.int(defval=12, title='Display Rows', minval=0, maxval=100, group=g_scrtb)
string i_scr_tbl_position = input.string(defval=position.bottom_left, title='Table Position', options=[position.top_left, position.top_center, position.top_right, position.middle_left, position.middle_center, position.middle_right, position.bottom_left, position.bottom_center, position.bottom_right], group=g_scrtb)
string i_scr_tbl_text_size = input.string(defval=size.small, title='Table Size', options=[size.auto, size.tiny, size.small, size.normal, size.large, size.huge], group=g_scrtb)

//_____________________________ Menu Screener End

//_____________________________ Menu Indicators Start

g_pchg = '██████████████ 250 Candle % Change ██████████████'
tt_pchg = 
 "• Calculate the % change between the past 250th candle and the current candle." +
 "\n• For a bullish trend, the input value is considered positive; for a bearish trend, it's negative." +
 "\n• The default value is 8 for daily timeframe. For intraday timeframes like 5 minutes, change it to 2 or 4 or adjust as needed for other timeframes."

float i_pchg_250 = input.float(defval=8, title='Above/Below %', minval=0, tooltip=tt_pchg, group=g_pchg)

g_rsi = '███████████ Relative Strength Index (RSI) ███████████'
bool i_rsi_display = input.bool(defval=true, title='Display', group=g_rsi)
int i_rsi_len = input.int(defval=14, title='RSI Length', minval=1, group=g_rsi)
int i_rsi_sma_len = input.int(defval=14, title='SMA Length', minval=1, group=g_rsi)
int i_rsi_ob = input.int(defval=60, title='Overbought', minval=0, maxval=100, group=g_rsi)
int i_rsi_os = input.int(defval=40, title='Oversold', minval=0, maxval=100, group=g_rsi)
float i_rsi_voffset = input.float(defval=1.3, title='Vertical Offset', step=0.1, group=g_rsi)
float i_rsi_height = input.float(defval=2, title='Height', step=0.1, group=g_rsi)

g_mfi = '█████████████ Money Flow Index (MFI) █████████████'
bool i_mfi_display = input.bool(defval=true, title='Display', group=g_mfi)
int i_mfi_len = input.int(defval=14, title='MFI Length', minval=1, group=g_mfi)
int i_mfi_ob = input.int(defval=60, title='Overbought', minval=0, maxval=100, group=g_mfi)
int i_mfi_os = input.int(defval=40, title='Oversold', minval=0, maxval=100, group=g_mfi)
float i_mfi_voffset = input.float(defval=1.6, title='Vertical Offset', step=0.1, group=g_mfi)// 1.1
float i_mfi_height = input.float(defval=1, title='Height', step=0.1, group=g_mfi)//1.0

g_cci = '██████████ Commodity Channel Index (CCI) ██████████'
bool i_cci_display = input.bool(defval=true, title='Display', group=g_cci)
int i_cci_len = input.int(defval=20, title='CCI Length', minval=1, group=g_cci)
int i_cci_sma_len = input.int(defval=5, title='SMA Length', minval=1, group=g_cci)
int i_cci_ob = input.int(defval=100, title='Overbought', minval=0, group=g_cci)
int i_cci_os = input.int(defval=-100, title='Oversold', maxval=0, group=g_cci)
float i_cci_voffset = input.float(defval=1.8, title='Vertical Offset', step=0.1, group=g_cci)
float i_cci_height = input.float(defval=0.2, title='Height', step=0.1, group=g_cci)

g_vol = '██████████████████ Volume ██████████████████'
tt_vm = 
 "• The value shifts the volume moving average upward." +
 "\n• The default value of 1 means no multiplier is applied, but a multiplier of 5 indicates higher volume according to the strategy."

bool i_vol_display = input.bool(defval=true, title='Display', inline='VOL', group=g_vol)
string i_vol_type = input.string(defval='Regular Volume', title='Type', options=['Buying/Selling Volume', 'Regular Volume', 'None'], group=g_vol)
int i_vol_ma_len = input.int(defval=20, title='MA Length', minval=1, group=g_vol)
float i_vol_ma_multi = input.float(defval=5, title='MA Multiplier (x)', minval=1, tooltip=tt_vm, group=g_vol)
i_vol_hoffset = 0
float i_vol_voffset = input.float(defval=0.3, title='Vertical Offset', step=0.1, group=g_vol)
float i_vol_height = input.float(defval=0.6, title='Height', step=0.1, group=g_vol)

g_st = '█████████████████ Supertrend █████████████████'
bool i_st_display = input.bool(defval=true, title='Display', group=g_st)
int i_st_atr_period = input.int(defval=10, title="ATR Length", minval=1, group=g_st)
float i_st_factor = input.float(defval=3.0, title="Factor", minval=0.01, step=0.01, group=g_st)

//_____________________________ Menu Indicators End

//_____________________________ Menu Table Start

g_tb = '███████████████████ Table ███████████████████'
string i_tbl_position = input.string(defval=position.top_right, title='Position', options=[position.top_left, position.top_center, position.top_right, position.middle_left, position.middle_center, position.middle_right, position.bottom_left, position.bottom_center, position.bottom_right], group=g_tb)
string i_tbl_text_size = input.string(defval=size.normal, title='Size', options=[size.auto, size.tiny, size.small, size.normal, size.large, size.huge], group=g_tb)

//_____________________________ Menu Table End

//_____________________________ Chart Settings Start

g_ch = '████████████████ Chart Settings ████████████████'
int i_display_len = input.int(defval=50, title='Display Length', minval=1, group=g_ch)
color i_pos_col = input.color(defval=#26A69A, title='Positive', group=g_ch)
color i_pos_light_col = input.color(defval=#B2DFDB, title='Positive Light', group=g_ch)
color i_neg_light_col = input.color(defval=#FFCDD2, title='Negative Light', group=g_ch)
color i_neg_col = input.color(defval=#FF5250, title='Negative', group=g_ch)
color i_indicator_col = input.color(defval=#2962FF, title='Indicator', group=g_ch)
color i_signal_col = input.color(defval=#FF6D00, title='Signal', group=g_ch)
color i_neu_col = input.color(defval=#787B86, title='Neutral', group=g_ch)

//_____________________________ Chart Settings End

//_____________________________ 1. Percentage Change 250 Start

float pchg = (ta.change(close, 250) / close) * 100
 
//_____________________________ 1. Percentage Change 250 end

//_____________________________ 2. RSI Start

float rsi = ta.rsi(close, i_rsi_len)
float rsi_sma = ta.sma(rsi, i_rsi_sma_len)

//_____________________________ 2. RSI End

//_____________________________ 3. MFI Start

float mfi = ta.mfi(hlc3, i_mfi_len)

//_____________________________ 3. MFI End

//_____________________________ 4. CCI Start

float cci = ta.cci(hlc3, i_cci_len)
float cci_sma = ta.sma(cci, i_cci_sma_len)

//_____________________________ 4. CCI End

//_____________________________ 5. Volume: 20 SMA Start

vol_sma = ta.ema(volume, i_vol_ma_len) * i_vol_ma_multi

//_____________________________ 5. Volume: 20 SMA End

//_____________________________ 6. Supertrend Start

[supertrend, direction] = ta.supertrend(i_st_factor, i_st_atr_period)

supertrend := i_st_display and barstate.isfirst ? na : supertrend
upTrend = plot(series=i_st_display and direction < 0 ? supertrend : na, title="Supertrend Up", color=i_pos_col, style=plot.style_linebr)
downTrend = plot(series=i_st_display and direction < 0 ? na : supertrend, title="Supertrend Down", color=i_neg_col, style=plot.style_linebr)
bodyMiddle = plot(series=i_st_display and barstate.isfirst ? na : (open + close) / 2, title="Body Middle", display=display.none)

//fill(plot1=bodyMiddle, plot2=upTrend, color=color.new(i_pos_col, 90), fillgaps=false)
//fill(plot1=bodyMiddle, plot2=downTrend, color=color.new(i_neg_col, 90), fillgaps=false)

//_____________________________ 6. Supertrend End

//_____________________________ Signals Start

// Condition
short_cont = 
 //ta.crossunder(pchg, (-i_pchg_250)) and 
 pchg < (-i_pchg_250) and 
 rsi < i_rsi_os and 
 mfi < i_mfi_os and 
 cci < i_cci_os and
 volume > vol_sma and
 barstate.isconfirmed

long_cont = 
 //ta.crossover(pchg, i_pchg_250) and 
 pchg > i_pchg_250 and 
 rsi > i_rsi_ob and 
 mfi > i_mfi_ob and 
 cci > i_cci_ob and
 volume > vol_sma and
 barstate.isconfirmed

// Plot 
plotshape(series=short_cont, title='Short Signal', style=shape.triangledown, location=location.abovebar, color=i_neg_light_col, size=size.tiny)
plotshape(series=long_cont, title='Long Signal', style=shape.triangleup, location=location.belowbar, color=i_pos_light_col, size=size.tiny)

bgcolor(color=short_cont ? color.new(i_neg_light_col, 90) : long_cont ? color.new(i_pos_light_col, 90) : na, title='Signal Bgcolor', show_last=i_display_len)
barcolor(color=short_cont ? i_neg_light_col : long_cont ? i_pos_light_col : na, title='Signal Candle')

//_____________________________ Signals End

//_____________________________ Overlay Charts Start 

// Acknowledgement & Reference
// Trader: 'dgtrd'
// Indicator Title: 'Technical Analyst by DGT'
// Indicator Link: 'https://www.tradingview.com/script/r2kuEi0l-Technical-Analyst-by-DGT/'

// Functions  ----------------------------------------------------------------------------------- //

f_drawLabelX(_x, _y, _text, _xloc, _yloc, _color, _style, _textcolor, _size, _textalign, _tooltip) =>
    var id = label.new(_x, _y, _text, _xloc, _yloc, _color, _style, _textcolor, _size, _textalign, _tooltip)
    label.set_text(id, _text)
    label.set_tooltip(id, _tooltip)
    label.set_xy(id, _x, _y)
    label.set_textcolor(id, _textcolor)

// -Calculations ================================================================================ //

source   = close
nzVolume = nz(volume)

//------------------------------------------------------------------------------
// Volume

//vol_sma = ta.sma(nzVolume, i_vol_ma_len)

B = nzVolume * (close - low) / (high - low)
S = nzVolume * (high - close) / (high - low)

// Draw Charts
var a_lines       = array.new_line()
var a_hist        = array.new_box()

//i_display_len = 50
priceHighest      = ta.highest(high, i_display_len)
priceLowest       = ta.lowest (low , i_display_len)
priceChangeRate   = (priceHighest - priceLowest) / priceHighest

oscHighest        = 100//ta.highest(osc, i_display_len)

volumeMARate      = nzVolume / vol_sma
volumeHighest     = ta.highest(nzVolume, i_display_len)
bullCandle        = close > open

if barstate.islast 
    if array.size(a_lines) > 0
        for i = 1 to array.size(a_lines)
            line.delete(array.shift(a_lines))
    
    if array.size(a_hist) > 0
        for i = 1 to array.size(a_hist)
            box.delete(array.shift(a_hist))

    if i_mfi_display
        mid_line = math.avg(100, 0)
        array.push(a_hist, box.new (bar_index[i_display_len], priceLowest * (1 - priceChangeRate * i_mfi_voffset) * (1 + i_mfi_ob / oscHighest * priceChangeRate * i_mfi_height), 
                                     bar_index              , priceLowest * (1 - priceChangeRate * i_mfi_voffset) * (1 + i_mfi_ob / oscHighest * priceChangeRate * i_mfi_height), color.new(i_pos_col, 75), 1))
        array.push(a_hist, box.new (bar_index[i_display_len], priceLowest * (1 - priceChangeRate * i_mfi_voffset) * (1 + mid_line / oscHighest * priceChangeRate * i_mfi_height), 
                                     bar_index              , priceLowest * (1 - priceChangeRate * i_mfi_voffset) * (1 + mid_line / oscHighest * priceChangeRate * i_mfi_height), color.new(i_neu_col, 75), 1))
        array.push(a_hist, box.new (bar_index[i_display_len], priceLowest * (1 - priceChangeRate * i_mfi_voffset) * (1 + i_mfi_os / oscHighest * priceChangeRate * i_mfi_height), 
                                     bar_index              , priceLowest * (1 - priceChangeRate * i_mfi_voffset) * (1 + i_mfi_os / oscHighest * priceChangeRate * i_mfi_height), color.new(i_neg_col, 75), 1))
        f_drawLabelX(                bar_index + 3          , priceLowest * (1 - priceChangeRate * i_mfi_voffset) * (1 + mid_line / oscHighest * priceChangeRate * i_mfi_height), 'MFI', xloc.bar_index, yloc.price, #00000000, label.style_label_left, chart.fg_color, size.small, text.align_center, str.tostring(mfi, '#.##'))

    if i_rsi_display
        mid_line = math.avg(100, 0)
        array.push(a_hist, box.new (bar_index[i_display_len], priceLowest * (1 - priceChangeRate * i_rsi_voffset) * (1 + i_rsi_ob / oscHighest * priceChangeRate * i_rsi_height), 
                                     bar_index              , priceLowest * (1 - priceChangeRate * i_rsi_voffset) * (1 + i_rsi_ob / oscHighest * priceChangeRate * i_rsi_height), color.new(i_pos_col, 75), 1))
        array.push(a_hist, box.new (bar_index[i_display_len], priceLowest * (1 - priceChangeRate * i_rsi_voffset) * (1 + mid_line / oscHighest * priceChangeRate * i_rsi_height), 
                                     bar_index              , priceLowest * (1 - priceChangeRate * i_rsi_voffset) * (1 + mid_line / oscHighest * priceChangeRate * i_rsi_height), color.new(i_neu_col, 75), 1))
        array.push(a_hist, box.new (bar_index[i_display_len], priceLowest * (1 - priceChangeRate * i_rsi_voffset) * (1 + i_rsi_os / oscHighest * priceChangeRate * i_rsi_height), 
                                     bar_index              , priceLowest * (1 - priceChangeRate * i_rsi_voffset) * (1 + i_rsi_os / oscHighest * priceChangeRate * i_rsi_height), color.new(i_neg_col, 75), 1))
        f_drawLabelX(                bar_index + 3          , priceLowest * (1 - priceChangeRate * i_rsi_voffset) * (1 + mid_line / oscHighest * priceChangeRate * i_rsi_height), 'RSI', xloc.bar_index, yloc.price, #00000000, label.style_label_left, chart.fg_color, size.small, text.align_center, str.tostring(rsi, '#.##'))

    if i_cci_display
        mid_line = math.avg(100, 0)
        array.push(a_hist, box.new (bar_index[i_display_len], priceLowest * (1 - priceChangeRate * i_cci_voffset) * (1 + i_cci_ob / oscHighest * priceChangeRate * i_cci_height), 
                                     bar_index              , priceLowest * (1 - priceChangeRate * i_cci_voffset) * (1 + i_cci_ob / oscHighest * priceChangeRate * i_cci_height), color.new(i_pos_col, 75), 1))
        array.push(a_hist, box.new (bar_index[i_display_len], priceLowest * (1 - priceChangeRate * i_cci_voffset), 
                                     bar_index              , priceLowest * (1 - priceChangeRate * i_cci_voffset), color.new(i_neu_col, 75), 1))
        array.push(a_hist, box.new (bar_index[i_display_len], priceLowest * (1 - priceChangeRate * i_cci_voffset) * (1 + i_cci_os / oscHighest * priceChangeRate * i_cci_height), 
                                     bar_index              , priceLowest * (1 - priceChangeRate * i_cci_voffset) * (1 + i_cci_os / oscHighest * priceChangeRate * i_cci_height), color.new(i_neg_col, 75), 1))
        f_drawLabelX(                bar_index + 3          , priceLowest * (1 - priceChangeRate * i_cci_voffset), 'CCI', xloc.bar_index, yloc.price, #00000000, label.style_label_left, chart.fg_color, size.small, text.align_center, str.tostring(cci, '#.##'))

    if i_vol_type != 'None' 
        f_drawLabelX(                bar_index + 3          , priceHighest * (1 + priceChangeRate * i_vol_voffset), 'VOL', xloc.bar_index, yloc.price, #00000000, label.style_label_left, chart.fg_color, size.small, text.align_center, 'Buy Vol : ' + str.tostring(B / (B + S) * 100, '#.##') + '%\nSell Vol : ' + str.tostring(S / (B + S) * 100, '#.##') + '%\nLast Vol : ' + str.tostring(nzVolume, format.volume) + '\nAvg Vol : ' + str.tostring(vol_sma, format.volume))

    for barIndex = 0 to i_display_len - 1
        if array.size(a_lines) < 500

            if i_mfi_display
                array.push(a_lines, line.new(bar_index[barIndex], priceLowest * (1 - priceChangeRate * i_mfi_voffset) * (1 + mfi[barIndex]     / oscHighest * priceChangeRate * i_mfi_height), 
                                         bar_index[barIndex + 1], priceLowest * (1 - priceChangeRate * i_mfi_voffset) * (1 + mfi[barIndex + 1] / oscHighest * priceChangeRate * i_mfi_height), xloc.bar_index, extend.none, i_indicator_col   , line.style_solid, 1))

            if i_rsi_display
                array.push(a_lines, line.new(bar_index[barIndex], priceLowest * (1 - priceChangeRate * i_rsi_voffset) * (1 + rsi[barIndex]     / oscHighest * priceChangeRate * i_rsi_height), 
                                         bar_index[barIndex + 1], priceLowest * (1 - priceChangeRate * i_rsi_voffset) * (1 + rsi[barIndex + 1] / oscHighest * priceChangeRate * i_rsi_height), xloc.bar_index, extend.none, i_indicator_col   , line.style_solid, 1))
                array.push(a_lines, line.new(bar_index[barIndex], priceLowest * (1 - priceChangeRate * i_rsi_voffset) * (1 + rsi_sma[barIndex] / oscHighest * priceChangeRate * i_rsi_height), 
                                         bar_index[barIndex + 1], priceLowest * (1 - priceChangeRate * i_rsi_voffset) * (1 + rsi_sma[barIndex + 1] / oscHighest * priceChangeRate * i_rsi_height), xloc.bar_index, extend.none, i_signal_col   , line.style_solid, 1))

            if i_cci_display
                array.push(a_lines, line.new(bar_index[barIndex], priceLowest * (1 - priceChangeRate * i_cci_voffset) * (1 + cci[barIndex]     / oscHighest * priceChangeRate * i_cci_height), 
                                         bar_index[barIndex + 1], priceLowest * (1 - priceChangeRate * i_cci_voffset) * (1 + cci[barIndex + 1] / oscHighest * priceChangeRate * i_cci_height), xloc.bar_index, extend.none, i_indicator_col   , line.style_solid, 1))
                array.push(a_lines, line.new(bar_index[barIndex], priceLowest * (1 - priceChangeRate * i_cci_voffset) * (1 + cci_sma[barIndex] / oscHighest * priceChangeRate * i_cci_height), 
                                         bar_index[barIndex + 1], priceLowest * (1 - priceChangeRate * i_cci_voffset) * (1 + cci_sma[barIndex + 1] / oscHighest * priceChangeRate * i_cci_height), xloc.bar_index, extend.none, i_signal_col   , line.style_solid, 1))

            if nzVolume
                if i_vol_type != 'None' 
                    array.push(a_hist, box.new (bar_index[barIndex] + i_vol_hoffset,  priceHighest * (1 + priceChangeRate * i_vol_voffset), 
                                                 bar_index[barIndex] + i_vol_hoffset,  priceHighest * (1 + priceChangeRate * i_vol_voffset) * (1 + nzVolume[barIndex] / volumeHighest * priceChangeRate * i_vol_height), i_vol_type == 'Buying/Selling Volume' ? color.new(i_pos_col, 0) : bullCandle[barIndex] ? color.new(i_pos_col, 0) : color.new(i_neg_col, 0), 2, bgcolor = i_vol_type == 'Buying/Selling Volume' ? color.new(i_pos_col, 0) : bullCandle[barIndex] ? color.new(i_pos_col, 0) : color.new(i_neg_col, 0)))
                    if i_vol_type == 'Buying/Selling Volume'
                        array.push(a_hist, box.new (bar_index[barIndex] + i_vol_hoffset,   priceHighest * (1 + priceChangeRate * i_vol_voffset), 
                                                     bar_index[barIndex] + i_vol_hoffset,   priceHighest * (1 + priceChangeRate * i_vol_voffset) * (1 + S[barIndex]            / volumeHighest * priceChangeRate * i_vol_height), color.new(i_neg_col, 0), 2, bgcolor = color.new(i_neg_col, 0)))
                    // Voumme MA
                    if i_vol_display
                        array.push(a_lines, line.new(bar_index[barIndex] + i_vol_hoffset,     priceHighest * (1 + priceChangeRate * i_vol_voffset) * (1 + nzVolume[barIndex]   / volumeHighest * priceChangeRate * i_vol_height / volumeMARate[barIndex]), 
                                                     bar_index[barIndex + 1] + i_vol_hoffset, priceHighest * (1 + priceChangeRate * i_vol_voffset) * (1 + nzVolume[barIndex + 1] / volumeHighest * priceChangeRate * i_vol_height / volumeMARate[barIndex + 1]), xloc.bar_index, extend.none, i_neu_col, line.style_solid, 1))

//_____________________________ Overlay Charts End 

//_____________________________ Overlay Charts Table Start 

var table tbl = table.new(position=i_tbl_position, columns=2, rows=5, border_width=2)

// Color
col_pchg = pchg > i_pchg_250 ? i_pos_col : pchg < (-i_pchg_250) ? i_neg_col : i_neu_col
col_rsi = rsi > i_rsi_ob ? i_pos_col : rsi < i_rsi_os ? i_neg_col : i_neu_col
col_mfi = mfi > i_mfi_ob ? i_pos_col : mfi < i_mfi_os ? i_neg_col : i_neu_col
col_cci = cci > i_cci_ob ? i_pos_col : cci < i_cci_os ? i_neg_col : i_neu_col
col_vol = volume > vol_sma ? i_pos_col : i_neu_col

// Function to populate cells in the table
cell(int column, int row, string txt, color color) => 
    table.cell(tbl, column, row, text = txt, text_color = color, text_halign=text.align_left, bgcolor = color.new(color, 90), text_size=i_tbl_text_size)

// Check if it's the last bar
if barstate.islast
    cell(0, 0, "%Chg", col_pchg)
    cell(0, 1, "RSI", col_rsi)
    cell(0, 2, "MFI", col_mfi)
    cell(0, 3, "CCI", col_cci)
    cell(0, 4, "Vol", col_vol)

    cell(1, 0, str.tostring(pchg, '#.##'), col_pchg)
    cell(1, 1, str.tostring(rsi, '#.##'), col_rsi)
    cell(1, 2, str.tostring(mfi, '#.##'), col_mfi)
    cell(1, 3, str.tostring(cci, '#.##'), col_cci)
    cell(1, 4, str.tostring((volume / 100000), '#.##') + ' L', col_vol)
    
//_____________________________ Overlay Charts Table Start 

//_____________________________ Get Symbols for Screener Start

// Acknowledgement & Reference
// Trader: 'allanster'
// Indicator Title: 'How To Input CSV List Of Symbol Data Used For Screener'
// Indicator Link: 'https://www.tradingview.com/script/KfqHqHUH-How-To-Input-CSV-List-Of-Symbol-Data-Used-For-Screener/'

feed(back) =>                                             // extract tickerid and decrement list of ticker IDs
    loop  = back                                          // declare string variable to hold content list
    getT  = string(na)                                    // declare string variable to hold tickerid
    if str.length(loop) == 0                              // if list is empty
        getT := string(na)                                // assign na to tickerid variable
        loop := string(na)                                // assign na to list of ticker Ids variable
    else                                                  // else extract first tickerid
        getP  = nz(str.pos(loop, ','), str.length(loop))  // get position of first comma or last character
        getT := str.substring(loop, 0, getP)              // get tickerid in first position of list
        loop := str.replace(loop, getT + ',', '')         // clear tickerid + delimiter character from list
    [getT, loop]                                          // return tickerid in first position & truncated list

[tid_001, out_001] = feed(i_symbols), [tid_002, out_002] = feed(out_001), [tid_003, out_003] = feed(out_002), [tid_004, out_004] = feed(out_003),
[tid_005, out_005] = feed(out_004), [tid_006, out_006] = feed(out_005), [tid_007, out_007] = feed(out_006), [tid_008, out_008] = feed(out_007),
[tid_009, out_009] = feed(out_008), [tid_010, out_010] = feed(out_009), [tid_011, out_011] = feed(out_010), [tid_012, out_012] = feed(out_011),
[tid_013, out_013] = feed(out_012), [tid_014, out_014] = feed(out_013), [tid_015, out_015] = feed(out_014), [tid_016, out_016] = feed(out_015),
[tid_017, out_017] = feed(out_016), [tid_018, out_018] = feed(out_017), [tid_019, out_019] = feed(out_018), [tid_020, out_020] = feed(out_019),
[tid_021, out_021] = feed(out_020), [tid_022, out_022] = feed(out_021), [tid_023, out_023] = feed(out_022), [tid_024, out_024] = feed(out_023),
[tid_025, out_025] = feed(out_024), [tid_026, out_026] = feed(out_025), [tid_027, out_027] = feed(out_026), [tid_028, out_028] = feed(out_027),
[tid_029, out_029] = feed(out_028), [tid_030, out_030] = feed(out_029), [tid_031, out_031] = feed(out_030), [tid_032, out_032] = feed(out_031),
[tid_033, out_033] = feed(out_032), [tid_034, out_034] = feed(out_033), [tid_035, out_035] = feed(out_034), [tid_036, out_036] = feed(out_035),
[tid_037, out_037] = feed(out_036), [tid_038, out_038] = feed(out_037), [tid_039, out_039] = feed(out_038)//, [tid_040, out_040] = feed(out_039)

//_____________________________ Get Symbols for Screener End

//_____________________________ Screener Start

// Acknowledgement & Reference
// Trader: 'MUQWISHI'
// Indicator Title: 'Candlestick Patterns Screener [By MUQWISHI]'
// Indicator Link: 'https://www.tradingview.com/script/xiWQuGOq-Candlestick-Patterns-Screener-By-MUQWISHI/'

// Screener Conditions
bearish_cond = short_cont
bullish_cond = long_cont 

// Define Bull and Bear Conditions
bull = not(i_scr_direction == "Bearish")
bear = not(i_scr_direction == "Bullish")

// Function for Screener Indicator Calculation
indicator_calculation() =>
    // Initialize variables
    price = float(na)
    _time = int(na)
    signal = int(na) 

    if barstate.isconfirmed
        // Check for Bearish Momentum Candle and conditions (Modify here to customize indicators)
        if i_scr_show_bull and bearish_cond and bear 
            signal := -1

        // Check for Bullish Momentum Candle and conditions (Modify here to customize indicators)
        else if i_scr_show_bear and bullish_cond and bull
            signal := 1

        // Update price and time if signal is not null
        if not na(signal)
            price := math.round_to_mintick(close)
            _time := time

    [_time, price, signal]

// Function to format time
format_time(x) =>
    timezone = syminfo.timezone
    timeframe.isintraday ? str.format_time(x, "HH:mm  dd-MM-yyyy", timezone) : str.format_time(x, "dd-MM-yyyy", timezone)

// Function to extract symbol name
symbol(s) => 
    array.get(str.split(s, ":"), 1)

// Matrix setup
var matrix = matrix.new<string>(0, 4, na)

// Function to add rows to the matrix
mtxFun(symbol, _time, price, signal) =>
    matrix.add_row(matrix, 0, array.from(symbol, _time, price, signal))

// Screener function to collect data
screener(s) =>
    sym = ticker.modify(s, syminfo.session)
    [_time, price, signal] = request.security(sym, timeframe.period, indicator_calculation())

    // Check if the signal is not na and the time matches
    if not na(signal) and _time == time
        symbolName = symbol(s)
        formattedTime = format_time(_time)
        strPrice = str.tostring(price)
        strSignal = str.tostring(signal)
        
        // Add data to the matrix
        mtxFun(symbolName, formattedTime, strPrice, strSignal)

// Call Screener function for multiple symbols
screener(tid_001), screener(tid_002), screener(tid_003), screener(tid_004), screener(tid_005), screener(tid_006), screener(tid_007),
screener(tid_008), screener(tid_009), screener(tid_010), screener(tid_011), screener(tid_012), screener(tid_013), screener(tid_014),
screener(tid_015), screener(tid_016), screener(tid_017), screener(tid_018), screener(tid_019), screener(tid_020), screener(tid_021),
screener(tid_022), screener(tid_023), screener(tid_024), screener(tid_025), screener(tid_026), screener(tid_027), screener(tid_028),
screener(tid_029), screener(tid_030), screener(tid_031), screener(tid_032), screener(tid_033), screener(tid_034), screener(tid_035),
screener(tid_036), screener(tid_037), screener(tid_038), screener(tid_039)//, screener(tid_040)

// Trim excess rows in the matrix
if matrix.rows(matrix) > i_scr_tbl_disp_rows
    while matrix.rows(matrix) > i_scr_tbl_disp_rows
        matrix.remove_row(matrix, matrix.rows(matrix)-1)

// Plot Table
// Create table with specified properties
var table scr_tbl = table.new(position=i_scr_tbl_position, columns=3, rows=102, border_width=1)

// Function to populate cells in the table
scr_cell_title(col, row, txt) => 
    table.cell(scr_tbl, col, row, text = txt, text_color = i_neu_col, text_halign=text.align_center, bgcolor = color.new(i_neu_col, 90), text_size=i_scr_tbl_text_size)

scr_cell(col, row, txt, color) => 
    table.cell(scr_tbl, col, row, text = txt, text_color = color, text_halign=text.align_left, bgcolor = color.new(color, 90), text_size=i_scr_tbl_text_size)

// Check if it's the last bar
if barstate.islast
    // Clear existing data in the table
    table.clear(scr_tbl, 0, 0, 2, 101)

    scr_cell_title(0, 0, 'Momentum Investing')
    table.merge_cells(table_id=scr_tbl, start_column=0, start_row=0, end_column=2, end_row=0)
    scr_cell_title(0, 1, "Symbol")
    scr_cell_title(1, 1, "Time")
    scr_cell_title(2, 1, "Price")

    j = 2
    // Populate table with matrix data
    if matrix.rows(matrix) > 0
        for i = 0 to matrix.rows(matrix) - 1
            // Determine color based on the signal
            col = matrix.get(matrix, i, 3) ==  "1" ? i_pos_col :
                  matrix.get(matrix, i, 3) == "-1" ? i_neg_col : i_neu_col

            // Populate cells in the table
            scr_cell(0, j, matrix.get(matrix, i, 0), col)
            scr_cell(1, j, matrix.get(matrix, i, 1), col)
            scr_cell(2, j, matrix.get(matrix, i, 2), col)

            j += 1

//_____________________________ Screener End

//_____________________________ Code End

// Readme First:
// 
// About:
// This is a Momentum Investing Strategy Setup shared by trader Ankush Bajaj.
// The original video is based on the daily timeframe for long-term investment.
// This strategy can also be adapted for lower timeframes.
// To adapted the strategy for lower timeframes like 5 minutes, change the 'Above/Below %' to 2 or 4 or adjust as needed according your timeframe.
// Example: For 5 min timeframe use 'Above/Below %' as 2. For 1hr timeframe use 'Above/Below %' as 4.
// Also adjust the 'MA Multiplier (x)' value. Default is 5x. This can be adjusted to 2 times, 3 times etc.
// 
// Strategy Reference Video:
// Video Title: "Momentum Investing Strategies | Understand Different Types of Momentum Strategies | Ep 141"
// Video Link: https://www.youtube.com/watch?v=-uEEmnFtDIw
// Video Title: "Momentum Investing using Technical Indicators | Ep 142 | Samco Securities"
// Video Link: https://www.youtube.com/watch?v=zmpsx7BpzvU&t=1154s
// 
// Strategy Type: Momentum
// Bias: Strongly Directional
// Trading Style: Investment
// Instrument: Any
// Original Symbol: Any
// Timeframe: Daily (default)
// 
// Indicator Used and Settings:
// 1. % Change of last 250 candle
// 2. RSI 14
// 3. MFI 14
// 4. CCI 20
// 5. Volume 20 EMA
// 
// Long Entry Rules (As per the video):
// - Daily Timeframe
// - % Change of 250 Candle > 8
// - RSI above 60
// - MFI above 60
// - CCI above 100
// - Volume > EMA 20 of Volume * 5
// - Market Cap > 1000 Crore
// - Price > Rs.50
// 
// Short Entry Rules (Not mentioned in the video):
// - Daily Timeframe
// - % Change of 250 Candle < -8
// - RSI below 40
// - MFI below 40
// - CCI below -100
// - Volume > EMA 20 of Volume * 5
// - Market Cap > 1000 Crore
// - Price > Rs.50
##-- File Name: PineScript-main/Momentum Setup - Ankush Bajaj Momentum Investing Setup/Momentum Setup - Ankush Bajaj Momentum Investing Setup with Scanner.txt | File No: 29 | Ended --##

##-- File Name: PineScript-main/Momentum Setup - Ankush Bajaj Momentum Investing Setup/Momentum Setup - Ankush Bajaj Momentum Investing Setup.txt | File No: 30 | Started --##
// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © Arun_K_Bhaskar

//@version=5
indicator(title='Momentum Setup - Ankush Bajaj Momentum Investing Setup', shorttitle='AB Mom', overlay=true, max_bars_back=500, max_lines_count=500, max_boxes_count=500)

//_____________________________ Menu Indicators Start

g_pchg = '██████████████ 250 Candle % Change ██████████████'
tt_pchg = 
 "• Calculate the % change between the past 250th candle and the current candle." +
 "\n• For a bullish trend, the input value is considered positive; for a bearish trend, it's negative." +
 "\n• The default value is 8 for daily timeframe. For intraday timeframes like 5 minutes, change it to 2 or 4 or adjust as needed for other timeframes."

float i_pchg_250 = input.float(defval=8, title='Above/Below %', minval=0, tooltip=tt_pchg, group=g_pchg)

g_rsi = '███████████ Relative Strength Index (RSI) ███████████'
bool i_rsi_display = input.bool(defval=true, title='Display', group=g_rsi)
int i_rsi_len = input.int(defval=14, title='RSI Length', minval=1, group=g_rsi)
int i_rsi_sma_len = input.int(defval=14, title='SMA Length', minval=1, group=g_rsi)
int i_rsi_ob = input.int(defval=60, title='Overbought', minval=0, maxval=100, group=g_rsi)
int i_rsi_os = input.int(defval=40, title='Oversold', minval=0, maxval=100, group=g_rsi)
float i_rsi_voffset = input.float(defval=1.3, title='Vertical Offset', step=0.1, group=g_rsi)
float i_rsi_height = input.float(defval=2, title='Height', step=0.1, group=g_rsi)

g_mfi = '█████████████ Money Flow Index (MFI) █████████████'
bool i_mfi_display = input.bool(defval=true, title='Display', group=g_mfi)
int i_mfi_len = input.int(defval=14, title='MFI Length', minval=1, group=g_mfi)
int i_mfi_ob = input.int(defval=60, title='Overbought', minval=0, maxval=100, group=g_mfi)
int i_mfi_os = input.int(defval=40, title='Oversold', minval=0, maxval=100, group=g_mfi)
float i_mfi_voffset = input.float(defval=1.6, title='Vertical Offset', step=0.1, group=g_mfi)// 1.1
float i_mfi_height = input.float(defval=1, title='Height', step=0.1, group=g_mfi)//1.0

g_cci = '██████████ Commodity Channel Index (CCI) ██████████'
bool i_cci_display = input.bool(defval=true, title='Display', group=g_cci)
int i_cci_len = input.int(defval=20, title='CCI Length', minval=1, group=g_cci)
int i_cci_sma_len = input.int(defval=5, title='SMA Length', minval=1, group=g_cci)
int i_cci_ob = input.int(defval=100, title='Overbought', minval=0, group=g_cci)
int i_cci_os = input.int(defval=-100, title='Oversold', maxval=0, group=g_cci)
float i_cci_voffset = input.float(defval=1.8, title='Vertical Offset', step=0.1, group=g_cci)
float i_cci_height = input.float(defval=0.2, title='Height', step=0.1, group=g_cci)

g_vol = '██████████████████ Volume ██████████████████'
tt_vm = 
 "• The value shifts the volume moving average upward." +
 "\n• The default value of 1 means no multiplier is applied, but a multiplier of 5 indicates higher volume according to the strategy."

bool i_vol_display = input.bool(defval=true, title='Display', inline='VOL', group=g_vol)
string i_vol_type = input.string(defval='Regular Volume', title='Type', options=['Buying/Selling Volume', 'Regular Volume', 'None'], group=g_vol)
int i_vol_ma_len = input.int(defval=20, title='MA Length', minval=1, group=g_vol)
float i_vol_ma_multi = input.float(defval=5, title='MA Multiplier (x)', minval=1, tooltip=tt_vm, group=g_vol)
i_vol_hoffset = 0
float i_vol_voffset = input.float(defval=0.3, title='Vertical Offset', step=0.1, group=g_vol)
float i_vol_height = input.float(defval=0.6, title='Height', step=0.1, group=g_vol)

g_st = '█████████████████ Supertrend █████████████████'
bool i_st_display = input.bool(defval=true, title='Display', group=g_st)
int i_st_atr_period = input.int(defval=10, title="ATR Length", minval=1, group=g_st)
float i_st_factor = input.float(defval=3.0, title="Factor", minval=0.01, step=0.01, group=g_st)

//_____________________________ Menu Indicators End

//_____________________________ Menu Table Start

g_tb = '███████████████████ Table ███████████████████'
string i_tbl_position = input.string(defval=position.top_right, title='Position', options=[position.top_left, position.top_center, position.top_right, position.middle_left, position.middle_center, position.middle_right, position.bottom_left, position.bottom_center, position.bottom_right], group=g_tb)
string i_tbl_text_size = input.string(defval=size.normal, title='Size', options=[size.auto, size.tiny, size.small, size.normal, size.large, size.huge], group=g_tb)

//_____________________________ Menu Table End

//_____________________________ Chart Settings Start

g_ch = '████████████████ Chart Settings ████████████████'
int i_display_len = input.int(defval=50, title='Display Length', minval=1, group=g_ch)
color i_pos_col = input.color(defval=#26A69A, title='Positive', group=g_ch)
color i_pos_light_col = input.color(defval=#B2DFDB, title='Positive Light', group=g_ch)
color i_neg_light_col = input.color(defval=#FFCDD2, title='Negative Light', group=g_ch)
color i_neg_col = input.color(defval=#FF5250, title='Negative', group=g_ch)
color i_indicator_col = input.color(defval=#2962FF, title='Indicator', group=g_ch)
color i_signal_col = input.color(defval=#FF6D00, title='Signal', group=g_ch)
color i_neu_col = input.color(defval=#787B86, title='Neutral', group=g_ch)

//_____________________________ Chart Settings End

//_____________________________ 1. Percentage Change 250 Start

float pchg = (ta.change(close, 250) / close) * 100
 
//_____________________________ 1. Percentage Change 250 end

//_____________________________ 2. RSI Start

float rsi = ta.rsi(close, i_rsi_len)
float rsi_sma = ta.sma(rsi, i_rsi_sma_len)

//_____________________________ 2. RSI End

//_____________________________ 3. MFI Start

float mfi = ta.mfi(hlc3, i_mfi_len)

//_____________________________ 3. MFI End

//_____________________________ 4. CCI Start

float cci = ta.cci(hlc3, i_cci_len)
float cci_sma = ta.sma(cci, i_cci_sma_len)

//_____________________________ 4. CCI End

//_____________________________ 5. Volume: 20 SMA Start

vol_sma = ta.ema(volume, i_vol_ma_len) * i_vol_ma_multi

//_____________________________ 5. Volume: 20 SMA End

//_____________________________ 6. Supertrend Start

[supertrend, direction] = ta.supertrend(i_st_factor, i_st_atr_period)

supertrend := i_st_display and barstate.isfirst ? na : supertrend
upTrend = plot(series=i_st_display and direction < 0 ? supertrend : na, title="Supertrend Up", color=i_pos_col, style=plot.style_linebr)
downTrend = plot(series=i_st_display and direction < 0 ? na : supertrend, title="Supertrend Down", color=i_neg_col, style=plot.style_linebr)
bodyMiddle = plot(series=i_st_display and barstate.isfirst ? na : (open + close) / 2, title="Body Middle", display=display.none)

//fill(plot1=bodyMiddle, plot2=upTrend, color=color.new(i_pos_col, 90), fillgaps=false)
//fill(plot1=bodyMiddle, plot2=downTrend, color=color.new(i_neg_col, 90), fillgaps=false)

//_____________________________ 6. Supertrend End

//_____________________________ Signals Start

// Condition
short_cont = 
 //ta.crossunder(pchg, (-i_pchg_250)) and 
 pchg < (-i_pchg_250) and 
 rsi < i_rsi_os and 
 mfi < i_mfi_os and 
 cci < i_cci_os and
 volume > vol_sma and
 barstate.isconfirmed

long_cont = 
 //ta.crossover(pchg, i_pchg_250) and 
 pchg > i_pchg_250 and 
 rsi > i_rsi_ob and 
 mfi > i_mfi_ob and 
 cci > i_cci_ob and
 volume > vol_sma and
 barstate.isconfirmed

// Plot 
plotshape(series=short_cont, title='Short Signal', style=shape.triangledown, location=location.abovebar, color=i_neg_light_col, size=size.tiny)
plotshape(series=long_cont, title='Long Signal', style=shape.triangleup, location=location.belowbar, color=i_pos_light_col, size=size.tiny)

bgcolor(color=short_cont ? color.new(i_neg_light_col, 90) : long_cont ? color.new(i_pos_light_col, 90) : na, title='Signal Bgcolor', show_last=i_display_len)
barcolor(color=short_cont ? i_neg_light_col : long_cont ? i_pos_light_col : na, title='Signal Candle')

//_____________________________ Signals End

//_____________________________ Overlay Charts Start 

// Acknowledgement & Reference
// Trader: 'dgtrd'
// Indicator Title: 'Technical Analyst by DGT'
// Indicator Link: 'https://www.tradingview.com/script/r2kuEi0l-Technical-Analyst-by-DGT/'

// Functions  ----------------------------------------------------------------------------------- //

f_drawLabelX(_x, _y, _text, _xloc, _yloc, _color, _style, _textcolor, _size, _textalign, _tooltip) =>
    var id = label.new(_x, _y, _text, _xloc, _yloc, _color, _style, _textcolor, _size, _textalign, _tooltip)
    label.set_text(id, _text)
    label.set_tooltip(id, _tooltip)
    label.set_xy(id, _x, _y)
    label.set_textcolor(id, _textcolor)

// -Calculations ================================================================================ //

source   = close
nzVolume = nz(volume)

//------------------------------------------------------------------------------
// Volume

//vol_sma = ta.sma(nzVolume, i_vol_ma_len)

B = nzVolume * (close - low) / (high - low)
S = nzVolume * (high - close) / (high - low)

// Draw Charts
var a_lines       = array.new_line()
var a_hist        = array.new_box()

//i_display_len = 50
priceHighest      = ta.highest(high, i_display_len)
priceLowest       = ta.lowest (low , i_display_len)
priceChangeRate   = (priceHighest - priceLowest) / priceHighest

oscHighest        = 100//ta.highest(osc, i_display_len)

volumeMARate      = nzVolume / vol_sma
volumeHighest     = ta.highest(nzVolume, i_display_len)
bullCandle        = close > open

if barstate.islast 
    if array.size(a_lines) > 0
        for i = 1 to array.size(a_lines)
            line.delete(array.shift(a_lines))
    
    if array.size(a_hist) > 0
        for i = 1 to array.size(a_hist)
            box.delete(array.shift(a_hist))

    if i_mfi_display
        mid_line = math.avg(100, 0)
        array.push(a_hist, box.new (bar_index[i_display_len], priceLowest * (1 - priceChangeRate * i_mfi_voffset) * (1 + i_mfi_ob / oscHighest * priceChangeRate * i_mfi_height), 
                                     bar_index              , priceLowest * (1 - priceChangeRate * i_mfi_voffset) * (1 + i_mfi_ob / oscHighest * priceChangeRate * i_mfi_height), color.new(i_pos_col, 75), 1))
        array.push(a_hist, box.new (bar_index[i_display_len], priceLowest * (1 - priceChangeRate * i_mfi_voffset) * (1 + mid_line / oscHighest * priceChangeRate * i_mfi_height), 
                                     bar_index              , priceLowest * (1 - priceChangeRate * i_mfi_voffset) * (1 + mid_line / oscHighest * priceChangeRate * i_mfi_height), color.new(i_neu_col, 75), 1))
        array.push(a_hist, box.new (bar_index[i_display_len], priceLowest * (1 - priceChangeRate * i_mfi_voffset) * (1 + i_mfi_os / oscHighest * priceChangeRate * i_mfi_height), 
                                     bar_index              , priceLowest * (1 - priceChangeRate * i_mfi_voffset) * (1 + i_mfi_os / oscHighest * priceChangeRate * i_mfi_height), color.new(i_neg_col, 75), 1))
        f_drawLabelX(                bar_index + 3          , priceLowest * (1 - priceChangeRate * i_mfi_voffset) * (1 + mid_line / oscHighest * priceChangeRate * i_mfi_height), 'MFI', xloc.bar_index, yloc.price, #00000000, label.style_label_left, chart.fg_color, size.small, text.align_center, str.tostring(mfi, '#.##'))

    if i_rsi_display
        mid_line = math.avg(100, 0)
        array.push(a_hist, box.new (bar_index[i_display_len], priceLowest * (1 - priceChangeRate * i_rsi_voffset) * (1 + i_rsi_ob / oscHighest * priceChangeRate * i_rsi_height), 
                                     bar_index              , priceLowest * (1 - priceChangeRate * i_rsi_voffset) * (1 + i_rsi_ob / oscHighest * priceChangeRate * i_rsi_height), color.new(i_pos_col, 75), 1))
        array.push(a_hist, box.new (bar_index[i_display_len], priceLowest * (1 - priceChangeRate * i_rsi_voffset) * (1 + mid_line / oscHighest * priceChangeRate * i_rsi_height), 
                                     bar_index              , priceLowest * (1 - priceChangeRate * i_rsi_voffset) * (1 + mid_line / oscHighest * priceChangeRate * i_rsi_height), color.new(i_neu_col, 75), 1))
        array.push(a_hist, box.new (bar_index[i_display_len], priceLowest * (1 - priceChangeRate * i_rsi_voffset) * (1 + i_rsi_os / oscHighest * priceChangeRate * i_rsi_height), 
                                     bar_index              , priceLowest * (1 - priceChangeRate * i_rsi_voffset) * (1 + i_rsi_os / oscHighest * priceChangeRate * i_rsi_height), color.new(i_neg_col, 75), 1))
        f_drawLabelX(                bar_index + 3          , priceLowest * (1 - priceChangeRate * i_rsi_voffset) * (1 + mid_line / oscHighest * priceChangeRate * i_rsi_height), 'RSI', xloc.bar_index, yloc.price, #00000000, label.style_label_left, chart.fg_color, size.small, text.align_center, str.tostring(rsi, '#.##'))

    if i_cci_display
        mid_line = math.avg(100, 0)
        array.push(a_hist, box.new (bar_index[i_display_len], priceLowest * (1 - priceChangeRate * i_cci_voffset) * (1 + i_cci_ob / oscHighest * priceChangeRate * i_cci_height), 
                                     bar_index              , priceLowest * (1 - priceChangeRate * i_cci_voffset) * (1 + i_cci_ob / oscHighest * priceChangeRate * i_cci_height), color.new(i_pos_col, 75), 1))
        array.push(a_hist, box.new (bar_index[i_display_len], priceLowest * (1 - priceChangeRate * i_cci_voffset), 
                                     bar_index              , priceLowest * (1 - priceChangeRate * i_cci_voffset), color.new(i_neu_col, 75), 1))
        array.push(a_hist, box.new (bar_index[i_display_len], priceLowest * (1 - priceChangeRate * i_cci_voffset) * (1 + i_cci_os / oscHighest * priceChangeRate * i_cci_height), 
                                     bar_index              , priceLowest * (1 - priceChangeRate * i_cci_voffset) * (1 + i_cci_os / oscHighest * priceChangeRate * i_cci_height), color.new(i_neg_col, 75), 1))
        f_drawLabelX(                bar_index + 3          , priceLowest * (1 - priceChangeRate * i_cci_voffset), 'CCI', xloc.bar_index, yloc.price, #00000000, label.style_label_left, chart.fg_color, size.small, text.align_center, str.tostring(cci, '#.##'))

    if i_vol_type != 'None' 
        f_drawLabelX(                bar_index + 3          , priceHighest * (1 + priceChangeRate * i_vol_voffset), 'VOL', xloc.bar_index, yloc.price, #00000000, label.style_label_left, chart.fg_color, size.small, text.align_center, 'Buy Vol : ' + str.tostring(B / (B + S) * 100, '#.##') + '%\nSell Vol : ' + str.tostring(S / (B + S) * 100, '#.##') + '%\nLast Vol : ' + str.tostring(nzVolume, format.volume) + '\nAvg Vol : ' + str.tostring(vol_sma, format.volume))

    for barIndex = 0 to i_display_len - 1
        if array.size(a_lines) < 500

            if i_mfi_display
                array.push(a_lines, line.new(bar_index[barIndex], priceLowest * (1 - priceChangeRate * i_mfi_voffset) * (1 + mfi[barIndex]     / oscHighest * priceChangeRate * i_mfi_height), 
                                         bar_index[barIndex + 1], priceLowest * (1 - priceChangeRate * i_mfi_voffset) * (1 + mfi[barIndex + 1] / oscHighest * priceChangeRate * i_mfi_height), xloc.bar_index, extend.none, i_indicator_col   , line.style_solid, 1))

            if i_rsi_display
                array.push(a_lines, line.new(bar_index[barIndex], priceLowest * (1 - priceChangeRate * i_rsi_voffset) * (1 + rsi[barIndex]     / oscHighest * priceChangeRate * i_rsi_height), 
                                         bar_index[barIndex + 1], priceLowest * (1 - priceChangeRate * i_rsi_voffset) * (1 + rsi[barIndex + 1] / oscHighest * priceChangeRate * i_rsi_height), xloc.bar_index, extend.none, i_indicator_col   , line.style_solid, 1))
                array.push(a_lines, line.new(bar_index[barIndex], priceLowest * (1 - priceChangeRate * i_rsi_voffset) * (1 + rsi_sma[barIndex] / oscHighest * priceChangeRate * i_rsi_height), 
                                         bar_index[barIndex + 1], priceLowest * (1 - priceChangeRate * i_rsi_voffset) * (1 + rsi_sma[barIndex + 1] / oscHighest * priceChangeRate * i_rsi_height), xloc.bar_index, extend.none, i_signal_col   , line.style_solid, 1))

            if i_cci_display
                array.push(a_lines, line.new(bar_index[barIndex], priceLowest * (1 - priceChangeRate * i_cci_voffset) * (1 + cci[barIndex]     / oscHighest * priceChangeRate * i_cci_height), 
                                         bar_index[barIndex + 1], priceLowest * (1 - priceChangeRate * i_cci_voffset) * (1 + cci[barIndex + 1] / oscHighest * priceChangeRate * i_cci_height), xloc.bar_index, extend.none, i_indicator_col   , line.style_solid, 1))
                array.push(a_lines, line.new(bar_index[barIndex], priceLowest * (1 - priceChangeRate * i_cci_voffset) * (1 + cci_sma[barIndex] / oscHighest * priceChangeRate * i_cci_height), 
                                         bar_index[barIndex + 1], priceLowest * (1 - priceChangeRate * i_cci_voffset) * (1 + cci_sma[barIndex + 1] / oscHighest * priceChangeRate * i_cci_height), xloc.bar_index, extend.none, i_signal_col   , line.style_solid, 1))

            if nzVolume
                if i_vol_type != 'None' 
                    array.push(a_hist, box.new (bar_index[barIndex] + i_vol_hoffset,  priceHighest * (1 + priceChangeRate * i_vol_voffset), 
                                                 bar_index[barIndex] + i_vol_hoffset,  priceHighest * (1 + priceChangeRate * i_vol_voffset) * (1 + nzVolume[barIndex] / volumeHighest * priceChangeRate * i_vol_height), i_vol_type == 'Buying/Selling Volume' ? color.new(i_pos_col, 0) : bullCandle[barIndex] ? color.new(i_pos_col, 0) : color.new(i_neg_col, 0), 2, bgcolor = i_vol_type == 'Buying/Selling Volume' ? color.new(i_pos_col, 0) : bullCandle[barIndex] ? color.new(i_pos_col, 0) : color.new(i_neg_col, 0)))
                    if i_vol_type == 'Buying/Selling Volume'
                        array.push(a_hist, box.new (bar_index[barIndex] + i_vol_hoffset,   priceHighest * (1 + priceChangeRate * i_vol_voffset), 
                                                     bar_index[barIndex] + i_vol_hoffset,   priceHighest * (1 + priceChangeRate * i_vol_voffset) * (1 + S[barIndex]            / volumeHighest * priceChangeRate * i_vol_height), color.new(i_neg_col, 0), 2, bgcolor = color.new(i_neg_col, 0)))
                    // Voumme MA
                    if i_vol_display
                        array.push(a_lines, line.new(bar_index[barIndex] + i_vol_hoffset,     priceHighest * (1 + priceChangeRate * i_vol_voffset) * (1 + nzVolume[barIndex]   / volumeHighest * priceChangeRate * i_vol_height / volumeMARate[barIndex]), 
                                                     bar_index[barIndex + 1] + i_vol_hoffset, priceHighest * (1 + priceChangeRate * i_vol_voffset) * (1 + nzVolume[barIndex + 1] / volumeHighest * priceChangeRate * i_vol_height / volumeMARate[barIndex + 1]), xloc.bar_index, extend.none, i_neu_col, line.style_solid, 1))

//_____________________________ Overlay Charts End 

//_____________________________ Overlay Charts Table Start 

var table tbl = table.new(position=i_tbl_position, columns=2, rows=5, border_width=2)

// Color
col_pchg = pchg > i_pchg_250 ? i_pos_col : pchg < (-i_pchg_250) ? i_neg_col : i_neu_col
col_rsi = rsi > i_rsi_ob ? i_pos_col : rsi < i_rsi_os ? i_neg_col : i_neu_col
col_mfi = mfi > i_mfi_ob ? i_pos_col : mfi < i_mfi_os ? i_neg_col : i_neu_col
col_cci = cci > i_cci_ob ? i_pos_col : cci < i_cci_os ? i_neg_col : i_neu_col
col_vol = volume > vol_sma ? i_pos_col : i_neu_col

// Function to populate cells in the table
cell(int column, int row, string txt, color color) => 
    table.cell(tbl, column, row, text = txt, text_color = color, text_halign=text.align_left, bgcolor = color.new(color, 90), text_size=i_tbl_text_size)

// Check if it's the last bar
if barstate.islast
    cell(0, 0, "%Chg", col_pchg)
    cell(0, 1, "RSI", col_rsi)
    cell(0, 2, "MFI", col_mfi)
    cell(0, 3, "CCI", col_cci)
    cell(0, 4, "Vol", col_vol)

    cell(1, 0, str.tostring(pchg, '#.##'), col_pchg)
    cell(1, 1, str.tostring(rsi, '#.##'), col_rsi)
    cell(1, 2, str.tostring(mfi, '#.##'), col_mfi)
    cell(1, 3, str.tostring(cci, '#.##'), col_cci)
    cell(1, 4, str.tostring((volume / 100000), '#.##') + ' L', col_vol)
    
//_____________________________ Overlay Charts Table Start 

//_____________________________ Code End

// Readme First:
// 
// About:
// This is a Momentum Investing Strategy Setup shared by trader Ankush Bajaj.
// The original video is based on the daily timeframe for long-term investment.
// This strategy can also be adapted for lower timeframes.
// To adapted the strategy for lower timeframes like 5 minutes, change the 'Above/Below %' to 2 or 4 or adjust as needed according your timeframe.
// Example: For 5 min timeframe use 'Above/Below %' as 2. For 1hr timeframe use 'Above/Below %' as 4.
// Also adjust the 'MA Multiplier (x)' value. Default is 5x. This can be adjusted to 2 times, 3 times etc.
// 
// Strategy Reference Video:
// Video Title: "Momentum Investing Strategies | Understand Different Types of Momentum Strategies | Ep 141"
// Video Link: https://www.youtube.com/watch?v=-uEEmnFtDIw
// Video Title: "Momentum Investing using Technical Indicators | Ep 142 | Samco Securities"
// Video Link: https://www.youtube.com/watch?v=zmpsx7BpzvU&t=1154s
// 
// Strategy Type: Momentum
// Bias: Strongly Directional
// Trading Style: Investment
// Instrument: Any
// Original Symbol: Any
// Timeframe: Daily (default)
// 
// Indicator Used and Settings:
// 1. % Change of last 250 candle
// 2. RSI 14
// 3. MFI 14
// 4. CCI 20
// 5. Volume 20 EMA
// 
// Long Entry Rules (As per the video):
// - Daily Timeframe
// - % Change of 250 Candle > 8
// - RSI above 60
// - MFI above 60
// - CCI above 100
// - Volume > EMA 20 of Volume * 5
// - Market Cap > 1000 Crore
// - Price > Rs.50
// 
// Short Entry Rules (Not mentioned in the video):
// - Daily Timeframe
// - % Change of 250 Candle < -8
// - RSI below 40
// - MFI below 40
// - CCI below -100
// - Volume > EMA 20 of Volume * 5
// - Market Cap > 1000 Crore
// - Price > Rs.50
##-- File Name: PineScript-main/Momentum Setup - Ankush Bajaj Momentum Investing Setup/Momentum Setup - Ankush Bajaj Momentum Investing Setup.txt | File No: 30 | Ended --##

##-- File Name: PineScript-main/Momentum Setup - Ankush Bajaj Momentum Investing Setup/Readme First.txt | File No: 31 | Started --##
Readme First:

About:
This is a Momentum Investing Strategy Setup shared by trader Ankush Bajaj.
The original video is based on the daily timeframe for long-term investment.
This strategy can also be adapted for lower timeframes.
To adapted the strategy for lower timeframes like 5 minutes, change the 'Above/Below %' to 2 or 4 or adjust as needed according your timeframe.
Example: For 5 min timeframe use 'Above/Below %' as 2. For 1hr timeframe use 'Above/Below %' as 4.
Also adjust the 'MA Multiplier (x)' value. Default is 5x. This can be adjusted to 2 times, 3 times etc.

Strategy Reference Video:
Video Title: "Momentum Investing Strategies | Understand Different Types of Momentum Strategies | Ep 141"
Video Link: https://www.youtube.com/watch?v=-uEEmnFtDIw
Video Title: "Momentum Investing using Technical Indicators | Ep 142 | Samco Securities"
Video Link: https://www.youtube.com/watch?v=zmpsx7BpzvU&t=1154s

Strategy Type: Momentum
Bias: Strongly Directional
Trading Style: Investment
Instrument: Any
Original Symbol: Any
Timeframe: Daily (default)

Indicator Used and Settings:
1. % Change of last 250 candle
2. RSI 14
3. MFI 14
4. CCI 20
5. Volume 20 EMA

Long Entry Rules (As per the video):
- Daily Timeframe
- % Change of 250 Candle > 8
- RSI above 60
- MFI above 60
- CCI above 100
- Volume > EMA 20 of Volume * 5
- Market Cap > 1000 Crore
- Price > Rs.50

Short Entry Rules (Not mentioned in the video):
- Daily Timeframe
- % Change of 250 Candle < -8
- RSI below 40
- MFI below 40
- CCI below -100
- Volume > EMA 20 of Volume * 5
- Market Cap > 1000 Crore
- Price > Rs.50
##-- File Name: PineScript-main/Momentum Setup - Ankush Bajaj Momentum Investing Setup/Readme First.txt | File No: 31 | Ended --##

##-- File Name: PineScript-main/Momentum Setup - RSI Directional Momentum/[Indicator] Momentum Setup - RSI Directional Momentum.txt | File No: 32 | Started --##
// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © Arun_K_Bhaskar

//@version=6
indicator(title = 'Momentum Setup - RSI Directional Momentum Indicator', shorttitle = 'RSIDM', behind_chart = false)

//___________________________ Menu Start

string g_scn_tb = '█████████████████ Scanner █████████████████'

string tt_ch = 
 "Continuous Break:" + 
 "\n• Buy: RSI crosses above 60, dips below, then breaks the previous high while staying above 60." + 
 "\n• Sell: RSI crosses below 40, rises above, then breaks the previous low while staying below 40." +

 "\n\n Continuous Retracement:" + 
 "\n• After a Continuous Break, a Fibonacci level is set." +
 "\n• Buy: Price retraces to this level and bounces." +
 "\n• Sell: Price retraces to this level and drops." +

 "\n\n Flip Break:" + 
 "\n• If a Continuous Break fails, the trade flips (Long → Short, Short → Long)." + 

 "\n\n Flip Retracement:" + 
 "\n• If a Continuous Retracement fails, the trade flips (Long → Short, Short → Long)." + 

 "\n\n Divergence:" + 
 "\n• Buy: Price makes a lower low, RSI makes a higher low." + 
 "\n• Sell: Price makes a higher high, RSI makes a lower high." + 

 "\n\n Hidden Divergence (Trend continuation):" + 
 "\n• Buy: Price makes a higher low, RSI makes a lower low." + 
 "\n• Sell: Price makes a lower high, RSI makes a higher high."

string i_scn_choose = input.string(
 defval = 'Continuous Break', 
 title = 'Scanning Method', 
 options = ['Continuous Break', 'Continuous Retracement', 'Flip Break', 'Flip Retracement', 'Divergence', 'Hidden Divergence'], tooltip = tt_ch, group = g_scn_tb)

bool i_scn_show_long = input.bool(defval = true, title = 'Long Signals', inline = 'tb_2', group = g_scn_tb)
bool i_scn_show_short = input.bool(defval = true, title = 'Short Signals', inline = 'tb_2', group = g_scn_tb)

string g_rsi = '██████████ Relative Strength Index (RSI) ██████████'
string tt_ret_fib = 
 "• 0: Bottom of bullish & top of bearish breaking candle." + 
 "\n• 1: Top of bullish & bottom of bearish breaking candle." + 
 "\n• 0.5: 50% of the breaking candle."
int i_rsi_len = input.int(defval = 14, title = 'RSI Length', minval = 1, group = g_rsi)
float i_rsi_src = input.source(defval = close, title = 'RSI Source', group = g_rsi)
int i_rsi_ma_len = input.int(defval = 14, title = 'SMA Length', minval = 1, group = g_rsi)
float i_rsi_fib_val = input.float(defval = 0.5, title = 'Fib Value', step = 0.1, tooltip = tt_ret_fib, group = g_rsi)
bool i_rsi_show_bull = input.bool(defval = true, title = 'Display Bullish Divergence', group = g_rsi)
bool i_rsi_show_bear = input.bool(defval = true, title = 'Display Bearish Divergence', group = g_rsi)
bool i_rsi_show_hbull = input.bool(defval = true, title = 'Display Hidden Bullish Divergence', group = g_rsi)
bool i_rsi_show_hbear = input.bool(defval = true, title = 'Display Hidden Bearish Divergence', group = g_rsi)
int i_rsi_p_right = input.int(defval = 5, title = 'Pivot Lookback Right', group = g_rsi)
int i_rsi_p_left = input.int(defval = 5, title = 'Pivot Lookback Left', group = g_rsi)
int i_rsi_range_max = input.int(defval = 60, title = 'Max of Lookback Range', group = g_rsi)
int i_rsi_range_min = input.int(defval = 5, title = 'Min of Lookback Range', group = g_rsi)

string g_af = '██████████████ Additional Fiters ██████████████'

string tt_pchg = 
 "• Percentage change of the day." 
string tt_vpchg = 
 "• 0% means today's volume must exceed the previous day's." + 
 "\n• 300%+ often signals a major breakout (today or next day)."
string tt_atr = "• Filters out longer or more volatile signal candles."
string tt_atr_mul = "• Higher values filter longer or more volatile candles."
string tt_bf = "• 80 means the body covers 80%+ of the candle."
string tt_bs = "• 2 means the candle is twice the size of the previous one."
string tt_vol = "• Filter candles with volume > SMA of volume."
string tt_rv = "• Filter candles with volume > Relative Volume."
string tt_tf = "• Filter signals within a given time."
string tt_df = "• Filter signals on specified dates (for Break Candles (2) only)."

bool i_pchg_filter = input.bool(defval = false, title = 'Apply % Change Filter', tooltip = tt_pchg, group = g_af)
float i_pchg_above_below = input.float(defval = 2, title = '% Change Above/Below +/-', minval = 0, group = g_af)

bool i_vol_filter = input.bool(defval = false, title = 'Apply Volume Filter', tooltip = tt_vpchg, group = g_af)
int i_vol_above = input.int(defval = 500000, title = 'Volume Above', minval = 0, group = g_af)

bool i_vol_pchg_filter = input.bool(defval = false, title = 'Apply Volume % Change Filter', tooltip = tt_vpchg, group = g_af)
float i_vol_pchg_above = input.float(defval = 0, title = 'Volume % Change Above', minval = 0, group = g_af)

bool i_atr_filter = input.bool(defval = false, title = 'Apply ATR Filter', tooltip = tt_atr, group = g_af)
int i_atr_length = input.int(defval = 14, minval = 1, title = 'ATR Length', group = g_af)
float i_atr_multi = input.float(defval = 1, title = 'ATR Multiplier', minval = 1, group = g_af)

bool i_body_filter = input.bool(defval = false, title = 'Apply Body % Filter', tooltip = tt_bf, group = g_af)
float i_body_percent = input.float(defval = 70, title = 'Body % Above', minval = 0, maxval = 100, group = g_af) / 100

bool i_body_size_filter = input.bool(defval = false, title = 'Apply Body Size Filter', tooltip = tt_bs, group = g_af)
int i_body_size_multi = input.int(defval = 2, title = 'Body Size Multiplier (x)', minval = 0, group = g_af)

bool i_volume_filter = input.bool(defval = false, title = 'Apply Volume Filter', tooltip = tt_vol, group = g_af)
int i_vol_sma_length = input.int(defval = 20, minval = 1, title = 'Volume SMA Length', group = g_af)

bool i_rel_vol_filter = input.bool(defval = false, title = 'Apply Relative Volume Filter', tooltip = tt_rv, group = g_af)
int i_rel_vol_avg_vol_len = input.int(defval = 90, title = 'Relative Volume Length', minval = 2, group = g_af)
float i_rel_vol_avg_vol_multi = input.float(defval = 5, title = 'Rel Vol SMA Multiplier', minval = 0, group = g_af)

bool i_time_filter = input.bool(defval = false, title = 'Apply Time Filter', tooltip = tt_tf, group = g_af)
int i_hour_1 = input.int(defval = 9, minval = 0, title = 'Time From', inline = 't_1', group = g_af)
int i_minute_1 = input.int(defval = 15, minval = 0, title = ':', inline = 't_1', group = g_af)
int i_hour_2 = input.int(defval = 10, minval = 0, title = 'Time To ', inline = 't_2', group = g_af)
int i_minute_2 = input.int(defval = 15, minval = 0, title = ':', inline = 't_2', group = g_af)

bool i_date_filter = input.bool(defval = false, title = 'Apply Date Filter', tooltip = tt_df, group = g_af)
int i_day = input.int(defval = 25, minval = 1, maxval = 31, title = 'Day', group = g_af)
int i_month = input.int(defval = 10, minval = 1, maxval = 12, title = 'Month', group = g_af)
int i_year = input.int(defval = 2024, minval = 0, title = 'Year', group = g_af)

string g_cum = '█████████████ Performance Table █████████████'
bool i_cum_tbl_disp = input.bool(defval = true, title = 'Display', group = g_cum)
string i_cum_tbl_pos = input.string(defval = position.bottom_right, title = 'Position', options = [position.top_left, position.top_center, position.top_right, position.middle_left, position.middle_center, position.middle_right, position.bottom_left, position.bottom_center, position.bottom_right], group = g_cum)
string i_cum_tbl_size = input.string(defval = size.normal, title = 'Size', options = [size.auto, size.tiny, size.small, size.normal, size.large, size.huge], group = g_cum)

//string g_ch = '█████████████████ Colors █████████████████'
color i_pos_color = #089981 //input.color(defval = #089981, title = 'Positive', group = g_ch)
color i_pos_light_color = #70CCBD //input.color(defval = #70CCBD, title = 'Positive Light', group = g_ch)
color i_neg_light_color = #FAA1A4 //input.color(defval = #FAA1A4, title = 'Negative Light', group = g_ch)
color i_neg_color = #F23645 //input.color(defval = #F23645, title = 'Negative', group = g_ch)
color i_indicator_color = #2962FF //input.color(defval = #2962FF, title = 'Indicator', group = g_ch)
color i_signal_color = #FF6D00 //input.color(defval = #FF6D00, title = 'Signal', group = g_ch)
color i_neu_color = #D1D4DC //input.color(defval = #D1D4DC, title = 'Neutral Light', group = g_ch)
color i_neu_dark_color = #0F0F0F //input.color(defval = #0F0F0F, title = 'Neutral', group = g_ch)

//___________________________ Menu End

//___________________________ Performance Start

is_new_day = ta.change(time('D')) != 0

// Cumulative Percentage Change
var float cum_pchg = na
day_pchg = na(close[1]) ? 0 : (close - close[1]) / close[1] * 100
cum_pchg := is_new_day ? day_pchg : na(cum_pchg) ? day_pchg : cum_pchg + day_pchg

// Cumulative Volume and Volume Percentage Change
var float curr_cum_vol = na
var float prev_cum_vol = na
if is_new_day
    prev_cum_vol := curr_cum_vol
    curr_cum_vol := volume
    curr_cum_vol
else
    curr_cum_vol := na(curr_cum_vol) ? volume : curr_cum_vol + volume
    curr_cum_vol
prev_vol_safe = nz(prev_cum_vol, curr_cum_vol)
cum_vol_pchg = (curr_cum_vol - prev_vol_safe) / prev_vol_safe * 100

var table tbl_cum = table.new(position=i_cum_tbl_pos, columns=2, rows=4, border_width=1, force_overlay=true)

cell_perform(col, row, txt, txt_color, aligh) =>
    table.cell(tbl_cum, col, row, txt, text_color=txt_color, text_halign=aligh, bgcolor=i_neu_dark_color, text_size=i_cum_tbl_size)

if barstate.islast and i_cum_tbl_disp
    pchg_col = cum_pchg > 0 ? i_pos_color : i_neg_color
    vol_pchg_col = cum_vol_pchg > 0 ? i_pos_color : i_neg_color
    prev_vol_pchg_col = prev_vol_safe < curr_cum_vol ? i_neg_color : i_pos_color
    
    cell_perform(0, 0, '%Chg', chart.fg_color, text.align_left)
    cell_perform(1, 0, str.tostring(cum_pchg, '#.##') + ' %', pchg_col, text.align_right)
    cell_perform(0, 1, 'Vol %Chg', chart.fg_color, text.align_left)
    cell_perform(1, 1, str.tostring(cum_vol_pchg, '#.##') + ' %', vol_pchg_col, text.align_right)
    cell_perform(0, 2, 'Vol', chart.fg_color, text.align_left)
    cell_perform(1, 2, str.tostring(curr_cum_vol / 100000, '#.##') + ' L', vol_pchg_col, text.align_right)
    cell_perform(0, 3, 'PD Vol', chart.fg_color, text.align_left)
    cell_perform(1, 3, str.tostring(prev_vol_safe / 100000, '#.##') + ' L', prev_vol_pchg_col, text.align_right)

//___________________________ Performance End

//___________________________ Additional Filters Start

// Pre-calculate common values
candle_range = high - low
body_size = math.abs(close - open)

// Combined filter conditions
pchg_above_filter = not i_pchg_filter or cum_pchg > i_pchg_above_below
pchg_below_filter = not i_pchg_filter or cum_pchg < -i_pchg_above_below
vol_filter = not i_vol_filter or curr_cum_vol >= i_vol_above
vol_pchg_filter = not i_vol_pchg_filter or cum_vol_pchg >= i_vol_pchg_above

// ATR Filter
atr_filter = not i_atr_filter or candle_range > ta.atr(i_atr_length) * i_atr_multi

// Body Filters
body_filter = not i_body_filter or candle_range > 0 and body_size / candle_range >= i_body_percent
body_size_filter = not i_body_size_filter or candle_range > 0 and body_size / candle_range >= i_body_percent and candle_range >= (high[1] - low[1]) * i_body_size_multi

// Volume Filters
volume_filter = not i_volume_filter or volume > ta.sma(volume, i_vol_sma_length)

// Relative Volume Filter
var bool rel_vol_filter = true
if i_rel_vol_filter
    average_volume = ta.sma(volume, i_rel_vol_avg_vol_len)
    relative_volume = volume / nz(average_volume[1], volume)
    rel_vol_sma_multiplier = ta.sma(relative_volume, i_rel_vol_avg_vol_len) * i_rel_vol_avg_vol_multi
    rel_vol_filter := relative_volume > rel_vol_sma_multiplier

// Time Filter
time_filter = 
 not i_time_filter or 
 (hour > i_hour_1 or hour == i_hour_1 and minute >= i_minute_1) and 
 (hour < i_hour_2 or hour == i_hour_2 and minute < i_minute_2)

// Date Filter
date_filter = not i_date_filter or year == i_year and month == i_month and dayofmonth == i_day

//___________________________ Additional Filters End

//___________________________ RSI Start

// Acknowledgement & Reference
// Trader: 'TradingView'
// Indicator Title: Built-in Relative Strength Index, RSI Divergence Indicator

color no_color = #00000000

// RSI Calculation
float rsi = ta.rsi(i_rsi_src, i_rsi_len)
float rsi_ma = ta.sma(rsi, i_rsi_ma_len)

// RSI Plot
plot(series = rsi, title = 'RSI', color = i_indicator_color, linewidth = 2)
plot(series = rsi_ma, title = 'RSI Moving Average', color = i_signal_color)

// RSI Bands
float overbought = 70
float breakout = 60
float middle = 50
float breakdown = 40
float oversold = 30
hline(price = overbought, title = 'Band Overbought', color = color.new(i_neg_color, 50), linestyle = hline.style_dotted)
band_ub = hline(price = breakout, title = 'Band Bullish', color = color.new(i_neu_color, 50), linestyle = hline.style_dotted)
hline(price = middle, title = 'Band Middle', color = color.new(i_neu_color, 50), linestyle = hline.style_dotted)
band_lb = hline(price = breakdown, title = 'Band Bearish', color = color.new(i_neu_color, 50), linestyle = hline.style_dotted)
hline(price = oversold, title = 'Band Oversold', color = color.new(i_pos_color, 50), linestyle = hline.style_dotted)
fill(hline1 = band_ub, hline2 = band_lb, color = color.new(i_neu_color, 95), title = 'Fill Middle')

// Divergence Calculation
_inRange(cond) =>
    bars = ta.barssince(cond)
    i_rsi_range_min <= bars and bars <= i_rsi_range_max

bool plFound = not na(ta.pivotlow(rsi, i_rsi_p_left, i_rsi_p_right))
bool phFound = not na(ta.pivothigh(rsi, i_rsi_p_left, i_rsi_p_right))
float rsiLBR = rsi[i_rsi_p_right]
float lowLBR = low[i_rsi_p_right]
float highLBR = high[i_rsi_p_right]

// Bull Divergence
rsiHL = rsiLBR > ta.valuewhen(plFound, rsiLBR, 1) and _inRange(plFound[1])
priceLL = lowLBR < ta.valuewhen(plFound, lowLBR, 1)
bullDiv = i_scn_choose == 'Divergence' and i_rsi_show_bull and priceLL and rsiHL and plFound

// Bear Divergence
rsiLH = rsiLBR < ta.valuewhen(phFound, rsiLBR, 1) and _inRange(phFound[1])
priceHH = highLBR > ta.valuewhen(phFound, highLBR, 1)
bearDiv = i_scn_choose == 'Divergence' and i_rsi_show_bear and priceHH and rsiLH and phFound

// Hidden Bullish
rsiLL = rsiLBR < ta.valuewhen(plFound, rsiLBR, 1) and _inRange(plFound[1])
priceHL = lowLBR > ta.valuewhen(plFound, lowLBR, 1)
hiddenBullDiv = i_scn_choose == 'Hidden Divergence' and i_rsi_show_hbull and priceHL and rsiLL and plFound

// Hidden Bearish
rsiHH = rsiLBR > ta.valuewhen(phFound, rsiLBR, 1) and _inRange(phFound[1])
priceLH = highLBR < ta.valuewhen(phFound, highLBR, 1)
hiddenBearDiv = i_scn_choose == 'Hidden Divergence' and i_rsi_show_hbear and priceLH and rsiHH and phFound

// Divergence Plots
// Underlay
plot(i_scn_choose == 'Divergence' and plFound ? rsiLBR : na, offset = -i_rsi_p_right, title = 'Line Bull Div', color = bullDiv ? i_pos_color : no_color, linewidth = 2, display = display.pane, editable = i_rsi_show_bull)
//plotshape(bullDiv ? rsiLBR : na, offset=-i_rsi_p_right, title="Label Bull Div", text=" Bull ", style=shape.labelup, location=location.absolute, color=i_pos_color, textcolor=i_neu_color, editable=i_rsi_show_bull)
plot(i_scn_choose == 'Divergence' and phFound ? rsiLBR : na, offset = -i_rsi_p_right, title = 'Line Bear Div', color = bearDiv ? i_neg_color : no_color, linewidth = 2, display = display.pane, editable = i_rsi_show_bear)
//plotshape(bearDiv ? rsiLBR : na, offset=-i_rsi_p_right, title="Label Bear Div", text=" Bear ", style=shape.labeldown, location=location.absolute, color=i_neg_color, textcolor=i_neu_color, editable=i_rsi_show_bear)
// Overlay
plot(i_scn_choose == 'Divergence' and plFound ? lowLBR : na, offset = -i_rsi_p_right, title = 'Line Bull Div Over', color = bullDiv ? i_pos_color : no_color, linewidth = 2, display = display.pane, force_overlay = true)
//plotshape(bullDiv ? lowLBR : na, offset=-i_rsi_p_right, title="Label Bull Div Over", text=" Bull ", style=shape.labelup, location=location.absolute, color=i_pos_color, textcolor=i_neu_color, force_overlay=true)
plot(i_scn_choose == 'Divergence' and phFound ? highLBR : na, offset = -i_rsi_p_right, title = 'Line Bear Div Over', color = bearDiv ? i_neg_color : no_color, linewidth = 2, display = display.pane, force_overlay = true)
//plotshape(bearDiv ? highLBR : na, offset=-i_rsi_p_right, title="Label Bear Div Over", text=" Bear ", style=shape.labeldown, location=location.absolute, color=i_neg_color, textcolor=i_neu_color, force_overlay=true)

// Underlay
plot(i_scn_choose == 'Hidden Divergence' and plFound ? rsiLBR : na, offset = -i_rsi_p_right, title = 'Line Hidden Bull Div', color = hiddenBullDiv ? i_pos_color : no_color, display = display.pane, editable = i_rsi_show_hbull)
//plotshape(hiddenBullDiv ? rsiLBR : na, offset=-i_rsi_p_right, title="Label Hidden Bull Div", text=" H Bull ", style=shape.labelup, location=location.absolute, color=i_pos_color, textcolor=i_neu_color, editable=i_rsi_show_hbull)
plot(i_scn_choose == 'Hidden Divergence' and phFound ? rsiLBR : na, offset = -i_rsi_p_right, title = 'Line Hidden Bear Div', color = hiddenBearDiv ? i_neg_color : no_color, display = display.pane, editable = i_rsi_show_hbear)
//plotshape(hiddenBearDiv ? rsiLBR : na, offset=-i_rsi_p_right, title="Label Hidden Bear Div", text=" H Bear ", style=shape.labeldown, location=location.absolute, color=i_neg_color, textcolor=i_neu_color, editable=i_rsi_show_hbear)
// Overlay
plot(i_scn_choose == 'Hidden Divergence' and plFound ? lowLBR : na, offset = -i_rsi_p_right, title = 'Line Hidden Bull Div Over', color = hiddenBullDiv ? i_pos_color : no_color, display = display.pane, force_overlay = true)
//plotshape(hiddenBullDiv ? lowLBR : na, offset=-i_rsi_p_right, title="Label Hidden Bull Div Over", text=" H Bull ", style=shape.labelup, location=location.absolute, color=i_pos_color, textcolor=i_neu_color, force_overlay=true)
plot(i_scn_choose == 'Hidden Divergence' and phFound ? highLBR : na, offset = -i_rsi_p_right, title = 'Line Hidden Bear Div Over', color = hiddenBearDiv ? i_neg_color : no_color, display = display.pane, force_overlay = true)
//plotshape(hiddenBearDiv ? highLBR : na, offset=-i_rsi_p_right, title="Label Hidden Bear Div Over", text=" H Bear ", style=shape.labeldown, location=location.absolute, color=i_neg_color, textcolor=i_neu_color, force_overlay=true)

//___________________________ RSI End

//___________________________ Signals Start

// Acknowledgement & Reference
// Trader: 'vitvlkv'
// Indicator Title: 'HOWTO: cond1 + cond2 = alert once'
// Indicator Link: 'https://www.tradingview.com/script/UHkEyCV3-HOWTO-cond1-cond2-alert-once/'

// State Machine for Continuous Signals
var int state = 0
state := nz(state[1]) == 3 or nz(state[1]) == 6 ? 0 : nz(state[1])

// Short Conditions
bool short_1 = 
 ta.crossunder(rsi, breakdown) and 
 rsi < rsi_ma and 
 (state == 0 or state >= 4 and state <= 5)

var float short_1_low = na
var float short_1_rsi = na
var int short_1_bar = na
if short_1
    short_1_low := low
    short_1_rsi := rsi
    short_1_bar := bar_index

bool short_2 = rsi > breakdown

bool short_3 = 
 not na(short_1_low) and 
 rsi < breakdown and 
 rsi < rsi_ma and 
 close < short_1_low and 
 //ta.crossunder(close, short_1_low) and 
 pchg_above_filter and 
 pchg_below_filter and 
 vol_filter and 
 vol_pchg_filter and 
 atr_filter and 
 body_filter and 
 body_size_filter and 
 volume_filter and 
 rel_vol_filter and 
 time_filter and 
 date_filter and 
 barstate.isconfirmed 

// Long Conditions
long_1 = 
 ta.crossover(rsi, breakout) and 
 rsi > rsi_ma and 
 (state == 0 or state >= 1 and state <= 2)

var float long_1_high = na
var float long_1_rsi = na
var int long_1_bar = na
if long_1
    long_1_high := high
    long_1_rsi := rsi
    long_1_bar := bar_index

long_2 = rsi < breakout

long_3 = 
 not na(long_1_high) and 
 rsi > breakout and 
 rsi > rsi_ma and 
 close > long_1_high and 
 //ta.crossover(close, long_1_high) and 
 pchg_above_filter and 
 pchg_below_filter and 
 vol_filter and 
 vol_pchg_filter and 
 atr_filter and 
 body_filter and 
 body_size_filter and 
 volume_filter and 
 rel_vol_filter and 
 time_filter and 
 date_filter and 
 barstate.isconfirmed

// State Transitions
if short_1
    state := 1
else if short_2 and state == 1
    state := 2
else if short_3 and state == 2
    state := 3
else if long_1
    state := 4
else if long_2 and state == 4
    state := 5
else if long_3 and state == 5
    state := 6

// Continuous Signals
short_cont_break = state == 3
long_cont_break = state == 6

//___________________________ Continuous Retracement Signals

// Fibonacci Levels for Continuous Signals
var float short_signal_high = na
var float short_signal_low = na
var int short_signal_bar = na
var float long_signal_high = na
var float long_signal_low = na
var int long_signal_bar = na

if short_cont_break
    short_signal_high := high
    short_signal_low := low
    short_signal_bar := bar_index

if long_cont_break
    long_signal_high := high
    long_signal_low := low
    long_signal_bar := bar_index

short_fib_val = 
 not na(short_signal_high) and not na(short_signal_low) ? 
 short_signal_high - (short_signal_high - short_signal_low) * i_rsi_fib_val : na

long_fib_val = 
 not na(long_signal_high) and not na(long_signal_low) ? 
 long_signal_low + (long_signal_high - long_signal_low) * i_rsi_fib_val : na

// Continuous Retracement Signals
var bool short_active = false
var bool long_active = false
var bool short_cont_ret_done = false
var bool long_cont_ret_done = false
var int short_ret_bar = na
var float short_ret_high = na
var int long_ret_bar = na
var float long_ret_low = na

if short_cont_break
    short_active := true
    long_active := false
    short_cont_ret_done := false
    long_cont_ret_done := false

if long_cont_break
    long_active := true
    short_active := false
    long_cont_ret_done := false
    short_cont_ret_done := false
 
short_cont_ret = 
 short_active and 
 not short_cont_ret_done and 
 not na(short_fib_val) and 
 ta.crossover(high, short_fib_val) and 
 high[1] < short_fib_val

long_cont_ret = 
 long_active and 
 not long_cont_ret_done and 
 not na(long_fib_val) and 
 ta.crossunder(low, long_fib_val) and 
 low[1] > long_fib_val

if short_cont_ret
    short_cont_ret_done := true
    short_ret_bar := bar_index
    short_ret_high := high
if long_cont_ret
    long_cont_ret_done := true
    long_ret_bar := bar_index
    long_ret_low := low
 
//___________________________ Flip Signals

// Acknowledgement & Reference
// Trader: 'vitvlkv'
// Indicator Title: 'HOWTO: Skip consecutive signals'
// Indicator Link: 'https://www.tradingview.com/script/2M9I2sgP-HOWTO-Skip-consecutive-signals/'

exrem(bool cond1, bool cond2) =>
    var int signal = 0
    signal := cond1 ? 1 : cond2 ? -1 : signal[1]
    bool entry = signal != signal[1]
    [entry and signal == 1, entry and signal == -1]

[long_flip_break, short_flip_break] = exrem(long_cont_break, short_cont_break)
[long_flip_ret, short_flip_ret] = exrem(long_cont_ret, short_cont_ret)

//___________________________ Plot Signal

choice_cont_ln = i_scn_choose == 'Continuous Break'
choice_cont_ret_ln = i_scn_choose == 'Continuous Retracement'

choice_cont = i_scn_choose == 'Continuous Break' or i_scn_choose == 'Continuous Retracement'
choice_cont_ret = i_scn_choose == 'Continuous Retracement'
choice_flip = i_scn_choose == 'Flip Break'
choice_flip_ret = i_scn_choose == 'Flip Retracement'

// Line Instances
f_drawLine(id, x1, y1, x2, y2, col) => 
    line.new(x1, y1, x2, y2, color=col, style=line.style_dotted, force_overlay=true)

var line short_line_1 = na
var line short_line_2 = na
var line long_line_1 = na
var line long_line_2 = na

if short_cont_break and choice_cont_ln and not na(short_1_low) and not na(short_signal_low) and not na(short_1_bar) and not na(short_signal_bar)
    short_line_1 := f_drawLine(short_line_1, short_1_bar, short_1_low, short_signal_bar, short_1_low, i_neg_color)

if short_cont_ret and choice_cont_ret_ln and not na(short_fib_val) and not na(short_ret_high) and not na(short_signal_bar) and not na(short_ret_bar)
    short_line_2 := f_drawLine(short_line_2, short_signal_bar, short_fib_val, short_ret_bar, short_fib_val, i_neg_color)

if long_cont_break and choice_cont_ln and not na(long_1_high) and not na(long_signal_high) and not na(long_1_bar) and not na(long_signal_bar)
    long_line_1 := f_drawLine(long_line_1, long_1_bar, long_1_high, long_signal_bar, long_1_high, i_pos_color)

if long_cont_ret and choice_cont_ret_ln and not na(long_fib_val) and not na(long_ret_low) and not na(long_signal_bar) and not na(long_ret_bar)
    long_line_2 := f_drawLine(long_line_2, long_signal_bar, long_fib_val, long_ret_bar, long_fib_val, i_pos_color)

// Continuous 1st Alert
plotshape(i_scn_show_short and choice_cont ? short_1 : false, title = 'Cont 1st Short', style = shape.circle, location = location.abovebar, color = i_neg_light_color, size = size.auto, force_overlay = true)
plotshape(i_scn_show_long and choice_cont ? long_1 : false, title = 'Cont 1st Long', style = shape.circle, location = location.belowbar, color = i_pos_light_color, size = size.auto, force_overlay = true)
barcolor(i_scn_show_short and choice_cont and short_1 ? i_neg_light_color : i_scn_show_long and choice_cont and long_1 ? i_pos_light_color : na, title = 'Cont 1st Candle')
//bgcolor(i_scn_show_short and choice_cont and short_1 ? color.new(i_neg_light_color, 90) : i_scn_show_long and choice_cont and long_1 ? color.new(i_pos_light_color, 90) : na, title="Cont 1st Bgcolor")

// Continuous 2nd Breakout
plotshape(i_scn_show_short and choice_cont ? short_cont_break : false, title = 'Cont 2nd Short', style = shape.triangledown, location = location.abovebar, color = i_neg_light_color, text = '2', textcolor = i_neg_light_color, size = size.auto, force_overlay = true)
plotshape(i_scn_show_long and choice_cont ? long_cont_break : false, title = 'Cont 2nd Long', style = shape.triangleup, location = location.belowbar, color = i_pos_light_color, text = '2', textcolor = i_pos_light_color, size = size.auto, force_overlay = true)
barcolor(i_scn_show_short and choice_cont and short_cont_break ? i_neg_light_color : i_scn_show_long and choice_cont and long_cont_break ? i_pos_light_color : na, title = 'Cont 2nd Candle')
bgcolor(i_scn_show_short and choice_cont and short_cont_break ? color.new(i_neg_light_color, 90) : i_scn_show_long and choice_cont and long_cont_break ? color.new(i_pos_light_color, 90) : na, title = 'Cont 2nd Bgcolor')

// Continuous 3rd Retracement
plotshape(i_scn_show_short and choice_cont_ret ? short_cont_ret : false, title = 'Cont 3rd Short', style = shape.triangledown, location = location.abovebar, color = i_neg_light_color, text = '3', textcolor = i_neg_light_color, size = size.auto, force_overlay = true)
plotshape(i_scn_show_long and choice_cont_ret ? long_cont_ret : false, title = 'Cont 3rd Long', style = shape.triangleup, location = location.belowbar, color = i_pos_light_color, text = '3', textcolor = i_pos_light_color, size = size.auto, force_overlay = true)
barcolor(i_scn_show_short and choice_cont_ret and short_cont_ret ? i_neg_light_color : i_scn_show_long and choice_cont_ret and long_cont_ret ? i_pos_light_color : na, title = 'Cont 3rd Candle')
bgcolor(i_scn_show_short and choice_cont_ret and short_cont_ret ? color.new(i_neg_light_color, 90) : i_scn_show_long and choice_cont_ret and long_cont_ret ? color.new(i_pos_light_color, 90) : na, title = 'Cont 3rd Bgcolor')

// Flip 2nd Breakout
plotshape(i_scn_show_short and choice_flip ? short_flip_break : false, title = 'Flip 2nd Short', style = shape.triangledown, location = location.abovebar, color = i_neg_light_color, text = '2', textcolor = i_neg_light_color, size = size.auto, force_overlay = true)
plotshape(i_scn_show_long and choice_flip ? long_flip_break : false, title = 'Flip 2nd Long', style = shape.triangleup, location = location.belowbar, color = i_pos_light_color, text = '2', textcolor = i_pos_light_color, size = size.auto, force_overlay = true)
barcolor(i_scn_show_short and choice_flip and short_flip_break ? i_neg_light_color : i_scn_show_long and choice_flip and long_flip_break ? i_pos_light_color : na, title = 'Flip 2nd Candle')
bgcolor(i_scn_show_short and choice_flip and short_flip_break ? color.new(i_neg_light_color, 90) : i_scn_show_long and choice_flip and long_flip_break ? color.new(i_pos_light_color, 90) : na, title = 'Flip 2nd Bgcolor')

// Flip 3rd Retracement
plotshape(i_scn_show_short and choice_flip_ret ? short_flip_ret : false, title = 'Flip 3rd Short', style = shape.triangledown, location = location.abovebar, color = i_neg_light_color, text = '3', textcolor = i_neg_light_color, size = size.auto, force_overlay = true)
plotshape(i_scn_show_long and choice_flip_ret ? long_flip_ret : false, title = 'Flip 3rd Long', style = shape.triangleup, location = location.belowbar, color = i_pos_light_color, text = '3', textcolor = i_pos_light_color, size = size.auto, force_overlay = true)
barcolor(i_scn_show_short and choice_flip_ret and short_flip_ret ? i_neg_light_color : i_scn_show_long and choice_flip_ret and long_flip_ret ? i_pos_light_color : na, title = 'Flip 3rd Candle')
bgcolor(i_scn_show_short and choice_flip_ret and short_flip_ret ? color.new(i_neg_light_color, 90) : i_scn_show_long and choice_flip_ret and long_flip_ret ? color.new(i_pos_light_color, 90) : na, title = 'Flip 3rd Bgcolor')

//___________________________ Signals End

//___________________________ Code End

// Read Me First
// 
// Indicator Title: "Momentum Setup: RSI Directional Momentum Scanner"
// 
// Overview
//  - Upgraded From: "Momentum Setup: RSI Confirmed Direction Scanner".
//  - Improvements: Optimized for speed, refined signals, better performance.
// 
// Features
// - Scanning Methods:
//   - Continuous Break: RSI breakout signals.
//   - Continuous Retracement: Fibonacci retracement after break.
//   - Flip Break: Failed break flips trade direction.
//   - Flip Retracement: Failed retracement flips trade.
//   - Divergence: Price vs. RSI divergence.
//   - Hidden Divergence: Trend continuation signals.
//  
// Note: Read tooltips for more clarity.
// 
// Questions?: Message the author on TradingView: https://www.tradingview.com/u/Arun_K_Bhaskar/
// 
// More Indicators: Free TradingView indicators and source code on GitHub: https://github.com/ArunKBhaskar/PineScript
##-- File Name: PineScript-main/Momentum Setup - RSI Directional Momentum/[Indicator] Momentum Setup - RSI Directional Momentum.txt | File No: 32 | Ended --##

##-- File Name: PineScript-main/Momentum Setup - RSI Directional Momentum/[Readme] Momentum Setup - RSI Directional Momentum.txt | File No: 33 | Started --##

// Read Me First
// 
// Indicator Title: "Momentum Setup - RSI Directional Momentum Scanner"
// 
// Overview
//  - Upgraded From: "Momentum Setup: RSI Confirmed Direction Scanner".
//  - Improvements: Optimized for speed, refined signals, better performance.
// 
// Features
// - Scanning Methods:
//   - Continuous Break: RSI breakout signals.
//   - Continuous Retracement: Fibonacci retracement after break.
//   - Flip Break: Failed break flips trade direction.
//   - Flip Retracement: Failed retracement flips trade.
//   - Divergence: Price vs. RSI divergence.
//   - Hidden Divergence: Trend continuation signals.
//  
// Note: Read tooltips for more clarity.
// 
// Questions?: Message the author on TradingView: https://www.tradingview.com/u/Arun_K_Bhaskar/
// 
// More Indicators: Free TradingView indicators and source code on GitHub: https://github.com/ArunKBhaskar/PineScript

##-- File Name: PineScript-main/Momentum Setup - RSI Directional Momentum/[Readme] Momentum Setup - RSI Directional Momentum.txt | File No: 33 | Ended --##

##-- File Name: PineScript-main/Momentum Setup - RSI Directional Momentum/[Scanner] Momentum Setup - RSI Directional Momentum.txt | File No: 34 | Started --##
// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © Arun_K_Bhaskar

//@version=6
indicator(title = 'Momentum Setup - RSI Directional Momentum Scanner', shorttitle = 'RSIDMScan', behind_chart = false)

//___________________________ Menu Start

string g_scn_tb = '█████████████████ Scanner █████████████████'

string tt_ch = 
 "Continuous Break:" + 
 "\n• Buy: RSI crosses above 60, dips below, then breaks the previous high while staying above 60." + 
 "\n• Sell: RSI crosses below 40, rises above, then breaks the previous low while staying below 40." +

 "\n\n Continuous Retracement:" + 
 "\n• After a Continuous Break, a Fibonacci level is set." +
 "\n• Buy: Price retraces to this level and bounces." +
 "\n• Sell: Price retraces to this level and drops." +

 "\n\n Flip Break:" + 
 "\n• If a Continuous Break fails, the trade flips (Long → Short, Short → Long)." + 

 "\n\n Flip Retracement:" + 
 "\n• If a Continuous Retracement fails, the trade flips (Long → Short, Short → Long)." + 

 "\n\n Divergence:" + 
 "\n• Buy: Price makes a lower low, RSI makes a higher low." + 
 "\n• Sell: Price makes a higher high, RSI makes a lower high." + 

 "\n\n Hidden Divergence (Trend continuation):" + 
 "\n• Buy: Price makes a higher low, RSI makes a lower low." + 
 "\n• Sell: Price makes a lower high, RSI makes a higher high."

string tt_is = 
 "• Reads only the first 40 symbols." + 
 "\n• Max 4096 characters." + 
 "\n• Format: EXCHANGE:SYMBOL_A,EXCHANGE:SYMBOL_B"

string i_scn_choose = input.string(
 defval = 'Continuous Break', 
 title = 'Scanning Method', 
 options = ['Continuous Break', 'Continuous Retracement', 'Flip Break', 'Flip Retracement', 'Divergence', 'Hidden Divergence'], tooltip = tt_ch, group = g_scn_tb)

string i_symbols = input.text_area(
 defval = 'NSE:ABCAPITAL,NSE:ABFRL,NSE:ASHOKLEY,NSE:BANDHANBNK,NSE:BANKBARODA,NSE:BANKINDIA,NSE:BEL,NSE:BHEL,NSE:BIOCON,NSE:BPCL,NSE:CESC,NSE:DELHIVERY,NSE:FEDERALBNK,NSE:GAIL,NSE:HINDCOPPER,NSE:HUDCO,NSE:IEX,NSE:IGL,NSE:IIFL,NSE:INDUSTOWER,NSE:IOC,NSE:IREDA,NSE:IRFC,NSE:JIOFIN,NSE:LTF,NSE:MANAPPURAM,NSE:MOTHERSON,NSE:M_MFIN,NSE:NATIONALUM,NSE:NCC,NSE:NYKAA,NSE:ONGC,NSE:PETRONET,NSE:POONAWALLA,NSE:POWERGRID,NSE:RBLBANK,NSE:SAIL,NSE:TATASTEEL,NSE:UNIONBANK,NSE:ZOMATO', 
 title = 'Paste Symbols', tooltip = tt_is, group = g_scn_tb)

bool i_scn_show_table = input.bool(defval = true, title = 'Display Table', group = g_scn_tb)
bool i_scn_show_long = input.bool(defval = true, title = 'Long Signals', inline = 'tb_2', group = g_scn_tb)
bool i_scn_show_short = input.bool(defval = true, title = 'Short Signals', inline = 'tb_2', group = g_scn_tb)

int i_scn_tbl_show_rows = input.int(defval = 12, title = 'Display Rows', minval = 0, maxval = 100, group = g_scn_tb)
string i_scn_tbl_pos = input.string(defval = position.bottom_left, title = 'Table Position', options = [position.top_left, position.top_center, position.top_right, position.middle_left, position.middle_center, position.middle_right, position.bottom_left, position.bottom_center, position.bottom_right], group = g_scn_tb)
string i_scn_tbl_txt_size = input.string(defval = size.small, title = 'Table Size', options = [size.auto, size.tiny, size.small, size.normal, size.large, size.huge], group = g_scn_tb)

string g_rsi = '██████████ Relative Strength Index (RSI) ██████████'
string tt_ret_fib = 
 "• 0: Bottom of bullish & top of bearish breaking candle." + 
 "\n• 1: Top of bullish & bottom of bearish breaking candle." + 
 "\n• 0.5: 50% of the breaking candle."
int i_rsi_len = input.int(defval = 14, title = 'RSI Length', minval = 1, group = g_rsi)
float i_rsi_src = input.source(defval = close, title = 'RSI Source', group = g_rsi)
int i_rsi_ma_len = input.int(defval = 14, title = 'SMA Length', minval = 1, group = g_rsi)
float i_rsi_fib_val = input.float(defval = 0.5, title = 'Fib Value', step = 0.1, tooltip = tt_ret_fib, group = g_rsi)
bool i_rsi_show_bull = input.bool(defval = true, title = 'Display Bullish Divergence', group = g_rsi)
bool i_rsi_show_bear = input.bool(defval = true, title = 'Display Bearish Divergence', group = g_rsi)
bool i_rsi_show_hbull = input.bool(defval = true, title = 'Display Hidden Bullish Divergence', group = g_rsi)
bool i_rsi_show_hbear = input.bool(defval = true, title = 'Display Hidden Bearish Divergence', group = g_rsi)
int i_rsi_p_right = input.int(defval = 5, title = 'Pivot Lookback Right', group = g_rsi)
int i_rsi_p_left = input.int(defval = 5, title = 'Pivot Lookback Left', group = g_rsi)
int i_rsi_range_max = input.int(defval = 60, title = 'Max of Lookback Range', group = g_rsi)
int i_rsi_range_min = input.int(defval = 5, title = 'Min of Lookback Range', group = g_rsi)

string g_af = '██████████████ Additional Fiters ██████████████'

string tt_pchg = 
 "• Percentage change of the day." 
string tt_vpchg = 
 "• 0% means today's volume must exceed the previous day's." + 
 "\n• 300%+ often signals a major breakout (today or next day)."
string tt_atr = "• Filters out longer or more volatile signal candles."
string tt_atr_mul = "• Higher values filter longer or more volatile candles."
string tt_bf = "• 80 means the body covers 80%+ of the candle."
string tt_bs = "• 2 means the candle is twice the size of the previous one."
string tt_vol = "• Filter candles with volume > SMA of volume."
string tt_rv = "• Filter candles with volume > Relative Volume."
string tt_tf = "• Filter signals within a given time."
string tt_df = "• Filter signals on specified dates (for Break Candles (2) only)."

bool i_pchg_filter = input.bool(defval = false, title = 'Apply % Change Filter', tooltip = tt_pchg, group = g_af)
float i_pchg_above_below = input.float(defval = 2, title = '% Change Above/Below +/-', minval = 0, group = g_af)

bool i_vol_filter = input.bool(defval = false, title = 'Apply Volume Filter', tooltip = tt_vpchg, group = g_af)
int i_vol_above = input.int(defval = 500000, title = 'Volume Above', minval = 0, group = g_af)

bool i_vol_pchg_filter = input.bool(defval = false, title = 'Apply Volume % Change Filter', tooltip = tt_vpchg, group = g_af)
float i_vol_pchg_above = input.float(defval = 0, title = 'Volume % Change Above', minval = 0, group = g_af)

bool i_atr_filter = input.bool(defval = false, title = 'Apply ATR Filter', tooltip = tt_atr, group = g_af)
int i_atr_length = input.int(defval = 14, minval = 1, title = 'ATR Length', group = g_af)
float i_atr_multi = input.float(defval = 1, title = 'ATR Multiplier', minval = 1, group = g_af)

bool i_body_filter = input.bool(defval = false, title = 'Apply Body % Filter', tooltip = tt_bf, group = g_af)
float i_body_percent = input.float(defval = 70, title = 'Body % Above', minval = 0, maxval = 100, group = g_af) / 100

bool i_body_size_filter = input.bool(defval = false, title = 'Apply Body Size Filter', tooltip = tt_bs, group = g_af)
int i_body_size_multi = input.int(defval = 2, title = 'Body Size Multiplier (x)', minval = 0, group = g_af)

bool i_volume_filter = input.bool(defval = false, title = 'Apply Volume Filter', tooltip = tt_vol, group = g_af)
int i_vol_sma_length = input.int(defval = 20, minval = 1, title = 'Volume SMA Length', group = g_af)

bool i_rel_vol_filter = input.bool(defval = false, title = 'Apply Relative Volume Filter', tooltip = tt_rv, group = g_af)
int i_rel_vol_avg_vol_len = input.int(defval = 90, title = 'Relative Volume Length', minval = 2, group = g_af)
float i_rel_vol_avg_vol_multi = input.float(defval = 5, title = 'Rel Vol SMA Multiplier', minval = 0, group = g_af)

bool i_time_filter = input.bool(defval = false, title = 'Apply Time Filter', tooltip = tt_tf, group = g_af)
int i_hour_1 = input.int(defval = 9, minval = 0, title = 'Time From', inline = 't_1', group = g_af)
int i_minute_1 = input.int(defval = 15, minval = 0, title = ':', inline = 't_1', group = g_af)
int i_hour_2 = input.int(defval = 10, minval = 0, title = 'Time To ', inline = 't_2', group = g_af)
int i_minute_2 = input.int(defval = 15, minval = 0, title = ':', inline = 't_2', group = g_af)

bool i_date_filter = input.bool(defval = false, title = 'Apply Date Filter', tooltip = tt_df, group = g_af)
int i_day = input.int(defval = 25, minval = 1, maxval = 31, title = 'Day', group = g_af)
int i_month = input.int(defval = 10, minval = 1, maxval = 12, title = 'Month', group = g_af)
int i_year = input.int(defval = 2024, minval = 0, title = 'Year', group = g_af)

string g_cum = '█████████████ Performance Table █████████████'
bool i_cum_tbl_disp = input.bool(defval = true, title = 'Display', group = g_cum)
string i_cum_tbl_pos = input.string(defval = position.bottom_right, title = 'Position', options = [position.top_left, position.top_center, position.top_right, position.middle_left, position.middle_center, position.middle_right, position.bottom_left, position.bottom_center, position.bottom_right], group = g_cum)
string i_cum_tbl_size = input.string(defval = size.normal, title = 'Size', options = [size.auto, size.tiny, size.small, size.normal, size.large, size.huge], group = g_cum)

//string g_ch = '█████████████████ Colors █████████████████'
color i_pos_color = #089981 //input.color(defval = #089981, title = 'Positive', group = g_ch)
color i_pos_light_color = #70CCBD //input.color(defval = #70CCBD, title = 'Positive Light', group = g_ch)
color i_neg_light_color = #FAA1A4 //input.color(defval = #FAA1A4, title = 'Negative Light', group = g_ch)
color i_neg_color = #F23645 //input.color(defval = #F23645, title = 'Negative', group = g_ch)
color i_indicator_color = #2962FF //input.color(defval = #2962FF, title = 'Indicator', group = g_ch)
color i_signal_color = #FF6D00 //input.color(defval = #FF6D00, title = 'Signal', group = g_ch)
color i_neu_color = #D1D4DC //input.color(defval = #D1D4DC, title = 'Neutral Light', group = g_ch)
color i_neu_dark_color = #0F0F0F //input.color(defval = #0F0F0F, title = 'Neutral', group = g_ch)

//___________________________ Menu End

//___________________________ Performance Start

is_new_day = ta.change(time('D')) != 0

// Cumulative Percentage Change
var float cum_pchg = na
day_pchg = na(close[1]) ? 0 : (close - close[1]) / close[1] * 100
cum_pchg := is_new_day ? day_pchg : na(cum_pchg) ? day_pchg : cum_pchg + day_pchg

// Cumulative Volume and Volume Percentage Change
var float curr_cum_vol = na
var float prev_cum_vol = na
if is_new_day
    prev_cum_vol := curr_cum_vol
    curr_cum_vol := volume
    curr_cum_vol
else
    curr_cum_vol := na(curr_cum_vol) ? volume : curr_cum_vol + volume
    curr_cum_vol
prev_vol_safe = nz(prev_cum_vol, curr_cum_vol)
cum_vol_pchg = (curr_cum_vol - prev_vol_safe) / prev_vol_safe * 100

var table tbl_cum = table.new(position=i_cum_tbl_pos, columns=2, rows=4, border_width=1, force_overlay=true)

cell_perform(col, row, txt, txt_color, aligh) =>
    table.cell(tbl_cum, col, row, txt, text_color=txt_color, text_halign=aligh, bgcolor=i_neu_dark_color, text_size=i_cum_tbl_size)

if barstate.islast and i_cum_tbl_disp
    pchg_col = cum_pchg > 0 ? i_pos_color : i_neg_color
    vol_pchg_col = cum_vol_pchg > 0 ? i_pos_color : i_neg_color
    prev_vol_pchg_col = prev_vol_safe < curr_cum_vol ? i_neg_color : i_pos_color
    
    cell_perform(0, 0, '%Chg', chart.fg_color, text.align_left)
    cell_perform(1, 0, str.tostring(cum_pchg, '#.##') + ' %', pchg_col, text.align_right)
    cell_perform(0, 1, 'Vol %Chg', chart.fg_color, text.align_left)
    cell_perform(1, 1, str.tostring(cum_vol_pchg, '#.##') + ' %', vol_pchg_col, text.align_right)
    cell_perform(0, 2, 'Vol', chart.fg_color, text.align_left)
    cell_perform(1, 2, str.tostring(curr_cum_vol / 100000, '#.##') + ' L', vol_pchg_col, text.align_right)
    cell_perform(0, 3, 'PD Vol', chart.fg_color, text.align_left)
    cell_perform(1, 3, str.tostring(prev_vol_safe / 100000, '#.##') + ' L', prev_vol_pchg_col, text.align_right)

//___________________________ Performance End

//___________________________ Additional Filters Start

// Pre-calculate common values
candle_range = high - low
body_size = math.abs(close - open)

// Combined filter conditions
pchg_above_filter = not i_pchg_filter or cum_pchg > i_pchg_above_below
pchg_below_filter = not i_pchg_filter or cum_pchg < -i_pchg_above_below
vol_filter = not i_vol_filter or curr_cum_vol >= i_vol_above
vol_pchg_filter = not i_vol_pchg_filter or cum_vol_pchg >= i_vol_pchg_above

// ATR Filter
atr_filter = not i_atr_filter or candle_range > ta.atr(i_atr_length) * i_atr_multi

// Body Filters
body_filter = not i_body_filter or candle_range > 0 and body_size / candle_range >= i_body_percent
body_size_filter = not i_body_size_filter or candle_range > 0 and body_size / candle_range >= i_body_percent and candle_range >= (high[1] - low[1]) * i_body_size_multi

// Volume Filters
volume_filter = not i_volume_filter or volume > ta.sma(volume, i_vol_sma_length)

// Relative Volume Filter
var bool rel_vol_filter = true
if i_rel_vol_filter
    average_volume = ta.sma(volume, i_rel_vol_avg_vol_len)
    relative_volume = volume / nz(average_volume[1], volume)
    rel_vol_sma_multiplier = ta.sma(relative_volume, i_rel_vol_avg_vol_len) * i_rel_vol_avg_vol_multi
    rel_vol_filter := relative_volume > rel_vol_sma_multiplier

// Time Filter
time_filter = 
 not i_time_filter or 
 (hour > i_hour_1 or hour == i_hour_1 and minute >= i_minute_1) and 
 (hour < i_hour_2 or hour == i_hour_2 and minute < i_minute_2)

// Date Filter
date_filter = not i_date_filter or year == i_year and month == i_month and dayofmonth == i_day

//___________________________ Additional Filters End

//___________________________ RSI Start

// Acknowledgement & Reference
// Trader: 'TradingView'
// Indicator Title: Built-in Relative Strength Index, RSI Divergence Indicator

color no_color = #00000000

// RSI Calculation
float rsi = ta.rsi(i_rsi_src, i_rsi_len)
float rsi_ma = ta.sma(rsi, i_rsi_ma_len)

// RSI Plot
plot(series = rsi, title = 'RSI', color = i_indicator_color, linewidth = 2)
plot(series = rsi_ma, title = 'RSI Moving Average', color = i_signal_color)

// RSI Bands
float overbought = 70
float breakout = 60
float middle = 50
float breakdown = 40
float oversold = 30
hline(price = overbought, title = 'Band Overbought', color = color.new(i_neg_color, 50), linestyle = hline.style_dotted)
band_ub = hline(price = breakout, title = 'Band Bullish', color = color.new(i_neu_color, 50), linestyle = hline.style_dotted)
hline(price = middle, title = 'Band Middle', color = color.new(i_neu_color, 50), linestyle = hline.style_dotted)
band_lb = hline(price = breakdown, title = 'Band Bearish', color = color.new(i_neu_color, 50), linestyle = hline.style_dotted)
hline(price = oversold, title = 'Band Oversold', color = color.new(i_pos_color, 50), linestyle = hline.style_dotted)
fill(hline1 = band_ub, hline2 = band_lb, color = color.new(i_neu_color, 95), title = 'Fill Middle')

// Divergence Calculation
_inRange(cond) =>
    bars = ta.barssince(cond)
    i_rsi_range_min <= bars and bars <= i_rsi_range_max

bool plFound = not na(ta.pivotlow(rsi, i_rsi_p_left, i_rsi_p_right))
bool phFound = not na(ta.pivothigh(rsi, i_rsi_p_left, i_rsi_p_right))
float rsiLBR = rsi[i_rsi_p_right]
float lowLBR = low[i_rsi_p_right]
float highLBR = high[i_rsi_p_right]

// Bull Divergence
rsiHL = rsiLBR > ta.valuewhen(plFound, rsiLBR, 1) and _inRange(plFound[1])
priceLL = lowLBR < ta.valuewhen(plFound, lowLBR, 1)
bullDiv = i_scn_choose == 'Divergence' and i_rsi_show_bull and priceLL and rsiHL and plFound

// Bear Divergence
rsiLH = rsiLBR < ta.valuewhen(phFound, rsiLBR, 1) and _inRange(phFound[1])
priceHH = highLBR > ta.valuewhen(phFound, highLBR, 1)
bearDiv = i_scn_choose == 'Divergence' and i_rsi_show_bear and priceHH and rsiLH and phFound

// Hidden Bullish
rsiLL = rsiLBR < ta.valuewhen(plFound, rsiLBR, 1) and _inRange(plFound[1])
priceHL = lowLBR > ta.valuewhen(plFound, lowLBR, 1)
hiddenBullDiv = i_scn_choose == 'Hidden Divergence' and i_rsi_show_hbull and priceHL and rsiLL and plFound

// Hidden Bearish
rsiHH = rsiLBR > ta.valuewhen(phFound, rsiLBR, 1) and _inRange(phFound[1])
priceLH = highLBR < ta.valuewhen(phFound, highLBR, 1)
hiddenBearDiv = i_scn_choose == 'Hidden Divergence' and i_rsi_show_hbear and priceLH and rsiHH and phFound

// Divergence Plots
// Underlay
plot(i_scn_choose == 'Divergence' and plFound ? rsiLBR : na, offset = -i_rsi_p_right, title = 'Line Bull Div', color = bullDiv ? i_pos_color : no_color, linewidth = 2, display = display.pane, editable = i_rsi_show_bull)
//plotshape(bullDiv ? rsiLBR : na, offset=-i_rsi_p_right, title="Label Bull Div", text=" Bull ", style=shape.labelup, location=location.absolute, color=i_pos_color, textcolor=i_neu_color, editable=i_rsi_show_bull)
plot(i_scn_choose == 'Divergence' and phFound ? rsiLBR : na, offset = -i_rsi_p_right, title = 'Line Bear Div', color = bearDiv ? i_neg_color : no_color, linewidth = 2, display = display.pane, editable = i_rsi_show_bear)
//plotshape(bearDiv ? rsiLBR : na, offset=-i_rsi_p_right, title="Label Bear Div", text=" Bear ", style=shape.labeldown, location=location.absolute, color=i_neg_color, textcolor=i_neu_color, editable=i_rsi_show_bear)
// Overlay
plot(i_scn_choose == 'Divergence' and plFound ? lowLBR : na, offset = -i_rsi_p_right, title = 'Line Bull Div Over', color = bullDiv ? i_pos_color : no_color, linewidth = 2, display = display.pane, force_overlay = true)
//plotshape(bullDiv ? lowLBR : na, offset=-i_rsi_p_right, title="Label Bull Div Over", text=" Bull ", style=shape.labelup, location=location.absolute, color=i_pos_color, textcolor=i_neu_color, force_overlay=true)
plot(i_scn_choose == 'Divergence' and phFound ? highLBR : na, offset = -i_rsi_p_right, title = 'Line Bear Div Over', color = bearDiv ? i_neg_color : no_color, linewidth = 2, display = display.pane, force_overlay = true)
//plotshape(bearDiv ? highLBR : na, offset=-i_rsi_p_right, title="Label Bear Div Over", text=" Bear ", style=shape.labeldown, location=location.absolute, color=i_neg_color, textcolor=i_neu_color, force_overlay=true)

// Underlay
plot(i_scn_choose == 'Hidden Divergence' and plFound ? rsiLBR : na, offset = -i_rsi_p_right, title = 'Line Hidden Bull Div', color = hiddenBullDiv ? i_pos_color : no_color, display = display.pane, editable = i_rsi_show_hbull)
//plotshape(hiddenBullDiv ? rsiLBR : na, offset=-i_rsi_p_right, title="Label Hidden Bull Div", text=" H Bull ", style=shape.labelup, location=location.absolute, color=i_pos_color, textcolor=i_neu_color, editable=i_rsi_show_hbull)
plot(i_scn_choose == 'Hidden Divergence' and phFound ? rsiLBR : na, offset = -i_rsi_p_right, title = 'Line Hidden Bear Div', color = hiddenBearDiv ? i_neg_color : no_color, display = display.pane, editable = i_rsi_show_hbear)
//plotshape(hiddenBearDiv ? rsiLBR : na, offset=-i_rsi_p_right, title="Label Hidden Bear Div", text=" H Bear ", style=shape.labeldown, location=location.absolute, color=i_neg_color, textcolor=i_neu_color, editable=i_rsi_show_hbear)
// Overlay
plot(i_scn_choose == 'Hidden Divergence' and plFound ? lowLBR : na, offset = -i_rsi_p_right, title = 'Line Hidden Bull Div Over', color = hiddenBullDiv ? i_pos_color : no_color, display = display.pane, force_overlay = true)
//plotshape(hiddenBullDiv ? lowLBR : na, offset=-i_rsi_p_right, title="Label Hidden Bull Div Over", text=" H Bull ", style=shape.labelup, location=location.absolute, color=i_pos_color, textcolor=i_neu_color, force_overlay=true)
plot(i_scn_choose == 'Hidden Divergence' and phFound ? highLBR : na, offset = -i_rsi_p_right, title = 'Line Hidden Bear Div Over', color = hiddenBearDiv ? i_neg_color : no_color, display = display.pane, force_overlay = true)
//plotshape(hiddenBearDiv ? highLBR : na, offset=-i_rsi_p_right, title="Label Hidden Bear Div Over", text=" H Bear ", style=shape.labeldown, location=location.absolute, color=i_neg_color, textcolor=i_neu_color, force_overlay=true)

//___________________________ RSI End

//___________________________ Signals Start

// Acknowledgement & Reference
// Trader: 'vitvlkv'
// Indicator Title: 'HOWTO: cond1 + cond2 = alert once'
// Indicator Link: 'https://www.tradingview.com/script/UHkEyCV3-HOWTO-cond1-cond2-alert-once/'

// State Machine for Continuous Signals
var int state = 0
state := nz(state[1]) == 3 or nz(state[1]) == 6 ? 0 : nz(state[1])

// Short Conditions
bool short_1 = 
 ta.crossunder(rsi, breakdown) and 
 rsi < rsi_ma and 
 (state == 0 or state >= 4 and state <= 5)

var float short_1_low = na
var float short_1_rsi = na
var int short_1_bar = na
if short_1
    short_1_low := low
    short_1_rsi := rsi
    short_1_bar := bar_index

bool short_2 = rsi > breakdown

bool short_3 = 
 not na(short_1_low) and 
 rsi < breakdown and 
 rsi < rsi_ma and 
 close < short_1_low and 
 //ta.crossunder(close, short_1_low) and 
 pchg_above_filter and 
 pchg_below_filter and 
 vol_filter and 
 vol_pchg_filter and 
 atr_filter and 
 body_filter and 
 body_size_filter and 
 volume_filter and 
 rel_vol_filter and 
 time_filter and 
 date_filter and 
 barstate.isconfirmed 

// Long Conditions
long_1 = 
 ta.crossover(rsi, breakout) and 
 rsi > rsi_ma and 
 (state == 0 or state >= 1 and state <= 2)

var float long_1_high = na
var float long_1_rsi = na
var int long_1_bar = na
if long_1
    long_1_high := high
    long_1_rsi := rsi
    long_1_bar := bar_index

long_2 = rsi < breakout

long_3 = 
 not na(long_1_high) and 
 rsi > breakout and 
 rsi > rsi_ma and 
 close > long_1_high and 
 //ta.crossover(close, long_1_high) and 
 pchg_above_filter and 
 pchg_below_filter and 
 vol_filter and 
 vol_pchg_filter and 
 atr_filter and 
 body_filter and 
 body_size_filter and 
 volume_filter and 
 rel_vol_filter and 
 time_filter and 
 date_filter and 
 barstate.isconfirmed

// State Transitions
if short_1
    state := 1
else if short_2 and state == 1
    state := 2
else if short_3 and state == 2
    state := 3
else if long_1
    state := 4
else if long_2 and state == 4
    state := 5
else if long_3 and state == 5
    state := 6

// Continuous Signals
short_cont_break = state == 3
long_cont_break = state == 6

//___________________________ Continuous Retracement Signals

// Fibonacci Levels for Continuous Signals
var float short_signal_high = na
var float short_signal_low = na
var int short_signal_bar = na
var float long_signal_high = na
var float long_signal_low = na
var int long_signal_bar = na

if short_cont_break
    short_signal_high := high
    short_signal_low := low
    short_signal_bar := bar_index

if long_cont_break
    long_signal_high := high
    long_signal_low := low
    long_signal_bar := bar_index

short_fib_val = 
 not na(short_signal_high) and not na(short_signal_low) ? 
 short_signal_high - (short_signal_high - short_signal_low) * i_rsi_fib_val : na

long_fib_val = 
 not na(long_signal_high) and not na(long_signal_low) ? 
 long_signal_low + (long_signal_high - long_signal_low) * i_rsi_fib_val : na

// Continuous Retracement Signals
var bool short_active = false
var bool long_active = false
var bool short_cont_ret_done = false
var bool long_cont_ret_done = false
var int short_ret_bar = na
var float short_ret_high = na
var int long_ret_bar = na
var float long_ret_low = na

if short_cont_break
    short_active := true
    long_active := false
    short_cont_ret_done := false
    long_cont_ret_done := false

if long_cont_break
    long_active := true
    short_active := false
    long_cont_ret_done := false
    short_cont_ret_done := false
 
short_cont_ret = 
 short_active and 
 not short_cont_ret_done and 
 not na(short_fib_val) and 
 ta.crossover(high, short_fib_val) and 
 high[1] < short_fib_val

long_cont_ret = 
 long_active and 
 not long_cont_ret_done and 
 not na(long_fib_val) and 
 ta.crossunder(low, long_fib_val) and 
 low[1] > long_fib_val

if short_cont_ret
    short_cont_ret_done := true
    short_ret_bar := bar_index
    short_ret_high := high
if long_cont_ret
    long_cont_ret_done := true
    long_ret_bar := bar_index
    long_ret_low := low
 
//___________________________ Flip Signals

// Acknowledgement & Reference
// Trader: 'vitvlkv'
// Indicator Title: 'HOWTO: Skip consecutive signals'
// Indicator Link: 'https://www.tradingview.com/script/2M9I2sgP-HOWTO-Skip-consecutive-signals/'

exrem(bool cond1, bool cond2) =>
    var int signal = 0
    signal := cond1 ? 1 : cond2 ? -1 : signal[1]
    bool entry = signal != signal[1]
    [entry and signal == 1, entry and signal == -1]

[long_flip_break, short_flip_break] = exrem(long_cont_break, short_cont_break)
[long_flip_ret, short_flip_ret] = exrem(long_cont_ret, short_cont_ret)

//___________________________ Plot Signal

choice_cont_ln = i_scn_choose == 'Continuous Break'
choice_cont_ret_ln = i_scn_choose == 'Continuous Retracement'

choice_cont = i_scn_choose == 'Continuous Break' or i_scn_choose == 'Continuous Retracement'
choice_cont_ret = i_scn_choose == 'Continuous Retracement'
choice_flip = i_scn_choose == 'Flip Break'
choice_flip_ret = i_scn_choose == 'Flip Retracement'

// Line Instances
f_drawLine(id, x1, y1, x2, y2, col) => 
    line.new(x1, y1, x2, y2, color=col, style=line.style_dotted, force_overlay=true)

var line short_line_1 = na
var line short_line_2 = na
var line long_line_1 = na
var line long_line_2 = na

if short_cont_break and choice_cont_ln and not na(short_1_low) and not na(short_signal_low) and not na(short_1_bar) and not na(short_signal_bar)
    short_line_1 := f_drawLine(short_line_1, short_1_bar, short_1_low, short_signal_bar, short_1_low, i_neg_color)

if short_cont_ret and choice_cont_ret_ln and not na(short_fib_val) and not na(short_ret_high) and not na(short_signal_bar) and not na(short_ret_bar)
    short_line_2 := f_drawLine(short_line_2, short_signal_bar, short_fib_val, short_ret_bar, short_fib_val, i_neg_color)

if long_cont_break and choice_cont_ln and not na(long_1_high) and not na(long_signal_high) and not na(long_1_bar) and not na(long_signal_bar)
    long_line_1 := f_drawLine(long_line_1, long_1_bar, long_1_high, long_signal_bar, long_1_high, i_pos_color)

if long_cont_ret and choice_cont_ret_ln and not na(long_fib_val) and not na(long_ret_low) and not na(long_signal_bar) and not na(long_ret_bar)
    long_line_2 := f_drawLine(long_line_2, long_signal_bar, long_fib_val, long_ret_bar, long_fib_val, i_pos_color)

// Continuous 1st Alert
plotshape(i_scn_show_short and choice_cont ? short_1 : false, title = 'Cont 1st Short', style = shape.circle, location = location.abovebar, color = i_neg_light_color, size = size.auto, force_overlay = true)
plotshape(i_scn_show_long and choice_cont ? long_1 : false, title = 'Cont 1st Long', style = shape.circle, location = location.belowbar, color = i_pos_light_color, size = size.auto, force_overlay = true)
barcolor(i_scn_show_short and choice_cont and short_1 ? i_neg_light_color : i_scn_show_long and choice_cont and long_1 ? i_pos_light_color : na, title = 'Cont 1st Candle')
//bgcolor(i_scn_show_short and choice_cont and short_1 ? color.new(i_neg_light_color, 90) : i_scn_show_long and choice_cont and long_1 ? color.new(i_pos_light_color, 90) : na, title="Cont 1st Bgcolor")

// Continuous 2nd Breakout
plotshape(i_scn_show_short and choice_cont ? short_cont_break : false, title = 'Cont 2nd Short', style = shape.triangledown, location = location.abovebar, color = i_neg_light_color, text = '2', textcolor = i_neg_light_color, size = size.auto, force_overlay = true)
plotshape(i_scn_show_long and choice_cont ? long_cont_break : false, title = 'Cont 2nd Long', style = shape.triangleup, location = location.belowbar, color = i_pos_light_color, text = '2', textcolor = i_pos_light_color, size = size.auto, force_overlay = true)
barcolor(i_scn_show_short and choice_cont and short_cont_break ? i_neg_light_color : i_scn_show_long and choice_cont and long_cont_break ? i_pos_light_color : na, title = 'Cont 2nd Candle')
bgcolor(i_scn_show_short and choice_cont and short_cont_break ? color.new(i_neg_light_color, 90) : i_scn_show_long and choice_cont and long_cont_break ? color.new(i_pos_light_color, 90) : na, title = 'Cont 2nd Bgcolor')

// Continuous 3rd Retracement
plotshape(i_scn_show_short and choice_cont_ret ? short_cont_ret : false, title = 'Cont 3rd Short', style = shape.triangledown, location = location.abovebar, color = i_neg_light_color, text = '3', textcolor = i_neg_light_color, size = size.auto, force_overlay = true)
plotshape(i_scn_show_long and choice_cont_ret ? long_cont_ret : false, title = 'Cont 3rd Long', style = shape.triangleup, location = location.belowbar, color = i_pos_light_color, text = '3', textcolor = i_pos_light_color, size = size.auto, force_overlay = true)
barcolor(i_scn_show_short and choice_cont_ret and short_cont_ret ? i_neg_light_color : i_scn_show_long and choice_cont_ret and long_cont_ret ? i_pos_light_color : na, title = 'Cont 3rd Candle')
bgcolor(i_scn_show_short and choice_cont_ret and short_cont_ret ? color.new(i_neg_light_color, 90) : i_scn_show_long and choice_cont_ret and long_cont_ret ? color.new(i_pos_light_color, 90) : na, title = 'Cont 3rd Bgcolor')

// Flip 2nd Breakout
plotshape(i_scn_show_short and choice_flip ? short_flip_break : false, title = 'Flip 2nd Short', style = shape.triangledown, location = location.abovebar, color = i_neg_light_color, text = '2', textcolor = i_neg_light_color, size = size.auto, force_overlay = true)
plotshape(i_scn_show_long and choice_flip ? long_flip_break : false, title = 'Flip 2nd Long', style = shape.triangleup, location = location.belowbar, color = i_pos_light_color, text = '2', textcolor = i_pos_light_color, size = size.auto, force_overlay = true)
barcolor(i_scn_show_short and choice_flip and short_flip_break ? i_neg_light_color : i_scn_show_long and choice_flip and long_flip_break ? i_pos_light_color : na, title = 'Flip 2nd Candle')
bgcolor(i_scn_show_short and choice_flip and short_flip_break ? color.new(i_neg_light_color, 90) : i_scn_show_long and choice_flip and long_flip_break ? color.new(i_pos_light_color, 90) : na, title = 'Flip 2nd Bgcolor')

// Flip 3rd Retracement
plotshape(i_scn_show_short and choice_flip_ret ? short_flip_ret : false, title = 'Flip 3rd Short', style = shape.triangledown, location = location.abovebar, color = i_neg_light_color, text = '3', textcolor = i_neg_light_color, size = size.auto, force_overlay = true)
plotshape(i_scn_show_long and choice_flip_ret ? long_flip_ret : false, title = 'Flip 3rd Long', style = shape.triangleup, location = location.belowbar, color = i_pos_light_color, text = '3', textcolor = i_pos_light_color, size = size.auto, force_overlay = true)
barcolor(i_scn_show_short and choice_flip_ret and short_flip_ret ? i_neg_light_color : i_scn_show_long and choice_flip_ret and long_flip_ret ? i_pos_light_color : na, title = 'Flip 3rd Candle')
bgcolor(i_scn_show_short and choice_flip_ret and short_flip_ret ? color.new(i_neg_light_color, 90) : i_scn_show_long and choice_flip_ret and long_flip_ret ? color.new(i_pos_light_color, 90) : na, title = 'Flip 3rd Bgcolor')

//___________________________ Signals End

//___________________________ Get Symbols List for Screener Start

// Acknowledgement & Reference
// Trader: 'allanster'
// Indicator Title: 'How To Input CSV List Of Symbol Data Used For Screener'
// Indicator Link: 'https://www.tradingview.com/script/KfqHqHUH-How-To-Input-CSV-List-Of-Symbol-Data-Used-For-Screener/'

// Feed Function
feed(input_string) =>
    if na(input_string) or str.length(input_string) == 0
        [string(na), string(na)]
    else
        result = str.split(input_string, ',')
        first_item = ''
        for i = 0 to array.size(result) - 1 by 1
            trimmed = str.trim(array.get(result, i))
            if trimmed != ''
                first_item := trimmed
                break
        remaining = str.replace(input_string, first_item + ',', '', 1)
        [first_item, remaining]

// Flexible Symbol Extraction
sym_split_arr = str.split(i_symbols, ',')
new_sym_arr = array.new_string(array.size(sym_split_arr), na)
for i = 0 to array.size(sym_split_arr) - 1 by 1
    trimmed = str.trim(array.get(sym_split_arr, i))
    if trimmed != ''
        array.set(new_sym_arr, i, trimmed)

// Assign symbols dynamically
t_01 = array.size(new_sym_arr) > 0 ? array.get(new_sym_arr, 0) : na
t_02 = array.size(new_sym_arr) > 1 ? array.get(new_sym_arr, 1) : na
t_03 = array.size(new_sym_arr) > 2 ? array.get(new_sym_arr, 2) : na
t_04 = array.size(new_sym_arr) > 3 ? array.get(new_sym_arr, 3) : na
t_05 = array.size(new_sym_arr) > 4 ? array.get(new_sym_arr, 4) : na
t_06 = array.size(new_sym_arr) > 5 ? array.get(new_sym_arr, 5) : na
t_07 = array.size(new_sym_arr) > 6 ? array.get(new_sym_arr, 6) : na
t_08 = array.size(new_sym_arr) > 7 ? array.get(new_sym_arr, 7) : na
t_09 = array.size(new_sym_arr) > 8 ? array.get(new_sym_arr, 8) : na
t_10 = array.size(new_sym_arr) > 9 ? array.get(new_sym_arr, 9) : na
t_11 = array.size(new_sym_arr) > 10 ? array.get(new_sym_arr, 10) : na
t_12 = array.size(new_sym_arr) > 11 ? array.get(new_sym_arr, 11) : na
t_13 = array.size(new_sym_arr) > 12 ? array.get(new_sym_arr, 12) : na
t_14 = array.size(new_sym_arr) > 13 ? array.get(new_sym_arr, 13) : na
t_15 = array.size(new_sym_arr) > 14 ? array.get(new_sym_arr, 14) : na
t_16 = array.size(new_sym_arr) > 15 ? array.get(new_sym_arr, 15) : na
t_17 = array.size(new_sym_arr) > 16 ? array.get(new_sym_arr, 16) : na
t_18 = array.size(new_sym_arr) > 17 ? array.get(new_sym_arr, 17) : na
t_19 = array.size(new_sym_arr) > 18 ? array.get(new_sym_arr, 18) : na
t_20 = array.size(new_sym_arr) > 19 ? array.get(new_sym_arr, 19) : na
t_21 = array.size(new_sym_arr) > 20 ? array.get(new_sym_arr, 20) : na
t_22 = array.size(new_sym_arr) > 21 ? array.get(new_sym_arr, 21) : na
t_23 = array.size(new_sym_arr) > 22 ? array.get(new_sym_arr, 22) : na
t_24 = array.size(new_sym_arr) > 23 ? array.get(new_sym_arr, 23) : na
t_25 = array.size(new_sym_arr) > 24 ? array.get(new_sym_arr, 24) : na
t_26 = array.size(new_sym_arr) > 25 ? array.get(new_sym_arr, 25) : na
t_27 = array.size(new_sym_arr) > 26 ? array.get(new_sym_arr, 26) : na
t_28 = array.size(new_sym_arr) > 27 ? array.get(new_sym_arr, 27) : na
t_29 = array.size(new_sym_arr) > 28 ? array.get(new_sym_arr, 28) : na
t_30 = array.size(new_sym_arr) > 29 ? array.get(new_sym_arr, 29) : na
t_31 = array.size(new_sym_arr) > 30 ? array.get(new_sym_arr, 30) : na
t_32 = array.size(new_sym_arr) > 31 ? array.get(new_sym_arr, 31) : na
t_33 = array.size(new_sym_arr) > 32 ? array.get(new_sym_arr, 32) : na
t_34 = array.size(new_sym_arr) > 33 ? array.get(new_sym_arr, 33) : na
t_35 = array.size(new_sym_arr) > 34 ? array.get(new_sym_arr, 34) : na
t_36 = array.size(new_sym_arr) > 35 ? array.get(new_sym_arr, 35) : na
t_37 = array.size(new_sym_arr) > 36 ? array.get(new_sym_arr, 36) : na
t_38 = array.size(new_sym_arr) > 37 ? array.get(new_sym_arr, 37) : na
t_39 = array.size(new_sym_arr) > 38 ? array.get(new_sym_arr, 38) : na
t_40 = array.size(new_sym_arr) > 39 ? array.get(new_sym_arr, 39) : na

//___________________________ Get Symbols List for Screener End

//___________________________ Scanner Start

// Acknowledgement & Reference
// Trader: 'MUQWISHI'
// Indicator Title: 'Candlestick Patterns Screener [By MUQWISHI]'
// Indicator Link: 'https://www.tradingview.com/script/xiWQuGOq-Candlestick-Patterns-Screener-By-MUQWISHI/'

// Scanner Conditions
bool short_cond =  
 i_scn_choose == 'Continuous Break' ? short_cont_break : 
 i_scn_choose == 'Continuous Retracement' ? short_cont_ret : 
 i_scn_choose == 'Flip Break' ? short_flip_break : 
 i_scn_choose == 'Flip Retracement' ? short_flip_ret : 
 i_scn_choose == 'Divergence' ? bearDiv : hiddenBearDiv

bool long_cond = 
 i_scn_choose == 'Continuous Break' ? long_cont_break : 
 i_scn_choose == 'Continuous Retracement' ? long_cont_ret : 
 i_scn_choose == 'Flip Break' ? long_flip_break : 
 i_scn_choose == 'Flip Retracement' ? long_flip_ret : 
 i_scn_choose == 'Divergence' ? bullDiv : hiddenBullDiv

// Indicator Calculation Function 
indicator_calculation() =>
    // Declare variables with var for persistence
    var float price = na
    var int _time = na
    var float pchg = na
    var float vol_pchg = na
    var int signal = na

    if barstate.isconfirmed
        // Single-line signal assignment
        signal := i_scn_show_long and long_cond ? 1 : i_scn_show_short and short_cond ? -1 : na

        if not na(signal)
            price := math.round_to_mintick(close)
            _time := time
            pchg := cum_pchg
            vol_pchg := cum_vol_pchg
            vol_pchg

    [_time, price, pchg, vol_pchg, signal]

// Time Formatting Function
format_time(x) =>
    str.format_time(x, timeframe.isintraday ? 'HH:mm dd-MM-yyyy' : 'dd-MM-yyyy', syminfo.timezone)

// Symbol Extraction Function
ticker_extract(s) =>
    array.get(str.split(s, ':'), 1)

// Matrix setup
var matrix = matrix.new<string>(0, 6, na)

// Add Rows Function
rows_to_matix(symbol, _time, price, pchg, vol_pchg, signal) =>
    matrix.add_row(matrix, 0, array.from(symbol, _time, price, pchg, vol_pchg, signal))

// Scanner Function
scan(new_sym_arr) =>
    for i = 0 to array.size(new_sym_arr) - 1 by 1
        sym = ticker.modify(array.get(new_sym_arr, i), syminfo.session)
        [_time, price, pchg, vol_pchg, signal] = request.security(sym, timeframe.period, indicator_calculation())
        if not na(signal) and _time == time
            rows_to_matix(
                 ticker_extract(array.get(new_sym_arr, i)), 
                 format_time(_time), 
                 str.tostring(price), 
                 str.tostring(pchg, '#.##'), 
                 str.tostring(vol_pchg, '#.##'), 
                 str.tostring(signal))

// Scan Symbols Array
scan(new_sym_arr)

// Trim excess rows in the matrix
if matrix.rows(matrix) > i_scn_tbl_show_rows
    while matrix.rows(matrix) > i_scn_tbl_show_rows
        matrix.remove_row(matrix, matrix.rows(matrix) - 1)

// Draw Table
var table tbl_scan = table.new(position = i_scn_tbl_pos, columns = 5, rows = 102, border_width = 1, force_overlay = true)

// Cells Function
cell_scan_title(int _column, int _row, string _title) =>
    table.cell(table_id = tbl_scan, column = _column, row = _row, text = _title, text_color = i_neu_color, text_halign = text.align_center, bgcolor = i_neu_dark_color, text_size = i_scn_tbl_txt_size)

cell_scan(col, row, txt, _text_color) =>
    table.cell(tbl_scan, col, row, text = txt, text_color = _text_color, text_halign = text.align_left, bgcolor = i_neu_dark_color, text_size = i_scn_tbl_txt_size)

// Scanner Table
if barstate.islast and i_scn_show_table
    // Clear existing data in the table
    table.clear(table_id = tbl_scan, start_column = 0, start_row = 0, end_column = 2, end_row = 101)

    cell_scan_title(0, 0, i_scn_choose)
    table.merge_cells(table_id = tbl_scan, start_column = 0, start_row = 0, end_column = 4, end_row = 0)
    cell_scan_title(0, 1, 'Symbol')
    cell_scan_title(1, 1, 'Time')
    cell_scan_title(2, 1, 'Price')
    cell_scan_title(3, 1, '%Chg')
    cell_scan_title(4, 1, 'V %Chg')

    j = 4

    // Populate table with matrix data
    if matrix.rows(matrix) > 0
        for i = 0 to matrix.rows(matrix) - 1 by 1
            color txt_color = matrix.get(matrix, i, 5) == '1' ? i_pos_color : matrix.get(matrix, i, 5) == '-1' ? i_neg_color : na

            cell_scan(0, j, matrix.get(matrix, i, 0), txt_color)
            cell_scan(1, j, matrix.get(matrix, i, 1), txt_color)
            cell_scan(2, j, matrix.get(matrix, i, 2), txt_color)
            cell_scan(3, j, matrix.get(matrix, i, 3), txt_color)
            cell_scan(4, j, matrix.get(matrix, i, 4), txt_color)
            j := j + 1

//___________________________ Scanner End

//___________________________ Code End

// Read Me First
// 
// Indicator Title: "Momentum Setup - RSI Directional Momentum Scanner"
// 
// Overview
//  - Upgraded From: "Momentum Setup: RSI Confirmed Direction Scanner".
//  - Improvements: Optimized for speed, refined signals, better performance.
// 
// Features
// - Scanning Methods:
//   - Continuous Break: RSI breakout signals.
//   - Continuous Retracement: Fibonacci retracement after break.
//   - Flip Break: Failed break flips trade direction.
//   - Flip Retracement: Failed retracement flips trade.
//   - Divergence: Price vs. RSI divergence.
//   - Hidden Divergence: Trend continuation signals.
//  
// Note: Read tooltips for more clarity.
// 
// Questions?: Message the author on TradingView: https://www.tradingview.com/u/Arun_K_Bhaskar/
// 
// More Indicators: Free TradingView indicators and source code on GitHub: https://github.com/ArunKBhaskar/PineScript

##-- File Name: PineScript-main/Momentum Setup - RSI Directional Momentum/[Scanner] Momentum Setup - RSI Directional Momentum.txt | File No: 34 | Ended --##

##-- File Name: PineScript-main/Momentum Setup - Vijay Thakare Option Buying Scalping Setup/Momentum Setup - Vijay Thakare Option Buying Scalping Setup with Scanner.txt | File No: 35 | Started --##
// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © Arun_K_Bhaskar

//@version=5
indicator(title='Momentum Setup: Vijay Thakare Option Buying Scalping Setup Scanner', shorttitle='VT Scalp Scan', overlay=true, max_bars_back=500, max_lines_count=500, max_boxes_count=500)

//_____________________________ Menu Screener Start

g_scrtb = '█████████████████ Screener █████████████████'

string i_scr_choose = input.string(defval='Continuous Signals', title='Screening Method', options=['Continuous Signals', 'Flip Signals'], group=g_scrtb)

tt_is = "• Reads only up to first 40 symbols." +
     "\n• Total characters cannot exceed 4096." +
     "\n• Use comma as delimiter without any space." +
     "\n• Eg: EXCHANGE:SYMBOL_A,EXCHANGE:SYMBOL_B"

string i_symbols = input.text_area(
 defval="NSE:NIFTY,NSE:NIFTYJR,NSE:BANKNIFTY,NSE:CNXFINANCE,NSE:NIFTY_MID_SELECT,BSE:SENSEX,BSE:SNSX50,BSE:BANK,NSE:ASHOKLEY,NSE:BANKBARODA,NSE:BANKINDIA,NSE:BEL,NSE:BHEL,NSE:CANBK,NSE:COALINDIA,NSE:ENGINERSIN,NSE:GAIL,NSE:HINDCOPPER,NSE:HUDCO,NSE:IEX,NSE:IRCON,NSE:IRFC,NSE:JSWINFRA,NSE:MOTHERSON,NSE:NATIONALUM,NSE:NBCC,NSE:NCC,NSE:NHPC,NSE:NMDC,NSE:NTPC,NSE:ONGC,NSE:PFC,NSE:PNB,NSE:POWERGRID,NSE:RAILTEL,NSE:RVNL,NSE:SAIL,NSE:SJVN,NSE:UNIONBANK,NSE:VEDL,NSE:ZEEL,NSE:ZOMATO", 
 title="Paste Symbols", tooltip=tt_is, group=g_scrtb)

string i_scr_direction = input.string(defval='Both', title='Direction', options=['Both', 'Long', 'Short'], inline='tb_1', group=g_scrtb)
bool i_scr_show_bull  = input.bool(defval=true, title='Only Long', inline='tb_2', group=g_scrtb)
bool i_scr_show_bear  = input.bool(defval=true, title='Only Short', inline='tb_2', group=g_scrtb)

int i_scr_tbl_disp_rows = input.int(defval=12, title='Display Rows', minval=0, maxval=100, group=g_scrtb)
string i_scr_tbl_position = input.string(defval=position.bottom_left, title='Table Position', options=[position.top_left, position.top_center, position.top_right, position.middle_left, position.middle_center, position.middle_right, position.bottom_left, position.bottom_center, position.bottom_right], group=g_scrtb)
string i_scr_tbl_text_size = input.string(defval=size.small, title='Table Size', options=[size.auto, size.tiny, size.small, size.normal, size.large, size.huge], group=g_scrtb)

//_____________________________ Menu Screener End

//_____________________________ Menu Indicators Start

g_st = '█████████████████ Supertrend █████████████████'
//bool i_st_display = input.bool(defval=true, title='Display', group=g_st)
int i_st_atr_period = input.int(defval=10, title="ATR Length", minval=1, group=g_st)
float i_st_factor = input.float(defval=3.0, title="Factor", minval=0.01, step=0.01, group=g_st)

gp_ma = '████████ Exponential Moving Average (EMA) ████████'
bool i_ma_display = input.bool(defval=true, title='Display', group=gp_ma)
int i_ma_len_1 = input.int(defval=20, title='Length', minval=1, group=gp_ma)
int i_ma_len_2 = input.int(defval=50, title='Length', minval=1, group=gp_ma)
int i_ma_len_3 = input.int(defval=100, title='Length', minval=1, group=gp_ma)
int i_ma_len_4 = input.int(defval=200, title='Length', minval=1, group=gp_ma)

g_vwap = '████████████████ VWAP / TWAP ████████████████'
tt_vt = "• Choose TWAP if Volume is not available for the Symbol."
bool i_vtwap_display = input.bool(defval=true, title='Display', group=g_vwap)
string i_vtwap_choice = input.string(defval = "VWAP", title="Choose", options=["VWAP", "TWAP"], tooltip=tt_vt, group=g_vwap)
string i_vtwap_timeframe = input.timeframe(defval = "1D", title = "Timeframe", group=g_vwap)

g_macd = '███████████████████ MACD ███████████████████'
bool i_macd_display = input.bool(defval=true, title='Display', group=g_macd)
int i_macd_fast_len = input.int(defval=3, title='Fast Length', minval=1, group=g_macd)
int i_macd_slow_len = input.int(defval=9, title='Slow Length', minval=1, group=g_macd)
int i_macd_signal_len = input.int(defval=15, title='Signal Smoothing', minval=1, group=g_macd)
float i_macd_voffset = input.float(defval=0.5, title='Vertical Offset', step=0.1, group=g_macd)
float i_macd_height = input.float(defval=0.7, title='Height', step=0.1, group=g_macd)

g_stoc = '█████████████████ Stochastic █████████████████'
bool i_stoc_display = input.bool(defval=true, title='Display', group=g_stoc)
int i_stoc_k_len = input.int(defval=5, title='%K Length', minval=1, group=g_stoc)
int i_stoc_k_smooth = input.int(defval=3, title='%K Smoothing', minval=1, group=g_stoc)
int i_stoc_d_smooth = input.int(defval=3, title='%D Smoothing', minval=1, group=g_stoc)
int i_stoc_over_bought = input.int(defval=60, title='Over Bought', minval=1, group=g_stoc)
int i_stoc_over_sold = input.int(defval=40, title='Over Sold', minval=1, group=g_stoc)
float i_stoc_voffset = input.float(defval=1.8, title='Vertical Offset', step=0.1, group=g_stoc)// 1.1
float i_stoc_height = input.float(defval=0.6, title='Height', step=0.1, group=g_stoc)//1.0

g_vol = '██████████████████ Volume ██████████████████'
bool i_vol_display = input.bool(defval=true, title='Display', inline='VOL', group=g_vol)
//int i_vol_sma_length = input.int(defval=20, title='MA Length', minval=1, group=g_vol)
string i_vol_type   = input.string(defval='Regular Volume', title='Type', options=['Buying/Selling Volume', 'Regular Volume', 'None'], group = g_vol)
i_vol_hoffset = 0
float i_vol_voffset = input.float(defval=0.5, title='Vertical Offset', step=0.1, group=g_vol)
float i_vol_height = input.float(defval=0.6, title='Height', step=0.1, group=g_vol)

//_____________________________ Menu Indicators End

//_____________________________ Menu Additional Fiters Start

g_af = '███████████████ Additional Fiters ███████████████'

tt_atr = "ATR helps filter out longer or more volatile signal candles."
tt_atr_mul = "Higher multiplier value filters a longer or more volatile signal candle."

tt_bf = "If the input is '80', it means the body covers over 80% of the candle."

tt_bs = '2 means the candle is 2 times larger than the previous candle.'

tt_vol = "Filter out a candle when its volume is greater than the SMA of the volume."

tt_rv = "Filter out a candle when its volume is greater than the Relative Volume."

tt_tf = "Filter out a signals between the given Time."

bool i_atr_filter = input.bool(defval=false, title='Apply ATR Filter', tooltip=tt_atr, group=g_af)
int i_atr_length = input.int(defval=14, minval=1, title='ATR Length', group=g_af)
float i_atr_multi = input.float(defval=1, title='ATR Multiplier', minval=1, group=g_af)

bool i_body_filter = input.bool(defval=false, title='Apply Body % Filter', tooltip=tt_bf, group=g_af)
float i_body_percent = input.float(defval=80, title='Body % Above', minval=0, maxval=100, group=g_af) / 100

bool i_body_size_filter = input.bool(defval=false, title='Apply Body Size Filter', tooltip=tt_bs, group=g_af)
int i_body_size_multiplier = input.int(defval=2, title='Body Size Multiplier (x)', minval=0,  group=g_af)

bool i_volume_filter = input.bool(defval=false, title='Apply Volume Filter', tooltip=tt_vol, group=g_af)
int i_vol_sma_length = input.int(defval=20, minval=1, title='Volume SMA Length', group=g_af)

bool i_rel_vol_filter = input.bool(defval=false, title='Apply Relative Volume Filter', tooltip=tt_rv, group=g_af)
int i_rel_vol_avg_vol_len = input.int(defval=90, title='Relative Volume Length', minval=2, group=g_af)
float i_rel_vol_avg_vol_multi = input.float(defval=2, title='Rel Vol SMA Multiplier', minval=0, group=g_af)

bool i_time_filter = input.bool(defval=false, title='Apply Time Filter', tooltip=tt_tf, group=g_af)
int i_hour_1 = input.int(defval=9, minval=0, title='Time From', inline='t_1', group=g_af)
int i_minute_1 = input.int(defval=15, minval=0, title=':', inline='t_1', group=g_af)
int i_hour_2 = input.int(defval=10, minval=0, title='Time To ', inline='t_2', group=g_af)
int i_minute_2 = input.int(defval=15, minval=0, title=':', inline='t_2', group=g_af)

//_____________________________ Menu Additional Fiters End

//_____________________________ Chart Settings Start

g_ch = '███████████████ Chart Settings ███████████████'
int i_display_len = input.int(defval=50, title='Display Length', minval=1, group=g_ch)
color i_pos_color = input.color(defval=#26A69A, title='Positive', group=g_ch)
color i_pos_light_color = input.color(defval=#ACE5DC, title='Positive Light', group=g_ch)
color i_neu_color = input.color(defval=#D1D4DC, title='Neutral', group=g_ch)
color i_neg_light_color = input.color(defval=#FCCBCD, title='Negative Light', group=g_ch)
color i_neg_color = input.color(defval=#FF5252, title='Negative', group=g_ch)
color i_indicator_color = input.color(defval=#2962FF, title='Indicator', group=g_ch)
color i_signal_color = input.color(defval=#FF6D00, title='Signal', group=g_ch)

//_____________________________ Chart Settings End

//_____________________________ 1. EMA 20, 50, 100, 200 Start

float ema_1 = ta.ema(close, i_ma_len_1)
float ema_2 = ta.ema(close, i_ma_len_2)
float ema_3 = ta.ema(close, i_ma_len_3)
float ema_4 = ta.ema(close, i_ma_len_4)

plot(series=i_ma_display ? ema_1 : na, title='EMA 1', color=i_pos_color)
plot(series=i_ma_display ? ema_2 : na, title='EMA 2', color=i_indicator_color)
plot(series=i_ma_display ? ema_3 : na, title='EMA 3', color=i_signal_color)
plot(series=i_ma_display ? ema_4 : na, title='EMA 4', color=i_neg_color)

//_____________________________ 1. EMA 20, 50, 100, 200 End

//_____________________________ 2. VWAP / TWAP Start

// VWAP
float vwap = na
[_vwap, _stdevUpper, _] = ta.vwap(hlc3, timeframe.change(i_vtwap_timeframe), 1)
vwap := _vwap

// TWAP
twap(source, anchorChange) =>
    var prices = 0.0
    var count = 0

    if anchorChange
        prices := 0
        count := 0

	prices += source
	count += 1

    prices / count

twapValue = twap(ohlc4, timeframe.change(i_vtwap_timeframe))

vwap_twap_choice = i_vtwap_choice == "VWAP" ? vwap : twapValue
plot(series = i_vtwap_display ? vwap_twap_choice : na, title = "VWAP/TWAP", color=i_neu_color)

//_____________________________ 2. VWAP / TWAP End

//_____________________________ 3. MACD: 3, 9, 15 Start

[macdLine, signalLine, histLine] = ta.macd(close, i_macd_fast_len, i_macd_slow_len, i_macd_signal_len)

//_____________________________ 3. MACD: 3, 9, 15 End

//_____________________________ 4. Stochastic: 5, 3, 3 Start

float stoc_k = ta.sma(ta.stoch(close, high, low, i_stoc_k_len), i_stoc_k_smooth)
float stoc_d = ta.sma(stoc_k, i_stoc_d_smooth)

//_____________________________ 4. Stochastic: 5, 3, 3 End

//_____________________________ 5. Volume: 20 SMA Start

vol_sma = ta.sma(volume, i_vol_sma_length)

//_____________________________ 5. Volume: 20 SMA End

//_____________________________ 6. Supertrend Start

[supertrend, direction] = ta.supertrend(i_st_factor, i_st_atr_period)

supertrend := barstate.isfirst ? na : supertrend
upTrend = plot(series=direction < 0 ? supertrend : na, title="Supertrend Up", color = i_pos_color, style = plot.style_linebr)
downTrend = plot(series=direction < 0 ? na : supertrend, title="Supertrend Down", color = i_neg_color, style = plot.style_linebr)
bodyMiddle = plot(series=barstate.isfirst ? na : ohlc4, title="Body Middle", display = display.none)

fill(plot1=bodyMiddle, plot2=upTrend, color=color.new(i_pos_color, 90), fillgaps=false, display=display.none)
fill(plot1=bodyMiddle, plot2=downTrend, color=color.new(i_neg_color, 90), fillgaps=false, display=display.none)

//_____________________________ 6. Supertrend End

//_____________________________ Additional Filters Start

// ATR Filter
bool atr_filter = true
if i_atr_filter
    atr_filter := (high - low) > ta.atr(i_atr_length) * i_atr_multi

// Body Percent Filter
bool body_filter = true
if i_body_filter
    body_filter := (math.abs(close - open)) / (high - low) >= i_body_percent

// Body Size Filter
bool body_size_filter = true
if i_body_size_filter
    body_size_filter := (math.abs(close - open)) / (high - low) >= i_body_percent and (high - low) >= (high[1] - low[1]) * i_body_size_multiplier

// Volume SMA Filter
bool volume_filter = true
if i_volume_filter
    volume_filter := volume > ta.sma(volume, i_vol_sma_length)

// Relative Volume Filter
average_volume = ta.sma(volume, i_rel_vol_avg_vol_len)
relative_volume = volume / average_volume[1]
rel_vol_sma_multiplier = ta.sma(relative_volume, i_rel_vol_avg_vol_len) * i_rel_vol_avg_vol_multi

bool rel_vol_filter = true
if i_rel_vol_filter
    rel_vol_filter := relative_volume > rel_vol_sma_multiplier

// Time Filter
bool time_filter = true
if i_time_filter
    time_filter := (hour > i_hour_1 or (hour == i_hour_1 and minute >= i_minute_1)) and (hour < i_hour_2 or (hour == i_hour_2 and minute < i_minute_2))

//_____________________________ Additional Filters End

//_____________________________ Retracement Signals Start
// Short Retracement Start

// Short Condition 1
short_ret_cont_1 = macdLine > 0

// Short Condition 2
short_ret_cont_2 = 
 close < supertrend and 
 close < vwap_twap_choice and 
 stoc_k < i_stoc_over_bought and 
 stoc_k < stoc_d and 
 macdLine < 0 and
 macdLine < signalLine and
 macdLine < histLine and
 atr_filter and
 body_filter and
 body_size_filter and
 volume_filter and
 rel_vol_filter and
 time_filter and
 barstate.isconfirmed

// Short Retracement Trigger
var bear_break_current_state = 0
bear_break_previous_state = nz(bear_break_current_state[1])
bear_break_current_state := bear_break_previous_state == 2 ? 0 : bear_break_previous_state
if short_ret_cont_1 and bear_break_current_state == 0
    bear_break_current_state := 1
if short_ret_cont_2 and bear_break_current_state == 1
    bear_break_current_state := 2

short_ret_trigger = bear_break_current_state == 2 ? true : false

//___________________________ Short Retracement End

//___________________________ Long Retracement Start
// Long Retracement Start

// Long Condition 1
long_ret_cont_1 = macdLine < 0

// Long Condition 2
long_ret_cont_2 = 
 close > supertrend and 
 close > vwap_twap_choice and 
 stoc_k > i_stoc_over_sold and 
 stoc_k > stoc_d and 
 macdLine > 0 and
 macdLine > signalLine and
 macdLine > histLine and
 atr_filter and
 body_filter and
 body_size_filter and
 volume_filter and
 rel_vol_filter and
 time_filter and
 barstate.isconfirmed

// Long  Retracement Trigger
var bull_break_current_state = 0
bull_break_previous_state = nz(bull_break_current_state[1])
bull_break_current_state := bull_break_previous_state == 2 ? 0 : bull_break_previous_state
if long_ret_cont_1 and bull_break_current_state == 0
    bull_break_current_state := 1
if long_ret_cont_2 and bull_break_current_state == 1
    bull_break_current_state := 2

long_ret_trigger = bull_break_current_state == 2 ? true : false

//___________________________ Long Retracement End


//_______________________ Signals End


//___________________________ Plot Retracements

plotshape(series=i_scr_choose == 'Continuous Signals' and short_ret_trigger ? 3 : na, title='Short Continuous', style=shape.triangledown, location=location.abovebar, color=i_neg_light_color, size=size.tiny)
plotshape(series=i_scr_choose == 'Continuous Signals' and long_ret_trigger ? 3 : na, title='Long Continuous', style=shape.triangleup, location=location.belowbar, color=i_pos_light_color, size=size.tiny)

bgcolor(color=i_scr_choose == 'Continuous Signals' and short_ret_trigger ? color.new(i_neg_light_color, 90) : i_scr_choose == 'Continuous Signals' and long_ret_trigger ? color.new(i_pos_light_color, 90) : na, title='Continuous Bgcolor', show_last=i_display_len)
barcolor(color=i_scr_choose == 'Continuous Signals' and short_ret_trigger ? i_neg_light_color : i_scr_choose == 'Continuous Signals' and long_ret_trigger ? i_pos_light_color : na, title='Continuous Candle')

//_____________________________ Retracement Signals End

//_____________________________ Flip Signals Start

// Signal Generation Function
exrem(condition_1, condition_2) =>
    var entry_signal = 0
    entry_signal := condition_1 ? 1 : condition_2 ? -1 : entry_signal[1]
    entry = entry_signal != entry_signal[1]
    long = entry and entry_signal == 1
    short = entry and entry_signal == -1
    [long, short]

[long_entry, short_entry] = exrem(long_ret_cont_2, short_ret_cont_2)

//___________________________ Plot Flip

plotshape(series=i_scr_choose == 'Flip Signals' ? short_entry : na, title='Short Flip', style=shape.triangledown, location=location.abovebar, color=i_neg_light_color, size=size.tiny)
plotshape(series=i_scr_choose == 'Flip Signals' ? long_entry  : na, title='Long Flip', style=shape.triangleup, location=location.belowbar, color=i_pos_light_color, size=size.tiny)

bgcolor(color=i_scr_choose == 'Flip Signals' and short_entry ? color.new(i_neg_light_color, 90) : i_scr_choose == 'Flip Signals' and long_entry ? color.new(i_pos_light_color, 90) : na, title='Flip Bgcolor', show_last=i_display_len)
barcolor(color=i_scr_choose == 'Flip Signals' and short_entry ? i_neg_light_color : i_scr_choose == 'Flip Signals' and long_entry ? i_pos_light_color : na, title='Flip Candle')

//plotshape(series=short_ret_cont_2, title='Short Shape', style=shape.diamond, location=location.top, color=color.new(i_neg_color, 50), size=size.tiny, display=display.none)
//plotshape(series=long_ret_cont_2, title='Long Shape', style=shape.diamond, location=location.bottom, color=color.new(i_pos_color, 50), size=size.tiny, display=display.none)

//_____________________________ Flip Signals End

//_____________________________ Signals End

//_____________________________ Overlay Charts Start 

// Acknowledgement & Reference
// Trader: 'dgtrd'
// Indicator Title: 'Technical Analyst by DGT'
// Indicator Link: 'https://www.tradingview.com/script/r2kuEi0l-Technical-Analyst-by-DGT/'

// Functions  ----------------------------------------------------------------------------------- //

f_drawLabelX(_x, _y, _text, _xloc, _yloc, _color, _style, _textcolor, _size, _textalign, _tooltip) =>
    var id = label.new(_x, _y, _text, _xloc, _yloc, _color, _style, _textcolor, _size, _textalign, _tooltip)
    label.set_text(id, _text)
    label.set_tooltip(id, _tooltip)
    label.set_xy(id, _x, _y)
    label.set_textcolor(id, _textcolor)

// -Calculations ================================================================================ //

source   = close
nzVolume = nz(volume)

//------------------------------------------------------------------------------
// Momentum : MACD Oscillator

histColor = histLine >= 0 ? histLine[1] < histLine ? i_pos_color : i_pos_light_color : histLine[1] < histLine ? i_neg_light_color : i_neg_color

//------------------------------------------------------------------------------
// Volume

volMa = ta.sma(nzVolume, i_vol_sma_length)

B = nzVolume * (close - low) / (high - low)
S = nzVolume * (high - close) / (high - low)

// Draw Charts
var a_lines       = array.new_line()
var a_hist        = array.new_box()

//i_display_len = 50
priceHighest      = ta.highest(high, i_display_len)
priceLowest       = ta.lowest (low , i_display_len)
priceChangeRate   = (priceHighest - priceLowest) / priceHighest

oscHighest        = 100//ta.highest(osc, i_display_len)
macdHighest       = ta.highest(macdLine, i_display_len) - ta.lowest(macdLine, i_display_len)

volumeMARate      = nzVolume / volMa
volumeHighest     = ta.highest(nzVolume, i_display_len)
bullCandle        = close > open

if barstate.islast 
    if array.size(a_lines) > 0
        for i = 1 to array.size(a_lines)
            line.delete(array.shift(a_lines))
    
    if array.size(a_hist) > 0
        for i = 1 to array.size(a_hist)
            box.delete(array.shift(a_hist))

    if i_stoc_display
        mid_line = math.avg(100, 0)
        array.push(a_hist , box.new (bar_index[i_display_len], priceLowest * (1 - priceChangeRate * i_stoc_voffset) * (1 + i_stoc_over_bought / oscHighest * priceChangeRate * i_stoc_height), 
                                     bar_index                   , priceLowest * (1 - priceChangeRate * i_stoc_voffset) * (1 + i_stoc_over_bought / oscHighest * priceChangeRate * i_stoc_height), color.new(i_neg_color  , 75), 1))
        array.push(a_hist , box.new (bar_index[i_display_len], priceLowest * (1 - priceChangeRate * i_stoc_voffset) * (1 +        mid_line / oscHighest * priceChangeRate * i_stoc_height), 
                                     bar_index                   , priceLowest * (1 - priceChangeRate * i_stoc_voffset) * (1 +        mid_line / oscHighest * priceChangeRate * i_stoc_height), color.new(i_neu_color  , 75), 1))
        array.push(a_hist , box.new (bar_index[i_display_len], priceLowest * (1 - priceChangeRate * i_stoc_voffset) * (1 +   i_stoc_over_sold / oscHighest * priceChangeRate * i_stoc_height), 
                                     bar_index                   , priceLowest * (1 - priceChangeRate * i_stoc_voffset) * (1 +   i_stoc_over_sold / oscHighest * priceChangeRate * i_stoc_height), color.new(i_pos_color, 75), 1))
        f_drawLabelX(bar_index + 3,                                priceLowest * (1 - priceChangeRate * i_stoc_voffset) * (1 +        mid_line / oscHighest * priceChangeRate * i_stoc_height), 'STOC', xloc.bar_index, yloc.price, #00000000, label.style_label_left, chart.fg_color, size.tiny, text.align_center, '%stoc_k : ' + str.tostring(stoc_k, '#.##') + '\n%stoc_d : ' + str.tostring(stoc_d, '#.##'))

    if i_macd_display
        f_drawLabelX(bar_index + 3,  priceLowest * (1 - priceChangeRate * i_macd_voffset) * (1 +        50 / oscHighest * priceChangeRate * i_macd_height), 'MACD', xloc.bar_index, yloc.price, #00000000, label.style_label_left, chart.fg_color, size.tiny, text.align_center, '')//'macd : ' + str.tostring(macdLine, '#.##') + '\nsignal : ' + str.tostring(signalLine, '#.##'))
    
    if i_vol_type != 'None' 
        f_drawLabelX(bar_index + 3,  priceHighest * (1 + priceChangeRate * i_vol_voffset), 'VOL', xloc.bar_index, yloc.price, #00000000, label.style_label_left, chart.fg_color, size.tiny, text.align_center, 'buying volume : ' + str.tostring(B / (B + S) * 100, '#.##') + '%\nselling volume : ' + str.tostring(S / (B + S) * 100, '#.##') + '%\nlast volume : ' + str.tostring(nzVolume, format.volume) + '\naverage volume : ' + str.tostring(volMa, format.volume))

    for barIndex = 0 to i_display_len - 1
        if array.size(a_lines) < 500

            if i_stoc_display
                array.push(a_lines, line.new(bar_index[barIndex], priceLowest * (1 - priceChangeRate * i_stoc_voffset) * (1 + stoc_k[barIndex]     / oscHighest * priceChangeRate * i_stoc_height), 
                                         bar_index[barIndex + 1], priceLowest * (1 - priceChangeRate * i_stoc_voffset) * (1 + stoc_k[barIndex + 1] / oscHighest * priceChangeRate * i_stoc_height), xloc.bar_index, extend.none, i_indicator_color   , line.style_solid, 1))
                array.push(a_lines, line.new(bar_index[barIndex], priceLowest * (1 - priceChangeRate * i_stoc_voffset) * (1 + stoc_d[barIndex]     / oscHighest * priceChangeRate * i_stoc_height), 
                                         bar_index[barIndex + 1], priceLowest * (1 - priceChangeRate * i_stoc_voffset) * (1 + stoc_d[barIndex + 1] / oscHighest * priceChangeRate * i_stoc_height), xloc.bar_index, extend.none, i_signal_color   , line.style_solid, 1))

            if i_macd_display
                array.push(a_lines, line.new(bar_index[barIndex], priceLowest * (1 - priceChangeRate * i_macd_voffset) * (1 + macdLine[barIndex]       / macdHighest * priceChangeRate * i_macd_height ), 
                                         bar_index[barIndex + 1], priceLowest * (1 - priceChangeRate * i_macd_voffset) * (1 + macdLine[barIndex + 1]   / macdHighest * priceChangeRate * i_macd_height ), xloc.bar_index, extend.none, i_indicator_color   , line.style_solid, 1))
                array.push(a_lines, line.new(bar_index[barIndex], priceLowest * (1 - priceChangeRate * i_macd_voffset) * (1 + signalLine[barIndex]     / macdHighest * priceChangeRate * i_macd_height ), 
                                         bar_index[barIndex + 1], priceLowest * (1 - priceChangeRate * i_macd_voffset) * (1 + signalLine[barIndex + 1] / macdHighest * priceChangeRate * i_macd_height ), xloc.bar_index, extend.none, i_signal_color   , line.style_solid, 1))

                array.push(a_hist , box.new (bar_index[barIndex], priceLowest * (1 - priceChangeRate * i_macd_voffset), 
                                             bar_index[barIndex], priceLowest * (1 - priceChangeRate * i_macd_voffset) * (1 + histLine[barIndex] / macdHighest * priceChangeRate * i_macd_height), histColor[barIndex], 2))

            if nzVolume
                if i_vol_type != 'None' 
                    array.push(a_hist , box.new (bar_index[barIndex] + i_vol_hoffset,  priceHighest * (1 + priceChangeRate * i_vol_voffset), 
                                                 bar_index[barIndex] + i_vol_hoffset,  priceHighest * (1 + priceChangeRate * i_vol_voffset) * (1 + nzVolume[barIndex] / volumeHighest * priceChangeRate * i_vol_height), i_vol_type == 'Buying/Selling Volume' ? color.new(i_pos_color, 0) : bullCandle[barIndex] ? color.new(i_pos_color, 0) : color.new(i_neg_color, 0), 2, bgcolor = i_vol_type == 'Buying/Selling Volume' ? color.new(i_pos_color, 0) : bullCandle[barIndex] ? color.new(i_pos_color, 0) : color.new(i_neg_color, 0)))
                    if i_vol_type == 'Buying/Selling Volume'
                        array.push(a_hist , box.new (bar_index[barIndex] + i_vol_hoffset,   priceHighest * (1 + priceChangeRate * i_vol_voffset), 
                                                     bar_index[barIndex] + i_vol_hoffset,   priceHighest * (1 + priceChangeRate * i_vol_voffset) * (1 + S[barIndex]            / volumeHighest * priceChangeRate * i_vol_height), color.new(i_neg_color, 0), 2, bgcolor = color.new(i_neg_color, 0)))
                    // Voumme MA
                    if i_vol_display
                        array.push(a_lines, line.new(bar_index[barIndex] + i_vol_hoffset,     priceHighest * (1 + priceChangeRate * i_vol_voffset) * (1 + nzVolume[barIndex]     / volumeHighest * priceChangeRate * i_vol_height / volumeMARate[barIndex]), 
                                                   bar_index[barIndex + 1] + i_vol_hoffset, priceHighest * (1 + priceChangeRate * i_vol_voffset) * (1 + nzVolume[barIndex + 1] / volumeHighest * priceChangeRate * i_vol_height / volumeMARate[barIndex + 1]), xloc.bar_index, extend.none, i_neu_color, line.style_solid, 1))

//_____________________________ Overlay Charts End 

//_____________________________ Get Symbols for Screener Start

// Acknowledgement & Reference
// Trader: 'allanster'
// Indicator Title: 'How To Input CSV List Of Symbol Data Used For Screener'
// Indicator Link: 'https://www.tradingview.com/script/KfqHqHUH-How-To-Input-CSV-List-Of-Symbol-Data-Used-For-Screener/'

feed(back) =>                                             // extract tickerid and decrement list of ticker IDs
    loop  = back                                          // declare string variable to hold content list
    getT  = string(na)                                    // declare string variable to hold tickerid
    if str.length(loop) == 0                              // if list is empty
        getT := string(na)                                // assign na to tickerid variable
        loop := string(na)                                // assign na to list of ticker Ids variable
    else                                                  // else extract first tickerid
        getP  = nz(str.pos(loop, ','), str.length(loop))  // get position of first comma or last character
        getT := str.substring(loop, 0, getP)              // get tickerid in first position of list
        loop := str.replace(loop, getT + ',', '')         // clear tickerid + delimiter character from list
    [getT, loop]                                          // return tickerid in first position & truncated list

[tid_01, out_01] = feed(i_symbols), [tid_02, out_02] = feed(out_01), [tid_03, out_03] = feed(out_02), [tid_04, out_04] = feed(out_03),
[tid_05, out_05] = feed(out_04), [tid_06, out_06] = feed(out_05), [tid_07, out_07] = feed(out_06), [tid_08, out_08] = feed(out_07),
[tid_09, out_09] = feed(out_08), [tid_10, out_10] = feed(out_09), [tid_11, out_11] = feed(out_10), [tid_12, out_12] = feed(out_11),
[tid_13, out_13] = feed(out_12), [tid_14, out_14] = feed(out_13), [tid_15, out_15] = feed(out_14), [tid_16, out_16] = feed(out_15),
[tid_17, out_17] = feed(out_16), [tid_18, out_18] = feed(out_17), [tid_19, out_19] = feed(out_18), [tid_20, out_20] = feed(out_19),
[tid_21, out_21] = feed(out_20), [tid_22, out_22] = feed(out_21), [tid_23, out_23] = feed(out_22), [tid_24, out_24] = feed(out_23),
[tid_25, out_25] = feed(out_24), [tid_26, out_26] = feed(out_25), [tid_27, out_27] = feed(out_26), [tid_28, out_28] = feed(out_27),
[tid_29, out_29] = feed(out_28), [tid_30, out_30] = feed(out_29), [tid_31, out_31] = feed(out_30), [tid_32, out_32] = feed(out_31),
[tid_33, out_33] = feed(out_32), [tid_34, out_34] = feed(out_33), [tid_35, out_35] = feed(out_34), [tid_36, out_36] = feed(out_35),
[tid_37, out_37] = feed(out_36), [tid_38, out_38] = feed(out_37), [tid_39, out_39] = feed(out_38), [tid_40, out_40] = feed(out_39)

//_____________________________ Get Symbols for Screener End

//_____________________________ Screener Start

// Acknowledgement & Reference
// Trader: 'MUQWISHI'
// Indicator Title: 'Candlestick Patterns Screener [By MUQWISHI]'
// Indicator Link: 'https://www.tradingview.com/script/xiWQuGOq-Candlestick-Patterns-Screener-By-MUQWISHI/'

// Choose Screening Method
bear_method = 
 i_scr_choose == 'Continuous Signals' ? short_ret_trigger : 
 i_scr_choose == 'Flip Signals' ? short_entry : na

bull_method = 
 i_scr_choose == 'Continuous Signals' ? long_ret_trigger : 
 i_scr_choose == 'Flip Signals' ? long_entry : na

// Screener Conditions
bearish_cond = bear_method
bullish_cond = bull_method 

// Define Bull and Bear Conditions
bull = not(i_scr_direction == "Short")
bear = not(i_scr_direction == "Long")

// Function for Screener Indicator Calculation
indicator_calculation() =>
    // Initialize variables
    price = float(na)
    _time = int(na)
    signal = int(na) 

    if barstate.isconfirmed
        // Check for Short Momentum Candle and conditions (Modify here to customize indicators)
        if i_scr_show_bull and bearish_cond and bear 
            signal := -1

        // Check for Long Momentum Candle and conditions (Modify here to customize indicators)
        else if i_scr_show_bear and bullish_cond and bull
            signal := 1

        // Update price and time if signal is not null
        if not na(signal)
            price := math.round_to_mintick(close)
            _time := time

    [_time, price, signal]

// Function to format time
format_time(x) =>
    timezone = syminfo.timezone
    timeframe.isintraday ? str.format_time(x, "HH:mm  dd-MM-yyyy", timezone) : str.format_time(x, "dd-MM-yyyy", timezone)

// Function to extract symbol name
symbol(s) => 
    array.get(str.split(s, ":"), 1)

// Matrix setup
var matrix = matrix.new<string>(0, 4, na)

// Function to add rows to the matrix
mtxFun(symbol, _time, price, signal) =>
    matrix.add_row(matrix, 0, array.from(symbol, _time, price, signal))

// Screener function to collect data
screener(s) =>
    sym = ticker.modify(s, syminfo.session)
    [_time, price, signal] = request.security(sym, timeframe.period, indicator_calculation())

    // Check if the signal is not na and the time matches
    if not na(signal) and _time == time
        symbolName = symbol(s)
        formattedTime = format_time(_time)
        strPrice = str.tostring(price)
        strSignal = str.tostring(signal)
        
        // Add data to the matrix
        mtxFun(symbolName, formattedTime, strPrice, strSignal)

// Call Screener function for multiple symbols
screener(tid_01), screener(tid_02), screener(tid_03), screener(tid_04), screener(tid_05), screener(tid_06), screener(tid_07),
screener(tid_08), screener(tid_09), screener(tid_10), screener(tid_11), screener(tid_12), screener(tid_13), screener(tid_14),
screener(tid_15), screener(tid_16), screener(tid_17), screener(tid_18), screener(tid_19), screener(tid_20), screener(tid_21),
screener(tid_22), screener(tid_23), screener(tid_24), screener(tid_25), screener(tid_26), screener(tid_27), screener(tid_28),
screener(tid_29), screener(tid_30), screener(tid_31), screener(tid_32), screener(tid_33), screener(tid_34), screener(tid_35),
screener(tid_36), screener(tid_37), screener(tid_38), screener(tid_39), screener(tid_40)

// Trim excess rows in the matrix
if matrix.rows(matrix) > i_scr_tbl_disp_rows
    while matrix.rows(matrix) > i_scr_tbl_disp_rows
        matrix.remove_row(matrix, matrix.rows(matrix)-1)

// Plot Table
// Create table with specified properties
var table scr_tbl = table.new(position=i_scr_tbl_position, columns=3, rows=102, border_width=1)

// Function to populate cells in the table
scr_cell_title(col, row, txt) => 
    table.cell(scr_tbl, col, row, text = txt, text_color = i_neu_color, text_halign=text.align_center, bgcolor = color.new(i_neu_color, 90), text_size=i_scr_tbl_text_size)

scr_cell(col, row, txt, color) => 
    table.cell(scr_tbl, col, row, text = txt, text_color = color, text_halign=text.align_left, bgcolor = color.new(color, 90), text_size=i_scr_tbl_text_size)

// Check if it's the last bar
if barstate.islast
    // Clear existing data in the table
    table.clear(scr_tbl, 0, 0, 2, 101)

    scr_cell_title(0, 0, i_scr_choose)
    table.merge_cells(table_id=scr_tbl, start_column=0, start_row=0, end_column=2, end_row=0)
    scr_cell_title(0, 1, "Symbol")
    scr_cell_title(1, 1, "Time")
    scr_cell_title(2, 1, "Price")

    j = 2
    // Populate table with matrix data
    if matrix.rows(matrix) > 0
        for i = 0 to matrix.rows(matrix) - 1
            // Determine color based on the signal
            col = matrix.get(matrix, i, 3) ==  "1" ? i_pos_color :
                  matrix.get(matrix, i, 3) == "-1" ? i_neg_color : i_neu_color

            // Populate cells in the table
            scr_cell(0, j, matrix.get(matrix, i, 0), col)
            scr_cell(1, j, matrix.get(matrix, i, 1), col)
            scr_cell(2, j, matrix.get(matrix, i, 2), col)

            j += 1

//_____________________________ Screener End

//_____________________________ Code End

// Readme First:
// 
// About:
// This is a BANKNIFTY option buying or scalping setup shared by trader Vijay S. Thakare on YouTube.
// 
// Strategy Reference Video:
// Vijay Thakare at Traders Carnival Seminar:
// Video Title: "Vijay Thakare: An Excellent Option Scalper Sharing His Knowledge @ Traders Carnival"
// Video Link: https://www.youtube.com/watch?v=6INokexfeLc
// 
// Explanation Video from His YouTube Channel:
// Video Title: "Setup Video"
// Video Link: https://www.youtube.com/watch?v=KK5j1dgklIY&t=9150s
// 
// Strategy Type: Momentum
// Bias: Strongly Directional
// Trading Style: Scalping
// Instrument: Option - Buying
// Original Symbol: NSE:BANKNIFTY (Works with other symbols as well)
// Timeframe: 5 minute
// 
// Risk Reward Ratio: 1:2
// Stop Loss: Rs. 20 on the premium chart
// Target: Rs. 40 on the premium chart
// 
// Charts Referred:
// - BANKNIFTY Futures Chart
// - BANKNIFTY Options Premium Chart
// 
// Indicator Used and Settings:
// 1. EMA: Close, 20, 50, 100, 200
// 2. VWAP: Daily VWAP
// 3. MACD: Fast Length - 3, Slow Length - 9, Signal Smoothing - 15
// 4. Stochastic: %K Length - 5, %K Smoothing - 3, %D Smoothing - 3
// 
// Long Entry Rules:
// - Close above VWAP
// - Close above Supertrend (Not in original strategy. It avoids many false signals.)
// - MACD above 0
// - Stochastic above 40
// - Consider VWAP, EMA 20, 50, 100, 200 are closer to each other
// - Rising volume (optional)
// 
// Short Entry Rules:
// - Close below VWAP
// - Close below Supertrend (Not in original strategy. It avoids many false signals.)
// - MACD below 0
// - Stochastic below 60
// - Consider VWAP, EMA 20, 50, 100, 200 are closer to each other
// - Rising volume (optional)
//
// Update 09 June 2024
// 1. Added Supertrend filter.
// 2. Added TWAP to use it with Symbols without Volume.
// 3. Removed indicator values Table.
// 4. Two types of scanners are available. One generates continuous signals and one generates flip signals.

##-- File Name: PineScript-main/Momentum Setup - Vijay Thakare Option Buying Scalping Setup/Momentum Setup - Vijay Thakare Option Buying Scalping Setup with Scanner.txt | File No: 35 | Ended --##

##-- File Name: PineScript-main/Momentum Setup - Vijay Thakare Option Buying Scalping Setup/Momentum Setup - Vijay Thakare Option Buying Scalping Setup.txt | File No: 36 | Started --##
// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © Arun_K_Bhaskar

//@version=5
indicator(title='Momentum Setup: Vijay Thakare Option Buying Scalping Setup', shorttitle='VT Scalp', overlay=true, max_bars_back=500, max_lines_count=500, max_boxes_count=500)

//_____________________________ Menu Screener Start

g_scrtb = '█████████████████ Screener █████████████████'

string i_scr_choose = input.string(defval='Continuous Signals', title='Screening Method', options=['Continuous Signals', 'Flip Signals'], group=g_scrtb)

tt_is = "• Reads only up to first 40 symbols." +
     "\n• Total characters cannot exceed 4096." +
     "\n• Use comma as delimiter without any space." +
     "\n• Eg: EXCHANGE:SYMBOL_A,EXCHANGE:SYMBOL_B"

string i_symbols = input.text_area(
 defval="NSE:NIFTY,NSE:NIFTYJR,NSE:BANKNIFTY,NSE:CNXFINANCE,NSE:NIFTY_MID_SELECT,BSE:SENSEX,BSE:SNSX50,BSE:BANK,NSE:ASHOKLEY,NSE:BANKBARODA,NSE:BANKINDIA,NSE:BEL,NSE:BHEL,NSE:CANBK,NSE:COALINDIA,NSE:ENGINERSIN,NSE:GAIL,NSE:HINDCOPPER,NSE:HUDCO,NSE:IEX,NSE:IRCON,NSE:IRFC,NSE:JSWINFRA,NSE:MOTHERSON,NSE:NATIONALUM,NSE:NBCC,NSE:NCC,NSE:NHPC,NSE:NMDC,NSE:NTPC,NSE:ONGC,NSE:PFC,NSE:PNB,NSE:POWERGRID,NSE:RAILTEL,NSE:RVNL,NSE:SAIL,NSE:SJVN,NSE:UNIONBANK,NSE:VEDL,NSE:ZEEL,NSE:ZOMATO", 
 title="Paste Symbols", tooltip=tt_is, group=g_scrtb)

string i_scr_direction = input.string(defval='Both', title='Direction', options=['Both', 'Long', 'Short'], inline='tb_1', group=g_scrtb)
bool i_scr_show_bull  = input.bool(defval=true, title='Only Long', inline='tb_2', group=g_scrtb)
bool i_scr_show_bear  = input.bool(defval=true, title='Only Short', inline='tb_2', group=g_scrtb)

int i_scr_tbl_disp_rows = input.int(defval=12, title='Display Rows', minval=0, maxval=100, group=g_scrtb)
string i_scr_tbl_position = input.string(defval=position.bottom_left, title='Table Position', options=[position.top_left, position.top_center, position.top_right, position.middle_left, position.middle_center, position.middle_right, position.bottom_left, position.bottom_center, position.bottom_right], group=g_scrtb)
string i_scr_tbl_text_size = input.string(defval=size.small, title='Table Size', options=[size.auto, size.tiny, size.small, size.normal, size.large, size.huge], group=g_scrtb)

//_____________________________ Menu Screener End

//_____________________________ Menu Indicators Start

g_st = '█████████████████ Supertrend █████████████████'
//bool i_st_display = input.bool(defval=true, title='Display', group=g_st)
int i_st_atr_period = input.int(defval=10, title="ATR Length", minval=1, group=g_st)
float i_st_factor = input.float(defval=3.0, title="Factor", minval=0.01, step=0.01, group=g_st)

gp_ma = '████████ Exponential Moving Average (EMA) ████████'
bool i_ma_display = input.bool(defval=true, title='Display', group=gp_ma)
int i_ma_len_1 = input.int(defval=20, title='Length', minval=1, group=gp_ma)
int i_ma_len_2 = input.int(defval=50, title='Length', minval=1, group=gp_ma)
int i_ma_len_3 = input.int(defval=100, title='Length', minval=1, group=gp_ma)
int i_ma_len_4 = input.int(defval=200, title='Length', minval=1, group=gp_ma)

g_vwap = '████████████████ VWAP / TWAP ████████████████'
tt_vt = "• Choose TWAP if Volume is not available for the Symbol."
bool i_vtwap_display = input.bool(defval=true, title='Display', group=g_vwap)
string i_vtwap_choice = input.string(defval = "VWAP", title="Choose", options=["VWAP", "TWAP"], tooltip=tt_vt, group=g_vwap)
string i_vtwap_timeframe = input.timeframe(defval = "1D", title = "Timeframe", group=g_vwap)

g_macd = '███████████████████ MACD ███████████████████'
bool i_macd_display = input.bool(defval=true, title='Display', group=g_macd)
int i_macd_fast_len = input.int(defval=3, title='Fast Length', minval=1, group=g_macd)
int i_macd_slow_len = input.int(defval=9, title='Slow Length', minval=1, group=g_macd)
int i_macd_signal_len = input.int(defval=15, title='Signal Smoothing', minval=1, group=g_macd)
float i_macd_voffset = input.float(defval=0.5, title='Vertical Offset', step=0.1, group=g_macd)
float i_macd_height = input.float(defval=0.7, title='Height', step=0.1, group=g_macd)

g_stoc = '█████████████████ Stochastic █████████████████'
bool i_stoc_display = input.bool(defval=true, title='Display', group=g_stoc)
int i_stoc_k_len = input.int(defval=5, title='%K Length', minval=1, group=g_stoc)
int i_stoc_k_smooth = input.int(defval=3, title='%K Smoothing', minval=1, group=g_stoc)
int i_stoc_d_smooth = input.int(defval=3, title='%D Smoothing', minval=1, group=g_stoc)
int i_stoc_over_bought = input.int(defval=60, title='Over Bought', minval=1, group=g_stoc)
int i_stoc_over_sold = input.int(defval=40, title='Over Sold', minval=1, group=g_stoc)
float i_stoc_voffset = input.float(defval=1.8, title='Vertical Offset', step=0.1, group=g_stoc)// 1.1
float i_stoc_height = input.float(defval=0.6, title='Height', step=0.1, group=g_stoc)//1.0

g_vol = '██████████████████ Volume ██████████████████'
bool i_vol_display = input.bool(defval=true, title='Display', inline='VOL', group=g_vol)
//int i_vol_sma_length = input.int(defval=20, title='MA Length', minval=1, group=g_vol)
string i_vol_type   = input.string(defval='Regular Volume', title='Type', options=['Buying/Selling Volume', 'Regular Volume', 'None'], group = g_vol)
i_vol_hoffset = 0
float i_vol_voffset = input.float(defval=0.5, title='Vertical Offset', step=0.1, group=g_vol)
float i_vol_height = input.float(defval=0.6, title='Height', step=0.1, group=g_vol)

//_____________________________ Menu Indicators End

//_____________________________ Menu Additional Fiters Start

g_af = '███████████████ Additional Fiters ███████████████'

tt_atr = "ATR helps filter out longer or more volatile signal candles."
tt_atr_mul = "Higher multiplier value filters a longer or more volatile signal candle."

tt_bf = "If the input is '80', it means the body covers over 80% of the candle."

tt_bs = '2 means the candle is 2 times larger than the previous candle.'

tt_vol = "Filter out a candle when its volume is greater than the SMA of the volume."

tt_rv = "Filter out a candle when its volume is greater than the Relative Volume."

tt_tf = "Filter out a signals between the given Time."

bool i_atr_filter = input.bool(defval=false, title='Apply ATR Filter', tooltip=tt_atr, group=g_af)
int i_atr_length = input.int(defval=14, minval=1, title='ATR Length', group=g_af)
float i_atr_multi = input.float(defval=1, title='ATR Multiplier', minval=1, group=g_af)

bool i_body_filter = input.bool(defval=false, title='Apply Body % Filter', tooltip=tt_bf, group=g_af)
float i_body_percent = input.float(defval=80, title='Body % Above', minval=0, maxval=100, group=g_af) / 100

bool i_body_size_filter = input.bool(defval=false, title='Apply Body Size Filter', tooltip=tt_bs, group=g_af)
int i_body_size_multiplier = input.int(defval=2, title='Body Size Multiplier (x)', minval=0,  group=g_af)

bool i_volume_filter = input.bool(defval=false, title='Apply Volume Filter', tooltip=tt_vol, group=g_af)
int i_vol_sma_length = input.int(defval=20, minval=1, title='Volume SMA Length', group=g_af)

bool i_rel_vol_filter = input.bool(defval=false, title='Apply Relative Volume Filter', tooltip=tt_rv, group=g_af)
int i_rel_vol_avg_vol_len = input.int(defval=90, title='Relative Volume Length', minval=2, group=g_af)
float i_rel_vol_avg_vol_multi = input.float(defval=2, title='Rel Vol SMA Multiplier', minval=0, group=g_af)

bool i_time_filter = input.bool(defval=false, title='Apply Time Filter', tooltip=tt_tf, group=g_af)
int i_hour_1 = input.int(defval=9, minval=0, title='Time From', inline='t_1', group=g_af)
int i_minute_1 = input.int(defval=15, minval=0, title=':', inline='t_1', group=g_af)
int i_hour_2 = input.int(defval=10, minval=0, title='Time To ', inline='t_2', group=g_af)
int i_minute_2 = input.int(defval=15, minval=0, title=':', inline='t_2', group=g_af)

//_____________________________ Menu Additional Fiters End

//_____________________________ Chart Settings Start

g_ch = '███████████████ Chart Settings ███████████████'
int i_display_len = input.int(defval=50, title='Display Length', minval=1, group=g_ch)
color i_pos_color = input.color(defval=#26A69A, title='Positive', group=g_ch)
color i_pos_light_color = input.color(defval=#ACE5DC, title='Positive Light', group=g_ch)
color i_neu_color = input.color(defval=#D1D4DC, title='Neutral', group=g_ch)
color i_neg_light_color = input.color(defval=#FCCBCD, title='Negative Light', group=g_ch)
color i_neg_color = input.color(defval=#FF5252, title='Negative', group=g_ch)
color i_indicator_color = input.color(defval=#2962FF, title='Indicator', group=g_ch)
color i_signal_color = input.color(defval=#FF6D00, title='Signal', group=g_ch)

//_____________________________ Chart Settings End

//_____________________________ 1. EMA 20, 50, 100, 200 Start

float ema_1 = ta.ema(close, i_ma_len_1)
float ema_2 = ta.ema(close, i_ma_len_2)
float ema_3 = ta.ema(close, i_ma_len_3)
float ema_4 = ta.ema(close, i_ma_len_4)

plot(series=i_ma_display ? ema_1 : na, title='EMA 1', color=i_pos_color)
plot(series=i_ma_display ? ema_2 : na, title='EMA 2', color=i_indicator_color)
plot(series=i_ma_display ? ema_3 : na, title='EMA 3', color=i_signal_color)
plot(series=i_ma_display ? ema_4 : na, title='EMA 4', color=i_neg_color)

//_____________________________ 1. EMA 20, 50, 100, 200 End

//_____________________________ 2. VWAP / TWAP Start

// VWAP
float vwap = na
[_vwap, _stdevUpper, _] = ta.vwap(hlc3, timeframe.change(i_vtwap_timeframe), 1)
vwap := _vwap

// TWAP
twap(source, anchorChange) =>
    var prices = 0.0
    var count = 0

    if anchorChange
        prices := 0
        count := 0

	prices += source
	count += 1

    prices / count

twapValue = twap(ohlc4, timeframe.change(i_vtwap_timeframe))

vwap_twap_choice = i_vtwap_choice == "VWAP" ? vwap : twapValue
plot(series = i_vtwap_display ? vwap_twap_choice : na, title = "VWAP/TWAP", color=i_neu_color)

//_____________________________ 2. VWAP / TWAP End

//_____________________________ 3. MACD: 3, 9, 15 Start

[macdLine, signalLine, histLine] = ta.macd(close, i_macd_fast_len, i_macd_slow_len, i_macd_signal_len)

//_____________________________ 3. MACD: 3, 9, 15 End

//_____________________________ 4. Stochastic: 5, 3, 3 Start

float stoc_k = ta.sma(ta.stoch(close, high, low, i_stoc_k_len), i_stoc_k_smooth)
float stoc_d = ta.sma(stoc_k, i_stoc_d_smooth)

//_____________________________ 4. Stochastic: 5, 3, 3 End

//_____________________________ 5. Volume: 20 SMA Start

vol_sma = ta.sma(volume, i_vol_sma_length)

//_____________________________ 5. Volume: 20 SMA End

//_____________________________ 6. Supertrend Start

[supertrend, direction] = ta.supertrend(i_st_factor, i_st_atr_period)

supertrend := barstate.isfirst ? na : supertrend
upTrend = plot(series=direction < 0 ? supertrend : na, title="Supertrend Up", color = i_pos_color, style = plot.style_linebr)
downTrend = plot(series=direction < 0 ? na : supertrend, title="Supertrend Down", color = i_neg_color, style = plot.style_linebr)
bodyMiddle = plot(series=barstate.isfirst ? na : ohlc4, title="Body Middle", display = display.none)

fill(plot1=bodyMiddle, plot2=upTrend, color=color.new(i_pos_color, 90), fillgaps=false, display=display.none)
fill(plot1=bodyMiddle, plot2=downTrend, color=color.new(i_neg_color, 90), fillgaps=false, display=display.none)

//_____________________________ 6. Supertrend End

//_____________________________ Additional Filters Start

// ATR Filter
bool atr_filter = true
if i_atr_filter
    atr_filter := (high - low) > ta.atr(i_atr_length) * i_atr_multi

// Body Percent Filter
bool body_filter = true
if i_body_filter
    body_filter := (math.abs(close - open)) / (high - low) >= i_body_percent

// Body Size Filter
bool body_size_filter = true
if i_body_size_filter
    body_size_filter := (math.abs(close - open)) / (high - low) >= i_body_percent and (high - low) >= (high[1] - low[1]) * i_body_size_multiplier

// Volume SMA Filter
bool volume_filter = true
if i_volume_filter
    volume_filter := volume > ta.sma(volume, i_vol_sma_length)

// Relative Volume Filter
average_volume = ta.sma(volume, i_rel_vol_avg_vol_len)
relative_volume = volume / average_volume[1]
rel_vol_sma_multiplier = ta.sma(relative_volume, i_rel_vol_avg_vol_len) * i_rel_vol_avg_vol_multi

bool rel_vol_filter = true
if i_rel_vol_filter
    rel_vol_filter := relative_volume > rel_vol_sma_multiplier

// Time Filter
bool time_filter = true
if i_time_filter
    time_filter := (hour > i_hour_1 or (hour == i_hour_1 and minute >= i_minute_1)) and (hour < i_hour_2 or (hour == i_hour_2 and minute < i_minute_2))

//_____________________________ Additional Filters End

//_____________________________ Retracement Signals Start
// Short Retracement Start

// Short Condition 1
short_ret_cont_1 = macdLine > 0

// Short Condition 2
short_ret_cont_2 = 
 close < supertrend and 
 close < vwap_twap_choice and 
 stoc_k < i_stoc_over_bought and 
 stoc_k < stoc_d and 
 macdLine < 0 and
 macdLine < signalLine and
 macdLine < histLine and
 atr_filter and
 body_filter and
 body_size_filter and
 volume_filter and
 rel_vol_filter and
 time_filter and
 barstate.isconfirmed

// Short Retracement Trigger
var bear_break_current_state = 0
bear_break_previous_state = nz(bear_break_current_state[1])
bear_break_current_state := bear_break_previous_state == 2 ? 0 : bear_break_previous_state
if short_ret_cont_1 and bear_break_current_state == 0
    bear_break_current_state := 1
if short_ret_cont_2 and bear_break_current_state == 1
    bear_break_current_state := 2

short_ret_trigger = bear_break_current_state == 2 ? true : false

//___________________________ Short Retracement End

//___________________________ Long Retracement Start
// Long Retracement Start

// Long Condition 1
long_ret_cont_1 = macdLine < 0

// Long Condition 2
long_ret_cont_2 = 
 close > supertrend and 
 close > vwap_twap_choice and 
 stoc_k > i_stoc_over_sold and 
 stoc_k > stoc_d and 
 macdLine > 0 and
 macdLine > signalLine and
 macdLine > histLine and
 atr_filter and
 body_filter and
 body_size_filter and
 volume_filter and
 rel_vol_filter and
 time_filter and
 barstate.isconfirmed

// Long  Retracement Trigger
var bull_break_current_state = 0
bull_break_previous_state = nz(bull_break_current_state[1])
bull_break_current_state := bull_break_previous_state == 2 ? 0 : bull_break_previous_state
if long_ret_cont_1 and bull_break_current_state == 0
    bull_break_current_state := 1
if long_ret_cont_2 and bull_break_current_state == 1
    bull_break_current_state := 2

long_ret_trigger = bull_break_current_state == 2 ? true : false

//___________________________ Long Retracement End


//_______________________ Signals End


//___________________________ Plot Retracements

plotshape(series=i_scr_choose == 'Continuous Signals' and short_ret_trigger ? 3 : na, title='Short Continuous', style=shape.triangledown, location=location.abovebar, color=i_neg_light_color, size=size.tiny)
plotshape(series=i_scr_choose == 'Continuous Signals' and long_ret_trigger ? 3 : na, title='Long Continuous', style=shape.triangleup, location=location.belowbar, color=i_pos_light_color, size=size.tiny)

bgcolor(color=i_scr_choose == 'Continuous Signals' and short_ret_trigger ? color.new(i_neg_light_color, 90) : i_scr_choose == 'Continuous Signals' and long_ret_trigger ? color.new(i_pos_light_color, 90) : na, title='Continuous Bgcolor', show_last=i_display_len)
barcolor(color=i_scr_choose == 'Continuous Signals' and short_ret_trigger ? i_neg_light_color : i_scr_choose == 'Continuous Signals' and long_ret_trigger ? i_pos_light_color : na, title='Continuous Candle')

//_____________________________ Retracement Signals End

//_____________________________ Flip Signals Start

// Signal Generation Function
exrem(condition_1, condition_2) =>
    var entry_signal = 0
    entry_signal := condition_1 ? 1 : condition_2 ? -1 : entry_signal[1]
    entry = entry_signal != entry_signal[1]
    long = entry and entry_signal == 1
    short = entry and entry_signal == -1
    [long, short]

[long_entry, short_entry] = exrem(long_ret_cont_2, short_ret_cont_2)

//___________________________ Plot Flip

plotshape(series=i_scr_choose == 'Flip Signals' ? short_entry : na, title='Short Flip', style=shape.triangledown, location=location.abovebar, color=i_neg_light_color, size=size.tiny)
plotshape(series=i_scr_choose == 'Flip Signals' ? long_entry  : na, title='Long Flip', style=shape.triangleup, location=location.belowbar, color=i_pos_light_color, size=size.tiny)

bgcolor(color=i_scr_choose == 'Flip Signals' and short_entry ? color.new(i_neg_light_color, 90) : i_scr_choose == 'Flip Signals' and long_entry ? color.new(i_pos_light_color, 90) : na, title='Flip Bgcolor', show_last=i_display_len)
barcolor(color=i_scr_choose == 'Flip Signals' and short_entry ? i_neg_light_color : i_scr_choose == 'Flip Signals' and long_entry ? i_pos_light_color : na, title='Flip Candle')

//plotshape(series=short_ret_cont_2, title='Short Shape', style=shape.diamond, location=location.top, color=color.new(i_neg_color, 50), size=size.tiny, display=display.none)
//plotshape(series=long_ret_cont_2, title='Long Shape', style=shape.diamond, location=location.bottom, color=color.new(i_pos_color, 50), size=size.tiny, display=display.none)

//_____________________________ Flip Signals End

//_____________________________ Signals End

//_____________________________ Overlay Charts Start 

// Acknowledgement & Reference
// Trader: 'dgtrd'
// Indicator Title: 'Technical Analyst by DGT'
// Indicator Link: 'https://www.tradingview.com/script/r2kuEi0l-Technical-Analyst-by-DGT/'

// Functions  ----------------------------------------------------------------------------------- //

f_drawLabelX(_x, _y, _text, _xloc, _yloc, _color, _style, _textcolor, _size, _textalign, _tooltip) =>
    var id = label.new(_x, _y, _text, _xloc, _yloc, _color, _style, _textcolor, _size, _textalign, _tooltip)
    label.set_text(id, _text)
    label.set_tooltip(id, _tooltip)
    label.set_xy(id, _x, _y)
    label.set_textcolor(id, _textcolor)

// -Calculations ================================================================================ //

source   = close
nzVolume = nz(volume)

//------------------------------------------------------------------------------
// Momentum : MACD Oscillator

histColor = histLine >= 0 ? histLine[1] < histLine ? i_pos_color : i_pos_light_color : histLine[1] < histLine ? i_neg_light_color : i_neg_color

//------------------------------------------------------------------------------
// Volume

volMa = ta.sma(nzVolume, i_vol_sma_length)

B = nzVolume * (close - low) / (high - low)
S = nzVolume * (high - close) / (high - low)

// Draw Charts
var a_lines       = array.new_line()
var a_hist        = array.new_box()

//i_display_len = 50
priceHighest      = ta.highest(high, i_display_len)
priceLowest       = ta.lowest (low , i_display_len)
priceChangeRate   = (priceHighest - priceLowest) / priceHighest

oscHighest        = 100//ta.highest(osc, i_display_len)
macdHighest       = ta.highest(macdLine, i_display_len) - ta.lowest(macdLine, i_display_len)

volumeMARate      = nzVolume / volMa
volumeHighest     = ta.highest(nzVolume, i_display_len)
bullCandle        = close > open

if barstate.islast 
    if array.size(a_lines) > 0
        for i = 1 to array.size(a_lines)
            line.delete(array.shift(a_lines))
    
    if array.size(a_hist) > 0
        for i = 1 to array.size(a_hist)
            box.delete(array.shift(a_hist))

    if i_stoc_display
        mid_line = math.avg(100, 0)
        array.push(a_hist , box.new (bar_index[i_display_len], priceLowest * (1 - priceChangeRate * i_stoc_voffset) * (1 + i_stoc_over_bought / oscHighest * priceChangeRate * i_stoc_height), 
                                     bar_index                   , priceLowest * (1 - priceChangeRate * i_stoc_voffset) * (1 + i_stoc_over_bought / oscHighest * priceChangeRate * i_stoc_height), color.new(i_neg_color  , 75), 1))
        array.push(a_hist , box.new (bar_index[i_display_len], priceLowest * (1 - priceChangeRate * i_stoc_voffset) * (1 +        mid_line / oscHighest * priceChangeRate * i_stoc_height), 
                                     bar_index                   , priceLowest * (1 - priceChangeRate * i_stoc_voffset) * (1 +        mid_line / oscHighest * priceChangeRate * i_stoc_height), color.new(i_neu_color  , 75), 1))
        array.push(a_hist , box.new (bar_index[i_display_len], priceLowest * (1 - priceChangeRate * i_stoc_voffset) * (1 +   i_stoc_over_sold / oscHighest * priceChangeRate * i_stoc_height), 
                                     bar_index                   , priceLowest * (1 - priceChangeRate * i_stoc_voffset) * (1 +   i_stoc_over_sold / oscHighest * priceChangeRate * i_stoc_height), color.new(i_pos_color, 75), 1))
        f_drawLabelX(bar_index + 3,                                priceLowest * (1 - priceChangeRate * i_stoc_voffset) * (1 +        mid_line / oscHighest * priceChangeRate * i_stoc_height), 'STOC', xloc.bar_index, yloc.price, #00000000, label.style_label_left, chart.fg_color, size.tiny, text.align_center, '%stoc_k : ' + str.tostring(stoc_k, '#.##') + '\n%stoc_d : ' + str.tostring(stoc_d, '#.##'))

    if i_macd_display
        f_drawLabelX(bar_index + 3,  priceLowest * (1 - priceChangeRate * i_macd_voffset) * (1 +        50 / oscHighest * priceChangeRate * i_macd_height), 'MACD', xloc.bar_index, yloc.price, #00000000, label.style_label_left, chart.fg_color, size.tiny, text.align_center, '')//'macd : ' + str.tostring(macdLine, '#.##') + '\nsignal : ' + str.tostring(signalLine, '#.##'))
    
    if i_vol_type != 'None' 
        f_drawLabelX(bar_index + 3,  priceHighest * (1 + priceChangeRate * i_vol_voffset), 'VOL', xloc.bar_index, yloc.price, #00000000, label.style_label_left, chart.fg_color, size.tiny, text.align_center, 'buying volume : ' + str.tostring(B / (B + S) * 100, '#.##') + '%\nselling volume : ' + str.tostring(S / (B + S) * 100, '#.##') + '%\nlast volume : ' + str.tostring(nzVolume, format.volume) + '\naverage volume : ' + str.tostring(volMa, format.volume))

    for barIndex = 0 to i_display_len - 1
        if array.size(a_lines) < 500

            if i_stoc_display
                array.push(a_lines, line.new(bar_index[barIndex], priceLowest * (1 - priceChangeRate * i_stoc_voffset) * (1 + stoc_k[barIndex]     / oscHighest * priceChangeRate * i_stoc_height), 
                                         bar_index[barIndex + 1], priceLowest * (1 - priceChangeRate * i_stoc_voffset) * (1 + stoc_k[barIndex + 1] / oscHighest * priceChangeRate * i_stoc_height), xloc.bar_index, extend.none, i_indicator_color   , line.style_solid, 1))
                array.push(a_lines, line.new(bar_index[barIndex], priceLowest * (1 - priceChangeRate * i_stoc_voffset) * (1 + stoc_d[barIndex]     / oscHighest * priceChangeRate * i_stoc_height), 
                                         bar_index[barIndex + 1], priceLowest * (1 - priceChangeRate * i_stoc_voffset) * (1 + stoc_d[barIndex + 1] / oscHighest * priceChangeRate * i_stoc_height), xloc.bar_index, extend.none, i_signal_color   , line.style_solid, 1))

            if i_macd_display
                array.push(a_lines, line.new(bar_index[barIndex], priceLowest * (1 - priceChangeRate * i_macd_voffset) * (1 + macdLine[barIndex]       / macdHighest * priceChangeRate * i_macd_height ), 
                                         bar_index[barIndex + 1], priceLowest * (1 - priceChangeRate * i_macd_voffset) * (1 + macdLine[barIndex + 1]   / macdHighest * priceChangeRate * i_macd_height ), xloc.bar_index, extend.none, i_indicator_color   , line.style_solid, 1))
                array.push(a_lines, line.new(bar_index[barIndex], priceLowest * (1 - priceChangeRate * i_macd_voffset) * (1 + signalLine[barIndex]     / macdHighest * priceChangeRate * i_macd_height ), 
                                         bar_index[barIndex + 1], priceLowest * (1 - priceChangeRate * i_macd_voffset) * (1 + signalLine[barIndex + 1] / macdHighest * priceChangeRate * i_macd_height ), xloc.bar_index, extend.none, i_signal_color   , line.style_solid, 1))

                array.push(a_hist , box.new (bar_index[barIndex], priceLowest * (1 - priceChangeRate * i_macd_voffset), 
                                             bar_index[barIndex], priceLowest * (1 - priceChangeRate * i_macd_voffset) * (1 + histLine[barIndex] / macdHighest * priceChangeRate * i_macd_height), histColor[barIndex], 2))

            if nzVolume
                if i_vol_type != 'None' 
                    array.push(a_hist , box.new (bar_index[barIndex] + i_vol_hoffset,  priceHighest * (1 + priceChangeRate * i_vol_voffset), 
                                                 bar_index[barIndex] + i_vol_hoffset,  priceHighest * (1 + priceChangeRate * i_vol_voffset) * (1 + nzVolume[barIndex] / volumeHighest * priceChangeRate * i_vol_height), i_vol_type == 'Buying/Selling Volume' ? color.new(i_pos_color, 0) : bullCandle[barIndex] ? color.new(i_pos_color, 0) : color.new(i_neg_color, 0), 2, bgcolor = i_vol_type == 'Buying/Selling Volume' ? color.new(i_pos_color, 0) : bullCandle[barIndex] ? color.new(i_pos_color, 0) : color.new(i_neg_color, 0)))
                    if i_vol_type == 'Buying/Selling Volume'
                        array.push(a_hist , box.new (bar_index[barIndex] + i_vol_hoffset,   priceHighest * (1 + priceChangeRate * i_vol_voffset), 
                                                     bar_index[barIndex] + i_vol_hoffset,   priceHighest * (1 + priceChangeRate * i_vol_voffset) * (1 + S[barIndex]            / volumeHighest * priceChangeRate * i_vol_height), color.new(i_neg_color, 0), 2, bgcolor = color.new(i_neg_color, 0)))
                    // Voumme MA
                    if i_vol_display
                        array.push(a_lines, line.new(bar_index[barIndex] + i_vol_hoffset,     priceHighest * (1 + priceChangeRate * i_vol_voffset) * (1 + nzVolume[barIndex]     / volumeHighest * priceChangeRate * i_vol_height / volumeMARate[barIndex]), 
                                                   bar_index[barIndex + 1] + i_vol_hoffset, priceHighest * (1 + priceChangeRate * i_vol_voffset) * (1 + nzVolume[barIndex + 1] / volumeHighest * priceChangeRate * i_vol_height / volumeMARate[barIndex + 1]), xloc.bar_index, extend.none, i_neu_color, line.style_solid, 1))

//_____________________________ Overlay Charts End 

//_____________________________ Code End

// Readme First:
// 
// About:
// This is a BANKNIFTY option buying or scalping setup shared by trader Vijay S. Thakare on YouTube.
// 
// Strategy Reference Video:
// Vijay Thakare at Traders Carnival Seminar:
// Video Title: "Vijay Thakare: An Excellent Option Scalper Sharing His Knowledge @ Traders Carnival"
// Video Link: https://www.youtube.com/watch?v=6INokexfeLc
// 
// Explanation Video from His YouTube Channel:
// Video Title: "Setup Video"
// Video Link: https://www.youtube.com/watch?v=KK5j1dgklIY&t=9150s
// 
// Strategy Type: Momentum
// Bias: Strongly Directional
// Trading Style: Scalping
// Instrument: Option - Buying
// Original Symbol: NSE:BANKNIFTY (Works with other symbols as well)
// Timeframe: 5 minute
// 
// Risk Reward Ratio: 1:2
// Stop Loss: Rs. 20 on the premium chart
// Target: Rs. 40 on the premium chart
// 
// Charts Referred:
// - BANKNIFTY Futures Chart
// - BANKNIFTY Options Premium Chart
// 
// Indicator Used and Settings:
// 1. EMA: Close, 20, 50, 100, 200
// 2. VWAP: Daily VWAP
// 3. MACD: Fast Length - 3, Slow Length - 9, Signal Smoothing - 15
// 4. Stochastic: %K Length - 5, %K Smoothing - 3, %D Smoothing - 3
// 
// Long Entry Rules:
// - Close above VWAP
// - Close above Supertrend (Not in original strategy. It avoids many false signals.)
// - MACD above 0
// - Stochastic above 40
// - Consider VWAP, EMA 20, 50, 100, 200 are closer to each other
// - Rising volume (optional)
// 
// Short Entry Rules:
// - Close below VWAP
// - Close below Supertrend (Not in original strategy. It avoids many false signals.)
// - MACD below 0
// - Stochastic below 60
// - Consider VWAP, EMA 20, 50, 100, 200 are closer to each other
// - Rising volume (optional)
//
// Update 09 June 2024
// 1. Added Supertrend filter.
// 2. Added TWAP to use it with Symbols without Volume.
// 3. Removed indicator values Table.
// 4. Two types of scanners are available. One generates continuous signals and one generates flip signals.

##-- File Name: PineScript-main/Momentum Setup - Vijay Thakare Option Buying Scalping Setup/Momentum Setup - Vijay Thakare Option Buying Scalping Setup.txt | File No: 36 | Ended --##

##-- File Name: PineScript-main/Momentum Setup - Vijay Thakare Option Buying Scalping Setup/Readme First.txt | File No: 37 | Started --##
Readme First:

About:
This is a BANKNIFTY option buying or scalping setup shared by trader Vijay S. Thakare on YouTube.

Strategy Reference Video:
Vijay Thakare at Traders Carnival Seminar:
Video Title: "Vijay Thakare: An Excellent Option Scalper Sharing His Knowledge @ Traders Carnival"
Video Link: https://www.youtube.com/watch?v=6INokexfeLc

Explanation Video from His YouTube Channel:
Video Title: "Setup Video"
Video Link: https://www.youtube.com/watch?v=KK5j1dgklIY&t=9150s

Strategy Type: Momentum
Bias: Strongly Directional
Trading Style: Scalping
Instrument: Option - Buying
Original Symbol: NSE:BANKNIFTY (Works with other symbols as well)
Timeframe: 5 minute

Risk Reward Ratio: 1:2
Stop Loss: Rs. 20 on the premium chart
Target: Rs. 40 on the premium chart

Charts Referred:
- BANKNIFTY Futures Chart
- BANKNIFTY Options Premium Chart

Indicator Used and Settings:
1. EMA: Close, 20, 50, 100, 200
2. VWAP: Daily VWAP
3. MACD: Fast Length - 3, Slow Length - 9, Signal Smoothing - 15
4. Stochastic: %K Length - 5, %K Smoothing - 3, %D Smoothing - 3

Long Entry Rules:
- Close above VWAP
- Close above Supertrend (Not in original strategy. It avoids many false signals.)
- MACD above 0
- Stochastic above 40
- Consider VWAP, EMA 20, 50, 100, 200 are closer to each other
- Rising volume (optional)

Short Entry Rules:
- Close below VWAP
- Close below Supertrend (Not in original strategy. It avoids many false signals.)
- MACD below 0
- Stochastic below 60
- Consider VWAP, EMA 20, 50, 100, 200 are closer to each other
- Rising volume (optional)

Update 09 June 2024
1. Added Supertrend filter.
2. Added TWAP to use it with Symbols without Volume.
3. Removed indicator values Table.
4. Two types of scanners are available. One generates continuous signals and one generates flip signals.

##-- File Name: PineScript-main/Momentum Setup - Vijay Thakare Option Buying Scalping Setup/Readme First.txt | File No: 37 | Ended --##

##-- File Name: PineScript-main/Trend Following Setup - Sideways Market Skipper Scanner/Indicator - Trend Following Setup - Sideways Market Skipper.txt | File No: 38 | Started --##
// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © Arun_K_Bhaskar

//@version=5
indicator(title='Trend Following Setup - Sideways Market Skipper', shorttitle='Sideways Skip', overlay=false, max_bars_back=500)

//_____________________________ Menu Supertrend Start

g_st = '█████████████████ Supertrend █████████████████'
//bool i_st_display = input.bool(defval=true, title='Display', group=g_st)
int i_st_atr_period = input.int(defval=10, title="ATR Length", minval=1, group=g_st)
float i_st_factor = input.float(defval=3.0, title="Factor", minval=0.01, step=0.01, group=g_st)

//_____________________________ Menu Supertrend End

//_____________________________ Menu Range Start

g_r = '███████████████ Volatility Range ███████████████'

tt_r = 
 "• 'Auto ATR': Automatically sets the range based on the ATR value." +
 "\n• The range adjusts automatically when switching between symbols." +
 "\n• The default ATR timeframe is 1 hour." +
 "\n• For a Supertrend Long Crossover, the range is defined by adding the ATR value." +
 "\n• For a Supertrend Short Crossunder, the range is defined by subtracting the ATR value." +
 "\n\n• Type Points: Manually enter the points for different symbols to define the volatility range." +
 "\n• For example, the points are 60 for NIFTY and 120 for BANKNIFTY."

tt_tp = "Applicable only when 'Range Type' is selected as 'Type Points'."

tt_atr_tf =
 "• This uses the ATR value of the given timeframe." +
 "\n• The default ATR timeframe is 1 hour."

bool i_atr_range_display = input.bool(defval=true, title='Display', group=g_r)
string i_atr_range_choice = input.string(defval='Auto ATR', title='Range Type', options=['Auto ATR', 'Type Points'], tooltip=tt_r, group=g_r)
float i_atr_range_points = input.float(defval=120, title="Type Points", minval=0.01, tooltip=tt_tp, group=g_r)

//string i_atr_range_timeframe = input.timeframe(defval='60', title='ATR Timeframe', tooltip=tt_atr_tf, group=g_r)
int i_atr_range_length = input.int(defval=14, title='ATR Length', minval=1, group=g_r)
string i_atr_range_smoothing = input.string(title="ATR Smoothing", defval="RMA", options=["RMA", "SMA", "EMA", "WMA"], group=g_r)
float i_atr_range_multiplier = input.float(defval=1.5, title="ATR Multiplier", minval=1, step=0.5, group=g_r)
int i_atr_range_sma_length = input.int(defval=14, title='ATR SMA Length', minval=1, group=g_r)

//_____________________________ Menu Range End

//_____________________________ Menu Additional Fiters Start

g_af = '███████████████ Additional Fiters ███████████████'
tt_pchg = 
 "• If '% Change Above/Below +/-' is 4, it means relative volume is considered when the price change is above 4%." +
 "\n• A value of 4% is positive for bullish scenarios and negative for bearish scenarios." +
 "\n• The percentage change is calculated using cumulative percentage change, so there might be a minor difference between the actual and displayed percentage change."
tt_vpchg = 
 "• If 'Volume % Change Above' is 0, it means Relative Volume is considered when today's volume is greater than the previous day's volume." +
 "\n• For 'Screening Method' choice 'Retracement to EMA,' the 'Apply Volume % Change Filter' can be unchecked." +
 "\n• A 'Volume % Change Above' 300% or more often indicates a major breakout, which may happen today or the next day." +
 "\n• The volume percentage change is calculated using cumulative percentage change, so there might be a minor difference between the actual and displayed percentage change."
tt_atr = 
 "• ATR helps filter out longer or more volatile signal candles."
tt_atr_mul =
 "• Higher multiplier value filters a longer or more volatile signal candle."
tt_bf =
 "• If the input is '80', it means the body covers over 80% of the candle."
tt_bs =
 "• 2 means the candle is 2 times larger than the previous candle."
tt_vol =
 "• Filter out a candle when its volume is greater than the SMA of the volume."
tt_rv =
 "• Filter out a candle when its volume is greater than the Relative Volume."
tt_tf =
 "• Filter out a signals between the given Time."

bool i_pchg_filter = input.bool(defval=false, title='Apply % Change Filter', tooltip=tt_pchg, group=g_af)
float i_pchg_above_below = input.float(defval=2, title='% Change Above/Below +/-', minval=0, group=g_af)

bool i_vol_pchg_filter = input.bool(defval=false, title='Apply Volume % Change Filter', tooltip=tt_vpchg, group=g_af)
float i_vol_pchg_above = input.float(defval=0, title='Volume % Change Above', minval=0, group=g_af)

bool i_atr_filter = input.bool(defval=true, title='Apply ATR Filter', tooltip=tt_atr, group=g_af)
int i_atr_length = input.int(defval=14, minval=1, title='ATR Length', group=g_af)
float i_atr_multi = input.float(defval=1, title='ATR Multiplier', minval=1, group=g_af)

bool i_body_filter = input.bool(defval=false, title='Apply Body % Filter', tooltip=tt_bf, group=g_af)
float i_body_percent = input.float(defval=80, title='Body % Above', minval=0, maxval=100, group=g_af) / 100

bool i_body_size_filter = input.bool(defval=false, title='Apply Body Size Filter', tooltip=tt_bs, group=g_af)
int i_body_size_multiplier = input.int(defval=2, title='Body Size Multiplier (x)', minval=0,  group=g_af)

bool i_volume_filter = input.bool(defval=false, title='Apply Volume Filter', tooltip=tt_vol, group=g_af)
int i_vol_sma_length = input.int(defval=20, minval=1, title='Volume SMA Length', group=g_af)

bool i_rel_vol_filter = input.bool(defval=false, title='Apply Relative Volume Filter', tooltip=tt_rv, group=g_af)
int i_rel_vol_avg_vol_len = input.int(defval=90, title='Relative Volume Length', minval=2, group=g_af)
float i_rel_vol_avg_vol_multi = input.float(defval=5, title='Rel Vol SMA Multiplier', minval=0, group=g_af)

bool i_time_filter = input.bool(defval=false, title='Apply Time Filter', tooltip=tt_tf, group=g_af)
int i_hour_1 = input.int(defval=9, minval=0, title='Time From', inline='t_1', group=g_af)
int i_minute_1 = input.int(defval=15, minval=0, title=':', inline='t_1', group=g_af)
int i_hour_2 = input.int(defval=10, minval=0, title='Time To ', inline='t_2', group=g_af)
int i_minute_2 = input.int(defval=15, minval=0, title=':', inline='t_2', group=g_af)

//_____________________________ Menu Additional Fiters End

//_____________________________ Menu Table Start

g_dtb = '█████████████████ Data Table █████████████████'
bool i_tbl_data_show  = input.bool(defval=true, title='Display Table', group=g_dtb)
string i_tbl_data_pos = input.string(defval=position.bottom_right, title='Position', options=[position.top_left, position.top_center, position.top_right, position.middle_left, position.middle_center, position.middle_right, position.bottom_left, position.bottom_center, position.bottom_right], group=g_dtb)
string i_tbl_data_txt_size = input.string(defval=size.normal, title='Size', options=[size.auto, size.tiny, size.small, size.normal, size.large, size.huge], group=g_dtb)

//_____________________________ Menu Table End

//_____________________________ Chart Settings Start

g_ch = '███████████████ Chart Settings ███████████████'
color i_pos_color = input.color(defval=#26A69A, title='Positive Mid', group=g_ch)
color i_pos_light_color = input.color(defval=#ACE5DC, title='Positive Light', group=g_ch)
color i_neg_light_color = input.color(defval=#FCCBCD, title='Negative Light', group=g_ch)
color i_neg_color = input.color(defval=#FF5252, title='Negative Mid', group=g_ch)
color i_indicator_color = input.color(defval=#2962FF, title='Indicator', group=g_ch)
color i_signal_color = input.color(defval=#FF6D00, title='Signal', group=g_ch)
color i_neu_color = input.color(defval=#D1D4DC, title='Neutral Light', group=g_ch)
color i_neu_mid_color = input.color(defval=#2A2E39, title='Neutral Mid', group=g_ch)
color i_neu_dark_color = input.color(defval=#141516, title='Neutral Dark', group=g_ch)

//_____________________________ Chart Settings End

//_____________________________ 1. Supertrend Start

[supertrend, direction] = ta.supertrend(i_st_factor, i_st_atr_period)
supertrend := barstate.isfirst ? na : supertrend

// Plot Supertrend
upTrend = plot(series=direction < 0 ? supertrend : na, title="Supertrend Up", color=i_pos_color, style=plot.style_linebr, force_overlay=true)
downTrend = plot(series=direction < 0 ? na : supertrend, title="Supertrend Down", color=i_neg_color, style=plot.style_linebr, force_overlay=true)
bodyMiddle = plot(series=barstate.isfirst ? na : (open + close) / 2, title="Body Middle", display=display.none, force_overlay=true)
fill(plot1=bodyMiddle, plot2=upTrend, color=color.new(i_pos_color, 90), fillgaps=false)
fill(plot1=bodyMiddle, plot2=downTrend, color=color.new(i_neg_color, 90), fillgaps=false)

//_____________________________ 1. Supertrend End

//_____________________________ 2. ATR Start

ma_function_atr(source, length) =>
	switch i_atr_range_smoothing
		'RMA' => ta.rma(source, length)
		'SMA' => ta.sma(source, length)
		'EMA' => ta.ema(source, length)
		'WMA' => ta.wma(source, length)

atr = ma_function_atr(ta.tr(true), i_atr_range_length)
atr_sma = ta.sma(atr, i_atr_range_sma_length)
plot(series=atr, title="ATR", color=i_indicator_color)
plot(series=atr_sma, title="ATR SMA", color=i_signal_color)

// Range Source
range_input = i_atr_range_choice == 'Auto ATR' ? (atr * i_atr_range_multiplier) : i_atr_range_points
range_source = i_atr_range_choice == 'Type Points' ? i_atr_range_points :range_input

//_____________________________ 2. ATR End

//_____________________________ Cumulative Percentage Change Start

// Function to calculate Daily Cumulative Percentage Change of Close Price
cumulative_percentage_change() =>
    var float _cum_pct_change = na
    _is_new_day = ta.change(time('D')) != 0 ? 1 : 0
    _daily_pct_change = na(close[1]) ? 0 : (close - close[1]) / close[1] * 100
    _cum_pct_change := _is_new_day ? _daily_pct_change : (na(_cum_pct_change) ? _daily_pct_change : (_cum_pct_change + _daily_pct_change))
    _cum_pct_change

// Calculate current cumulative percentage change
cum_pchg = cumulative_percentage_change()

//_____________________________ Cumulative Percentage Change End

//_____________________________ Cumulative Volume Percentage Change Start

// Function to calculate Daily Cumulative Volume
cumulative_volume() =>
    var float _cum_vol = na
    _is_new_day = ta.change(time('D')) != 0 ? 1 : 0
    _cum_vol := _is_new_day ? volume : (na(_cum_vol) ? volume : (_cum_vol + volume))
    _cum_vol

// Calculate current and previous day cumulative volumes
var float current_cum_vol = na
var float prev_cum_vol = na

if ta.change(time('D')) != 0
    prev_cum_vol := current_cum_vol
    current_cum_vol := volume
else
    current_cum_vol += volume

// Calculate Cumulative Volume Percentage Change
cum_vol_pchg = (current_cum_vol - nz(prev_cum_vol, current_cum_vol)) / nz(prev_cum_vol, current_cum_vol) * 100

//_____________________________ Cumulative Volume Percentage Change End

//_____________________________ Additional Filters Start

// % Change Filter
bool pchg_above_filter = true
bool pchg_below_filter = true
if i_pchg_filter
    pchg_above_filter := cum_pchg > i_pchg_above_below
    pchg_below_filter := cum_pchg < -i_pchg_above_below

// Volume % Change Filter
bool vol_pchg_filter = true
if i_vol_pchg_filter
    vol_pchg_filter := cum_vol_pchg >= i_vol_pchg_above

// ATR Filter
bool atr_filter = true
if i_atr_filter
    atr_filter := (high - low) > ta.atr(i_atr_length) * i_atr_multi

// Body Percent Filter
bool body_filter = true
if i_body_filter
    body_filter := (math.abs(close - open)) / (high - low) >= i_body_percent

// Body Size Filter
bool body_size_filter = true
if i_body_size_filter
    body_size_filter := (math.abs(close - open)) / (high - low) >= i_body_percent and (high - low) >= (high[1] - low[1]) * i_body_size_multiplier

// Volume SMA Filter
bool volume_filter = true
if i_volume_filter
    volume_filter := volume > ta.sma(volume, i_vol_sma_length)

// Continuous Signals Filter
average_volume = ta.sma(volume, i_rel_vol_avg_vol_len)
relative_volume = volume / average_volume[1]
rel_vol_sma_multiplier = ta.sma(relative_volume, i_rel_vol_avg_vol_len) * i_rel_vol_avg_vol_multi

bool rel_vol_filter = true
if i_rel_vol_filter
    rel_vol_filter := relative_volume > rel_vol_sma_multiplier

// Time Filter
bool time_filter = true
if i_time_filter
    time_filter := (hour > i_hour_1 or (hour == i_hour_1 and minute >= i_minute_1)) and (hour < i_hour_2 or (hour == i_hour_2 and minute < i_minute_2))

//_____________________________ Additional Filters End

//_____________________________ Signals Start

// Condition 1
short_cont = ta.crossunder(close, supertrend) and barstate.isconfirmed
long_cont = ta.crossover(close, supertrend) and barstate.isconfirmed

// Get Volatility Range After Cross 
var top_price = float(na)
var bottom_price = float(na)

if (short_cont)
    bottom_price := close - range_source
    top_price := na  // Reset top_price to avoid plotting it

if (long_cont)
    top_price := close + range_source
    bottom_price := na  // Reset bottom_price to avoid plotting it

// Condition 2
short_break_cond = 
 close < bottom_price and 
 open > close and
 atr > atr_sma and
 pchg_below_filter and
 vol_pchg_filter and
 atr_filter and
 body_filter and
 body_size_filter and
 volume_filter and
 rel_vol_filter and 
 time_filter and
 barstate.isconfirmed

long_break_cond = 
 close > top_price and 
 open < close and
 atr > atr_sma and
 pchg_above_filter and
 vol_pchg_filter and
 atr_filter and
 body_filter and
 body_size_filter and
 volume_filter and
 rel_vol_filter and 
 time_filter and
 barstate.isconfirmed

// Short Signal
var short_current_state = 0
bear_previous_state = nz(short_current_state[1])
short_current_state := bear_previous_state == 2 ? 0 : bear_previous_state
if short_cont and short_current_state == 0
    short_current_state := 1
if short_break_cond and short_current_state == 1
    short_current_state := 2

bool short_break_trigger = short_current_state == 2 ? true : false

// Long Signal
var long_current_state = 0
bull_previous_state = nz(long_current_state[1])
long_current_state := bull_previous_state == 2 ? 0 : bull_previous_state
if long_cont and long_current_state == 0
    long_current_state := 1
if long_break_cond and long_current_state == 1
    long_current_state := 2

bool long_break_trigger = long_current_state == 2 ? true : false

// Plot Supertrend Cross Bar
barcolor(color=short_cont ? i_neg_light_color : long_cont ? i_pos_light_color : na, title='Supertrend Cross Candle')

// Plot Break Signal
plotshape(series=long_break_trigger ? 3 : na, title='Long Signal', style=shape.triangleup, location=location.belowbar, color=i_pos_light_color, size=size.tiny, force_overlay=true)
plotshape(series=short_break_trigger ? 3 : na, title='Short Signal', style=shape.triangledown, location=location.abovebar, color=i_neg_light_color, size=size.tiny, force_overlay=true)
barcolor(color=short_break_trigger ? i_neg_light_color : long_break_trigger ? i_pos_light_color : na, title='Signal Candle')

// Plot Historical Range
plot(series=i_atr_range_display and i_atr_range_display and top_price == top_price[1] ? top_price : na, title='Top Range', color=i_pos_color, linewidth=1, style=plot.style_steplinebr, offset=-1, force_overlay=true)
plot(series=i_atr_range_display and i_atr_range_display and bottom_price == bottom_price[1] ? bottom_price : na, title='Bottom Range', color=i_neg_color, linewidth=1, style=plot.style_steplinebr, offset=-1, force_overlay=true)

//_____________________________ Signals End

//_____________________________ Data Table Start

// To String
day_pchg_str = str.tostring(cum_pchg,"#.##") + ' %'
volume_pchg_str = str.tostring(cum_vol_pchg,"#.##") + ' %'
day_volume_str = str.tostring(current_cum_vol/100000,"#.##") + ' L'
prev_day_volume_str = str.tostring(prev_cum_vol/100000,"#.##") + ' L'

// Color
bgcolor_1 = i_neu_dark_color
bgcolor_2 = i_neu_mid_color

pchg_col = cum_pchg > 0 ? i_pos_color : i_neg_color
vol_pchg_col = cum_vol_pchg > 0 ? i_pos_color : i_neg_color
prev_vol_pchg_col = prev_cum_vol < current_cum_vol ? i_neg_color : i_pos_color

// Plot Table
var table tbl_data = table.new(position=i_tbl_data_pos, columns=2, rows=4, border_width=1, force_overlay=true)

if barstate.islast and i_tbl_data_show
    table.cell(table_id=tbl_data, column=0, row=0, text="%Chg", text_color=i_neu_color, text_halign=text.align_left, bgcolor=bgcolor_1, text_size=i_tbl_data_txt_size)
    table.cell(table_id=tbl_data, column=1, row=0, text=day_pchg_str, text_color=pchg_col, text_halign=text.align_right, bgcolor=bgcolor_1, text_size=i_tbl_data_txt_size)

    table.cell(table_id=tbl_data, column=0, row=1, text="Vol %Chg", text_color=i_neu_color, text_halign=text.align_left, bgcolor=bgcolor_2, text_size=i_tbl_data_txt_size)
    table.cell(table_id=tbl_data, column=1, row=1, text=volume_pchg_str, text_color=vol_pchg_col, text_halign=text.align_right, bgcolor=bgcolor_2, text_size=i_tbl_data_txt_size)

    table.cell(table_id=tbl_data, column=0, row=2, text="Vol", text_color=i_neu_color, text_halign=text.align_left, bgcolor=bgcolor_1, text_size=i_tbl_data_txt_size)
    table.cell(table_id=tbl_data, column=1, row=2, text=day_volume_str, text_color=vol_pchg_col, text_halign=text.align_right, bgcolor=bgcolor_1, text_size=i_tbl_data_txt_size)

    table.cell(table_id=tbl_data, column=0, row=3, text="PD Vol", text_color=i_neu_color, text_halign=text.align_left, bgcolor=bgcolor_2, text_size=i_tbl_data_txt_size)
    table.cell(table_id=tbl_data, column=1, row=3, text=prev_day_volume_str, text_color=prev_vol_pchg_col, text_halign=text.align_right, bgcolor=bgcolor_2, text_size=i_tbl_data_txt_size)

//_____________________________ Data Table End

//_____________________________ Code End

// Readme First:
// 
// Trend Following Setup - Sideways Market Skipper Scanner
// 
// Long Signal Logic:
//  - Close crosses above the Supertrend.
//  - Add ATR value (with multiplier) to the close to identify the potential sideways or volatility range.
//  - When the price crosses this range, it's considered a breakout.
//  - The ATR should be rising or the volatility is increasing.
// 
// Short Signal Logic:
//  - Close crosses below the Supertrend.
//  - Substract ATR value (with multiplier) to the close to identify the potential sideways or volatility range.
//  - When the price crosses this range, it's considered a breakdown.
//  - The ATR should be rising or the volatility is increasing.
//
// Entry: Enter after the retracement once the signal is generated.

##-- File Name: PineScript-main/Trend Following Setup - Sideways Market Skipper Scanner/Indicator - Trend Following Setup - Sideways Market Skipper.txt | File No: 38 | Ended --##

##-- File Name: PineScript-main/Trend Following Setup - Sideways Market Skipper Scanner/Readme First.txt | File No: 39 | Started --##
// Readme First:
// 
// Trend Following Setup - Sideways Market Skipper Scanner
// 
// Long Signal Logic:
//  - Close crosses above the Supertrend.
//  - Add ATR value (with multiplier) to the close to identify the potential sideways or volatility range.
//  - When the price crosses this range, it's considered a breakout.
//  - The ATR should be rising or the volatility is increasing.
// 
// Short Signal Logic:
//  - Close crosses below the Supertrend.
//  - Substract ATR value (with multiplier) to the close to identify the potential sideways or volatility range.
//  - When the price crosses this range, it's considered a breakdown.
//  - The ATR should be rising or the volatility is increasing.
//
// Entry: Enter after the retracement once the signal is generated.
##-- File Name: PineScript-main/Trend Following Setup - Sideways Market Skipper Scanner/Readme First.txt | File No: 39 | Ended --##

##-- File Name: PineScript-main/Trend Following Setup - Sideways Market Skipper Scanner/Scanner - Trend Following Setup - Sideways Market Skipper Scanner.txt | File No: 40 | Started --##
// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © Arun_K_Bhaskar

//@version=5
indicator(title='Trend Following Setup - Sideways Market Skipper Scanner', shorttitle='Sideways Skip Scan', overlay=false, max_bars_back=500)

//_____________________________ Menu Scanner Start

g_scrtb = '██████████████████ Scanner ██████████████████'

//string i_scr_choose = input.string(defval='Continuous Signals', title='Scanning Method', options=['Continuous Signals', 'Flip Signals'], group=g_scrtb)

tt_is = "• Reads only up to first 40 symbols." +
     "\n• Total characters cannot exceed 4096." +
     "\n• Eg: EXCHANGE:SYMBOL_A,EXCHANGE:SYMBOL_B"

string i_symbols = input.text_area(
 defval="NSE:ABFRL,NSE:ASHOKA,NSE:BALMLAWRIE,NSE:BEL,NSE:BHEL,NSE:BOMDYEING,NSE:CANBK,NSE:DBREALTY,NSE:DCXINDIA,NSE:ENGINERSIN,NSE:GAIL,NSE:HINDCOPPER,NSE:HUDCO,NSE:INDIACEM,NSE:INOXWIND,NSE:IRCON,NSE:IRFC,NSE:ITI,NSE:MARKSANS,NSE:MIDHANI,NSE:MRPL,NSE:NATIONALUM,NSE:NBCC,NSE:NCC,NSE:NFL,NSE:NHPC,NSE:NLCINDIA,NSE:PNB,NSE:PTC,NSE:RAILTEL,NSE:RCF,NSE:RELINFRA,NSE:RVNL,NSE:SAIL,NSE:SCI,NSE:SJVN,NSE:TI,NSE:UNIONBANK,NSE:VEDL,NSE:ZEEL", 
 title="Paste Symbols", tooltip=tt_is, group=g_scrtb)

bool i_scr_show_table  = input.bool(defval=true, title='Display Table', group=g_scrtb)
bool i_scr_show_long  = input.bool(defval=true, title='Long Signals', inline='tb_2', group=g_scrtb)
bool i_scr_show_short  = input.bool(defval=true, title='Short Signals', inline='tb_2', group=g_scrtb)

int i_scr_tbl_disp_rows = input.int(defval=12, title='Display Rows', minval=0, maxval=100, group=g_scrtb)
string i_scr_tbl_position = input.string(defval=position.bottom_left, title='Table Position', options=[position.top_left, position.top_center, position.top_right, position.middle_left, position.middle_center, position.middle_right, position.bottom_left, position.bottom_center, position.bottom_right], group=g_scrtb)
string i_scr_tbl_text_size = input.string(defval=size.small, title='Table Size', options=[size.auto, size.tiny, size.small, size.normal, size.large, size.huge], group=g_scrtb)

//_____________________________ Menu Scanner End

//_____________________________ Menu Supertrend Start

g_st = '█████████████████ Supertrend █████████████████'
//bool i_st_display = input.bool(defval=true, title='Display', group=g_st)
int i_st_atr_period = input.int(defval=10, title="ATR Length", minval=1, group=g_st)
float i_st_factor = input.float(defval=3.0, title="Factor", minval=0.01, step=0.01, group=g_st)

//_____________________________ Menu Supertrend End

//_____________________________ Menu Range Start

g_r = '███████████████ Volatility Range ███████████████'

tt_r = 
 "• 'Auto ATR': Automatically sets the range based on the ATR value." +
 "\n• The range adjusts automatically when switching between symbols." +
 "\n• The default ATR timeframe is 1 hour." +
 "\n• For a Supertrend Long Crossover, the range is defined by adding the ATR value." +
 "\n• For a Supertrend Short Crossunder, the range is defined by subtracting the ATR value." +
 "\n\n• Type Points: Manually enter the points for different symbols to define the volatility range." +
 "\n• For example, the points are 60 for NIFTY and 120 for BANKNIFTY."

tt_tp = "Applicable only when 'Range Type' is selected as 'Type Points'."

tt_atr_tf =
 "• This uses the ATR value of the given timeframe." +
 "\n• The default ATR timeframe is 1 hour."

bool i_atr_range_display = input.bool(defval=true, title='Display', group=g_r)
string i_atr_range_choice = input.string(defval='Auto ATR', title='Range Type', options=['Auto ATR', 'Type Points'], tooltip=tt_r, group=g_r)
float i_atr_range_points = input.float(defval=120, title="Type Points", minval=0.01, tooltip=tt_tp, group=g_r)

//string i_atr_range_timeframe = input.timeframe(defval='60', title='ATR Timeframe', tooltip=tt_atr_tf, group=g_r)
int i_atr_range_length = input.int(defval=14, title='ATR Length', minval=1, group=g_r)
string i_atr_range_smoothing = input.string(title="ATR Smoothing", defval="RMA", options=["RMA", "SMA", "EMA", "WMA"], group=g_r)
float i_atr_range_multiplier = input.float(defval=1.5, title="ATR Multiplier", minval=1, step=0.5, group=g_r)
int i_atr_range_sma_length = input.int(defval=14, title='ATR SMA Length', minval=1, group=g_r)

//_____________________________ Menu Range End

//_____________________________ Menu Additional Fiters Start

g_af = '███████████████ Additional Fiters ███████████████'
tt_pchg = 
 "• If '% Change Above/Below +/-' is 4, it means relative volume is considered when the price change is above 4%." +
 "\n• A value of 4% is positive for bullish scenarios and negative for bearish scenarios." +
 "\n• The percentage change is calculated using cumulative percentage change, so there might be a minor difference between the actual and displayed percentage change."
tt_vpchg = 
 "• If 'Volume % Change Above' is 0, it means Relative Volume is considered when today's volume is greater than the previous day's volume." +
 "\n• For 'Screening Method' choice 'Retracement to EMA,' the 'Apply Volume % Change Filter' can be unchecked." +
 "\n• A 'Volume % Change Above' 300% or more often indicates a major breakout, which may happen today or the next day." +
 "\n• The volume percentage change is calculated using cumulative percentage change, so there might be a minor difference between the actual and displayed percentage change."
tt_atr = 
 "• ATR helps filter out longer or more volatile signal candles."
tt_atr_mul =
 "• Higher multiplier value filters a longer or more volatile signal candle."
tt_bf =
 "• If the input is '80', it means the body covers over 80% of the candle."
tt_bs =
 "• 2 means the candle is 2 times larger than the previous candle."
tt_vol =
 "• Filter out a candle when its volume is greater than the SMA of the volume."
tt_rv =
 "• Filter out a candle when its volume is greater than the Relative Volume."
tt_tf =
 "• Filter out a signals between the given Time."

bool i_pchg_filter = input.bool(defval=false, title='Apply % Change Filter', tooltip=tt_pchg, group=g_af)
float i_pchg_above_below = input.float(defval=2, title='% Change Above/Below +/-', minval=0, group=g_af)

bool i_vol_pchg_filter = input.bool(defval=false, title='Apply Volume % Change Filter', tooltip=tt_vpchg, group=g_af)
float i_vol_pchg_above = input.float(defval=0, title='Volume % Change Above', minval=0, group=g_af)

bool i_atr_filter = input.bool(defval=true, title='Apply ATR Filter', tooltip=tt_atr, group=g_af)
int i_atr_length = input.int(defval=14, minval=1, title='ATR Length', group=g_af)
float i_atr_multi = input.float(defval=1, title='ATR Multiplier', minval=1, group=g_af)

bool i_body_filter = input.bool(defval=false, title='Apply Body % Filter', tooltip=tt_bf, group=g_af)
float i_body_percent = input.float(defval=80, title='Body % Above', minval=0, maxval=100, group=g_af) / 100

bool i_body_size_filter = input.bool(defval=false, title='Apply Body Size Filter', tooltip=tt_bs, group=g_af)
int i_body_size_multiplier = input.int(defval=2, title='Body Size Multiplier (x)', minval=0,  group=g_af)

bool i_volume_filter = input.bool(defval=false, title='Apply Volume Filter', tooltip=tt_vol, group=g_af)
int i_vol_sma_length = input.int(defval=20, minval=1, title='Volume SMA Length', group=g_af)

bool i_rel_vol_filter = input.bool(defval=false, title='Apply Relative Volume Filter', tooltip=tt_rv, group=g_af)
int i_rel_vol_avg_vol_len = input.int(defval=90, title='Relative Volume Length', minval=2, group=g_af)
float i_rel_vol_avg_vol_multi = input.float(defval=5, title='Rel Vol SMA Multiplier', minval=0, group=g_af)

bool i_time_filter = input.bool(defval=false, title='Apply Time Filter', tooltip=tt_tf, group=g_af)
int i_hour_1 = input.int(defval=9, minval=0, title='Time From', inline='t_1', group=g_af)
int i_minute_1 = input.int(defval=15, minval=0, title=':', inline='t_1', group=g_af)
int i_hour_2 = input.int(defval=10, minval=0, title='Time To ', inline='t_2', group=g_af)
int i_minute_2 = input.int(defval=15, minval=0, title=':', inline='t_2', group=g_af)

//_____________________________ Menu Additional Fiters End

//_____________________________ Menu Table Start

g_dtb = '█████████████████ Data Table █████████████████'
bool i_tbl_data_show  = input.bool(defval=true, title='Display Table', group=g_dtb)
string i_tbl_data_pos = input.string(defval=position.bottom_right, title='Position', options=[position.top_left, position.top_center, position.top_right, position.middle_left, position.middle_center, position.middle_right, position.bottom_left, position.bottom_center, position.bottom_right], group=g_dtb)
string i_tbl_data_txt_size = input.string(defval=size.normal, title='Size', options=[size.auto, size.tiny, size.small, size.normal, size.large, size.huge], group=g_dtb)

//_____________________________ Menu Table End

//_____________________________ Chart Settings Start

g_ch = '███████████████ Chart Settings ███████████████'
color i_pos_dark_color = input.color(defval=#03110F, title='Positive Dark', group=g_ch)
color i_pos_color = input.color(defval=#26A69A, title='Positive Mid', group=g_ch)
color i_pos_light_color = input.color(defval=#ACE5DC, title='Positive Light', group=g_ch)
color i_neg_light_color = input.color(defval=#FCCBCD, title='Negative Light', group=g_ch)
color i_neg_color = input.color(defval=#FF5252, title='Negative Mid', group=g_ch)
color i_neg_dark_color = input.color(defval=#180809, title='Negative Dark', group=g_ch)
color i_indicator_color = input.color(defval=#2962FF, title='Indicator', group=g_ch)
color i_signal_color = input.color(defval=#FF6D00, title='Signal', group=g_ch)
color i_neu_color = input.color(defval=#D1D4DC, title='Neutral Light', group=g_ch)
color i_neu_mid_color = input.color(defval=#2A2E39, title='Neutral Mid', group=g_ch)
color i_neu_dark_color = input.color(defval=#141516, title='Neutral Dark', group=g_ch)

//_____________________________ Chart Settings End

//_____________________________ 1. Supertrend Start

[supertrend, direction] = ta.supertrend(i_st_factor, i_st_atr_period)
supertrend := barstate.isfirst ? na : supertrend

// Plot Supertrend
upTrend = plot(series=direction < 0 ? supertrend : na, title="Supertrend Up", color=i_pos_color, style=plot.style_linebr, force_overlay=true)
downTrend = plot(series=direction < 0 ? na : supertrend, title="Supertrend Down", color=i_neg_color, style=plot.style_linebr, force_overlay=true)
bodyMiddle = plot(series=barstate.isfirst ? na : (open + close) / 2, title="Body Middle", display=display.none, force_overlay=true)
fill(plot1=bodyMiddle, plot2=upTrend, color=color.new(i_pos_color, 90), fillgaps=false)
fill(plot1=bodyMiddle, plot2=downTrend, color=color.new(i_neg_color, 90), fillgaps=false)

//_____________________________ 1. Supertrend End

//_____________________________ 2. ATR Start

ma_function_atr(source, length) =>
	switch i_atr_range_smoothing
		'RMA' => ta.rma(source, length)
		'SMA' => ta.sma(source, length)
		'EMA' => ta.ema(source, length)
		'WMA' => ta.wma(source, length)

atr = ma_function_atr(ta.tr(true), i_atr_range_length)
atr_sma = ta.sma(atr, i_atr_range_sma_length)
plot(series=atr, title="ATR", color=i_indicator_color)
plot(series=atr_sma, title="ATR SMA", color=i_signal_color)

// Range Source
range_input = i_atr_range_choice == 'Auto ATR' ? (atr * i_atr_range_multiplier) : i_atr_range_points
range_source = i_atr_range_choice == 'Type Points' ? i_atr_range_points :range_input

//_____________________________ 2. ATR End

//_____________________________ Cumulative Percentage Change Start

// Function to calculate Daily Cumulative Percentage Change of Close Price
cumulative_percentage_change() =>
    var float _cum_pct_change = na
    _is_new_day = ta.change(time('D')) != 0 ? 1 : 0
    _daily_pct_change = na(close[1]) ? 0 : (close - close[1]) / close[1] * 100
    _cum_pct_change := _is_new_day ? _daily_pct_change : (na(_cum_pct_change) ? _daily_pct_change : (_cum_pct_change + _daily_pct_change))
    _cum_pct_change

// Calculate current cumulative percentage change
cum_pchg = cumulative_percentage_change()

//_____________________________ Cumulative Percentage Change End

//_____________________________ Cumulative Volume Percentage Change Start

// Function to calculate Daily Cumulative Volume
cumulative_volume() =>
    var float _cum_vol = na
    _is_new_day = ta.change(time('D')) != 0 ? 1 : 0
    _cum_vol := _is_new_day ? volume : (na(_cum_vol) ? volume : (_cum_vol + volume))
    _cum_vol

// Calculate current and previous day cumulative volumes
var float current_cum_vol = na
var float prev_cum_vol = na

if ta.change(time('D')) != 0
    prev_cum_vol := current_cum_vol
    current_cum_vol := volume
else
    current_cum_vol += volume

// Calculate Cumulative Volume Percentage Change
cum_vol_pchg = (current_cum_vol - nz(prev_cum_vol, current_cum_vol)) / nz(prev_cum_vol, current_cum_vol) * 100

//_____________________________ Cumulative Volume Percentage Change End

//_____________________________ Additional Filters Start

// % Change Filter
bool pchg_above_filter = true
bool pchg_below_filter = true
if i_pchg_filter
    pchg_above_filter := cum_pchg > i_pchg_above_below
    pchg_below_filter := cum_pchg < -i_pchg_above_below

// Volume % Change Filter
bool vol_pchg_filter = true
if i_vol_pchg_filter
    vol_pchg_filter := cum_vol_pchg >= i_vol_pchg_above

// ATR Filter
bool atr_filter = true
if i_atr_filter
    atr_filter := (high - low) > ta.atr(i_atr_length) * i_atr_multi

// Body Percent Filter
bool body_filter = true
if i_body_filter
    body_filter := (math.abs(close - open)) / (high - low) >= i_body_percent

// Body Size Filter
bool body_size_filter = true
if i_body_size_filter
    body_size_filter := (math.abs(close - open)) / (high - low) >= i_body_percent and (high - low) >= (high[1] - low[1]) * i_body_size_multiplier

// Volume SMA Filter
bool volume_filter = true
if i_volume_filter
    volume_filter := volume > ta.sma(volume, i_vol_sma_length)

// Continuous Signals Filter
average_volume = ta.sma(volume, i_rel_vol_avg_vol_len)
relative_volume = volume / average_volume[1]
rel_vol_sma_multiplier = ta.sma(relative_volume, i_rel_vol_avg_vol_len) * i_rel_vol_avg_vol_multi

bool rel_vol_filter = true
if i_rel_vol_filter
    rel_vol_filter := relative_volume > rel_vol_sma_multiplier

// Time Filter
bool time_filter = true
if i_time_filter
    time_filter := (hour > i_hour_1 or (hour == i_hour_1 and minute >= i_minute_1)) and (hour < i_hour_2 or (hour == i_hour_2 and minute < i_minute_2))

//_____________________________ Additional Filters End

//_____________________________ Signals Start

// Condition 1
short_cont = ta.crossunder(close, supertrend) and barstate.isconfirmed
long_cont = ta.crossover(close, supertrend) and barstate.isconfirmed

// Get Volatility Range After Cross 
var top_price = float(na)
var bottom_price = float(na)

if (short_cont)
    bottom_price := close - range_source
    top_price := na  // Reset top_price to avoid plotting it

if (long_cont)
    top_price := close + range_source
    bottom_price := na  // Reset bottom_price to avoid plotting it

// Condition 2
short_break_cond = 
 close < bottom_price and 
 open > close and
 atr > atr_sma and
 pchg_below_filter and
 vol_pchg_filter and
 atr_filter and
 body_filter and
 body_size_filter and
 volume_filter and
 rel_vol_filter and 
 time_filter and
 barstate.isconfirmed

long_break_cond = 
 close > top_price and 
 open < close and
 atr > atr_sma and
 pchg_above_filter and
 vol_pchg_filter and
 atr_filter and
 body_filter and
 body_size_filter and
 volume_filter and
 rel_vol_filter and 
 time_filter and
 barstate.isconfirmed

// Short Signal
var short_current_state = 0
bear_previous_state = nz(short_current_state[1])
short_current_state := bear_previous_state == 2 ? 0 : bear_previous_state
if short_cont and short_current_state == 0
    short_current_state := 1
if short_break_cond and short_current_state == 1
    short_current_state := 2

bool short_break_trigger = short_current_state == 2 ? true : false

// Long Signal
var long_current_state = 0
bull_previous_state = nz(long_current_state[1])
long_current_state := bull_previous_state == 2 ? 0 : bull_previous_state
if long_cont and long_current_state == 0
    long_current_state := 1
if long_break_cond and long_current_state == 1
    long_current_state := 2

bool long_break_trigger = long_current_state == 2 ? true : false

// Plot Supertrend Cross Bar
barcolor(color=short_cont ? i_neg_light_color : long_cont ? i_pos_light_color : na, title='Supertrend Cross Candle')

// Plot Break Signal
plotshape(series=long_break_trigger ? 3 : na, title='Long Signal', style=shape.triangleup, location=location.belowbar, color=i_pos_light_color, size=size.tiny, force_overlay=true)
plotshape(series=short_break_trigger ? 3 : na, title='Short Signal', style=shape.triangledown, location=location.abovebar, color=i_neg_light_color, size=size.tiny, force_overlay=true)
barcolor(color=short_break_trigger ? i_neg_light_color : long_break_trigger ? i_pos_light_color : na, title='Signal Candle')

// Plot Historical Range
plot(series=i_atr_range_display and i_atr_range_display and top_price == top_price[1] ? top_price : na, title='Top Range', color=i_pos_color, linewidth=1, style=plot.style_steplinebr, offset=-1, force_overlay=true)
plot(series=i_atr_range_display and i_atr_range_display and bottom_price == bottom_price[1] ? bottom_price : na, title='Bottom Range', color=i_neg_color, linewidth=1, style=plot.style_steplinebr, offset=-1, force_overlay=true)

//_____________________________ Signals End

//_____________________________ Data Table Start

// To String
day_pchg_str = str.tostring(cum_pchg,"#.##") + ' %'
volume_pchg_str = str.tostring(cum_vol_pchg,"#.##") + ' %'
day_volume_str = str.tostring(current_cum_vol/100000,"#.##") + ' L'
prev_day_volume_str = str.tostring(prev_cum_vol/100000,"#.##") + ' L'

// Color
bgcolor_1 = i_neu_dark_color
bgcolor_2 = i_neu_mid_color

pchg_col = cum_pchg > 0 ? i_pos_color : i_neg_color
vol_pchg_col = cum_vol_pchg > 0 ? i_pos_color : i_neg_color
prev_vol_pchg_col = prev_cum_vol < current_cum_vol ? i_neg_color : i_pos_color

// Plot Table
var table tbl_data = table.new(position=i_tbl_data_pos, columns=2, rows=4, border_width=1, force_overlay=true)

if barstate.islast and i_tbl_data_show
    table.cell(table_id=tbl_data, column=0, row=0, text="%Chg", text_color=i_neu_color, text_halign=text.align_left, bgcolor=bgcolor_1, text_size=i_tbl_data_txt_size)
    table.cell(table_id=tbl_data, column=1, row=0, text=day_pchg_str, text_color=pchg_col, text_halign=text.align_right, bgcolor=bgcolor_1, text_size=i_tbl_data_txt_size)

    table.cell(table_id=tbl_data, column=0, row=1, text="Vol %Chg", text_color=i_neu_color, text_halign=text.align_left, bgcolor=bgcolor_2, text_size=i_tbl_data_txt_size)
    table.cell(table_id=tbl_data, column=1, row=1, text=volume_pchg_str, text_color=vol_pchg_col, text_halign=text.align_right, bgcolor=bgcolor_2, text_size=i_tbl_data_txt_size)

    table.cell(table_id=tbl_data, column=0, row=2, text="Vol", text_color=i_neu_color, text_halign=text.align_left, bgcolor=bgcolor_1, text_size=i_tbl_data_txt_size)
    table.cell(table_id=tbl_data, column=1, row=2, text=day_volume_str, text_color=vol_pchg_col, text_halign=text.align_right, bgcolor=bgcolor_1, text_size=i_tbl_data_txt_size)

    table.cell(table_id=tbl_data, column=0, row=3, text="PD Vol", text_color=i_neu_color, text_halign=text.align_left, bgcolor=bgcolor_2, text_size=i_tbl_data_txt_size)
    table.cell(table_id=tbl_data, column=1, row=3, text=prev_day_volume_str, text_color=prev_vol_pchg_col, text_halign=text.align_right, bgcolor=bgcolor_2, text_size=i_tbl_data_txt_size)

//_____________________________ Data Table End

//_____________________________ Get Symbols for Scanner Start

// Acknowledgement & Reference
// Trader: 'allanster'
// Indicator Title: 'How To Input CSV List Of Symbol Data Used For Scanner'
// Indicator Link: 'https://www.tradingview.com/script/KfqHqHUH-How-To-Input-CSV-List-Of-Symbol-Data-Used-For-Scanner/'

feed(back) =>                                             // extract tickerid and decrement list of ticker IDs
    loop  = back                                          // declare string variable to hold content list
    getT  = string(na)                                    // declare string variable to hold tickerid
    if str.length(loop) == 0                              // if list is empty
        getT := string(na)                                // assign na to tickerid variable
        loop := string(na)                                // assign na to list of ticker Ids variable
    else                                                  // else extract first tickerid
        getP  = nz(str.pos(loop, ','), str.length(loop))  // get position of first comma or last character
        getT := str.substring(loop, 0, getP)              // get tickerid in first position of list
        loop := str.replace(loop, getT + ',', '')         // clear tickerid + delimiter character from list
    [getT, loop]                                          // return tickerid in first position & truncated list

[tid_01, out_01] = feed(i_symbols), [tid_02, out_02] = feed(out_01), [tid_03, out_03] = feed(out_02), [tid_04, out_04] = feed(out_03),
[tid_05, out_05] = feed(out_04), [tid_06, out_06] = feed(out_05), [tid_07, out_07] = feed(out_06), [tid_08, out_08] = feed(out_07),
[tid_09, out_09] = feed(out_08), [tid_10, out_10] = feed(out_09), [tid_11, out_11] = feed(out_10), [tid_12, out_12] = feed(out_11),
[tid_13, out_13] = feed(out_12), [tid_14, out_14] = feed(out_13), [tid_15, out_15] = feed(out_14), [tid_16, out_16] = feed(out_15),
[tid_17, out_17] = feed(out_16), [tid_18, out_18] = feed(out_17), [tid_19, out_19] = feed(out_18), [tid_20, out_20] = feed(out_19),
[tid_21, out_21] = feed(out_20), [tid_22, out_22] = feed(out_21), [tid_23, out_23] = feed(out_22), [tid_24, out_24] = feed(out_23),
[tid_25, out_25] = feed(out_24), [tid_26, out_26] = feed(out_25), [tid_27, out_27] = feed(out_26), [tid_28, out_28] = feed(out_27),
[tid_29, out_29] = feed(out_28), [tid_30, out_30] = feed(out_29), [tid_31, out_31] = feed(out_30), [tid_32, out_32] = feed(out_31),
[tid_33, out_33] = feed(out_32), [tid_34, out_34] = feed(out_33), [tid_35, out_35] = feed(out_34), [tid_36, out_36] = feed(out_35),
[tid_37, out_37] = feed(out_36), [tid_38, out_38] = feed(out_37), [tid_39, out_39] = feed(out_38), [tid_40, out_40] = feed(out_39)

//_____________________________ Get Symbols for Scanner End

//_____________________________ Scanner Start

// Acknowledgement & Reference
// Trader: 'MUQWISHI'
// Indicator Title: 'Candlestick Patterns Scanner [By MUQWISHI]'
// Indicator Link: 'https://www.tradingview.com/script/xiWQuGOq-Candlestick-Patterns-Scanner-By-MUQWISHI/'

// Scanner Conditions
short_cond = short_break_trigger
long_cond = long_break_trigger 

// Function for Scanner Indicator Calculation
indicator_calculation() =>
    // Initialize variables
    price = float(na)
    _time = int(na)
    _cum_pchg = float(na)
    _cum_vol_pchg = float(na)
    signal = int(na) 

    if barstate.isconfirmed
        // Check for Short Momentum Candle and conditions (Modify here to customize indicators)
        if i_scr_show_long and long_cond
            signal := 1

        // Check for Long Momentum Candle and conditions (Modify here to customize indicators)
        else if i_scr_show_short and short_cond
            signal := -1

        // Update price and time if signal is not null
        if not na(signal)
            price := math.round_to_mintick(close)
            _time := time
            _cum_pchg := cum_pchg
            _cum_vol_pchg := cum_vol_pchg

    [_time, price, _cum_pchg, _cum_vol_pchg, signal]

// Function to format time
format_time(x) =>
    timezone = syminfo.timezone
    timeframe.isintraday ? str.format_time(x, "HH:mm  dd-MM-yyyy", timezone) : str.format_time(x, "dd-MM-yyyy", timezone)

// Function to extract symbol name
symbol(s) => 
    array.get(str.split(s, ":"), 1)

// Matrix setup
var matrix = matrix.new<string>(0, 6, na)

// Function to add rows to the matrix
mtxFun(symbol, _time, price, _cum_pchg, _cum_vol_pchg, signal) =>
    matrix.add_row(matrix, 0, array.from(symbol, _time, price, _cum_pchg, _cum_vol_pchg, signal))

// Scanner function to collect data
screener(s) =>
    sym = ticker.modify(s, syminfo.session)
    [_time, price, _cum_pchg, _cum_vol_pchg, signal] = request.security(sym, timeframe.period, indicator_calculation())

    // Check if the signal is not na and the time matches
    if not na(signal) and _time == time
        symbolName = symbol(s)
        formattedTime = format_time(_time)
        strPrice = str.tostring(price)
        str_cum_pchg = str.tostring(_cum_pchg, '#.##')
        str_cum_vol_pchg = str.tostring(_cum_vol_pchg, '#.##')
        strSignal = str.tostring(signal)
        
        // Add data to the matrix
        mtxFun(symbolName, formattedTime, strPrice, str_cum_pchg, str_cum_vol_pchg, strSignal)

// Call Scanner function for multiple symbols
screener(tid_01), screener(tid_02), screener(tid_03), screener(tid_04), screener(tid_05), screener(tid_06), screener(tid_07),
screener(tid_08), screener(tid_09), screener(tid_10), screener(tid_11), screener(tid_12), screener(tid_13), screener(tid_14),
screener(tid_15), screener(tid_16), screener(tid_17), screener(tid_18), screener(tid_19), screener(tid_20), screener(tid_21),
screener(tid_22), screener(tid_23), screener(tid_24), screener(tid_25), screener(tid_26), screener(tid_27), screener(tid_28),
screener(tid_29), screener(tid_30), screener(tid_31), screener(tid_32), screener(tid_33), screener(tid_34), screener(tid_35),
screener(tid_36), screener(tid_37), screener(tid_38), screener(tid_39), screener(tid_40)

// Trim excess rows in the matrix
if matrix.rows(matrix) > i_scr_tbl_disp_rows
    while matrix.rows(matrix) > i_scr_tbl_disp_rows
        matrix.remove_row(matrix, matrix.rows(matrix)-1)

// Plot Table
// Create table with specified properties
var table scr_tbl = table.new(position=i_scr_tbl_position, columns=5, rows=102, border_width=1, force_overlay=true)

// Function to populate cells in the table
scr_cell_title(col, row, txt) => 
    table.cell(scr_tbl, col, row, text = txt, text_color = i_neu_color, text_halign=text.align_center, bgcolor=i_neu_dark_color, text_size=i_scr_tbl_text_size)

scr_cell(col, row, txt, _text_color, _bgcolor) => 
    table.cell(scr_tbl, col, row, text = txt, text_color = _text_color, text_halign=text.align_left, bgcolor=_bgcolor, text_size=i_scr_tbl_text_size)

// Check if it's the last bar
if barstate.islast and i_scr_show_table
    // Clear existing data in the table
    table.clear(scr_tbl, 0, 0, 2, 101)

    scr_cell_title(0, 0, "Sideways Market Skipper")
    table.merge_cells(table_id=scr_tbl, start_column=0, start_row=0, end_column=4, end_row=0)
    scr_cell_title(0, 1, "Symbol")
    scr_cell_title(1, 1, "Time")
    scr_cell_title(2, 1, "Price")
    scr_cell_title(3, 1, "%Chg")
    scr_cell_title(4, 1, "V %Chg")

    j = 4
    // Populate table with matrix data
    if matrix.rows(matrix) > 0
        for i = 0 to matrix.rows(matrix) - 1
            // Determine color based on the signal

            _textcolor = 
             matrix.get(matrix, i, 5) ==  "1" ? i_pos_color : 
             matrix.get(matrix, i, 5) == "-1" ? i_neg_color : i_neu_color

            _bg_color = 
             matrix.get(matrix, i, 5) ==  "1" ? i_pos_dark_color :
             matrix.get(matrix, i, 5) == "-1" ? i_neg_dark_color : i_neu_color

            // Populate cells in the table
            scr_cell(0, j, matrix.get(matrix, i, 0), _textcolor, _bg_color)
            scr_cell(1, j, matrix.get(matrix, i, 1), _textcolor, _bg_color)
            scr_cell(2, j, matrix.get(matrix, i, 2), _textcolor, _bg_color)
            scr_cell(3, j, matrix.get(matrix, i, 3), _textcolor, _bg_color)
            scr_cell(4, j, matrix.get(matrix, i, 4), _textcolor, _bg_color)

            j += 1

//_____________________________ Scanner End

//_____________________________ Code End

// Readme First:
// 
// Trend Following Setup - Sideways Market Skipper Scanner
// 
// Long Signal Logic:
//  - Close crosses above the Supertrend.
//  - Add ATR value (with multiplier) to the close to identify the potential sideways or volatility range.
//  - When the price crosses this range, it's considered a breakout.
//  - The ATR should be rising or the volatility is increasing.
// 
// Short Signal Logic:
//  - Close crosses below the Supertrend.
//  - Substract ATR value (with multiplier) to the close to identify the potential sideways or volatility range.
//  - When the price crosses this range, it's considered a breakdown.
//  - The ATR should be rising or the volatility is increasing.
//
// Entry: Enter after the retracement once the signal is generated.

##-- File Name: PineScript-main/Trend Following Setup - Sideways Market Skipper Scanner/Scanner - Trend Following Setup - Sideways Market Skipper Scanner.txt | File No: 40 | Ended --##


/* --- FILE: 2 All Working Pine scripts.txt --- */

/* --- FILE: Merged.pine --- */

##-- File Name: tradingview-pinescript-indicators-master/bands_and_channels/acceleration_bands.pine | File No: 1 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Acceleration Bands script may be freely distributed under the terms of the GPL-3.0 license.
study(title="Acceleration Bands", shorttitle="AB", overlay=true)

length = input(title="Length", type=integer, defval=20)
factor = input(title="Factor", type=float, defval=0.001, step=0.0001)
src = input(title="Source", type=source, defval=close)

mult = 4000 * factor * (high - low) / (high + low)

upperBandSrc = high * (1 + mult)
upperBand = sma(upperBandSrc, length)

basis = sma(src, length)

lowerBandSrc = low * (1 - mult)
lowerBand = sma(lowerBandSrc, length)

upperBandPlot = plot(upperBand, title="Upper", linewidth=1, color=#138484, transp=0)

plot(basis, title="Basis", linewidth=1, color=#741b47, transp=0)

lowerBandPlot = plot(lowerBand, title="Lower", linewidth=1, color=#138484, transp=0)

fill(upperBandPlot, lowerBandPlot, title="Background", color=color(#ffd966, 84))

##-- File Name: tradingview-pinescript-indicators-master/bands_and_channels/acceleration_bands.pine | File No: 1 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/bands_and_channels/interquartile_range_bands.pine | File No: 2 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Interquartile Range Bands script may be freely distributed under the terms of GPL-3.0 license.
study("Interquartile Range Bands", shorttitle="IQRB", overlay=true)

length = input(title="Length", type=integer, minval=1, defval=14)
mult = input(title="Multiplier", type=float, minval=0, step=0.1, defval=1.5)
src = input(title="Source", type=source, defval=close)

q1 = percentile_nearest_rank(src, length, 25)
median= percentile_nearest_rank(src, length, 50)
q3 = percentile_nearest_rank(src, length, 75)

iqr = q3 - q1

upperBand = q3 + mult * iqr
lowerBand = q1 - mult * iqr

upperBandPlot = plot(upperBand, title="Upper", color=#138484, transp=0)
plot(median, title="Median", color=#741b47, transp=0)
lowerBandPlot = plot(lowerBand, title="Lower", color=#138484, transp=0)
fill(upperBandPlot, lowerBandPlot, title="Background", color=color(#ffd966, 84))

##-- File Name: tradingview-pinescript-indicators-master/bands_and_channels/interquartile_range_bands.pine | File No: 2 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/bands_and_channels/kirshenbaum_bands.pine | File No: 3 | Started --##
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Kirshenbaum Bands script may be freely distributed under the terms of the GPL-3.0 license.
study("Kirshenbaum Bands", shorttitle="KB", overlay=true)

length = input(title="Length", type=integer, defval=30)
regressionLength = input(title="Regression Length", type=integer, defval=20)
mult = input(title="Multiplier", type=float, step=0.1, defval=1.75)
src = input(title="Source", type=source, defval=close)

regression = linreg(src, regressionLength, 0)
stderror = mult * sqrt(sma(pow(src - regression, 2), regressionLength))

basis = ema(src, length)
upper = basis + stderror
lower = basis - stderror

plot(basis, title="Basis", color=#351c75, transp=0)
upperBandPlot = plot(upper, title="Upper", color=#45818e, transp=0)
lowerBandPlot = plot(lower, title="Lower", color=#45818e, transp=0)
fill(upperBandPlot, lowerBandPlot, title="Background", color=color(#ffd966, 84))

##-- File Name: tradingview-pinescript-indicators-master/bands_and_channels/kirshenbaum_bands.pine | File No: 3 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/bands_and_channels/mean_absolute_deviation_bands.pine | File No: 4 | Started --##
//@version=4
// Copyright (c) 2020-present, Alex Orekhov (everget)
// Mean Absolute Deviation Bands script may be freely distributed under the terms of the GPL-3.0 license.
study("Mean Absolute Deviation Bands", shorttitle="MADB", overlay=true)

length = input(title="Length", defval=20, minval=2)
mult = input(title="Bands Multiplier", defval=2.0, type=input.float, step=0.1)
src = input(title="Source", defval=close)

basis = sma(src, length)
dev = mult * dev(src, length)
upper = basis + dev
lower = basis - dev

plot(basis, title="Basis", color=#351c75, transp=0)
upperPlot = plot(upper, title="Upper", color=#45818e, transp=0)
lowerPlot = plot(lower, title="Lower", color=#45818e, transp=0)
fill(upperPlot, lowerPlot, title="MADB Background", color=color.new(#ffd966, 84))

##-- File Name: tradingview-pinescript-indicators-master/bands_and_channels/mean_absolute_deviation_bands.pine | File No: 4 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/bands_and_channels/moving_average_channel.pine | File No: 5 | Started --##
//@version=4
// Copyright (c) 2017-present, Alex Orekhov (everget)
// Moving Average Channel script may be freely distributed under the terms of the GPL-3.0 license.
study("Moving Average Channel", shorttitle="MAC", overlay=true)

upperSrc = input(title="Upper Source", type=input.source, defval=high)
upperLength = input(title="Upper Length", type=input.integer, defval=20)
upperOffset = input(title="Upper Offset", type=input.integer, defval=0)

upper = sma(upperSrc, upperLength)
upperPlot = plot(upper, title="Upper", color=#3c78d8, offset=upperOffset, transp=0)

lowerSrc = input(title="Lower Source", type=input.source, defval=low)
lowerLength = input(title="Lower Length", type=input.integer, defval=20)
lowerOffset = input(title="Lower Offset", type=input.integer, defval=0)

lower = sma(lowerSrc, lowerLength)
lowerPlot = plot(lower, title="Lower", color=#f57c00, offset=lowerOffset, transp=0)

fill(upperPlot, lowerPlot, title="Background", color=color.new(#ffd966, 90))

barColor = close > upper ? color.lime : close < lower ? color.red : color.gray
barcolor(barColor, title="Bar Color")

##-- File Name: tradingview-pinescript-indicators-master/bands_and_channels/moving_average_channel.pine | File No: 5 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/bands_and_channels/stoller_average_range_channels.pine | File No: 6 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Stoller Average Range Channels (STARC) Bands script may be freely distributed under the terms of the GPL-3.0 license.
study("Stoller Average Range Channels (STARC) Bands", shorttitle="STARC", overlay=true)

length = input(title="Length", type=integer, minval=1, defval=6)
maInput = input(title="MA", defval="SMA", options=["EMA", "SMA", "VWMA", "WMA"])
atrLength = input(title="ATR Length", type=integer, minval=1, defval=15)
mult = input(title="Multiplier", type=float, step=0.1, defval=1.33)
src = input(title="Source", type=source, defval=close)

basis = iff(maInput == "EMA", ema(src, length),
	 iff(maInput == "SMA", sma(src, length),
	 iff(maInput == "VWMA", vwma(src, length),
	 iff(maInput == "WMA", wma(src, length),
	 na))))

upperBand = basis + atr(length) * mult
lowerBand = basis - atr(length) * mult

plot(upperBand, title="Upper", linewidth=2, color=blue, transp=0)
plot(basis, title="Basis", linewidth=2, color=#6d1e7f, transp=0)
plot(lowerBand, title="Lower", linewidth=2, color=red, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/bands_and_channels/stoller_average_range_channels.pine | File No: 6 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/bands_and_channels/vortex_bands.pine | File No: 7 | Started --##
//@version=4
// Copyright (c) 2020-present, Alex Orekhov (everget)
// Vortex Bands script may be freely distributed under the terms of the GPL-3.0 license.
study("Vortex Bands", shorttitle="VB", overlay=true)

length = input(title="Length", type=input.integer, defval=20)
mult = input(title="Multiplier", type=input.float, step=0.1, defval=2)
src = input(title="Source", type=input.source, defval=hlc3)
barColoringType = input(title="Bar Coloring", defval="None", options=["None", "Upper > Lower", "Close Above/Below Basis", "Close Inside Cloud", "Wicks Inside Cloud"])

_ema(src, alpha) =>
    out = src
    out := alpha * out + (1 - alpha) * nz(out[1], out)
    out

_mnma(src, length) =>
    alpha = 2 / (length + 1)
    ema1 = _ema(src, alpha)
    ema2 = _ema(ema1, alpha)
    out = ((2 - alpha) * ema1 - ema2) / (1 - alpha)
    out

basis = _mnma(src, length)
dev = mult * _mnma(src - basis, length)

upper = basis + dev
lower = basis - dev

plot(basis, title="Basis", color=color.maroon, transp=0)
upperBandPlot = plot(upper, title="Upper", linewidth=2, color=color.blue)
lowerBandPlot = plot(lower, title="Lower", linewidth=2, color=color.orange)
fill(upperBandPlot, lowerBandPlot, title="Background", color=color.new(#ffd966, 90))

barColor =
     barColoringType == "Upper > Lower" ? (upper > lower ? color.lime : color.red) :
     barColoringType == "Close Above/Below Basis" ? (close > basis ? color.lime : color.red) :
     barColoringType == "Close Inside Cloud" ? (min(upper, lower) < close and close < max(upper, lower) ? color.lime : color.red) :
     barColoringType == "Wicks Inside Cloud" ? (min(upper, lower) < low and high < max(upper, lower) ? color.lime : color.red) :
     na

barcolor(barColor, title="Bar Color")

##-- File Name: tradingview-pinescript-indicators-master/bands_and_channels/vortex_bands.pine | File No: 7 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/highlighters/bitmex_withdrawals_cutoff_time.pine | File No: 8 | Started --##
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// BitMEX Withdrawals Cutoff Time script may be freely distributed under the terms of GPL-3.0 license.
study("BitMEX Withdrawals Cutoff Time", overlay=true)

transparency = input(title="Transparency", minval=0, defval=70)

cutoff = hour(time) == 13
transparent = color(white, 100)

bgcolor(cutoff ? #f57f17 : transparent, title="Cutoff Time", transp=transparency)
##-- File Name: tradingview-pinescript-indicators-master/highlighters/bitmex_withdrawals_cutoff_time.pine | File No: 8 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/highlighters/leap_years.pine | File No: 9 | Started --##
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
study("Leap Years", overlay=true)

transparency = input(title="Transparency", type=integer, defval=88, minval=0, maxval=100)
showLabels = input(title="Show Labels ? ", type=bool, defval=true)

transparent = color(white, 100)
labelColor = #1e90ff
bgColor = #ffa726

isLeap = false

if year % 4 != 0 // year is not divisible by 4
    // it is a common year
    isLeap := false
else
    if year % 100 != 0 // year is not divisible by 100
        // it is a leap year
        isLeap := true
    else
        if year % 400 != 0 // year is not divisible by 400
            // it is a common year
            isLeap := false
        else
            // it is a leap year
            isLeap := true

lyText = " Leap \nYear "
lyStart = year != year[1] and isLeap
plotshape(showLabels and lyStart, title=lyText, text=lyText, color=labelColor, textcolor=white, style=shape.labelup, location=location.belowbar, size=size.small, transp=0)
bgcolor(title="Leap Year", color=isLeap ? bgColor : transparent, transp=transparency)

##-- File Name: tradingview-pinescript-indicators-master/highlighters/leap_years.pine | File No: 9 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/highlighters/quarters.pine | File No: 10 | Started --##
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
study("Quarters", overlay=true)

transparency = input(title="Transparency", type=integer, defval=88, minval=0, maxval=100)
showLabels = input(title="Show Labels ? ", type=bool, defval=true)

transparent = color(white, 100)
labelColor = #1e90ff

m = month(time)

q1Text = " Q1 "
q1Start = m[1] == 12 and m == 1
q1 = m == 1 or m == 2 or m == 3
plotshape(showLabels and q1Start, title=q1Text, text=q1Text, color=labelColor, textcolor=white, style=shape.labelup, location=location.belowbar, size=size.small, transp=0)
bgcolor(title="Q1", color=q1 ? #e6194b : transparent, transp=transparency)

q2Text = " Q2 "
q2Start = m[1] == 3 and m == 4
q2 = m == 4 or m == 5 or m == 6
plotshape(showLabels and q2Start, title=q2Text, text=q2Text, color=labelColor, textcolor=white, style=shape.labelup, location=location.belowbar, size=size.small, transp=0)
bgcolor(title="Q2", color=q2 ? #3cb44b : transparent, transp=transparency)

q3Text = " Q3 "
q3Start = m[1] == 6 and m == 7
q3 = m == 7 or m == 8 or m == 9
plotshape(showLabels and q3Start, title=q3Text, text=q3Text, color=labelColor, textcolor=white, style=shape.labelup, location=location.belowbar, size=size.small, transp=0)
bgcolor(title="Q3", color=q3 ? #ffe119 : transparent, transp=transparency)

q4Text = " Q4 "
q4Start = m[1] == 9 and m == 10
q4 = m == 10 or m == 11 or m == 12
plotshape(showLabels and q4Start, title=q4Text, text=q4Text, color=labelColor, textcolor=white, style=shape.labelup, location=location.belowbar, size=size.small, transp=0)
bgcolor(title="Q4", color=q4 ? #f58231 : transparent, transp=transparency)

##-- File Name: tradingview-pinescript-indicators-master/highlighters/quarters.pine | File No: 10 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/highlighters/range_candles.pine | File No: 11 | Started --##
//@version=4
// Copyright (c) 2020-present, Alex Orekhov (everget)
// Range Candles script may be freely distributed under the terms of the GPL-3.0 license.
study("Range Candles", overlay=true)

var color bullColor = input(title="Bull Color", defval=#26a69a)
var color bearColor = input(title="Bear Color", defval=#ef5350)
candleColor = close >= open ? bullColor : bearColor

plotcandle(
	 open,
	 high,
	 low,
	 close,
	 title="",
	 color=candleColor,
	 bordercolor=candleColor,
	 wickcolor=candleColor
	 )

##-- File Name: tradingview-pinescript-indicators-master/highlighters/range_candles.pine | File No: 11 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/highlighters/weekdays_gaps.pine | File No: 12 | Started --##
//@version=4
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Weekdays Gaps script may be freely distributed under the terms of the GPL-3.0 license.
study("Weekdays Gaps", overlay=true)

td = dayofweek(time)
yd = dayofweek(time[1])

mo = dayofweek.monday
tu = dayofweek.tuesday
we = dayofweek.wednesday
th = dayofweek.thursday
fr = dayofweek.friday
sa = dayofweek.saturday
su = dayofweek.sunday

gaps = td == mo and yd != su or
         td == tu and yd != mo or
         td == we and yd != tu or
         td == th and yd != we or
         td == fr and yd != th or
         td == sa and yd != fr or
         td == su and yd != sa

gapColor = color.new(#ffcc80, 70)
noneColor = color.new(color.white, 100)
bgcolor(gaps ? gapColor : noneColor, title="Gap")

##-- File Name: tradingview-pinescript-indicators-master/highlighters/weekdays_gaps.pine | File No: 12 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/adaptive_laguerre_filter.pine | File No: 13 | Started --##
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Adaptive Laguerre Filter script may be freely distributed under the terms of the GPL-3.0 license.
study("Adaptive Laguerre Filter", shorttitle="ALF", overlay=true)

length = input(title="Length", type=input.integer, defval=14)
medianLength = input(title="Median Length", type=input.integer, defval=5)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)
awaitBarConfirmation = input(title="Await Bar Confirmation ?", type=input.bool, defval=true)

_median(src, length) =>
	percentile_nearest_rank(src, length, 50)

alf = 0.0

diff = abs(src - nz(alf[1], src))

HH = 0.0
HH := diff

LL = 0.0
LL := diff

for i = 0 to length - 1
	if nz(diff[i]) > HH
		HH := nz(diff[i])
		HH

	if nz(diff[i]) < LL
		LL := nz(diff[i])
		LL

alpha = 0.0
alpha := HH - LL != 0.0 ? _median((diff - LL) / (HH - LL), medianLength) : nz(alpha[1], 2 / (length + 1))
alpha2 = 1 - alpha

L0 = 0.0
L0 := alpha * src + alpha2 * nz(L0[1], src)

L1 = 0.0
L1 := nz(L0[1], src) + alpha2 * (nz(L1[1], src) - L0)

L2 = 0.0
L2 := nz(L1[1], src) + alpha2 * (nz(L2[1], src) - L1)

L3 = 0.0
L3 := nz(L2[1], src) + alpha2 * (nz(L3[1], src) - L2)

alf := (L0 + 2 * L1 + 2 * L2 + L3) / 6

await = awaitBarConfirmation ? barstate.isconfirmed : true

alfColor = highlight ? (alf > alf[1] and await ? color.green : color.red) : #6d1e7f
plot(alf, title="ALF", linewidth=2, color=alfColor, transp=0)

alertCond = alfColor != alfColor[1] and await
alertcondition(alertCond, title="Color Change", message="ALF has changed its color!")

##-- File Name: tradingview-pinescript-indicators-master/movings/adaptive_laguerre_filter.pine | File No: 13 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/adaptive_rsi_moving_average.pine | File No: 14 | Started --##
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Adaptive RSI Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Adaptive RSI Moving Average", shorttitle="ARSIMA", overlay=true)

length = input(title="Length", type=input.integer, defval=14)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

alpha = 2 * abs(rsi(src, length) / 100 - 0.5)

arsima = 0.0
arsima := alpha * src + (1 - alpha) * nz(arsima[1])

arsimaColor = highlight ? arsima > arsima[1] ? color.green : color.red : #6d1e7f
plot(arsima, title="ARSIMA", linewidth=2, color=arsimaColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/adaptive_rsi_moving_average.pine | File No: 14 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/ahrens_moving_average.pine | File No: 15 | Started --##
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Ahrens Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Ahrens Moving Average", shorttitle="AHMA", overlay=true)

length = input(title="Length", type=input.integer, defval=9)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

ahma = 0.0
ahma1 = nz(ahma[1])
ahma := ahma1 + (src - (ahma1 + nz(ahma[length])) / 2) / length

ahmaColor = highlight ? ahma > ahma[1] ? color.green : color.red : #6d1e7f
plot(ahma, title="AHMA", linewidth=2, color=ahmaColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/ahrens_moving_average.pine | File No: 15 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/alpha_decreasing_exponential_moving_average.pine | File No: 16 | Started --##
//@version=4
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Alpha-Decreasing Exponential Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Alpha-Decreasing Exponential Moving Average", shorttitle="ADEMA", overlay=true)

alpha = 2 / (int(bar_index) + 1)

ema = close
ema := alpha * ema + (1 - alpha) * nz(ema[1], ema)

plot(ema, title="ADEMA", linewidth=2, color=color.orange)

##-- File Name: tradingview-pinescript-indicators-master/movings/alpha_decreasing_exponential_moving_average.pine | File No: 16 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/apirine_adaptive_exponential_moving_average.pine | File No: 17 | Started --##
//@version=3
// Copyright (c) 2019-present, Vitali Apirine
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Adaptive Exponential Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Adaptive Exponential Moving Average", shorttitle="AEMA", overlay=true)

length = input(title="Length", type=integer, defval=10)
hlLookback = input(title="Highest/Lowest Lookback", type=integer, defval=10)
src = input(title="Source", type=source, defval=close)
highlightMovements = input(title="Highlight Movements ?", type=bool, defval=false)

hh = highest(hlLookback)
ll = lowest(hlLookback)

mltp1 = 2 / (length + 1)
mltp2 = hh - ll != 0 ? abs(2 * src - ll - hh) / (hh - ll) : 0

rate = mltp1 * (1 + mltp2)

ma = 0.0
if n <= length
    ma := sma(src, length)
else
    ma := nz(ma[1], src) + rate * (src - nz(ma[1], src))

maColor = highlightMovements ? (ma > ma[1] ? green : red) : #512da8
plot(ma, title="AMA", linewidth=2, color=maColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/apirine_adaptive_exponential_moving_average.pine | File No: 17 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/apirine_adaptive_moving_average.pine | File No: 18 | Started --##
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Apirine Adaptive Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Apirine Adaptive Moving Average", shorttitle="AAMA", overlay=true)

length = input(title="Length", type=input.integer, defval=14)
fastLength = input(title="Fast EMA Length", type=input.integer, defval=2)
slowLength = input(title="Slow EMA Length", type=input.integer, defval=30)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

fastAlpha = 2 / (fastLength + 1)
slowAlpha = 2 / (slowLength + 1)

hh = highest(length + 1)
ll = lowest(length + 1)

mltp = hh - ll != 0 ? abs(2 * src - ll - hh) / (hh - ll) : 0

ssc = mltp * (fastAlpha - slowAlpha) + slowAlpha

aama = 0.0
aama := nz(aama[1], src) + pow(ssc, 2) * (src - nz(aama[1], src))

aamaColor = highlight ? aama > aama[1] ? color.green : color.red : #6d1e7f
plot(aama, title="AAMA", linewidth=2, color=aamaColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/apirine_adaptive_moving_average.pine | File No: 18 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/arnaud_legoux_moving_average.pine | File No: 19 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Arnaud Legoux Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Arnaud Legoux Moving Average", shorttitle="ALMA", overlay=true)

length = input(title="Length", type=integer, minval=1, defval=9)
offset = input(title="Offset", type=float, defval=0.85)
sigma = input(title="Sigma", type=float, defval=6)
src = input(title="Source", type=source, defval=close)

plot(alma(src, length, offset, sigma), title="ALMA", linewidth=2, color=#e69138, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/arnaud_legoux_moving_average.pine | File No: 19 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/bryant_adaptive_moving_average.pine | File No: 20 | Started --##
//@version=3
// Copyright (c) 2014-present, Michael R. Bryant
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Bryant Adaptive Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Bryant Adaptive Moving Average", shorttitle="BAMA", overlay=true)

length = input(title="Length", type=integer, defval=14)
trendParam = input(title="Trend Parameter", type=float, defval=-1, step=0.1)
maxLength = input(title="Max Length", type=integer, defval=100)
highlightMovements = input(title="Highlight Movements ?", type=bool, defval=false)
src = input(title="Source", type=source, defval=close)

mom = abs(change(src, length))
volatility = sum(abs(change(src)), length)

// Efficiency Ratio
er = volatility != 0 ? mom / volatility : 0

// Variable Efficiency Ratio
ver = pow(er - (2 * er - 1) / 2 * (1 - trendParam) + 0.5, 2)

vlength = (length - ver + 1) / ver
vlength := vlength > maxLength ? maxLength : vlength

valpha = 2 / (vlength + 1)

bama = src
bama := valpha * src + (1 - valpha) * nz(bama[1], bama)

bamaColor = highlightMovements ? (bama > bama[1] ? green : red) : #6d1e7f
plot(bama, title="BAMA", linewidth=2, color=bamaColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/bryant_adaptive_moving_average.pine | File No: 20 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/butterworth_filter.pine | File No: 21 | Started --##
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Butterworth Filter script may be freely distributed under the terms of the GPL-3.0 license.
study("Butterworth Filter", shorttitle="BF", overlay=true)

length = input(title="Length", type=input.integer, minval=1, defval=14)
poles = input(title="Poles", type=input.integer, defval=2, options=[2, 3])
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

PI = 2 * asin(1)

_bf2(src, length) =>
	a = exp(-sqrt(2) * PI / length)
	b = 2 * a * cos(sqrt(2) * PI / length)

	src1 = nz(src[1], src)
	src2 = nz(src[2], src1)

	bf = 0.0
	bf1 = nz(bf[1], src)
	bf2 = nz(bf[2], bf1)

	bf :=
		 b * bf1 -
		 pow(a, 2) * bf2 +
		 (1 - b + pow(a, 2)) / 4 * (src + 2 * src1 + src2)
	bf

_bf3(src, length) =>
	a = exp(-PI / length)
	b = 2 * a * cos(1.738 * PI / length)
	c = pow(a, 2)

	src1 = nz(src[1], src)
	src2 = nz(src[2], src1)
	src3 = nz(src[3], src2)

	bf = 0.0
	bf1 = nz(bf[1], src)
	bf2 = nz(bf[2], bf1)
	bf3 = nz(bf[3], bf2)

	bf :=
		 (b + c) * bf1 -
		 (c + b * c) * bf2 +
		 pow(c, 2) * bf3 +
		 (1 - b + c) * (1 - c) / 8 * (src + 3 * src1 + 3 * src2 + src3)
	bf

bf = poles == 2
	 ? _bf2(src, length)
	 : _bf3(src, length)

bfColor = highlight ? bf > bf[1] ? color.green : color.red : #6d1e7f
plot(bf, title="BF", linewidth=2, color=bfColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/butterworth_filter.pine | File No: 21 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/corrected_moving_average.pine | File No: 22 | Started --##
//@version=4
// Copyright (c) 2020-present, Alex Orekhov (everget)
// Corrected Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Corrected Moving Average", shorttitle="CMA", overlay=true)

length = input(title="Length", type=input.integer, defval=35)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight CMA ?", type=input.bool, defval=false)
applyFilling = input(title="Apply Ribbon Filling ?", type=input.bool, defval=true)

sma = sma(src, length)
cma = sma

v1 = variance(src, length)
v2 = pow(nz(cma[1], cma) - sma, 2)
v3 = v1 == 0 or v2 == 0 ? 1 : v2 / (v1 + v2)

var tolerance = pow(10, -5)
float err = 1

// Gain Factor
float kPrev = 1
float k = 1

for i = 0 to 5000
    if err > tolerance
        k := v3 * kPrev * (2 - kPrev)
        err := kPrev - k
        kPrev := k

cma := nz(cma[1], src) + k * (sma - nz(cma[1], src))

cmaColor = highlight ? (cma > cma[1] ? color.green : color.red) : color.orange
cmaPlot = plot(cma, title="CMA", linewidth=2, color=cmaColor)
smaPlot = plot(sma, title="SMA", linewidth=2, color=color.blue)

fillColor = applyFilling ? (sma > cma ? #0ebb23 : #cc0000) : color.new(color.white, 100) 
fill(smaPlot, cmaPlot, color=fillColor, transp=80)

long = crossover(sma, cma)
short = crossunder(sma, cma)

alertcondition(long, title="Long", message="Long")
alertcondition(short, title="Short", message="Short")

##-- File Name: tradingview-pinescript-indicators-master/movings/corrected_moving_average.pine | File No: 22 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/distance_coefficient_filter.pine | File No: 23 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Ehlers Distance Coefficient Filter script may be freely distributed under the terms of the GPL-3.0 license.
study("Ehlers Distance Coefficient Filter", shorttitle="EDCF", overlay=true)

length = input(title="Length", type=integer, defval=14)
src = input(title="Source", type=source, defval=hl2)

srcSum = 0.0
coefSum = 0.0

for count = 0 to length - 1
	distance = 0.0

	for lookback = 1 to length - 1
		distance := distance + pow(src[count] - src[count + lookback], 2)

	srcSum := srcSum + distance * src[count]
	coefSum := coefSum + distance

dcf = coefSum != 0 ? srcSum / coefSum : 0.0

plot(dcf, title="EDCF", linewidth=2, color=#6d1e7f, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/distance_coefficient_filter.pine | File No: 23 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/distance_weighted_moving_average.pine | File No: 24 | Started --##
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Distance Weighted Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Distance Weighted Moving Average", shorttitle="DWMA", overlay=true)

length = input(title="Length", type=integer, defval=14)
highlightMovements = input(title="Highlight Movements ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

sum = 0.0
weightSum = 0.0

calcWeight(src, length, i) =>
    distanceSum = 0.0
    for j = 0 to length - 1
        distanceSum := distanceSum + abs(nz(src[i]) - nz(src[j]))
    1 / distanceSum

for i = 0 to length - 1
    weight = calcWeight(src, length, i)
    sum := sum + nz(src[i]) * weight
    weightSum := weightSum + weight

dwma = sum / weightSum

dwmaColor = highlightMovements ? (dwma > dwma[1] ? green : red) : #6d1e7f
plot(dwma, title="DWMA", linewidth=2, color=dwmaColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/distance_weighted_moving_average.pine | File No: 24 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/double_exponential_moving_average.pine | File No: 25 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Double Exponential Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Double Exponential Moving Average", shorttitle="DEMA", overlay=true)

length = input(title="Length", type=integer, minval=1, defval=14)
src = input(title="Source", type=source, defval=close)

dema(src, length) =>
	ema1 = ema(src, length)
	ema2 = ema(ema1, length)
	dema = 2 * ema1 - ema2

plot(dema(src, length), title="DEMA", linewidth=2, color=#6d1e7f, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/double_exponential_moving_average.pine | File No: 25 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/double_weighted_moving_average.pine | File No: 26 | Started --##
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Double Weighted Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Double Weighted Moving Average", shorttitle="DWMA", overlay=true)

length = input(title="Length", type=integer, defval=10)
highlightMovements = input(title="Highlight Movements ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

dwma = wma(wma(src, length), length)

dwmaColor = highlightMovements ? (dwma > dwma[1] ? green : red) : #6d1e7f
plot(dwma, title="DWMA", linewidth=2, color=dwmaColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/double_weighted_moving_average.pine | File No: 26 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/ehlers_deviation_scaled_moving_average.pine | File No: 27 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Ehlers Deviation-Scaled Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Ehlers Deviation-Scaled Moving Average", shorttitle="EDSMA", overlay=true)

length = input(title="Length", type=integer, defval=40, minval=2)
ssfLength = input(title="Super Smoother Filter Length", type=integer, defval=20, minval=1)
numberOfPoles = input(title="Number of Poles", type=integer, defval=2, options=[2, 3])
src = input(title="Source", type=source, defval=close)

PI = 2 * asin(1)

twoPoleSuperSmootherFilter(src, length) =>
	arg = sqrt(2) * PI / length
	a1 = exp(-arg)
	b1 = 2 * a1 * cos(arg)
	c2 = b1
	c3 = -pow(a1, 2)
	c1 = 1 - c2 - c3

	ssf = 0.0
	ssf := c1 * src + c2 * nz(ssf[1]) + c3 * nz(ssf[2])

threePoleSuperSmootherFilter(src, length) =>
	arg = PI / length
	a1 = exp(-arg)
	b1 = 2 * a1 * cos(1.738 * arg)
	c1 = pow(a1, 2)

	coef2 = b1 + c1
	coef3 = -(c1 + b1 * c1)
	coef4 = pow(c1, 2)
	coef1 = 1 - coef2 - coef3 - coef4

	ssf = 0.0
	ssf := coef1 * src + coef2 * nz(ssf[1]) + coef3 * nz(ssf[2]) + coef4 * nz(ssf[3])

zeros = src - nz(src[2])

// Ehlers Super Smoother Filter
ssf = numberOfPoles == 2
	 ? twoPoleSuperSmootherFilter((zeros + zeros[1]) / 2, ssfLength)
	 : threePoleSuperSmootherFilter((zeros + zeros[1]) / 2, ssfLength)

// Rescale filter in terms of Standard Deviations
scaledFilter = stdev(ssf, length) != 0
	 ? ssf / stdev(ssf, length)
	 : 0

alpha = abs(scaledFilter) * 5 / length

edsma = 0.0
edsma := alpha * src + (1 - alpha) * nz(edsma[1])

plot(edsma, title="EDSMA", linewidth=2, color=#6d1e7f, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/ehlers_deviation_scaled_moving_average.pine | File No: 27 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/ehlers_distance_coefficient_filter.pine | File No: 28 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Ehlers Distance Coefficient Filter script may be freely distributed under the terms of GPL-3.0 license.
study("Ehlers Distance Coefficient Filter", shorttitle="EDCF", overlay=true)

length = input(title="Length", type=integer, defval=14)
src = input(title="Source", type=source, defval=hl2)

srcSum = 0.0
coefSum = 0.0

for count = 0 to length - 1
	distance = 0.0

	for lookback = 1 to length - 1
		distance := distance + pow(src[count] - src[count + lookback], 2)

	srcSum := srcSum + distance * src[count]
	coefSum := coefSum + distance

dcf = coefSum != 0 ? srcSum / coefSum : 0.0

plot(dcf, title="EDCF", linewidth=2, color=#6d1e7f, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/ehlers_distance_coefficient_filter.pine | File No: 28 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/ehlers_leading_indicator.pine | File No: 29 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Ehlers Leading Indicator script may be freely distributed under the terms of the GPL-3.0 license.
study("Ehlers Leading Indicator", shorttitle="ELI", overlay=true)

alpha1 = input(title="Alpha 1", type=float, step=0.1, defval=0.25)
alpha2 = input(title="Alpha 2", type=float, step=0.1, defval=0.33)
src = input(title="Source", type=source, defval=hl2)

lead = 0.0
lead := 2 * src + (alpha1 - 2) * nz(src[1]) + (1 - alpha1) * nz(lead[1])

leadingIndicator = 0.0
leadingIndicator := alpha2 * lead + (1 - alpha2) * nz(leadingIndicator[1])

plot(leadingIndicator, title="ELI", linewidth=2, color=#741b47, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/ehlers_leading_indicator.pine | File No: 29 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/ehlers_mesa_adaptive_moving_averages.pine | File No: 30 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Ehlers MESA Adaptive Moving Averages (MAMA & FAMA) script may be freely distributed under the terms of the GPL-3.0 license.
study("Ehlers MESA Adaptive Moving Averages (MAMA & FAMA)", shorttitle="MESA", overlay=true)

fastLimit = input(title="Fast Limit", type=float, defval=0.5)
slowLimit = input(title="Slow Limit", type=float, defval=0.05)
src = input(title="Source", type=source, defval=hl2)

computeMESAComponent(src, mesaPeriodMult) =>
	(0.962 * src + 0.5769 * nz(src[2]) - 0.5769 * nz(src[4]) - 0.0962 * nz(src[6])) * mesaPeriodMult

computeAlpha(src, fastLimit, slowLimit) =>
	mesaPeriod = 0.0
	mesaPeriodMult = 0.075 * nz(mesaPeriod[1]) + 0.54

	smooth = 0.0
	smooth := (4 * src + 3 * nz(src[1]) + 2 * nz(src[2]) + nz(src[3])) / 10

	detrender = 0.0
	detrender := computeMESAComponent(smooth, mesaPeriodMult)

	// Compute InPhase and Quadrature components
	I1 = nz(detrender[3])
	Q1 = computeMESAComponent(detrender, mesaPeriodMult)

	// Advance the phase of I1 and Q1 by 90 degrees
	jI = computeMESAComponent(I1, mesaPeriodMult)
	jQ = computeMESAComponent(Q1, mesaPeriodMult)

	I2 = 0.0
	Q2 = 0.0

	// Phasor addition for 3 bar averaging
	I2 := I1 - jQ
	Q2 := Q1 + jI

	// Smooth the I and Q components before applying the discriminator
	I2 := 0.2 * I2 + 0.8 * nz(I2[1])
	Q2 := 0.2 * Q2 + 0.8 * nz(Q2[1])

	// Homodyne Discriminator
	Re = I2 * nz(I2[1]) + Q2 * nz(Q2[1])
	Im = I2 * nz(Q2[1]) - Q2 * nz(I2[1])

	Re := 0.2 * Re + 0.8 * nz(Re[1])
	Im := 0.2 * Im + 0.8 * nz(Im[1])

	if Re != 0 and Im != 0
		mesaPeriod := 360 / atan(Im / Re)

	if mesaPeriod > 1.5 * nz(mesaPeriod[1])
		mesaPeriod := 1.5 * nz(mesaPeriod[1])

	if mesaPeriod < 0.67 * nz(mesaPeriod[1])
		mesaPeriod := 0.67 * nz(mesaPeriod[1])

	if mesaPeriod < 6
		mesaPeriod := 6

	if mesaPeriod > 50
		mesaPeriod := 50

	mesaPeriod := 0.2 * mesaPeriod + 0.8 * nz(mesaPeriod[1])

	smoothPeriod = 0.0
	smoothPeriod := 0.33 * mesaPeriod + 0.67 * nz(smoothPeriod[1])

	phase = 0.0

	if I1 != 0
		phase := atan(Q1 / I1)

	deltaPhase = nz(phase[1]) - phase

	if  deltaPhase < 1
		deltaPhase := 1

	alpha = fastLimit / deltaPhase

	if  alpha < slowLimit
		alpha := slowLimit

	alpha

mama(src, fastLimit, slowLimit) =>
	alpha = computeAlpha(src, fastLimit, slowLimit)

	mama = 0.0
	mama := alpha * src + (1 - alpha) * nz(mama[1])

fama(src, fastLimit, slowLimit) =>
	alpha = computeAlpha(src, fastLimit, slowLimit)
	mama = mama(src, fastLimit, slowLimit)

	fama = 0.0
	fama := (alpha / 2) * mama + (1 - alpha / 2) * nz(fama[1])

plot(mama(src, fastLimit, slowLimit), title="MAMA", linewidth=2, color=#674ea7, transp=0)
plot(fama(src, fastLimit, slowLimit), title="FAMA", linewidth=2, color=#f6b26b, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/ehlers_mesa_adaptive_moving_averages.pine | File No: 30 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/ehlers_modified_optimum_elliptic_filter.pine | File No: 31 | Started --##
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Ehlers Modified Optimum Elliptic Filter script may be freely distributed under the terms of GPL-3.0 license.
study("Ehlers Modified Optimum Elliptic Filter", shorttitle="MOEF", overlay=true)

src = input(title="Source", type=source, defval=hl2)
highlightMovements = input(title="Highlight Movements ?", type=bool, defval=false)

src1 = nz(src[1], src)
src2 = nz(src[2], src1)
src3 = nz(src[3], src2)

moef = src
moef := 0.13785 * (2 * src - src1) +
         0.0007 * (2 * src1 - src2) +
         0.13785 * (2 * src2 - src3) +
         1.2103 * nz(moef[1], moef) -
         0.4867 * nz(moef[2], moef)

moefColor = highlightMovements ? (moef > moef[1] ? green : red) : #6d1e7f
plot(moef, title="MOEF", linewidth=2, color=moefColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/ehlers_modified_optimum_elliptic_filter.pine | File No: 31 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/ehlers_optimum_elliptic_filter.pine | File No: 32 | Started --##
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Ehlers Optimum Elliptic Filter script may be freely distributed under the terms of GPL-3.0 license.
study("Ehlers Optimum Elliptic Filter", shorttitle="OEF", overlay=true)

src = input(title="Source", type=source, defval=hl2)
highlightMovements = input(title="Highlight Movements ?", type=bool, defval=false)

oef = 0.0
oef := 0.13785 * src + 0.0007 * nz(src[1]) + 0.13785 * nz(src[2]) + 1.2103 * nz(oef[1]) - 0.4867 * nz(oef[2])

oefColor = highlightMovements ? (oef > oef[1] ? green : red) : #6d1e7f
plot(oef, title="OEF", linewidth=2, color=oefColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/ehlers_optimum_elliptic_filter.pine | File No: 32 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/ehlers_super_smoother_filter.pine | File No: 33 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Ehlers Super Smoother Filter script may be freely distributed under the terms of the GPL-3.0 license.
study("Ehlers Super Smoother Filter", shorttitle="ESSF", overlay=true)

length = input(title="Length", type=integer, minval=1, defval=15)
numberOfPoles = input(title="Number of Poles", type=integer, defval=2, options=[2, 3])
src = input(title="Source", type=source, defval=close)

PI = 2 * asin(1)

get2PoleSSF(src, length) =>
	arg = sqrt(2) * PI / length
	a1 = exp(-arg)
	b1 = 2 * a1 * cos(arg)
	c2 = b1
	c3 = -pow(a1, 2)
	c1 = 1 - c2 - c3

	ssf = 0.0
	ssf := c1 * src + c2 * nz(ssf[1]) + c3 * nz(ssf[2])

get3PoleSSF(src, length) =>
	arg = PI / length
	a1 = exp(-arg)
	b1 = 2 * a1 * cos(1.738 * arg)
	c1 = pow(a1, 2)

	coef2 = b1 + c1
	coef3 = -(c1 + b1 * c1)
	coef4 = pow(c1, 2)
	coef1 = 1 - coef2 - coef3 - coef4

	ssf = 0.0
	ssf := coef1 * src + coef2 * nz(ssf[1]) + coef3 * nz(ssf[2]) + coef4 * nz(ssf[3])

essf = numberOfPoles == 2
		 ? get2PoleSSF(src, length)
		 : get3PoleSSF(src, length)

plot(essf, title="ESSF", linewidth=2, color=#741b47, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/ehlers_super_smoother_filter.pine | File No: 33 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/elastic_volume_weighted_moving_average.pine | File No: 34 | Started --##
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Elastic Volume Weighted Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Elastic Volume Weighted Moving Average", shorttitle="EVWMA", overlay=true)

length = input(title="Length", type=input.integer, defval=14)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

volumeSum = sum(volume, length)

evwma = 0.0
evwma := ((volumeSum - volume) * nz(evwma[1]) + volume * src) / volumeSum

evwmaColor = highlight ? evwma > evwma[1] ? color.green : color.red : #6d1e7f
plot(evwma, title="EVWMA", linewidth=2, color=evwmaColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/elastic_volume_weighted_moving_average.pine | File No: 34 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/exponential_moving_average.pine | File No: 35 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Exponential Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Exponential Moving Average", shorttitle="EMA", overlay=true)

length = input(title="Length", type=integer, minval=1, defval=14)
src = input(title="Source", type=source, defval=close)

plot(ema(src, length), title="EMA", linewidth=2, color=#6d1e7f, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/exponential_moving_average.pine | File No: 35 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/farey_sequence_weighted_moving_average.pine | File No: 36 | Started --##
//@version=4
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Farey Sequence Weighted Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Farey Sequence Weighted Moving Average", shorttitle="FSWMA", overlay=true)

order = input(title="Order", defval="5",
	 options=[
		 "2",
		 "3",
		 "4",
		 "5",
		 "6",
		 "7",
		 "8",
		 "9",
		 "10",
		 "11",
		 "12",
		 "13",
		 "14"
		 ])
src = input(title="Source", type=input.source, defval=close)
highlightMovements = input(title="Highlight Movements ?", type=input.bool, defval=true)

src1 = src[1]
src2 = src[2]
src3 = src[3]
src4 = src[4]
src5 = src[5]
src6 = src[6]
src7 = src[7]
src8 = src[8]
src9 = src[9]
src10 = src[10]
src11 = src[11]
src12 = src[12]
src13 = src[13]
src14 = src[14]
src15 = src[15]
src16 = src[16]
src17 = src[17]
src18 = src[18]
src19 = src[19]
src20 = src[20]
src21 = src[21]
src22 = src[22]
src23 = src[23]
src24 = src[24]
src25 = src[25]
src26 = src[26]
src27 = src[27]
src28 = src[28]
src29 = src[29]
src30 = src[30]
src31 = src[31]
src32 = src[32]
src33 = src[33]
src34 = src[34]
src35 = src[35]
src36 = src[36]
src37 = src[37]
src38 = src[38]
src39 = src[39]
src40 = src[40]
src41 = src[41]
src42 = src[42]
src43 = src[43]
src44 = src[44]
src45 = src[45]
src46 = src[46]
src47 = src[47]
src48 = src[48]
src49 = src[49]
src50 = src[50]
src51 = src[51]
src52 = src[52]
src53 = src[53]
src54 = src[54]
src55 = src[55]
src56 = src[56]
src57 = src[57]
src58 = src[58]
src59 = src[59]
src60 = src[60]
src61 = src[61]
src62 = src[62]
src63 = src[63]

// Generated by script, not manually
fswma =
     order == "2" ? (src + 0.5 * src1) / 1.5 :
     order == "3" ? (src + 0.667 * src1 + 0.5 * src2 + 0.333 * src3) / 2.5 :
     order == "4" ? (src + 0.75 * src1 + 0.667 * src2 + 0.5 * src3 + 0.333 * src4 + 0.25 * src5) / 3.5 :
     order == "5" ? (src + 0.8 * src1 + 0.75 * src2 + 0.667 * src3 + 0.6 * src4 + 0.5 * src5 + 0.4 * src6 + 0.333 * src7 + 0.25 * src8 + 0.2 * src9) / 5.5 :
     order == "6" ? (src + 0.833 * src1 + 0.8 * src2 + 0.75 * src3 + 0.667 * src4 + 0.6 * src5 + 0.5 * src6 + 0.4 * src7 + 0.333 * src8 + 0.25 * src9 + 0.2 * src10 + 0.167 * src11) / 6.5 :
     order == "7" ? (src + 0.857 * src1 + 0.833 * src2 + 0.8 * src3 + 0.75 * src4 + 0.714 * src5 + 0.667 * src6 + 0.6 * src7 + 0.571 * src8 + 0.5 * src9 + 0.429 * src10 + 0.4 * src11 + 0.333 * src12 + 0.286 * src13 + 0.25 * src14 + 0.2 * src15 + 0.167 * src16 + 0.143 * src17) / 9.5 :
     order == "8" ? (src + 0.875 * src1 + 0.857 * src2 + 0.833 * src3 + 0.8 * src4 + 0.75 * src5 + 0.714 * src6 + 0.667 * src7 + 0.625 * src8 + 0.6 * src9 + 0.571 * src10 + 0.5 * src11 + 0.429 * src12 + 0.4 * src13 + 0.375 * src14 + 0.333 * src15 + 0.286 * src16 + 0.25 * src17 + 0.2 * src18 + 0.167 * src19 + 0.143 * src20 + 0.125 * src21) / 11.5 :
     order == "9" ? (src + 0.889 * src1 + 0.875 * src2 + 0.857 * src3 + 0.833 * src4 + 0.8 * src5 + 0.778 * src6 + 0.75 * src7 + 0.714 * src8 + 0.667 * src9 + 0.625 * src10 + 0.6 * src11 + 0.571 * src12 + 0.556 * src13 + 0.5 * src14 + 0.444 * src15 + 0.429 * src16 + 0.4 * src17 + 0.375 * src18 + 0.333 * src19 + 0.286 * src20 + 0.25 * src21 + 0.222 * src22 + 0.2 * src23 + 0.167 * src24 + 0.143 * src25 + 0.125 * src26 + 0.111 * src27) / 14.5 :
     order == "10" ? (src + 0.9 * src1 + 0.889 * src2 + 0.875 * src3 + 0.857 * src4 + 0.833 * src5 + 0.8 * src6 + 0.778 * src7 + 0.75 * src8 + 0.714 * src9 + 0.7 * src10 + 0.667 * src11 + 0.625 * src12 + 0.6 * src13 + 0.571 * src14 + 0.556 * src15 + 0.5 * src16 + 0.444 * src17 + 0.429 * src18 + 0.4 * src19 + 0.375 * src20 + 0.333 * src21 + 0.3 * src22 + 0.286 * src23 + 0.25 * src24 + 0.222 * src25 + 0.2 * src26 + 0.167 * src27 + 0.143 * src28 + 0.125 * src29 + 0.111 * src30 + 0.1 * src31) / 16.5 :
     order == "11" ? (src + 0.909 * src1 + 0.9 * src2 + 0.889 * src3 + 0.875 * src4 + 0.857 * src5 + 0.833 * src6 + 0.818 * src7 + 0.8 * src8 + 0.778 * src9 + 0.75 * src10 + 0.727 * src11 + 0.714 * src12 + 0.7 * src13 + 0.667 * src14 + 0.636 * src15 + 0.625 * src16 + 0.6 * src17 + 0.571 * src18 + 0.556 * src19 + 0.545 * src20 + 0.5 * src21 + 0.455 * src22 + 0.444 * src23 + 0.429 * src24 + 0.4 * src25 + 0.375 * src26 + 0.364 * src27 + 0.333 * src28 + 0.3 * src29 + 0.286 * src30 + 0.273 * src31 + 0.25 * src32 + 0.222 * src33 + 0.2 * src34 + 0.182 * src35 + 0.167 * src36 + 0.143 * src37 + 0.125 * src38 + 0.111 * src39 + 0.1 * src40 + 0.091 * src41) / 21.5 :
     order == "12" ? (src + 0.917 * src1 + 0.909 * src2 + 0.9 * src3 + 0.889 * src4 + 0.875 * src5 + 0.857 * src6 + 0.833 * src7 + 0.818 * src8 + 0.8 * src9 + 0.778 * src10 + 0.75 * src11 + 0.727 * src12 + 0.714 * src13 + 0.7 * src14 + 0.667 * src15 + 0.636 * src16 + 0.625 * src17 + 0.6 * src18 + 0.583 * src19 + 0.571 * src20 + 0.556 * src21 + 0.545 * src22 + 0.5 * src23 + 0.455 * src24 + 0.444 * src25 + 0.429 * src26 + 0.417 * src27 + 0.4 * src28 + 0.375 * src29 + 0.364 * src30 + 0.333 * src31 + 0.3 * src32 + 0.286 * src33 + 0.273 * src34 + 0.25 * src35 + 0.222 * src36 + 0.2 * src37 + 0.182 * src38 + 0.167 * src39 + 0.143 * src40 + 0.125 * src41 + 0.111 * src42 + 0.1 * src43 + 0.091 * src44 + 0.083 * src45) / 23.5 :
     order == "13" ? (src + 0.923 * src1 + 0.917 * src2 + 0.909 * src3 + 0.9 * src4 + 0.889 * src5 + 0.875 * src6 + 0.857 * src7 + 0.846 * src8 + 0.833 * src9 + 0.818 * src10 + 0.8 * src11 + 0.778 * src12 + 0.769 * src13 + 0.75 * src14 + 0.727 * src15 + 0.714 * src16 + 0.7 * src17 + 0.692 * src18 + 0.667 * src19 + 0.636 * src20 + 0.625 * src21 + 0.615 * src22 + 0.6 * src23 + 0.583 * src24 + 0.571 * src25 + 0.556 * src26 + 0.545 * src27 + 0.538 * src28 + 0.5 * src29 + 0.462 * src30 + 0.455 * src31 + 0.444 * src32 + 0.429 * src33 + 0.417 * src34 + 0.4 * src35 + 0.385 * src36 + 0.375 * src37 + 0.364 * src38 + 0.333 * src39 + 0.308 * src40 + 0.3 * src41 + 0.286 * src42 + 0.273 * src43 + 0.25 * src44 + 0.231 * src45 + 0.222 * src46 + 0.2 * src47 + 0.182 * src48 + 0.167 * src49 + 0.154 * src50 + 0.143 * src51 + 0.125 * src52 + 0.111 * src53 + 0.1 * src54 + 0.091 * src55 + 0.083 * src56 + 0.077 * src57) / 29.5 :
     order == "14" ? (src + 0.929 * src1 + 0.923 * src2 + 0.917 * src3 + 0.909 * src4 + 0.9 * src5 + 0.889 * src6 + 0.875 * src7 + 0.857 * src8 + 0.846 * src9 + 0.833 * src10 + 0.818 * src11 + 0.8 * src12 + 0.786 * src13 + 0.778 * src14 + 0.769 * src15 + 0.75 * src16 + 0.727 * src17 + 0.714 * src18 + 0.7 * src19 + 0.692 * src20 + 0.667 * src21 + 0.643 * src22 + 0.636 * src23 + 0.625 * src24 + 0.615 * src25 + 0.6 * src26 + 0.583 * src27 + 0.571 * src28 + 0.556 * src29 + 0.545 * src30 + 0.538 * src31 + 0.5 * src32 + 0.462 * src33 + 0.455 * src34 + 0.444 * src35 + 0.429 * src36 + 0.417 * src37 + 0.4 * src38 + 0.385 * src39 + 0.375 * src40 + 0.364 * src41 + 0.357 * src42 + 0.333 * src43 + 0.308 * src44 + 0.3 * src45 + 0.286 * src46 + 0.273 * src47 + 0.25 * src48 + 0.231 * src49 + 0.222 * src50 + 0.214 * src51 + 0.2 * src52 + 0.182 * src53 + 0.167 * src54 + 0.154 * src55 + 0.143 * src56 + 0.125 * src57 + 0.111 * src58 + 0.1 * src59 + 0.091 * src60 + 0.083 * src61 + 0.077 * src62 + 0.071 * src63) / 32.5 :
     na

fswmaColor = highlightMovements ? (fswma > fswma[1] ? color.green : color.red) : #6d1e7f
plot(fswma, title="FSWMA", linewidth=2, color=fswmaColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/farey_sequence_weighted_moving_average.pine | File No: 36 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/fibonacci_weighted_moving_average.pine | File No: 37 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Fibonacci Weighted Moving Average script may be freely distributed under the terms of GPL-3.0 license.
study("Fibonacci Weighted Moving Average", shorttitle="FWMA", overlay=true)

length = input(title="Length", type=integer, defval=14)
src = input(title="Source", type=source, defval=close)

phi = (1 + sqrt(5)) / 2

fiboWeight(i) =>
    pow = pow(phi, i)
    (pow - pow(-1, i) / pow) / sqrt(5)

fwma(src, length) =>
    sum = 0.0
    weightSum = 0.0

    for i = 0 to length - 1
        weight = fiboWeight(length - i)
        sum := sum + nz(src[i]) * weight
        weightSum := weightSum + weight

    sum / weightSum

plot(fwma(src, length), title="FWMA", linewidth=2, color=#741b47, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/fibonacci_weighted_moving_average.pine | File No: 37 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/finite_impulse_response_filter.pine | File No: 38 | Started --##
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Finite Impulse Response (FIR) Filter script may be freely distributed under the terms of the GPL-3.0 license.
study("Finite Impulse Response (FIR) Filter", shorttitle="FIRF", overlay=true)

coef1 = input(title="1st Coefficient", type=input.float, step=0.1, defval=1)
coef2 = input(title="2nd Coefficient", type=input.float, step=0.1, defval=3.5)
coef3 = input(title="3rd Coefficient", type=input.float, step=0.1, defval=4.5)
coef4 = input(title="4th Coefficient", type=input.float, step=0.1, defval=3)
coef5 = input(title="5th Coefficient", type=input.float, step=0.1, defval=0.5)
coef6 = input(title="6th Coefficient", type=input.float, step=0.1, defval=-0.5)
coef7 = input(title="7th Coefficient", type=input.float, step=0.1, defval=-1.5)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

src1 = nz(src[1], src)
src2 = nz(src[2], src1)
src3 = nz(src[3], src2)
src4 = nz(src[4], src3)
src5 = nz(src[5], src4)
src6 = nz(src[6], src5)

coefSum = coef1 + coef2 + coef3 + coef4 + coef5 + coef6 + coef7

firf = (
	 coef1 * src +
	 coef2 * src1 +
	 coef3 * src2 +
	 coef4 * src3 +
	 coef5 * src4 +
	 coef6 * src5 +
	 coef7 * src6
	 ) / coefSum

firfColor = highlight ? firf > firf[1] ? color.green : color.red : #6d1e7f
plot(firf, title="FIRF", linewidth=2, color=firfColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/finite_impulse_response_filter.pine | File No: 38 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/fractal_adaptive_moving_average.pine | File No: 39 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Fractal Adaptive Moving Average script may be freely distributed under the terms of GPL-3.0 license.
study(title="Fractal Adaptive Moving Average", shorttitle="FRAMA", overlay=true)

length = input(title="Length", type=integer, defval=14)
highlightMovements = input(title="Highlight Movements ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

length2 = floor(length / 2)

hh2 = highest(length2)
ll2 = lowest(length2)

N1 = (hh2 - ll2) / length2

N2 = (hh2[length2] - ll2[length2]) / length2

N3 = (highest(length) - lowest(length)) / length

D = (log(N1 + N2) - log(N3)) / log(2)

factor = exp(-4.6 * (D - 1))

frama = 0.0
frama := factor * src + (1 - factor) * nz(frama[1])

framaColor = highlightMovements ? (frama > frama[1] ? green : red) : #6d1e7f
plot(frama, title="FRAMA", linewidth=2, color=framaColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/fractal_adaptive_moving_average.pine | File No: 39 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/gaussian_filter.pine | File No: 40 | Started --##
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Gaussian Filter script may be freely distributed under the terms of the GPL-3.0 license.
study("Gaussian Filter", shorttitle="GF", overlay=true)

cyclePeriod = input(title="Cycle Period", type=input.integer, minval=1, defval=14)
polesNumber = input(title="Number of Poles", type=input.integer, defval=4, options=[1, 2, 3, 4])
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

PI = 2 * asin(1)
beta = (1 - cos(2 * PI / cyclePeriod)) / (pow(2, 1 / polesNumber) - 1)
alpha = -beta + sqrt(pow(beta, 2) + 2 * beta)

_gf(poles) =>
	filter = 0.0
	filter1 = nz(filter[1], src)
	filter2 = nz(filter[2], filter1)
	filter3 = nz(filter[3], filter2)
	filter4 = nz(filter[4], filter3)

	if poles == 1
		filter := alpha * src + (1 - alpha) * filter1

	if poles == 2
		filter :=
			 pow(alpha, 2) * src +
			 2 * (1 - alpha) * filter1 -
			 pow(1 - alpha, 2) * filter2

	if poles == 3
		filter :=
			 pow(alpha, 3) * src +
			 3 * (1 - alpha) * filter1 -
			 3 * pow(1 - alpha, 2) * filter2 +
			 pow(1 - alpha, 3) * filter3

	if poles == 4
		filter :=
			 pow(alpha, 4) * src +
			 4 * (1 - alpha) * filter1 -
			 6 * pow(1 - alpha, 2) * filter2 +
			 4 * pow(1 - alpha, 3) * filter3 -
			 pow(1 - alpha, 4) * filter4
	filter

gf = _gf(polesNumber)
gfColor = highlight ? gf > gf[1] ? color.green : color.red : #6d1e7f
plot(gf, title="GF", linewidth=2, color=gfColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/gaussian_filter.pine | File No: 40 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/hampel_filter.pine | File No: 41 | Started --##
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Hampel Filter script may be freely distributed under the terms of the GPL-3.0 license.
study("Hampel Filter", shorttitle="HF", overlay=true)

length = input(title="Length", type=input.integer, minval=1, defval=14)
scalingFactor = input(title="Scaling Factor", type=input.float, step=0.1, defval=3)
src = input(title="Source", type=input.source, defval=close)

_median(src, length) =>
	percentile_nearest_rank(src, length, 50)

sampleMedian = _median(src, length)

// Median Absolute Deviation
mad = _median(abs(src - sampleMedian), length)

hf = abs(src - sampleMedian) <= scalingFactor * mad
	 ? src
	 : sampleMedian

// Plot EMA of the filtered samples
plot(ema(hf, length), title="HF", linewidth=2, color=#6d1e7f, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/hampel_filter.pine | File No: 41 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/henderson_weighted_moving_average.pine | File No: 42 | Started --##
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Henderson Weighted Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Henderson Weighted Moving Average", shorttitle="HWMA", overlay=true)

termsNumber = input(title="Terms Number", type=input.integer, minval=1, defval=7)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

// The general form of the weights of the (2m + 1)-term Henderson Weighted Moving Average
_weight(m, j) =>
	powj2 = pow(j, 2)
	powm22 = pow(m + 2, 2)

	numerator =
		 315 * (pow(m + 1, 2) - powj2) *
		 (powm22 - powj2) *
		 (pow(m + 3, 2) - powj2) *
		 (3 * powm22 - 11 * powj2 - 16)
	denominator =
		 8 * (m + 2) * (powm22 - 1) *
		 (4 * powm22 - 1) *
		 (4 * powm22 - 9) *
		 (4 * powm22 - 25)
	out = denominator != 0 ? numerator / denominator : 0
	out

sum = 0.0
weightSum = 0.0

termMult = floor((termsNumber - 1) / 2)

for i = 0 to termsNumber - 1
	weight = _weight(termMult, i - termMult)
	sum := sum + nz(src[i]) * weight
	weightSum := weightSum + weight

hwma = sum / weightSum

hwmaColor = highlight ? hwma > hwma[1] ? color.green : color.red : #6d1e7f
plot(hwma, title="HWMA", linewidth=2, color=hwmaColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/henderson_weighted_moving_average.pine | File No: 42 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/holt_exponential_moving_average.pine | File No: 43 | Started --##
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Holt Exponential Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Holt Exponential Moving Average", shorttitle="HEMA", overlay=true)

alphaLength = input(title="Alpha Length", type=input.integer, defval=20, minval=1)
gammaLength = input(title="Gamma Length", type=input.integer, defval=20, minval=1)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

alpha = 2 / (alphaLength + 1)
gamma = 2 / (gammaLength + 1)

b = 0.0
hema = 0.0

hema := (1 - alpha) * (nz(hema[1]) + nz(b[1], src)) + alpha * src
b := (1 - gamma) * nz(b[1]) + gamma * (hema - nz(hema[1]))

hemaColor = highlight ? hema > hema[1] ? color.green : color.red : #6d1e7f
plot(hema, title="HEMA", linewidth=2, color=hemaColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/holt_exponential_moving_average.pine | File No: 43 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/hull_moving_average.pine | File No: 44 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Hull Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Hull Moving Average", shorttitle="HMA", overlay=true)

length = input(title="Length", type=integer, defval=14, minval=1)
src = input(title="Source", type=source, defval=close)

hma(src, length) =>
	wma(2 * wma(src, length / 2) - wma(src, length), round(sqrt(length)))

plot(hma(src, length), title="HMA", linewidth=2, color=#6d1e7f, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/hull_moving_average.pine | File No: 44 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/infinite_impulse_response_filter.pine | File No: 45 | Started --##
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Infinite Impulse Response (IIR) Filter script may be freely distributed under the terms of the GPL-3.0 license.
study("Infinite Impulse Response (IIR) Filter", shorttitle="IIRF", overlay=true)

length = input(title="Length", type=input.integer, defval=14, minval=2)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

iirfAlpha = 2 / (length + 1)
iirfLag = round(1 / iirfAlpha - 1)

iirf = 0.0
iirf := iirfAlpha * (src + change(src, iirfLag)) + (1 - iirfAlpha) * nz(iirf[1])

iirfColor = highlight ? iirf > iirf[1] ? color.green : color.red : #6d1e7f
plot(iirf, title="IIRF", linewidth=2, color=iirfColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/infinite_impulse_response_filter.pine | File No: 45 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/inverse_distance_weighted_moving_average.pine | File No: 46 | Started --##
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Inverse Distance Weighted Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Inverse Distance Weighted Moving Average", shorttitle="IDWMA", overlay=true)

length = input(title="Length", type=integer, defval=14)
highlightMovements = input(title="Highlight Movements ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

sum = 0.0
weightSum = 0.0

calcWeight(src, length, i) =>
    distanceSum = 0.0
    for j = 0 to length - 1
        distanceSum := distanceSum + abs(nz(src[i]) - nz(src[j]))
    distanceSum

for i = 0 to length - 1
    weight = calcWeight(src, length, i)
    sum := sum + nz(src[i]) * weight
    weightSum := weightSum + weight

idwma = sum / weightSum

idwmaColor = highlightMovements ? (idwma > idwma[1] ? green : red) : #6d1e7f
plot(idwma, title="IDWMA", linewidth=2, color=idwmaColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/inverse_distance_weighted_moving_average.pine | File No: 46 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/jurik_moving_average.pine | File No: 47 | Started --##
//@version=3
// Copyright (c) 2007-present Jurik Research and Consulting. All rights reserved.
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Jurik Moving Average script may be freely distributed under the terms of GPL-3.0 license.
study("Jurik Moving Average", shorttitle="JMA", overlay=true)

length = input(title="Length", type=integer, defval=7)
phase = input(title="Phase", type=integer, defval=50)
power = input(title="Power", type=integer, defval=2)
src = input(title="Source", type=source, defval=close)
highlightMovements = input(title="Highlight Movements ?", type=bool, defval=true)

phaseRatio = phase < -100 ? 0.5 : phase > 100 ? 2.5 : phase / 100 + 1.5

beta = 0.45 * (length - 1) / (0.45 * (length - 1) + 2)
alpha = pow(beta, power)

jma = 0.0

e0 = 0.0
e0 := (1 - alpha) * src + alpha * nz(e0[1])

e1 = 0.0
e1 := (src - e0) * (1 - beta) + beta * nz(e1[1])

e2 = 0.0
e2 := (e0 + phaseRatio * e1 - nz(jma[1])) * pow(1 - alpha, 2) + pow(alpha, 2) * nz(e2[1])

jma := e2 + nz(jma[1])

jmaColor = highlightMovements ? (jma > jma[1] ? green : red) : #6d1e7f
plot(jma, title="JMA", linewidth=2, color=jmaColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/jurik_moving_average.pine | File No: 47 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/kaufman_adaptive_moving_average.pine | File No: 48 | Started --##
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Kaufman Adaptive Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Kaufman Adaptive Moving Average", shorttitle="KAMA", overlay=true)

length = input(title="Length", type=input.integer, defval=14)
fastLength = input(title="Fast EMA Length", type=input.integer, defval=2)
slowLength = input(title="Slow EMA Length", type=input.integer, defval=30)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

mom = abs(change(src, length))
volatility = sum(abs(change(src)), length)

// Efficiency Ratio
er = volatility != 0 ? mom / volatility : 0

fastAlpha = 2 / (fastLength + 1)
slowAlpha = 2 / (slowLength + 1)

alpha = pow(er * (fastAlpha - slowAlpha) + slowAlpha, 2)

kama = 0.0
kama := alpha * src + (1 - alpha) * nz(kama[1], src)

kamaColor = highlight ? kama > kama[1] ? color.green : color.red : #6d1e7f
plot(kama, title="KAMA", linewidth=2, color=kamaColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/kaufman_adaptive_moving_average.pine | File No: 48 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/laguerre_filter.pine | File No: 49 | Started --##
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Laguerre Filter script may be freely distributed under the terms of the GPL-3.0 license.
study("Laguerre Filter", shorttitle="LF", overlay=true)

alpha = input(title="Alpha", type=input.float, minval=0, maxval=1, step=0.1, defval=0.7)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

L0 = 0.0
L0 := alpha * src + (1 - alpha) * nz(L0[1])

L1 = 0.0
L1 := -(1 - alpha) * L0 + nz(L0[1]) + (1 - alpha) * nz(L1[1])

L2 = 0.0
L2 := -(1 - alpha) * L1 + nz(L1[1]) + (1 - alpha) * nz(L2[1])

L3 = 0.0
L3 := -(1 - alpha) * L2 + nz(L2[1]) + (1 - alpha) * nz(L3[1])

lf = (L0 + 2 * L1 + 2 * L2 + L3) / 6

lfColor = highlight ? lf > lf[1] ? color.green : color.red : #6d1e7f
plot(lf, title="LF", linewidth=2, color=lfColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/laguerre_filter.pine | File No: 49 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/least_squares_moving_average.pine | File No: 50 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Least Squares Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Least Squares Moving Average", shorttitle="LSMA", overlay=true)

length = input(title="Length", type=integer, minval=1, defval=14)
offset = input(title="Offset", type=integer, defval=0)
src = input(title="Source", type=source, defval=close)

plot(linreg(src, length, offset), title="LSMA", linewidth=2, color=#6d1e7f, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/least_squares_moving_average.pine | File No: 50 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/leo_moving_average.pine | File No: 51 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Leo Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Leo Moving Average", shorttitle="LMA", overlay=true)

length = input(title="Length", type=integer, minval=1, defval=14)
highlightMovements = input(title="Highlight Movements ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

lma = 2 * wma(src, length) - sma(src, length)

lmaColor = highlightMovements ? (lma > lma[1] ? green : red) : #6d1e7f

plot(lma, title="LMA", linewidth=2, color=lmaColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/leo_moving_average.pine | File No: 51 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/linear_weighted_moving_average.pine | File No: 52 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Linear Weighted Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Linear Weighted Moving Average", shorttitle="LWMA", overlay=true)

length = input(title="Length", type=integer, minval=1, defval=14)
src = input(title="Source", type=source, defval=close)

lwma(src, length) =>
	weightSum = 0.0
	sum = 0.0

	for i = 0 to length - 1
		weight = length - i
		weightSum := weightSum + weight
		sum := sum + nz(src[i]) * weight

	sum / weightSum

plot(lwma(src, length), title="LWMA", linewidth=2, color=#e69138, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/linear_weighted_moving_average.pine | File No: 52 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/mcginley_dynamic.pine | File No: 53 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// McGinley Dynamic script may be freely distributed under the terms of the GPL-3.0 license.
study("McGinley Dynamic", shorttitle="MD", overlay=true)

length = input(title="Length", type=integer, minval=1, defval=14)
k = input(title="K", type=float, step=0.1, defval=0.6)
src = input(title="Source", type=source, defval=close)

md(src, length, k) =>
	md = 0.0
	md := na(md[1]) ? src : md[1] + (src - md[1]) / (k * length * pow(src / md[1], 4))

plot(md(src, length, k), title="MD", linewidth=2, color=#6d1e7f, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/mcginley_dynamic.pine | File No: 53 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/mcnicholl_moving_average.pine | File No: 54 | Started --##
//@version=3
// Copyright (c) 1998-present, Dennis McNicholl
// Copyright (c) 2019-present, Alex Orekhov (everget)
// McNicholl Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("McNicholl Moving Average", shorttitle="MNMA", overlay=true)

length = input(title="Length", type=integer, defval=20)
highlightMovements = input(title="Highlight Movements ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

alpha = 2 / (length + 1)

ema1 = ema(src, length)
ema2 = ema(ema1, length)

mnma = ((2 - alpha) * ema1 - ema2) / (1 - alpha)

mnmaColor = highlightMovements ? (mnma > mnma[1] ? green : red) : #6d1e7f
plot(mnma, title="MNMA", linewidth=2, color=mnmaColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/mcnicholl_moving_average.pine | File No: 54 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/middle_high_low_moving_average.pine | File No: 55 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Middle-High-Low Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Middle-High-Low Moving Average", shorttitle="MHLMA", overlay=true)

length = input(title="Length", type=integer, minval=1, defval=14)
mhlRange = input(title="High-Low Range", type=integer, defval=10)
maType = input(title="MA Type", defval="EMA", options=["EMA", "SMA"])
highlightMovements = input(title="Highlight Movements ?", type=bool, defval=true)

mhl = avg(highest(mhlRange), lowest(mhlRange))
mhlma = maType == "EMA" ? ema(mhl, length) : sma(mhl, length)

mhlmaColor = highlightMovements ? (mhlma > mhlma[1] ? green : red) : #6d1e7f

plot(mhlma, title="MHLMA", linewidth=2, color=mhlmaColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/middle_high_low_moving_average.pine | File No: 55 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/moving_geometric_mean.pine | File No: 56 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Moving Geometric Mean script may be freely distributed under the terms of the GPL-3.0 license.
study("Moving Geometric Mean", shorttitle="MGM", overlay=true)

length = input(title="Length", type=integer, minval=1, defval=14)
src = input(title="Source", type=source, defval=close)

mgm(src, length) =>
	exp(sum(log(src), length) / length)

plot(mgm(src, length), title="MGM", linewidth=2, color=#6d1e7f, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/moving_geometric_mean.pine | File No: 56 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/moving_harmonic_mean.pine | File No: 57 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Moving Harmonic Mean script may be freely distributed under the terms of the GPL-3.0 license.
study("Moving Harmonic Mean", shorttitle="MHM", overlay=true)

length = input(title="Length", type=integer, defval=14, minval=1)
src = input(title="Source", type=source, defval=close)

mhm(src, length) =>
	sum = 0.0

	for i = 0 to length - 1
		sum := sum + 1 / (na(src[i]) ? 1 : src[i])

	length / sum

plot(mhm(src, length), title="MHM", linewidth=2, color=#6d1e7f, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/moving_harmonic_mean.pine | File No: 57 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/moving_median.pine | File No: 58 | Started --##
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Moving Median script may be freely distributed under the terms of the GPL-3.0 license.
study("Moving Median", shorttitle="MM", overlay=true)

length = input(title="Length", type=input.integer, defval=14)
highlight = input(title="Highlight ?", type=input.bool, defval=true)
src = input(title="Source", type=input.source, defval=close)

median = percentile_nearest_rank(src, length, 50)

medianColor = highlight ? median > median[1] ? color.green : color.red : #6d1e7f
plot(median, title="MM", linewidth=2, color=medianColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/moving_median.pine | File No: 58 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/moving_quadratic_mean.pine | File No: 59 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Moving Quadratic Mean (RMS) script may be freely distributed under the terms of the GPL-3.0 license.
study("Moving Quadratic Mean (RMS)", shorttitle="RMS", overlay=true)

length = input(title="Length", type=integer, minval=1, defval=14)
src = input(title="Source", type=source, defval=close)

rms(src, length) =>
	sqrt(sum(src * src, length) / length)

plot(rms(src, length), title="RMS", linewidth=2, color=#6d1e7f, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/moving_quadratic_mean.pine | File No: 59 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/multiple_hull_moving_average.pine | File No: 60 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Multiple Hull Moving Average script may be freely distributed under the terms of GPL-3.0 license.
study("Multiple Hull Moving Average", shorttitle="HMA", overlay=true)

len1 = input(title="1st Length", type=integer, defval=20)
src1 = input(title="1st Source", type=source, defval=close)
hma1 = wma(2 * wma(src1, len1 / 2) - wma(src1, len1), round(sqrt(len1)))
plot(hma1, title="1", linewidth=2, color=#85200c, transp=0)

len2 = input(title="2nd Length", type=integer, defval=50)
src2 = input(title="2nd Source", type=source, defval=close)
hma2 = wma(2 * wma(src2, len2 / 2) - wma(src2, len2), round(sqrt(len2)))
plot(hma2, title="2", linewidth=2, color=#1155cc, transp=0)

len3 = input(title="3rd Length", type=integer, defval=100)
src3 = input(title="3rd Source", type=source, defval=close)
hma3 = wma(2 * wma(src3, len3 / 2) - wma(src3, len3), round(sqrt(len3)))
plot(hma3, title="3", linewidth=2, color=#f1c232, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/multiple_hull_moving_average.pine | File No: 60 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/parabolic_sar.pine | File No: 61 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Parabolic SAR script may be freely distributed under the terms of the GPL-3.0 license.
study(title="Parabolic SAR", shorttitle="PSAR", overlay=true)

start = input(0.02)
increment = input(0.02)
maximum = input(0.2)

psar = sar(start, increment, maximum)

plot(psar, style=cross, color=blue)

##-- File Name: tradingview-pinescript-indicators-master/movings/parabolic_sar.pine | File No: 61 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/parabolic_weighted_moving_average.pine | File No: 62 | Started --##
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Parabolic Weighted Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Parabolic Weighted Moving Average", shorttitle="PWMA", overlay=true)

length = input(title="Length", type=integer, defval=14)
power = input(title="Power", type=integer, minval=0, defval=2)
highlightMovements = input(title="Highlight Movements ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

sum = 0.0
weightSum = 0.0

for i = 0 to length - 1
	weight = pow(length - i, power)
	sum := sum + nz(src[i]) * weight
	weightSum := weightSum + weight

pwma = sum / weightSum

pwmaColor = highlightMovements ? (pwma > pwma[1] ? green : red) : #6d1e7f
plot(pwma, title="PWMA", linewidth=2, color=pwmaColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/parabolic_weighted_moving_average.pine | File No: 62 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/pentuple_exponential_moving_average.pine | File No: 63 | Started --##
//@version=3
// Copyright (c) 2010-present, Bruno Pio
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Pentuple Exponential Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Pentuple Exponential Moving Average", shorttitle="PEMA", overlay=true)

length = input(title="Length", type=integer, defval=20)
highlightMovements = input(title="Highlight Movements ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

ema1 = ema(src, length)
ema2 = ema(ema1, length)
ema3 = ema(ema2, length)
ema4 = ema(ema3, length)
ema5 = ema(ema4, length)
ema6 = ema(ema5, length)
ema7 = ema(ema6, length)
ema8 = ema(ema7, length)

pema = 8 * ema1 - 28 * ema2 + 56 * ema3 - 70 * ema4 + 56 * ema5 - 28 * ema6 + 8 * ema7 - ema8

pemaColor = highlightMovements ? (pema > pema[1] ? green : red) : #6d1e7f
plot(pema, title="PEMA", linewidth=2, color=pemaColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/pentuple_exponential_moving_average.pine | File No: 63 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/quadruple_exponential_moving_average.pine | File No: 64 | Started --##
//@version=3
// Copyright (c) 2010-present, Bruno Pio
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Quadruple Exponential Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Quadruple Exponential Moving Average", shorttitle="QEMA", overlay=true)

length = input(title="Length", type=integer, defval=20)
highlightMovements = input(title="Highlight Movements ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

ema1 = ema(src, length)
ema2 = ema(ema1, length)
ema3 = ema(ema2, length)
ema4 = ema(ema3, length)
ema5 = ema(ema4, length)

qema = 5 * ema1 - 10 * ema2 + 10 * ema3 - 5 * ema4 + ema5

qemaColor = highlightMovements ? (qema > qema[1] ? green : red) : #6d1e7f
plot(qema, title="QEMA", linewidth=2, color=qemaColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/quadruple_exponential_moving_average.pine | File No: 64 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/quick_moving_average.pine | File No: 65 | Started --##
//@version=3
// Copyright (c) 2008-present, John McCormick
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Quick Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Quick Moving Average", shorttitle="QMA", overlay=true)

length = input(title="Length", type=integer, minval=1, defval=14)
src = input(title="Source", type=source, defval=close)
highlightMovements = input(title="Highlight Movements ?", type=bool, defval=false)

peak = length / 3
num = 0.0
denom = 0.0

for i = 1 to length + 1
	mult = 0.0
	if i <= peak
		mult := i / peak
	else
		mult := (length + 1 - i) / (length + 1 - peak)
	num := num + src[i - 1] * mult
	denom := denom + mult

qma = denom != 0.0 ? num / denom : src

qmaColor = highlightMovements ? (qma > qma[1] ? green : red) : #6d1e7f
plot(qma, title="QMA", linewidth=2, color=qmaColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/quick_moving_average.pine | File No: 65 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/recursive_median_filter.pine | File No: 66 | Started --##
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Recursive Median Filter script may be freely distributed under the terms of the GPL-3.0 license.
study("Recursive Median Filter", shorttitle="RMF", overlay=true)

medianLength = input(title="Median Length", type=input.integer, defval=5, minval=1)
lowpassLength = input(title="Lowpass Length", type=input.integer, defval=12, minval=1)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

_median(src, length) =>
	percentile_nearest_rank(src, length, 50)

PI = 2 * asin(1)

alphaArg = 2 * PI / lowpassLength
cos = cos(alphaArg)

alpha = 0.0
alpha := cos != 0 ? (cos + sin(alphaArg) - 1) / cos : nz(alpha[1])

rmf = 0.0
rmf := alpha * _median(src, medianLength) + (1 - alpha) * nz(rmf[1])

rmfColor = highlight ? rmf > rmf[1] ? color.green : color.red : #6d1e7f
plot(rmf, title="RMF", linewidth=2, color=rmfColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/recursive_median_filter.pine | File No: 66 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/recursive_median_oscillator.pine | File No: 67 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Recursive Median Filter script may be freely distributed under the terms of the GPL-3.0 license.
study("Recursive Median Filter", shorttitle="RMF", overlay=true)

medianLength = input(title="Length", type=integer, minval=1, defval=5)
lowpassLength = input(title="Lowpass Length", type=integer, minval=1, defval=12)
src = input(title="Source", type=source, defval=close)

median(src, length) =>
	percentile_nearest_rank(src, length, 50)

PI = 2 * asin(1)

alphaArg = 2 * PI / lowpassLength

alpha = 0.0
alpha := cos(alphaArg) != 0 ? (cos(alphaArg) + sin(alphaArg) - 1) / cos(alphaArg) : nz(alpha[1])

rmf = 0.0
rmf := alpha * median(src, medianLength) + (1 - alpha) * nz(rmf[1])

plot(rmf, title="RMF", linewidth=2, color=#6d1e7f, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/recursive_median_oscillator.pine | File No: 67 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/recursive_moving_trend_average.pine | File No: 68 | Started --##
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Recursive Moving Trend Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Recursive Moving Trend Average", shorttitle="RMTA", overlay=true)

length = input(title="Length", type=input.integer, defval=14, minval=1)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

alpha = 2 / (length + 1)

b = 0.0
b := (1 - alpha) * nz(b[1], src) + src

rmta = 0.0
rmta := (1 - alpha) * nz(rmta[1], src) + alpha * (src + b - nz(b[1]))

rmtaColor = highlight ? rmta > rmta[1] ? color.green : color.red : #6d1e7f
plot(rmta, title="RMTA", linewidth=2, color=rmtaColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/recursive_moving_trend_average.pine | File No: 68 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/regularized_exponential_moving_average.pine | File No: 69 | Started --##
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Regularized Exponential Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Regularized Exponential Moving Average", shorttitle="REMA", overlay=true)

length = input(title="Length", type=input.integer, defval=14)
lambda = input(title="Regularization Constant", type=input.float, minval=0, defval=0.5)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

alpha = 2 / (length + 1)

rema = 0.0
rema1 = nz(rema[1], src)
rema2 = nz(rema[2], rema1)

rema := (rema1 + alpha * (src - rema1) + lambda * (2 * rema1 - rema2)) / (lambda + 1)

remaColor = highlight ? rema > rema[1] ? color.green : color.red : #6d1e7f
plot(rema, title="REMA", linewidth=2, color=remaColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/regularized_exponential_moving_average.pine | File No: 69 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/self_weighted_moving_average.pine | File No: 70 | Started --##
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Self-Weighted Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Self-Weighted Moving Average", shorttitle="SEWMA", overlay=true)

length = input(title="Length", type=integer, minval=1, defval=14)
highlightMovements = input(title="Highlight Movements ?", type=bool, defval=false)
src = input(title="Source", type=source, defval=close)

sum = 0.0
weightSum = 0.0

for i = 0 to length - 1
	weight = src[length + i]
	weightSum := weightSum + weight
	sum := sum + weight * src[i]

sewma = sum / weightSum

sewmaColor = highlightMovements ? (sewma > sewma[1] ? green : red) : #6d1e7f
plot(sewma, title="SEWMA", linewidth=2, color=sewmaColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/self_weighted_moving_average.pine | File No: 70 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/sharp_modified_moving_average.pine | File No: 71 | Started --##
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Sharp Modified Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Sharp Modified Moving Average", shorttitle="SHMMA", overlay=true)

length = input(title="Length", type=input.integer, defval=14)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

factor = 0.0
slope = 0.0

for i = 1 to length
	factor := 1 + 2 * (i - 1)
	slope := slope + src[i - 1] * (length - factor) / 2

shmma = sma(src, length) + 6 * slope / ((length + 1) * length)

shmmaColor = highlight ? shmma > shmma[1] ? color.green : color.red : #6d1e7f
plot(shmma, title="SHMMA", linewidth=2, color=shmmaColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/sharp_modified_moving_average.pine | File No: 71 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/simple_moving_average.pine | File No: 72 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Simple Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Simple Moving Average", shorttitle="SMA", overlay=true)

length = input(title="Length", type=integer, minval=1, defval=14)
src = input(title="Source", type=source, defval=close)

plot(sma(src, length), title="SMA", linewidth=2, color=#6d1e7f, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/simple_moving_average.pine | File No: 72 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/sine_weighted_moving_average.pine | File No: 73 | Started --##
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Sine Weighted Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Sine Weighted Moving Average", shorttitle="SWMA", overlay=true)

length = input(title="Length", type=input.integer, defval=14)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

PI = 2 * asin(1)
sum = 0.0
weightSum = 0.0

for i = 0 to length - 1
	weight = sin((i + 1) * PI / (length + 1))
	sum := sum + nz(src[i]) * weight
	weightSum := weightSum + weight
	weightSum

swma = sum / weightSum

swmaColor = highlight ? swma > swma[1] ? color.green : color.red : #6d1e7f
plot(swma, title="SWMA", linewidth=2, color=swmaColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/sine_weighted_moving_average.pine | File No: 73 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/spencer_15_point_moving_average.pine | File No: 74 | Started --##
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Spencer 15-Point Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Spencer 15-Point Moving Average", shorttitle="SPMA 15", overlay=true)

src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

_weight(i) =>
	weight = 0.0

	if i == 0
		weight := -3
	if i == 1
		weight := -6
	if i == 2
		weight := -5
	if i == 3
		weight := 3
	if i == 4
		weight := 21
	if i == 5
		weight := 46
	if i == 6
		weight := 67
	if i == 7
		weight := 74
	if i == 8
		weight := 67
	if i == 9
		weight := 46
	if i == 10
		weight := 21
	if i == 11
		weight := 3
	if i == 12
		weight := -5
	if i == 13
		weight := -6
	if i == 14
		weight := -3
	weight

sum = 0.0
weightSum = 0.0

for i = 0 to 14
	weight = _weight(i)
	sum := sum + nz(src[i]) * weight
	weightSum := weightSum + weight

spma15 = sum / weightSum

spma15Color = highlight ? spma15 > spma15[1] ? color.green : color.red : #6d1e7f
plot(spma15, title="SPMA 15", linewidth=2, color=spma15Color, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/spencer_15_point_moving_average.pine | File No: 74 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/spencer_21_point_moving_average.pine | File No: 75 | Started --##
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Spencer 21-Point Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Spencer 21-Point Moving Average", shorttitle="SPMA 21", overlay=true)

src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

_weight(i) =>
	weight = 0.0

	if i == 0
		weight := -1
	if i == 1
		weight := -3
	if i == 2
		weight := -5
	if i == 3
		weight := -5
	if i == 4
		weight := -2
	if i == 5
		weight := 6
	if i == 6
		weight := 18
	if i == 7
		weight := 33
	if i == 8
		weight := 47
	if i == 9
		weight := 57
	if i == 10
		weight := 60
	if i == 11
		weight := 57
	if i == 12
		weight := 47
	if i == 13
		weight := 33
	if i == 14
		weight := 18
	if i == 15
		weight := 6
	if i == 16
		weight := -2
	if i == 17
		weight := -5
	if i == 18
		weight := -5
	if i == 19
		weight := -3
	if i == 20
		weight := -1
	weight

sum = 0.0
weightSum = 0.0

for i = 0 to 20
	weight = _weight(i)
	sum := sum + nz(src[i]) * weight
	weightSum := weightSum + weight

spma21 = sum / weightSum

spma21Color = highlight ? spma21 > spma21[1] ? color.green : color.red : #6d1e7f
plot(spma21, title="SPMA 21", linewidth=2, color=spma21Color, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/spencer_21_point_moving_average.pine | File No: 75 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/t3_moving_average.pine | File No: 76 | Started --##
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// T3 Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("T3 Moving Average", shorttitle="T3", overlay=true)

length = input(title="Length", type=input.integer, defval=5)
factor = input(title="Factor", type=input.float, minval=0, maxval=1, defval=0.7)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

_gd(src, length) =>
	ema(src, length) * (1 + factor) - ema(ema(src, length), length) * factor

t3 = _gd(_gd(_gd(src, length), length), length)

t3Color = highlight ? t3 > t3[1] ? color.green : color.red : #6d1e7f
plot(t3, title="T3", linewidth=2, color=t3Color, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/t3_moving_average.pine | File No: 76 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/triangular_moving_average.pine | File No: 77 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Triangular Moving Average script may be freely distributed under the terms of GPL-3.0 license.
study("Triangular Moving Average", shorttitle="TMA", overlay=true)

length = input(title="Length", type=integer, minval=1, defval=20)
highlightMovements = input(title="Highlight Movements ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

tma = sma(sma(src, ceil(length / 2)), floor(length / 2) + 1)
tmaColor = highlightMovements ? (tma > tma[1] ? green : red) : #6d1e7f

plot(tma, title="TMA", linewidth=2, color=tmaColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/triangular_moving_average.pine | File No: 77 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/trimean.pine | File No: 78 | Started --##
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Trimean script may be freely distributed under the terms of the GPL-3.0 license.
study("Trimean", shorttitle="Trimean", overlay=true)

length = input(title="Length", type=input.integer, minval=1, defval=14)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

q1 = percentile_nearest_rank(src, length, 25)
median = percentile_nearest_rank(src, length, 50)
q3 = percentile_nearest_rank(src, length, 75)

trimean = (q1 + 2 * median + q3) / 4

trimeanColor = highlight ? trimean > trimean[1] ? color.green : color.red : #6d1e7f
plot(trimean, title="Trimean", linewidth=2, color=trimeanColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/trimean.pine | File No: 78 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/vidya_variable_index_dynamic_average.pine | File No: 79 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Variable Index Dynamic Average script may be freely distributed under the terms of GPL-3.0 license.
study(title="Variable Index Dynamic Average", shorttitle="VIDYA", overlay=true)

length = input(title="Length", type=integer, defval=14)
highlightMovements = input(title="Highlight Movements ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

// Chande Momentum Oscillator
getCMO(src, length) =>
    mom = change(src)
    upSum = sum(max(mom, 0), length)
    downSum = sum(-min(mom, 0), length)
    out = (upSum - downSum) / (upSum + downSum)
    out

cmo = abs(getCMO(src, length))

alpha = 2 / (length + 1)

vidya = 0.0
vidya := src * alpha * cmo + nz(vidya[1]) * (1 - alpha * cmo)

vidyaColor = highlightMovements ? (vidya > vidya[1] ? green : red) : #6d1e7f
plot(vidya, title="VIDYA", linewidth=2, color=vidyaColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/vidya_variable_index_dynamic_average.pine | File No: 79 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/weighted_moving_average.pine | File No: 80 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Weighted Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Weighted Moving Average", shorttitle="WMA", overlay=true)

length = input(title="Length", type=integer, minval=1, defval=14)
src = input(title="Source", type=source, defval=close)

plot(wma(src, length), title="WMA", linewidth=2, color=#6d1e7f, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/weighted_moving_average.pine | File No: 80 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/wilder_modified_moving_average.pine | File No: 81 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Wilder Modified Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Wilder Modified Moving Average", shorttitle="WMMA", overlay=true)

length = input(title="Length", type=integer, minval=1, defval=14)
src = input(title="Source", type=source, defval=close)

plot(rma(src, length), title="WMMA", linewidth=2, color=#6d1e7f, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/wilder_modified_moving_average.pine | File No: 81 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/movings/zero_lag_exponential_moving_average.pine | File No: 82 | Started --##
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Zero Lag Exponential Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Zero Lag Exponential Moving Average", shorttitle="ZLEMA", overlay=true)

length = input(title="Length", type=input.integer, defval=14)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

lag = floor((length - 1) / 2)
zlema = ema(src + (src - src[lag]), length)

zlemaColor = highlight ? zlema > zlema[1] ? color.green : color.red : #6d1e7f
plot(zlema, title="ZLEMA", linewidth=2, color=zlemaColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/movings/zero_lag_exponential_moving_average.pine | File No: 82 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/accelerator_oscillator.pine | File No: 83 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Accelerator Oscillator script may be freely distributed under the terms of GPL-3.0 license.
study("Accelerator Oscillator", shorttitle="AC")

fastLength = input(title="Fast Length", type=integer, defval=5)
slowLength = input(title="Slow Length", type=integer, defval=34)
smoothLength = input(title="Smoothing Length", type=integer, defval=5)

ao = sma(hl2, fastLength) - sma(hl2, slowLength)

ac = ao - sma(ao, smoothLength)

acColor = ac >= 0 ? (ac[1] < ac ? #26A69A : #B2DFDB) : (ac[1] < ac ? #FFCDD2 : #EF5350)
plot(ac, title="AC", style=columns, color=acColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/accelerator_oscillator.pine | File No: 83 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/accumulative_swing_index.pine | File No: 84 | Started --##
//@version=3
// Copyright (c) 2017-present, Alex Orekhov (everget)
// Accumulative Swing Index script may be freely distributed under the terms of GPL-3.0 license.
study("Accumulative Swing Index", shorttitle="ASI")

limit = input(title="Limit Move Value", type=float, defval=10000)

// Swing Index
getSI(limit) =>
    H_C1 = abs(high - close[1])
    L_C1 = abs(low - close[1])
    H_L = abs(high - low)
    C1_O1 = abs(close[1] - open[1])
    K = max(H_C1, L_C1)
    R = iff(H_C1 >= max(L_C1, H_L), H_C1 - 0.5 * L_C1 + 0.25 * C1_O1, iff(L_C1 >= max(H_C1, H_L), L_C1 - 0.5 * H_C1 + 0.25 * C1_O1, H_L + 0.25 * C1_O1))
    result = 50 * ((close - close[1] + 0.5 * (close - open) + 0.25 * (close[1] - open[1])) / R) * K / limit
    result

// Accumulative Swing Index
asi = cum(getSI(limit))

asiColor = asi >= asi[1] ? #0ebb23 : red

plot(asi, title="ASI", color=asiColor, transp=0)
##-- File Name: tradingview-pinescript-indicators-master/oscillators/accumulative_swing_index.pine | File No: 84 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/asymmetrical_rsi.pine | File No: 85 | Started --##
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Asymmetrical RSI script may be freely distributed under the terms of the GPL-3.0 license.
study("Asymmetrical RSI", shorttitle="ARSI")

length = input(title="Length", type=input.integer, defval=14)
obLevel = input(title="Overbought Level", type=input.integer, defval=70)
osLevel = input(title="Oversold Level", type=input.integer, defval=30)
src = input(title="Source", type=input.source, defval=close)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=input.bool, defval=true)

roc = roc(src, 1)

upCount = sum(roc >= 0 ? 1 : 0, length)
upAlpha = 1 / upCount

upSum = 0.0
upSum := upAlpha * (roc >= 0 ? roc : 0) + (1 - upAlpha) * nz(upSum[1], upSum)

downCount = length - upCount
downAlpha = 1 / downCount

downSum = 0.0
downSum := downAlpha * (roc >= 0 ? 0 : abs(roc)) + (1 - downAlpha) * nz(downSum[1], downSum)

arsi = fixnan(100 * upSum / (upSum + downSum))

arsiColor = arsi > obLevel ? #0ebb23 : arsi < osLevel ? #ff0000 : #f4b77d
plot(arsi, title="ARSI", linewidth=2, color=arsiColor, transp=0)

transparent = color.new(color.white, 100)

maxLevelPlot = hline(100, title="Max Level", linestyle=hline.style_dotted, color=transparent)
obLevelPlot = hline(obLevel, title="Overbought Level", linestyle=hline.style_dotted)
hline(50, title="Middle Level", linestyle=hline.style_dotted)
osLevelPlot = hline(osLevel, title="Oversold Level", linestyle=hline.style_dotted)
minLevelPlot = hline(0, title="Min Level", linestyle=hline.style_dotted, color=transparent)

fill(obLevelPlot, osLevelPlot, color=color.purple, transp=95)

obFillColor = arsi > obLevel and highlightBreakouts ? color.green : transparent
osFillColor = arsi < osLevel and highlightBreakouts ? color.red : transparent

fill(maxLevelPlot, obLevelPlot, color=obFillColor, transp=90)
fill(minLevelPlot, osLevelPlot, color=osFillColor, transp=90)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/asymmetrical_rsi.pine | File No: 85 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/awesome_oscillator.pine | File No: 86 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Awesome Oscillator script may be freely distributed under the terms of GPL-3.0 license.
study("Awesome Oscillator", shorttitle="AO")

fastLength = input(title="Fast Length", type=integer, defval=5)
slowLength = input(title="Slow Length", type=integer, defval=34)

ao = sma(hl2, fastLength) - sma(hl2, slowLength)

aoColor = ao >= 0 ? (ao[1] < ao ? #26A69A : #B2DFDB) : (ao[1] < ao ? #FFCDD2 : #EF5350)
plot(ao, title="AO", style=columns, color=aoColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/awesome_oscillator.pine | File No: 86 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/cci_commodity_channel_index.pine | File No: 87 | Started --##
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Commodity Channel Index (CCI) script may be freely distributed under the terms of the GPL-3.0 license.
study("Commodity Channel Index", shorttitle="CCI")

length = input(title="Length", type=integer, defval=20)
obLevel = input(title="Overbought Level", type=integer, defval=100)
osLevel = input(title="Oversold Level", type=integer, defval=-100)
maxLevel = input(title="Max Level", type=integer, defval=300)
minLevel = input(title="Min Level", type=integer, defval=-300)
highlightBreakouts = input(title="Highlight Breakouts ?", type=bool, defval=true)
srcInput = input(title="Source", defval="hlc3",
	 options=["open",
				 "high",
				 "low",
				 "close",
				 "oo2",
				 "oh2",
				 "ol2",
				 "oc2",
				 "hh2",
				 "hl2",
				 "hc2",
				 "ll2",
				 "lc2",
				 "cc2",
				 "hlc3",
				 "ohlc4",
				 "wc",
				 "volume",
				 "acc/dist",
				 "on balance volume",
				 "price volume trend"])

getBaseSource(input) =>
	src = 0.0
	if input == "open"
		src := open
	if input == "high"
		src := high
	if input == "low"
		src := low
	if input == "close"
		src := close
	if input == "oo2"
		src := (open + nz(open[1])) / 2
	if input == "oh2"
		src := (open + high) / 2
	if input == "ol2"
		src := (open + low) / 2
	if input == "oc2"
		src := (open + close) / 2
	if input == "hh2"
		src := (high + nz(high[1])) / 2
	if input == "hl2" // Median Price
		src := hl2
	if input == "hc2"
		src := (high + close) / 2
	if input == "ll2"
		src := (low + nz(low[1])) / 2
	if input == "lc2"
		src := (low + close) / 2
	if input == "cc2"
		src := (close + nz(close[1])) / 2
	if input == "hlc3" // Typical Price
		src := hlc3
	if input == "ohlc4"
		src := ohlc4
	if input == "wc" // Weighted Close
		src := (2 * close + high + low) / 4
	if input == "volume"
		src := volume
	if input == "acc/dist"
		src := accdist
	if input == "on balance volume"
		src := cum(sign(change(close)) * volume)
	if input == "price volume trend"
		src := cum(roc(src, 1) * volume)
	src

src = getBaseSource(srcInput)

cci = (src - sma(src, length)) / (0.015 * dev(src, length))

cciColor = cci > obLevel ? #0ebb23 : cci < osLevel ? #ff0000 : #f4b77d
plot(cci, title="CCI", linewidth=2, color=cciColor, transp=0)

transparent = color(white, 100)

maxLevelPlot = hline(maxLevel, title="Max Level", linestyle=dotted, color=transparent)
obLevelPlot = hline(obLevel, title="Overbought Level", linestyle=dotted)
hline(0, title="Zero Level", linestyle=dotted)
osLevelPlot = hline(osLevel, title="Oversold Level", linestyle=dotted)
minLevelPlot = hline(minLevel, title="Min Level", linestyle=dotted, color=transparent)

fill(obLevelPlot, osLevelPlot, color=purple, transp=95)

obFillColor = cci > obLevel and highlightBreakouts ? green : transparent
osFillColor = cci < osLevel and highlightBreakouts ? red : transparent

fill(maxLevelPlot, obLevelPlot, color=obFillColor, transp=90)
fill(minLevelPlot, osLevelPlot, color=osFillColor, transp=90)

co = crossover(cci, obLevel)
cu = crossunder(cci, osLevel)

alertcondition(co, title="Alert on CCI Overbought", message="CCI Overbought!")
alertcondition(cu, title="Alert on CCI Oversold", message="CCI Oversold!")

##-- File Name: tradingview-pinescript-indicators-master/oscillators/cci_commodity_channel_index.pine | File No: 87 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/center_of_gravity_oscillator.pine | File No: 88 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// CG Oscillator script may be freely distributed under the terms of the GPL-3.0 license.
study("CG Oscillator", shorttitle="CGO")

length = input(title="Length", type=integer, minval=1, defval=10)
applyFilling = input(title="Apply Filling ?", type=bool, defval=false)
src = input(title="Source", type=source, defval=hl2)

numeratorSum = 0.0
denominatorSum = 0.0

for i = 0 to length - 1
	numeratorSum := numeratorSum + (i + 1) * nz(src[i])
	denominatorSum := denominatorSum + nz(src[i])

cgo = -numeratorSum / denominatorSum

cgoPlot = plot(cgo, title="CGO", color=#3d85c6, transp=0)
cgoPrevPlot = plot(cgo[1], title="CGO Prev", color=#ff3e7d, transp=0)

fillColor = applyFilling ? (cgo > cgo[1] ? #0ebb23 : #cc0000) : color(white, 100)
fill(cgoPlot, cgoPrevPlot, color=fillColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/center_of_gravity_oscillator.pine | File No: 88 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/chande_momentum_oscillator.pine | File No: 89 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Chande Momentum Oscillator script may be freely distributed under the terms of GPL-3.0 license.
study("Chande Momentum Oscillator", shorttitle="CMO")

length = input(title="Length", type=integer, defval=9)
obLevel = input(title="Overbought Level", type=integer, defval=50)
osLevel = input(title="Oversold Level", type=integer, defval=-50)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

mom = change(src)

upSum = sum(max(mom, 0), length)
downSum = sum(-min(mom, 0), length)

cmo = 100 * (upSum - downSum) / (upSum + downSum)

cmoColor = cmo > obLevel ? #0ebb23 : cmo < osLevel ? #ff0000 : #f4b77d

plot(cmo, title="CMO", linewidth=2, color=cmoColor, transp=0)

transparent = color(white, 100)

maxBand = hline(100, title="Max Level", linestyle=dotted, color=transparent)
hline(0, title="Zero Level", linestyle=dotted)
minBand = hline(-100, title="Min Level", linestyle=dotted, color=transparent)

obBand = hline(obLevel, title="Overbought Level", linestyle=dotted)
osBand = hline(osLevel, title="Oversold Level", linestyle=dotted)
fill(obBand, osBand, color=purple, transp=95)

obFillColor = cmo > obLevel and highlightBreakouts ? green : transparent
osFillColor = cmo < osLevel and highlightBreakouts ? red : transparent

fill(maxBand, obBand, color=obFillColor, transp=80)
fill(minBand, osBand, color=osFillColor, transp=80)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/chande_momentum_oscillator.pine | File No: 89 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/coppock_curve.pine | File No: 90 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Coppock Curve script may be freely distributed under the terms of GPL-3.0 license.
study("Coppock Curve")

length = input(title="Smoothing Length", type=integer, defval=10)
longRocLength = input(title="Long ROC Length", type=integer, defval=14)
shortRocLength = input(title="Short ROC Length", type=integer, defval=11)
src = input(title="Source", type=source, defval=close)

coppock = wma(roc(src, longRocLength) + roc(src, shortRocLength), length)

coppockColor = coppock > 0 ? #0ebb23 : red

plot(coppock, title="Coppock", linewidth=2, color=coppockColor, transp=0)
hline(0, title="Zero Level", linestyle=dotted)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/coppock_curve.pine | File No: 90 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/demarker.pine | File No: 91 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// DeMarker script may be freely distributed under the terms of the GPL-3.0 license.
study("DeMarker", shorttitle="DeMarker")

length = input(title="Length", type=integer, defval=14)
maType = input(title="Smoothing Type", defval="SMA", options=["EMA", "SMA", "VWMA", "WMA"])
obLevel = input(title="Overbought Level", type=float, step=0.1, defval=0.7)
osLevel = input(title="Oversold Level", type=float, step=0.1, defval=0.3)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

getMA(type, src, length) =>
    type == "SMA" ? sma(src, length) :
     type == "EMA" ? ema(src, length) :
     type == "VWMA" ? vwma(src, length) :
     type == "WMA" ? wma(src, length) :
     na

demax = max(change(high), 0)
demin = -min(change(low), 0)

demarker = getMA(maType, demax, length) / (getMA(maType, demax, length) + getMA(maType, demin, length))

demarkerColor = demarker > obLevel ? #0ebb23 : demarker < osLevel ? #ff0000 : #f4b77d
plot(demarker, title="DeMarker", linewidth=2, color=demarkerColor, transp=0)

transparent = color(white, 100)

maxLevelPlot = hline(1, title="Max Level", linestyle=dotted, color=transparent)
obLevelPlot = hline(obLevel, title="Overbought Level", linestyle=dotted)
hline(0.5, title="Middle Level", linestyle=dotted)
osLevelPlot = hline(osLevel, title="Oversold Level", linestyle=dotted)
minLevelPlot = hline(0, title="Min Level", linestyle=dotted, color=transparent)

fill(obLevelPlot, osLevelPlot, color=purple, transp=95)

obFillColor = demarker > obLevel and highlightBreakouts ? green : transparent
osFillColor = demarker < osLevel and highlightBreakouts ? red : transparent

fill(maxLevelPlot, obLevelPlot, color=obFillColor, transp=90)
fill(minLevelPlot, osLevelPlot, color=osFillColor, transp=90)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/demarker.pine | File No: 91 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/derivative_oscillator.pine | File No: 92 | Started --##
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Derivative Oscillator script may be freely distributed under the terms of GPL-3.0 license.
study("Derivative Oscillator", shorttitle="DOSC")

rsiLength = input(title="RSI Length", type=input.integer, defval=14)
ema1Length = input(title="1st EMA Smoothing Length", type=input.integer, defval=5)
ema2Length = input(title="2nd EMA Smoothing Length", type=input.integer, defval=3)
smaLength = input(title="3rd SMA Smoothing Length", type=input.integer, defval=9)
signalLength = input(title="Signal Length", type=input.integer, defval=9)
src = input(title="Source", type=input.source, defval=close)

smoothedRSI = ema(ema(rsi(src, rsiLength), ema1Length), ema2Length)
dosc = smoothedRSI - sma(smoothedRSI, smaLength)
signal = sma(dosc, signalLength)

doscColor = dosc >= 0 ? dosc[1] < dosc ? #26A69A : #B2DFDB : dosc[1] < dosc ? #FFCDD2 : #EF5350
plot(dosc, title="DOSC", style=plot.style_columns, linewidth=2, color=doscColor, transp=0)
plot(signal, title="Signal", linewidth=2, color=color.black, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/derivative_oscillator.pine | File No: 92 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/didi_index.pine | File No: 93 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Didi Index script may be freely distributed under the terms of GPL-3.0 license.
study("Didi Index")

curtaLength = input(title="Curta (Short) Length", type=integer, defval=3)
mediaLength = input(title="Media (Medium) Length", type=integer, defval=8)
longaLength = input(title="Longa (Long) Length", type=integer, defval=20)
src = input(title="Source", type=source, defval=close)
applyFilling = input(title="Apply Ribbon Filling ?", type=bool, defval=true)
highlightCrossovers = input(title="Highlight Crossovers ?", type=bool, defval=true)

media = sma(src, mediaLength)
curta = sma(src, curtaLength) / media
longa = sma(src, longaLength) / media

curtaPlot = plot(curta, title="Curta", color=green)
plot(1, title="Media", color=black, transp=0)
longaPlot = plot(longa, title="Longa", color=red)

fillColor = applyFilling ? (curta > longa ? #0ebb23 : red) : color(white, 100) 
fill(curtaPlot, longaPlot, color=fillColor, transp=80)

plotshape(crossover(curta, longa) and highlightCrossovers ? avg(longa, longa[1]) : na, title="Crossover", location=location.absolute, style=shape.circle, size=size.tiny, color=green, transp=20)
plotshape(crossunder(curta, longa) and highlightCrossovers ? avg(longa, longa[1]) : na, title="Crossunder", location=location.absolute, style=shape.circle, size=size.tiny, color=red, transp=20)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/didi_index.pine | File No: 93 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/disparity_index.pine | File No: 94 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Disparity Index script may be freely distributed under the terms of the GPL-3.0 license.
study("Disparity Index", shorttitle="DI")

length = input(title="Length", type=integer, minval=1, defval=14)
src = input(title="Source", type=source, defval=close)

di = 100 * (src - sma(src, length)) / sma(src, length)

diColor = di >= 0.0 ? #0ebb23 : #ff0000
plot(di, title="Disparity Index", linewidth=2, color=diColor, transp=0)

hline(0, title="Zero Level", linestyle=dotted, color=#989898)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/disparity_index.pine | File No: 94 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/dorsey_inertia.pine | File No: 95 | Started --##
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Dorsey Inertia script may be freely distributed under the terms of GPL-3.0 license.
study("Dorsey Inertia", shorttitle="Inertia")

stdevLength = input(title="Standard Deviation Length", type=integer, defval=21)
rviSmoothLength = input(title="RVI Smoothing Length", type=integer, defval=14)
smoothLength = input(title="Inertia Smoothing Length", type=integer, defval=14)

// Relative Volatility Index (1993)
rviOriginal(src, stdevLength, smoothLength) =>
	stdev = stdev(src, stdevLength)
	upSum = ema(change(src) >= 0 ? stdev : 0, smoothLength)
	downSum = ema(change(src) >= 0 ? 0 : stdev, smoothLength)
	100 * upSum / (upSum + downSum)

rvi = avg(rviOriginal(high, stdevLength, rviSmoothLength), rviOriginal(low, stdevLength, rviSmoothLength))
inertia = linreg(rvi, smoothLength, 0)

inertiaColor = inertia > 50 ? #0ebb23 : red

plot(inertia, title="Inertia", linewidth=2, color=inertiaColor, transp=0)
hline(50, title="Middle Level", linestyle=dotted)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/dorsey_inertia.pine | File No: 95 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/dynamic_momentum_index.pine | File No: 96 | Started --##
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Dynamic Momentum Index script may be freely distributed under the terms of the GPL-3.0 license.
study("Dynamic Momentum Index", shorttitle="DMI")

rsiLength = input(title="Initial RSI Length", type=integer, minval=1, defval=14)
stdevLength = input(title="Standard Deviation Length", type=integer, minval=1, defval=5)
maLength = input(title="Smoothing Length", type=integer, minval=1, defval=10)
lower = input(title="Lower Bound", type=integer, defval=5)
upper = input(title="Upper Bound", type=integer, defval=30)
obLevel = input(title="Overbought Level", type=integer, defval=70)
osLevel = input(title="Oversold Level", type=integer, defval=30)
src = input(title="Source", type=source, defval=close)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=bool, defval=true)

stdev = stdev(src, stdevLength)
V = stdev / sma(stdev, maLength)

T = round(rsiLength / V)
T := T > upper ? upper : T < lower ? lower : T

// Wilder's Smoothing (Running Moving Average)
_rma(src, length) =>
    out = 0.0
    out := ((length - 1) * nz(out[1]) + src) / length

_rsi(src, length) =>
	upSum = _rma(max(change(src), 0), length)
	downSum = _rma(-min(change(src), 0), length)
	rsi = downSum == 0
		 ? 100
		 : upSum == 0
			 ? 0
			 : 100 - (100 / (1 + upSum / downSum))
	rsi

dmi = _rsi(src, T)

dmiColor = dmi > obLevel ? #0ebb23 : dmi < osLevel ? red : #f4b77d
plot(dmi, title="DMI", linewidth=2, color=dmiColor, transp=0)

transparent = color(white, 100)

maxLevelPlot = hline(100, title="Max Level", linestyle=dotted, color=transparent)
obLevelPlot = hline(obLevel, title="Overbought Level", linestyle=dotted)
hline(50, title="Middle Level", linestyle=dotted)
osLevelPlot = hline(osLevel, title="Oversold Level", linestyle=dotted)
minLevelPlot = hline(0, title="Min Level", linestyle=dotted, color=transparent)

fill(obLevelPlot, osLevelPlot, color=purple, transp=95)

obFillColor = dmi > obLevel and highlightBreakouts ? green : transparent
osFillColor = dmi < osLevel and highlightBreakouts ? red : transparent

fill(maxLevelPlot, obLevelPlot, color=obFillColor, transp=90)
fill(minLevelPlot, osLevelPlot, color=osFillColor, transp=90)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/dynamic_momentum_index.pine | File No: 96 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/ehlers_cyber_cycle.pine | File No: 97 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Ehlers Cyber Cycle script may be freely distributed under the terms of the GPL-3.0 license.
study("Ehlers Cyber Cycle", shorttitle="ECC")

length = input(title="Length", type=integer, minval=1, defval=14)
alpha = input(title="Alpha", type=float, step=0.1, defval=0.7)
applyFilling = input(title="Apply Filling ?", type=bool, defval=false)
src = input(title="Source", type=source, defval=close)

smooth = (src + 2 * nz(src[1]) + 2 * nz(src[2]) + nz(src[3])) / 6

ecc = 0.0
ecc := pow(1 - alpha / 2, 2) * (smooth - 2 * nz(smooth[1]) + nz(smooth[2])) + 2 * (1 - alpha) * nz(ecc[1]) - pow(1 - alpha, 2) * nz(ecc[2])

eccPlot = plot(ecc, title="ECC", color=#3d85c6, transp=0)
eccPrevPlot = plot(ecc[1], title="Trigger", color=#ff3e7d, transp=0)

fillColor = applyFilling ? (ecc > ecc[1] ? #0ebb23 : #cc0000) : color(white, 100)
fill(eccPlot, eccPrevPlot, color=fillColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/ehlers_cyber_cycle.pine | File No: 97 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/ehlers_decycler_oscillator.pine | File No: 98 | Started --##
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Ehlers Decycler Oscillator script may be freely distributed under the terms of GPL-3.0 license.
study("Ehlers Decycler Oscillator", shorttitle="Decycler Oscillator")

hpPeriod = input(title="High-pass Filter Period", type=integer, defval=125)
k = input(title="K Multiplier", type=float, step=0.1, defval=1)
hpPeriod2 = input(title="High-pass Filter Period 2", type=integer, defval=100)
k2 = input(title="K Multiplier 2", type=float, step=0.1, defval=1.2)
src = input(title="Source", type=source, defval=close)
highlightCrossovers = input(title="Highlight Crossovers ?", type=bool, defval=true)
highlightZeroCrossovers = input(title="Highlight Zero Line Crossovers ?", type=bool, defval=false)
applyFilling = input(title="Apply Ribbon Filling ?", type=bool, defval=false)

PI = 2 * asin(1)

// High-pass Filter
_hp(src, hpPeriod, mult) =>
    alphaArg = 2 * PI / (mult * hpPeriod * sqrt(2))
    
    alpha = 0.0
    alpha := cos(alphaArg) != 0
         ? (cos(alphaArg) + sin(alphaArg) - 1) / cos(alphaArg)
         : nz(alpha[1])
    
    hp = 0.0
    hp := pow(1 - (alpha / 2), 2) * (src - 2 * nz(src[1]) + nz(src[2])) + 2 * (1 - alpha) * nz(hp[1]) - pow(1 - alpha, 2) * nz(hp[2])
    hp

hp = _hp(src, hpPeriod, 1)
decycler = src - hp
decosc = 100 * k * _hp(decycler, hpPeriod, 0.5) / src

hp2 = _hp(src, hpPeriod2, 1)
decycler2 = src - hp2
decosc2 = 100 * k2 * _hp(decycler2, hpPeriod2, 0.5) / src

trendColor = decosc2 > decosc ? #0ebb23 : red

decoscColor = applyFilling ? trendColor : #ff5048
decosc2Color = applyFilling ? trendColor : #f5c75e

decoscPlot = plot(decosc, title="1", linewidth=2, color=decoscColor, transp=0)
decosc2Plot = plot(decosc2, title="2", linewidth=2, color=decosc2Color, transp=0)
hline(0, title="Zero Level", linestyle=dotted)

transparent = color(white, 100)

fillColor = applyFilling ? trendColor : transparent
fill(decoscPlot, decosc2Plot, color=fillColor, transp=70)

zeroCrossBgColor = highlightZeroCrossovers ? (decosc > 0 or decosc2 > 0 ? green : red) : transparent
bgcolor(zeroCrossBgColor, transp=85)

plotshape(highlightCrossovers and crossover(decosc, decosc2) ? avg(decosc, decosc[1]) : na, title="Crossover", location=location.absolute, style=shape.circle, size=size.tiny, color=green, transp=0)
plotshape(highlightCrossovers and crossunder(decosc, decosc2) ? avg(decosc, decosc[1]) : na, title="Crossunder", location=location.absolute, style=shape.circle, size=size.tiny, color=red, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/ehlers_decycler_oscillator.pine | File No: 98 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/ehlers_fisherized_deviation_scaled_oscillator.pine | File No: 99 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Ehlers Fisherized Deviation-Scaled Oscillator script may be freely distributed under the terms of the GPL-3.0 license.
study("Ehlers Fisherized Deviation-Scaled Oscillator", shorttitle="EFDSO")

length = input(title="Length", type=integer, defval=40, minval=1)
ssfLength = input(title="Super Smoother Filter Length", type=integer, defval=20, minval=1)
numberOfPoles = input(title="Number of Poles", type=integer, defval=2, options=[2, 3])
obLevel = input(title="Overbought Level", type=float, step=0.1, defval=2)
osLevel = input(title="Oversold Level", type=float, step=0.1, defval=-2)
maxLevel = input(title="Max Level", type=float, step=0.1, defval=4.0)
minLevel = input(title="Min Level", type=float, step=0.1, defval=-4.0)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

PI = 2 * asin(1)

get2PoleSSF(src, length) =>
    arg = sqrt(2) * PI / length
    a1 = exp(-arg)
    b1 = 2 * a1 * cos(arg)
    c2 = b1
    c3 = -pow(a1, 2)
    c1 = 1 - c2 - c3

    ssf = 0.0
    ssf := c1 * src + c2 * nz(ssf[1]) + c3 * nz(ssf[2])

get3PoleSSF(src, length) =>
    arg = PI / length
    a1 = exp(-arg)
    b1 = 2 * a1 * cos(1.738 * arg)
    c1 = pow(a1, 2)

    coef2 = b1 + c1
    coef3 = -(c1 + b1 * c1)
    coef4 = pow(c1, 2)
    coef1 = 1 - coef2 - coef3 - coef4

    ssf = 0.0
    ssf := coef1 * src + coef2 * nz(ssf[1]) + coef3 * nz(ssf[2]) + coef4 * nz(ssf[3])

zeros = src - nz(src[2])
arg = avg(zeros, zeros[1])

// Ehlers Super Smoother Filter
essf = numberOfPoles == 2
     ? get2PoleSSF(arg, ssfLength)
     : get3PoleSSF(arg, ssfLength)

// Rescale filter in terms of Standard Deviations
stdev = stdev(essf, length)
scaledFilter = 0.0
scaledFilter := stdev != 0
     ? essf / stdev
     : nz(scaledFilter[1])

// Apply Fisher Transform to establish real Gaussian Probability Distribution
efdso = 0.0
efdso := abs(scaledFilter) < 2
     ? 0.5 * log((1 + scaledFilter / 2) / (1 - scaledFilter / 2))
     : nz(efdso[1])

efdsoColor = efdso > obLevel ? #0ebb23 : efdso < osLevel ? #ff0000 : #f4b77d
plot(efdso, title="EFDSO", linewidth=2, color=efdsoColor, transp=0)

transparent = color(white, 100)

maxLevelPlot = hline(maxLevel, title="Max Level", linestyle=dotted, color=transparent)
obLevelPlot = hline(obLevel, title="Overbought Level", linestyle=dotted)
hline(0, title="Zero Level", linestyle=dotted)
osLevelPlot = hline(osLevel, title="Oversold Level", linestyle=dotted)
minLevelPlot = hline(minLevel, title="Min Level", linestyle=dotted, color=transparent)

fill(obLevelPlot, osLevelPlot, color=purple, transp=95)

obFillColor = efdso > obLevel and highlightBreakouts ? green : transparent
osFillColor = efdso < osLevel and highlightBreakouts ? red : transparent

fill(maxLevelPlot, obLevelPlot, color=obFillColor, transp=90)
fill(minLevelPlot, osLevelPlot, color=osFillColor, transp=90)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/ehlers_fisherized_deviation_scaled_oscillator.pine | File No: 99 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/ehlers_roofing_filter.pine | File No: 100 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Ehlers Roofing Filter indicator script may be freely distributed under the terms of the GPL-3.0 license.
study("Ehlers Roofing Filter", shorttitle="ERF")

highpassLength = input(title="HighPass Length", type=integer, minval=1, defval=48)
ssfLength = input(title="Super Smoother Filter Length", type=integer, minval=1, defval=10)
numberOfPoles = input(title="Number of Poles", type=integer, defval=2, options=[2, 3])
src = input(title="Source", type=source, defval=close)

PI = 2 * asin(1)

twoPoleSuperSmootherFilter(src, length) =>
	arg = sqrt(2) * PI / length
	a1 = exp(-arg)
	b1 = 2 * a1 * cos(arg)
	c2 = b1
	c3 = -pow(a1, 2)
	c1 = 1 - c2 - c3

	ssf = 0.0
	ssf := c1 * src + c2 * nz(ssf[1]) + c3 * nz(ssf[2])

threePoleSuperSmootherFilter(src, length) =>
	arg = PI / length
	a1 = exp(-arg)
	b1 = 2 * a1 * cos(1.738 * arg)
	c1 = pow(a1, 2)

	coef2 = b1 + c1
	coef3 = -(c1 + b1 * c1)
	coef4 = pow(c1, 2)
	coef1 = 1 - coef2 - coef3 - coef4

	ssf = 0.0
	ssf := coef1 * src + coef2 * nz(ssf[1]) + coef3 * nz(ssf[2]) + coef4 * nz(ssf[3])

roofingFilter(src, highpassLength, ssfLength, numberOfPoles) =>
	alphaArg = 2 * PI / (highpassLength * sqrt(2))

	alpha = 0.0
	alpha := cos(alphaArg) != 0
		 ? (cos(alphaArg) + sin(alphaArg) - 1) / cos(alphaArg)
		 : nz(alpha[1])

	highpass = 0.0
	highpass := pow(1 - (alpha / 2), 2) * (src - 2 * nz(src[1]) + nz(src[2])) + 2 * (1 - alpha) * nz(highpass[1]) - pow(1 - alpha, 2) * nz(highpass[2])

	numberOfPoles == 2
	 ? twoPoleSuperSmootherFilter((highpass + nz(highpass[1])) / 2, ssfLength)
	 : threePoleSuperSmootherFilter((highpass + nz(highpass[1])) / 2, ssfLength)

erf = roofingFilter(src, highpassLength, ssfLength, numberOfPoles)

erfColor = erf >= 0.0 ? #0ebb23 : #ff0000

plot(erf, title="ERF", linewidth=2, color=erfColor, transp=0)

hline(0, title="Zero Level", linestyle=dotted, color=#989898)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/ehlers_roofing_filter.pine | File No: 100 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/ehlers_smoothed_adaptive_momentum.pine | File No: 101 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Ehlers Smoothed Adaptive Momentum script may be freely distributed under the terms of GPL-3.0 license.
study("Ehlers Smoothed Adaptive Momentum", shorttitle="ESAM")

length = input(title="Cutoff", type=integer, defval=8)
alpha = input(title="Alpha", type=float, minval=0, step=0.1, defval=0.7)
poles = input(title="Super Smoother Filter Poles", type=integer, defval=3, options=[2, 3])
src = input(title="Source", type=source, defval=close)

median(src, length) =>
    percentile_nearest_rank(src, length, 50)

PI = 2 * asin(1)

get2PoleSSF(src, length) =>
    arg = sqrt(2) * PI / length
    a1 = exp(-arg)
    b1 = 2 * a1 * cos(arg)
    c2 = b1
    c3 = -pow(a1, 2)
    c1 = 1 - c2 - c3
    
    ssf = 0.0
    ssf := c1 * src + c2 * nz(ssf[1]) + c3 * nz(ssf[2])

get3PoleSSF(src, length) =>
    arg = PI / length
    a1 = exp(-arg)
    b1 = 2 * a1 * cos(1.738 * arg)
    c1 = pow(a1, 2)

    coef2 = b1 + c1
    coef3 = -(c1 + b1 * c1)
    coef4 = pow(c1, 2)
    coef1 = 1 - coef2 - coef3 - coef4

    ssf = 0.0
    ssf := coef1 * src + coef2 * nz(ssf[1]) + coef3 * nz(ssf[2]) + coef4 * nz(ssf[3])

hilbertTransform(src) =>
    0.0962 * src + 0.5769 * nz(src[2]) - 0.5769 * nz(src[4]) - 0.0962 * nz(src[6])

computeComponent(src, periodMult) =>
    hilbertTransform(src) * periodMult

getESAM(src, length, alpha, poles) =>
    smooth = (src + 2 * nz(src[1]) + 2 * nz(src[2]) + nz(src[3])) / 6

    cycle = 0.0
    cycle := pow(1 - alpha / 2, 2) * (smooth - 2 * nz(smooth[1]) + nz(smooth[2])) + 2 * (1 - alpha) * nz(cycle[1]) - pow(1 - alpha, 2) * nz(cycle[2])

    if n < 7
        cycle := (src - 2 * nz(src[1]) + nz(src[2])) / 4
    
    instPeriod = 0.0
    instPeriodMult = 0.8 * nz(instPeriod[1]) + 0.5
    
    I1 = 0.0
    Q1 = 0.0
    
    // Compute InPhase and Quadrature Components
    I1 := nz(cycle[3])
    Q1 := computeComponent(src, instPeriodMult)
    
    deltaPhase = 0.0
    
    if Q1 != 0 and Q1[1] != 0
        deltaPhase := (I1 / Q1 - I1[1] / Q1[1]) / (1 + I1 * I1[1] / (Q1 * Q1[1]))
    
    if deltaPhase < 0.1
        deltaPhase := 0.1
    
    if deltaPhase > 1.1
        deltaPhase := 1.1

    medianDelta = median(deltaPhase, 5)

    // Dominant Cycle
    dc = 0.0

    if medianDelta == 0
        dc := 15
    else
        dc := 2 * PI / medianDelta + 0.5

    instPeriod := 0.33 * dc + 0.67 * nz(instPeriod[1])

    lookback = 0.0
    lookback := 0.15 * instPeriod + 0.85 * nz(lookback[1])
    
    mom = src - src[floor(lookback - 1)]
    
    esam = poles == 3
         ? get3PoleSSF(mom, length)
         : get2PoleSSF(mom, length)
    esam

esam = getESAM(src, length, alpha, poles)
esamColor = esam > 0 ? #0ebb23 : red

plot(esam, title="ESAM", linewidth=2, color=esamColor, transp=0)
hline(0, title="Zero Level", linestyle=dotted)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/ehlers_smoothed_adaptive_momentum.pine | File No: 101 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/ehlers_stochastic_cyber_cycle.pine | File No: 102 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Ehlers Stochastic Cyber Cycle script may be freely distributed under the terms of the GPL-3.0 license.
study("Ehlers Stochastic Cyber Cycle", shorttitle="ESCC")

length = input(title="Length", type=integer, minval=1, defval=14)
alpha = input(title="Alpha", type=float, step=0.1, defval=0.7)
applyFilling = input(title="Apply Filling ?", type=bool, defval=false)
src = input(title="Source", type=source, defval=close)

smooth = (src + 2 * nz(src[1]) + 2 * nz(src[2]) + nz(src[3])) / 6

cycle = 0.0
cycle := pow(1 - alpha / 2, 2) * (smooth - 2 * nz(smooth[1]) + nz(smooth[2])) + 2 * (1 - alpha) * nz(cycle[1]) - pow(1 - alpha, 2) * nz(cycle[2])

maxCycle = highest(cycle, length)
minCycle = lowest(cycle, length)

stoch = (cycle - minCycle) / (maxCycle - minCycle)

escc = 2 * ((4 * stoch + 3 * nz(stoch[1]) + 2 * nz(stoch[2]) + nz(stoch[3])) / 10 - 0.5)
esccPrev = 0.96 * (escc[1] + 0.02)

esccPlot = plot(escc, title="ESCC", color=#3d85c6, transp=0)
esccPrevPlot = plot(esccPrev, title="Trigger", color=#ff3e7d, transp=0)

hline(0, title="Zero Level", linestyle=dotted)

fillColor = applyFilling ? (escc > esccPrev ? #0ebb23 : #cc0000) : color(white, 100)
fill(esccPlot, esccPrevPlot, color=fillColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/ehlers_stochastic_cyber_cycle.pine | File No: 102 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/ehlers_stochastic.pine | File No: 103 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Ehlers Stochastic script may be freely distributed under the terms of the GPL-3.0 license.
study("Ehlers Stochastic", shorttitle="EStoch")

highpassLength = input(title="HighPass Length", type=integer, minval=1, defval=48)
ssfLength = input(title="Super Smoother Filter Length", type=integer, minval=1, defval=10)
stochLength = input(title="Stochastic Length", type=integer, minval=1, defval=20)
numberOfPoles = input(title="Number of Poles", type=integer, defval=2, options=[2, 3])
overboughtLevel = input(title="Overbought Level", type=float, step=0.1, defval=0.8)
oversoldLevel = input(title="Oversold Level", type=float, step=0.1, defval=0.2)
src = input(title="Source", type=source, defval=close)

PI = 2 * asin(1)

twoPoleSuperSmootherFilter(src, length) =>
	arg = sqrt(2) * PI / length
	a1 = exp(-arg)
	b1 = 2 * a1 * cos(arg)
	c2 = b1
	c3 = -pow(a1, 2)
	c1 = 1 - c2 - c3

	ssf = 0.0
	ssf := c1 * src + c2 * nz(ssf[1]) + c3 * nz(ssf[2])

threePoleSuperSmootherFilter(src, length) =>
	arg = PI / length
	a1 = exp(-arg)
	b1 = 2 * a1 * cos(1.738 * arg)
	c1 = pow(a1, 2)

	coef2 = b1 + c1
	coef3 = -(c1 + b1 * c1)
	coef4 = pow(c1, 2)
	coef1 = 1 - coef2 - coef3 - coef4

	ssf = 0.0
	ssf := coef1 * src + coef2 * nz(ssf[1]) + coef3 * nz(ssf[2]) + coef4 * nz(ssf[3])

roofingFilter(src, highpassLength, ssfLength, numberOfPoles) =>
	alphaArg = 2 * PI / (highpassLength * sqrt(2))

	alpha = 0.0
	alpha := cos(alphaArg) != 0
		 ? (cos(alphaArg) + sin(alphaArg) - 1) / cos(alphaArg)
		 : nz(alpha[1])

	highpass = 0.0
	highpass := pow(1 - (alpha / 2), 2) * (src - 2 * nz(src[1]) + nz(src[2])) + 2 * (1 - alpha) * nz(highpass[1]) - pow(1 - alpha, 2) * nz(highpass[2])

	numberOfPoles == 2
		 ? twoPoleSuperSmootherFilter((highpass + nz(highpass[1])) / 2, ssfLength)
		 : threePoleSuperSmootherFilter((highpass + nz(highpass[1])) / 2, ssfLength)

ehlersStochastic(roofingFilter, stochLength, ssfLength, numberOfPoles) =>
	rfHighest = highest(roofingFilter, stochLength)
	rfLowest = lowest(roofingFilter, stochLength)

	stoch = rfHighest - rfLowest != 0
		 ? (roofingFilter - rfLowest) / (rfHighest - rfLowest)
		 : 0

	numberOfPoles == 2
		 ? twoPoleSuperSmootherFilter((stoch + nz(stoch[1])) / 2, ssfLength)
		 : threePoleSuperSmootherFilter((stoch + nz(stoch[1])) / 2, ssfLength)

erf = roofingFilter(src, highpassLength, ssfLength, numberOfPoles)
estoch = ehlersStochastic(erf, stochLength, ssfLength, numberOfPoles)

estochColor = estoch > overboughtLevel ? #0ebb23 : estoch < oversoldLevel ? #cc0000 : #674ea7
plot(estoch, title="EStoch", linewidth=2, color=estochColor, transp=0)

hline(overboughtLevel, title="Overbought Level", linestyle=dotted, color=#e69138)
hline(0.5, title="Middle Level", linestyle=dotted, color=#989898)
hline(oversoldLevel, title="Oversold Level", linestyle=dotted, color=#e69138)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/ehlers_stochastic.pine | File No: 103 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/ehlers_super_passband_filter.pine | File No: 104 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Ehlers Super Passband Filter script may be freely distributed under the terms of the GPL-3.0 license.
study("Ehlers Super Passband Filter", shorttitle="ESPF")

fastLength = input(title="Fast Length", type=integer, minval=1, defval=40)
slowLength = input(title="Slow Length", type=integer, minval=1, defval=60)
src = input(title="Source", type=source, defval=close)

ehlersSuperPassbandFilter(src, fastLength, slowLength) =>
	a1 = 5 / fastLength
	a2 = 5 / slowLength

	espf = 0.0
	espf := (a1 - a2) * src +
		 (a2 * (1 - a1) - a1 * (1 - a2)) * nz(src[1]) +
		 ((1 - a1) + (1 - a2)) * nz(espf[1]) -
		 (1 - a1) * (1 - a2) * nz(espf[2])

espf = ehlersSuperPassbandFilter(src, fastLength, slowLength)

// Compute Root Mean Square
rms = sqrt(sum(espf * espf, 50) / 50)

spbColor = espf > rms ? #0ebb23 : espf < -rms ? #ff0000 : #674ea7

plot(rms, title="+RMS", linewidth=1, color=#f6b26b, transp=0)
plot(espf, title="ESPF", linewidth=2, color=spbColor, transp=0)
plot(-rms, title="-RMS", linewidth=1, color=#f6b26b, transp=0)

hline(0, title="Zero Level", linestyle=dotted, color=#989898)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/ehlers_super_passband_filter.pine | File No: 104 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/ehlers_triple_delay_line_detrender.pine | File No: 105 | Started --##
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Ehlers Triple Delay-Line Detrender script may be freely distributed under the terms of GPL-3.0 license.
study("Ehlers Triple Delay-Line Detrender", shorttitle="TDLD")

src = input(title="Source", type=source, defval=hl2)
showSignal = input(title="Show Signal Line ?", type=bool, defval=true)
showHistogram = input(title="Show Histogram ?", type=bool, defval=false)
highlightCrossovers = input(title="Highlight Signal Crossovers ?", type=bool, defval=true)
highlightZeroCrossovers = input(title="Highlight Zero Line Crossovers ?", type=bool, defval=false)
applyFilling = input(title="Apply Ribbon Filling ?", type=bool, defval=false)

tmp1 = 0.0
tmp1 := src + .088 * nz(tmp1[6])

tmp2 = 0.0
tmp2 := tmp1 - nz(tmp1[6]) + 1.2 * nz(tmp2[6]) - 0.7 * nz(tmp2[12])

detrender = nz(tmp2[12]) - 2 * nz(tmp2[6]) + tmp2

_moef(src) =>
    src1 = nz(src[1], src)
    src2 = nz(src[2], src1)
    src3 = nz(src[3], src2)
    
    moef = src
    moef := 0.13785 * (2 * src - src1) +
             0.0007 * (2 * src1 - src2) +
             0.13785 * (2 * src2 - src3) +
             1.2103 * nz(moef[1], moef) -
             0.4867 * nz(moef[2], moef)
    moef

tdld = _moef(detrender)
signal = _moef(tdld)

hist = tdld - signal
histColor = hist >= 0 ? (hist[1] < hist ? #26a69a : #b2dfdb) : (hist[1] < hist ? #ffcdd2 : #ef5350)
plot(showHistogram ? hist : na, title="Histogram", style=columns, color=histColor, transp=0)
hline(0, title="Zero Level", linestyle=dotted)

trendColor = tdld > signal ? #0ebb23 : red

tdldColor = applyFilling ? trendColor : (tdld > 0 ? #0ebb23 : red)
signalColor = applyFilling ? trendColor : #ff9800

tdldPlot = plot(tdld, title="TDLD", linewidth=2, color=tdldColor, transp=0)
signalPlot = plot(showSignal ? signal : na, title="Signal", color=signalColor, transp=0)

transparent = color(white, 100)

fillColor = applyFilling ? trendColor : transparent
fill(tdldPlot, signalPlot, color=fillColor, transp=70)

zeroCrossBgColor = highlightZeroCrossovers ? (tdld > 0 ? green : red) : transparent
bgcolor(zeroCrossBgColor, transp=80)

plotshape(highlightCrossovers and crossover(tdld, signal) ? avg(tdld, tdld[1]) : na, title="Crossover", location=location.absolute, style=shape.circle, size=size.tiny, color=green, transp=0)
plotshape(highlightCrossovers and crossunder(tdld, signal) ? avg(tdld, tdld[1]) : na, title="Crossunder", location=location.absolute, style=shape.circle, size=size.tiny, color=red, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/ehlers_triple_delay_line_detrender.pine | File No: 105 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/ergodic_oscillator.pine | File No: 106 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Ergodic Oscillator script may be freely distributed under the terms of the GPL-3.0 license.
study("Ergodic Oscillator", shorttitle="EOSC")

firstSmoothingLength = input(title="1st Smoothing Length", type=integer, minval=1, defval=8)
secondSmoothingLength = input(title="2nd Smoothing Length", type=integer, minval=1, defval=5)
signalLength = input(title="Signal Length", type=integer, minval=1, defval=5)
ergodicLength = input(title="Ergodic Length", type=integer, minval=1, defval=5)
ergodicSignalLength = input(title="Ergodic Signal Length", type=integer, minval=1, defval=14)
overboughtLevel = input(title="Overbought Level", type=integer, defval=20)
oversoldLevel = input(title="Oversold Level", type=integer, defval=-20)
src = input(title="Source", type=source, defval=close)

momentum = change(src)

ema1 = ema(momentum, firstSmoothingLength)
ema1Abs = ema(abs(momentum), firstSmoothingLength)

ema2 = ema(ema1, secondSmoothingLength)
ema2Abs = ema(abs(ema1Abs), secondSmoothingLength)

tsi = 100 * ema2 / ema2Abs

signal = ema(tsi, signalLength)

ergodic = ema(signal, ergodicLength)

ergodicSignal = ema(ergodic, ergodicSignalLength)

plot(ergodic, title="Ergodic", linewidth=2, color=#3c78d8, transp=0)
plot(ergodicSignal, title="Signal", linewidth=2, color=#cc0000, transp=0)

hline(overboughtLevel, title="Overbought Level", linestyle=dotted, linewidth=2, color=#0ebb23)
hline(oversoldLevel, title="Oversold Level", linestyle=dotted, linewidth=2, color=#ff9370)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/ergodic_oscillator.pine | File No: 106 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/forecast_oscillator.pine | File No: 107 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Forecast Oscillator script may be freely distributed under the terms of the GPL-3.0 license.
study("Forecast Oscillator", shorttitle="FOSC")

length = input(title="Length", type=integer, minval=1, defval=14)
src = input(title="Source", type=source, defval=close)

fosc = 100 * (src - linreg(src, length, 0)) / src

foscColor = fosc >= 0.0 ? #0ebb23 : #ff0000

plot(fosc, title="FOSC", linewidth=2, color=foscColor, transp=0)

hline(0, title="Zero Level", linestyle=dotted, color=#989898)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/forecast_oscillator.pine | File No: 107 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/gator_oscillator.pine | File No: 108 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Gator Oscillator script may be freely distributed under the terms of GPL-3.0 license.
study("Gator Oscillator", shorttitle="Gator")

jawLength = input(title="Jaw Length", type=integer, defval=13)
teethLength = input(title="Teeth Length", type=integer, defval=8)
lipsLength = input(title="Lips Length", type=integer, defval=5)

jaw = offset(rma(hl2, jawLength), 8)
teeth = offset(rma(hl2, teethLength), 5)
lips = offset(rma(hl2, lipsLength), 3)

upper = abs(jaw - teeth)
lower = -abs(teeth - lips)

upperColor = (upper[1] < upper ? #26A69A : #EF5350)
lowerColor = (lower[1] > lower ? #26A69A : #EF5350)

plot(upper, title="Upper", style=columns, color=upperColor, transp=0)
plot(lower, title="Lower", style=columns, color=lowerColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/gator_oscillator.pine | File No: 108 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/intraday_momentum_index.pine | File No: 109 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Intraday Momentum Index script may be freely distributed under the terms of the GPL-3.0 license.
study("Intraday Momentum Index", shorttitle="IMI")

length = input(title="Length", type=integer, minval=1, defval=14)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

gain = close > open ? close - open : 0
loss = close > open ? 0 : open - close

upSum = sum(gain, length)
downSum = sum(loss, length)

imi = 100 * upSum / (upSum + downSum)

obLevel = 70
osLevel = 30

imiColor = imi > obLevel ? #0ebb23 : imi < osLevel ? #ff0000 : #f4b77d
plot(imi, title="IMI", linewidth=2, color=imiColor, transp=0)

transparent = color(white, 100)

maxLevelPlot = hline(100, title="Max Level", linestyle=dotted, color=transparent)
obLevelPlot = hline(obLevel, title="Overbought Level", linestyle=dotted)
hline(50, title="Middle Level", linestyle=dotted)
osLevelPlot = hline(osLevel, title="Oversold Level", linestyle=dotted)
minLevelPlot = hline(0, title="Min Level", linestyle=dotted, color=transparent)

fill(obLevelPlot, osLevelPlot, color=purple, transp=95)

obFillColor = imi > obLevel and highlightBreakouts ? green : transparent
osFillColor = imi < osLevel and highlightBreakouts ? red : transparent

fill(maxLevelPlot, obLevelPlot, color=obFillColor, transp=90)
fill(minLevelPlot, osLevelPlot, color=osFillColor, transp=90)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/intraday_momentum_index.pine | File No: 109 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/jurik_rsx.pine | File No: 110 | Started --##
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Jurik RSX script may be freely distributed under the terms of GPL-3.0 license.
study("Jurik RSX", shorttitle="RSX")

length = input(title="Length", type=integer, defval=14)
src = input(title="Source", type=source, defval=hlc3)
obLevel = input(title="OB Level", type=integer, defval=70)
osLevel = input(title="OS Level", type=integer, defval=30)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=bool, defval=true)

f8 = 100 * src
f10 = nz(f8[1])
v8 = f8 - f10

f18 = 3 / (length + 2)
f20 = 1 - f18

f28 = 0.0
f28 := f20 * nz(f28[1]) + f18 * v8

f30 = 0.0
f30 := f18 * f28 + f20 * nz(f30[1])
vC = f28 * 1.5 - f30 * 0.5

f38 = 0.0
f38 := f20 * nz(f38[1]) + f18 * vC

f40 = 0.0
f40 := f18 * f38 + f20 * nz(f40[1])
v10 = f38 * 1.5 - f40 * 0.5

f48 = 0.0
f48 := f20 * nz(f48[1]) + f18 * v10

f50 = 0.0
f50 := f18 * f48 + f20 * nz(f50[1])
v14 = f48 * 1.5 - f50 * 0.5

f58 = 0.0
f58 := f20 * nz(f58[1]) + f18 * abs(v8)

f60 = 0.0
f60 := f18 * f58 + f20 * nz(f60[1])
v18 = f58 * 1.5 - f60 * 0.5

f68 = 0.0
f68 := f20 * nz(f68[1]) + f18 * v18

f70 = 0.0
f70 := f18 * f68 + f20 * nz(f70[1])
v1C = f68 * 1.5 - f70 * 0.5

f78 = 0.0
f78 := f20 * nz(f78[1]) + f18 * v1C

f80 = 0.0
f80 := f18 * f78 + f20 * nz(f80[1])
v20 = f78 * 1.5 - f80 * 0.5

f88_ = 0.0
f90_ = 0.0

f88 = 0.0
f90_ := nz(f90_[1]) == 0 ? 1 : nz(f88[1]) <= nz(f90_[1]) ? nz(f88[1]) + 1 : nz(f90_[1]) + 1
f88 := nz(f90_[1]) == 0 and (length - 1 >= 5) ? length - 1 : 5

f0 = f88 >= f90_ and f8 != f10 ? 1 : 0
f90 = f88 == f90_ and f0 == 0 ? 0 : f90_

v4_ = f88 < f90 and v20 > 0 ? (v14 / v20 + 1) * 50 : 50
rsx = v4_ > 100 ? 100 : v4_ < 0 ? 0 : v4_

rsxColor = rsx > obLevel ? #0ebb23 : rsx < osLevel ? #ff0000 : #f4b77d
plot(rsx, title="RSX", linewidth=2, color=rsxColor, transp=0)

transparent = color(white, 100)

maxLevelPlot = hline(100, title="Max Level", linestyle=dotted, color=transparent)
obLevelPlot = hline(obLevel, title="Overbought Level", linestyle=dotted)
hline(50, title="Middle Level", linestyle=dotted)
osLevelPlot = hline(osLevel, title="Oversold Level", linestyle=dotted)
minLevelPlot = hline(0, title="Min Level", linestyle=dotted, color=transparent)

fill(obLevelPlot, osLevelPlot, color=purple, transp=95)

obFillColor = rsx > obLevel and highlightBreakouts ? green : transparent
osFillColor = rsx < osLevel and highlightBreakouts ? red : transparent

fill(maxLevelPlot, obLevelPlot, color=obFillColor, transp=90)
fill(minLevelPlot, osLevelPlot, color=osFillColor, transp=90)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/jurik_rsx.pine | File No: 110 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/kairi_relative_index.pine | File No: 111 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Kairi Relative Index script may be freely distributed under the terms of the GPL-3.0 license.
study("Kairi Relative Index", shorttitle="KRI")

length = input(title="Length", type=integer, minval=1, defval=14)
src = input(title="Source", type=source, defval=close)

kri = 100 * (src - sma(src, length)) / sma(src, length)

plot(kri, title="KRI", linewidth=1, color=#134f5c, transp=0)

hline(0, title="Zero Level", linestyle=dotted, color=#989898)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/kairi_relative_index.pine | File No: 111 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/laguerre_rsi_self_adjusting_alpha_with_fractals_energy.pine | File No: 112 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Laguerre RSI (Self Adjusting Alpha with Fractals Energy) script may be freely distributed under the terms of the GPL-3.0 license.
study("Laguerre RSI (Self Adjusting Alpha with Fractals Energy)", shorttitle="LRSI")

alpha = input(title="Alpha", type=float, minval=0, step=0.1, defval=0.7)
applyFractalEnergy = input(title="Apply Fractal Energy ?", type=bool, defval=true)
feLength = input(title="Fractals Energy Length", type=integer, minval=1, defval=13)
src = input(title="Source", type=source, defval=close)

OC = (open + nz(close[1])) / 2
HC = max(high, nz(close[1]))
LC = min(low, nz(close[1]))

feSrc = (OC + HC + LC + close) / 4

feAlpha = log(sum((max(high, nz(close[1])) - min(low, nz(close[1]))) / (highest(high, feLength) - lowest(low, feLength)), feLength)) / log(feLength)

L0 = 0.0
L1 = 0.0
L2 = 0.0
L3 = 0.0

lrsiAlpha = applyFractalEnergy ? feAlpha : alpha

L0 := lrsiAlpha * (applyFractalEnergy ? feSrc : src) + (1 - lrsiAlpha) * nz(L0[1])
L1 := -(1 - lrsiAlpha) * L0 + nz(L0[1]) + (1 - lrsiAlpha) * nz(L1[1])
L2 := -(1 - lrsiAlpha) * L1 + nz(L1[1]) + (1 - lrsiAlpha) * nz(L2[1])
L3 := -(1 - lrsiAlpha) * L2 + nz(L2[1]) + (1 - lrsiAlpha) * nz(L3[1])

CU = 0.0
CD = 0.0

CU := (L0 >= L1 ? L0 - L1 : 0) + (L1 >= L2 ? L1 - L2 : 0) + (L2 >= L3 ? L2 - L3 : 0)
CD := (L0 >= L1 ? 0 : L1 - L0) + (L1 >= L2 ? 0 : L2 - L1) + (L2 >= L3 ? 0 : L3 - L2)

lrsi = iff(CU + CD != 0, CU / (CU + CD), 0)

overboughtLevel = hline(0.8, title="Overbought Level", linestyle=dashed, color=#686868)
oversoldLevel = hline(0.2, title="Oversold Level", linestyle=dashed, color=#686868)

plot(lrsi, title="LRSI", linewidth=2, color=#ff3e7d, transp=0)
plot(applyFractalEnergy ? feAlpha : na, title="FE Alpha", linewidth=2, color=#674ea7, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/laguerre_rsi_self_adjusting_alpha_with_fractals_energy.pine | File No: 112 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/laguerre_rsi.pine | File No: 113 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Laguerre RSI script may be freely distributed under the terms of the GPL-3.0 license.
study("Laguerre RSI", shorttitle="LRSI")

alpha = input(title="Alpha", type=float, minval=0, step=0.1, defval=0.7)
src = input(title="Source", type=source, defval=close)

L0 = 0.0
L1 = 0.0
L2 = 0.0
L3 = 0.0

L0 := alpha * src + (1 - alpha) * nz(L0[1])
L1 := -(1 - alpha) * L0 + nz(L0[1]) + (1 - alpha) * nz(L1[1])
L2 := -(1 - alpha) * L1 + nz(L1[1]) + (1 - alpha) * nz(L2[1])
L3 := -(1 - alpha) * L2 + nz(L2[1]) + (1 - alpha) * nz(L3[1])

CU = 0.0
CD = 0.0

CU := (L0 >= L1 ? L0 - L1 : 0) + (L1 >= L2 ? L1 - L2 : 0) + (L2 >= L3 ? L2 - L3 : 0)
CD := (L0 >= L1 ? 0 : L1 - L0) + (L1 >= L2 ? 0 : L2 - L1) + (L2 >= L3 ? 0 : L3 - L2)

lrsi = iff(CU + CD != 0, CU / (CU + CD), 0)

overboughtLevel = hline(0.8, title="Overbought Level", linestyle=dashed, color=#686868)
oversoldLevel = hline(0.2, title="Oversold Level", linestyle=dashed, color=#686868)

plot(lrsi, title="LRSI", linewidth=2, color=#ff3e7d, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/laguerre_rsi.pine | File No: 113 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/mass_index.pine | File No: 114 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Mass Index script may be freely distributed under the terms of GPL-3.0 license.
study("Mass Index")

smoothLength = input(title="Smoothing Length", type=integer, defval=9)
sumLength = input(title="Summation Length", type=integer, defval=25)
breakout = input(title="Breakout Level", type=integer, defval=27)

mi = sum(ema(high - low, smoothLength) / ema(ema(high - low, smoothLength), smoothLength), sumLength)

miColor = mi > breakout - 0.5 ? #ff9800 : #3c78d8

plot(mi, title="Mass Index", linewidth=2, color=miColor, transp=0)

transparent = color(white, 100)

maxLevel = hline(29, title="Max Level", linestyle=dotted, color=transparent)
breakoutLevel = hline(breakout, title="Breakout Level", linestyle=dotted)
hline(breakout - 0.5, title="Confirmation Level", linestyle=dotted)

breakoutFillColor = mi > breakout ? #e06666 : transparent

fill(maxLevel, breakoutLevel, color=breakoutFillColor, transp=80)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/mass_index.pine | File No: 114 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/mfi_money_flow_index.pine | File No: 115 | Started --##
//@version=4
// Copyright (c) 2021-present, Alex Orekhov (everget)
// Money Flow Index script may be freely distributed under the terms of GPL-3.0 license.
study("Money Flow Index", shorttitle="MFI", precision=2)

length = input(title="Length", type=input.integer, defval=14, minval=1)
signalLength = input(title="Signal Length", type=input.integer, defval=9, minval=1)
src = input(title="Source", type=input.source, defval=hlc3)
obLevel = input(title="Overbought Level", type=input.integer, defval=80)
osLevel = input(title="Oversold Level", type=input.integer, defval=20)
maxLevel = input(title="Max Level", type=input.integer, defval=100)
minLevel = input(title="Min Level", type=input.integer, defval=0)
showHistogram = input(title="Show Histogram ?", type=input.bool, defval=false)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=input.bool, defval=true)
highlightCrossovers = input(title="Highlight MFI/Signal Crossovers ?", type=input.bool, defval=true)
highlightMiddleCrossovers = input(title="Highlight Middle Line Crossovers ?", type=input.bool, defval=true)
applyRibbonFilling = input(title="Apply Ribbon Filling ?", type=input.bool, defval=true)

mfi = mfi(src, length)
signal = ema(mfi, signalLength)

trendColor = mfi > signal ? #0ebb23 : color.red
smiColor = applyRibbonFilling ? trendColor : #ff3e7d
signalColor = applyRibbonFilling ? trendColor : #3c78d8

mfiPlot = plot(mfi, title="MFI", color=smiColor, transp=0)
signalPlot = plot(signal, title="Signal", color=signalColor, transp=0)

hist = mfi - signal
histColor = hist >= 0 ? hist[1] < hist ? #26A69A : #B2DFDB : hist[1] < hist ? #FFCDD2 : #EF5350
plot(showHistogram ? hist : na, title="Histogram", style=plot.style_columns, color=histColor, transp=0)

var color noneColor = color.new(color.white, 100)

maxLevelPlot = hline(maxLevel, title="Max Level", linestyle=hline.style_dotted, color=noneColor)
obLevelPlot = hline(obLevel, title="Overbought Level", linestyle=hline.style_dotted, color=#00796b)
hline(50, title="Middle Level", linestyle=hline.style_dotted, color=#989898)
osLevelPlot = hline(osLevel, title="Oversold Level", linestyle=hline.style_dotted, color=#f57f17)
minLevelPlot = hline(minLevel, title="Min Level", linestyle=hline.style_dotted, color=noneColor)
fill(obLevelPlot, osLevelPlot, title="Middle Zone", color=color.purple, transp=95)

obFillColor = mfi > obLevel and highlightBreakouts ? color.green : noneColor
osFillColor = mfi < osLevel and highlightBreakouts ? color.red : noneColor

fill(maxLevelPlot, obLevelPlot, title="Overbought Level Breakout", color=obFillColor, transp=85)
fill(minLevelPlot, osLevelPlot, title="Oversold Level Breakout", color=osFillColor, transp=85)

fillColor = applyRibbonFilling ? trendColor : noneColor
fill(mfiPlot, signalPlot, title="Ribbon", color=fillColor, transp=70)

middleCrossBgColor = highlightMiddleCrossovers ? mfi > 50 ? color.green : color.red : noneColor
bgcolor(middleCrossBgColor, title="Middle Line Crossover Background", transp=90)

plotshape(highlightCrossovers and crossover(mfi, signal) ? mfi : na, title="MFI/Signal Crossover", location=location.absolute, style=shape.circle, size=size.tiny, color=color.green, transp=0)
plotshape(highlightCrossovers and crossunder(mfi, signal) ? mfi : na, title="MFI/Signal Crossunder", location=location.absolute, style=shape.circle, size=size.tiny, color=color.red, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/mfi_money_flow_index.pine | File No: 115 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/normalized_relative_vigor_index.pine | File No: 116 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Normalized Relative Vigor Index script may be freely distributed under the terms of the GPL-3.0 license.
study("Normalized Relative Vigor Index", shorttitle="NRVGI")

length = input(title="Length", type=integer, defval=10, minval=1)
applyFilling = input(title="Apply Filling ?", type=bool, defval=false)

rvgi = sum(swma(close - open), length) / sum(swma(high - low), length)
signal = swma(rvgi)

rvgiPlot = plot(100 * rvgi, title="NRVGI", color=green, transp=0)
signalPlot = plot(100 * signal, title="Signal", color=red, transp=0)

fillColor = applyFilling ? (rvgi > signal ? #0ebb23 : #cc0000) : color(white, 100)
fill(rvgiPlot, signalPlot, color=fillColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/normalized_relative_vigor_index.pine | File No: 116 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/percentage_price_oscillator.pine | File No: 117 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Percentage Price Oscillator script may be freely distributed under the terms of the GPL-3.0 license.
study("Percentage Price Oscillator", shorttitle="PPO")

fastLength = input(title="Fast Length", type=integer, minval=1, defval=12)
slowLength = input(title="Slow Length", type=integer, minval=1, defval=26)
signalLength = input(title="Signal Length", type=integer, minval=1, defval=9)
applyFilling = input(title="Apply Filling ?", type=bool, defval=false)
src = input(title="Source", type=source, defval=close)

ppo = 100 * (ema(src, fastLength) - ema(src, slowLength)) / ema(src, slowLength)

signal = ema(ppo, signalLength)

hist = ppo - signal

plot(hist, title="Histogram", style=histogram, transp=0, color=#ff006e)
ppoPlot = plot(ppo, title="PPO", transp=0, color=#0094ff)
signalPlot = plot(signal, title="Signal", transp=0, color=#ff6a00)

fillColor = applyFilling ? (ppo > signal ? #0ebb23 : #cc0000) : color(white, 100)
fill(ppoPlot, signalPlot, color=fillColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/percentage_price_oscillator.pine | File No: 117 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/percentage_volume_oscillator.pine | File No: 118 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Percentage Volume Oscillator script may be freely distributed under the terms of GPL-3.0 license.
study("Percentage Volume Oscillator", shorttitle="PVO")

fastLength = input(title="Fast Length", type=integer, defval=12)
slowLength = input(title="Slow Length", type=integer, defval=26)
signalLength = input(title="Signal Length", type=integer, defval=9)
showHistogram = input(title="Show Histogram ?", type=bool, defval=true)
highlightCrossovers = input(title="Highlight PVO/Signal Crossovers ?", type=bool, defval=true)
highlightZeroCrossovers = input(title="Highlight Zero Line Crossovers ?", type=bool, defval=false)
applyFilling = input(title="Apply Ribbon Filling ?", type=bool, defval=false)

src = volume

pvo = 100 * (ema(src, fastLength) - ema(src, slowLength)) / ema(src, slowLength)
signal = ema(pvo, signalLength)

hist = pvo - signal
histColor = hist >= 0 ? (hist[1] < hist ? #26A69A : #B2DFDB) : (hist[1] < hist ? #FFCDD2 : #EF5350)

plot(showHistogram ? hist : na, title="Histogram", style=columns, color=histColor, transp=0)
hline(0, title="Zero Line", linestyle=dotted)

trendColor = pvo > signal ? #0ebb23 : red
pvoColor = applyFilling ? trendColor : #0094ff
signalColor = applyFilling ? trendColor : #ff6a00

pvoPlot = plot(pvo, title="PVO", color=pvoColor, transp=0)
signalPlot = plot(signal, title="Signal", color=signalColor, transp=0)

transparent = color(white, 100)

fillColor = applyFilling ? trendColor : transparent
fill(pvoPlot, signalPlot, color=fillColor, transp=70)

zeroCrossBgColor = highlightZeroCrossovers ? (pvo > 0 ? green : red) : transparent
bgcolor(zeroCrossBgColor, transp=90)

plotshape(highlightCrossovers and crossover(pvo, signal) ? pvo : na, title="Crossover", location=location.absolute, style=shape.circle, size=size.tiny, color=green, transp=0)
plotshape(highlightCrossovers and crossunder(pvo, signal) ? pvo : na, title="Crossunder", location=location.absolute, style=shape.circle, size=size.tiny, color=red, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/percentage_volume_oscillator.pine | File No: 118 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/phase_change_index.pine | File No: 119 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Phase Change Index script may be freely distributed under the terms of GPL-3.0 license.
study("Phase Change Index", shorttitle="PCI")

length = input(title="Length", type=integer, minval=1, defval=35)
upperLevel = input(title="Upper Level", type=integer, defval=80)
lowerLevel = input(title="Lower Level", type=integer, defval=20)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=bool, defval=true)
applySmoothing = input(title="Apply Smoothing ?", type=bool, defval=false)
smoothingType = input(title="Smoothing Type", defval="SMA", options=["EMA", "SMA", "VWMA", "WMA"])
smoothingLength = input(title="Smoothing Length", type=integer, minval=1, defval=3)
src = input(title="Source", type=source, defval=close)

getMA(src, length) =>
	ma = 0.0
	if smoothingType == "EMA"
		ma := ema(src, length)
	if smoothingType == "SMA"
		ma := sma(src, length)
	if smoothingType == "VWMA"
		ma := vwma(src, length)
	if smoothingType == "WMA"
		ma := wma(src, length)
	ma

mom = change(src, length)

positiveSum = 0.0
negativeSum = 0.0

for i = 0 to length - 1
	gradient = nz(src[length]) + mom * (length - i) / (length - 1)
	deviation = nz(src[length - i]) - gradient

	if deviation > 0
		positiveSum := positiveSum + deviation
	else
		negativeSum := negativeSum - deviation

sum = positiveSum + negativeSum
pci = sum != 0 ? 100 * positiveSum / sum : 0
pci := applySmoothing ? getMA(pci, smoothingLength) : pci

pciColor = pci > upperLevel ? #0ebb23 : pci < lowerLevel ? #ff0000 : #f4b77d
plot(pci, title="PCI", linewidth=2, color=pciColor, transp=0)

transparent = color(white, 100)

maxLevelPlot = hline(100, title="Max Level", linestyle=dotted, color=transparent)
upperLevelPlot = hline(upperLevel, title="Upper Level", linestyle=dotted)
hline(50, title="Middle Level", linestyle=dotted)
lowerLevelPlot = hline(lowerLevel, title="Lower Level", linestyle=dotted)
minLevelPlot = hline(0, title="Min Level", linestyle=dotted, color=transparent)

fill(upperLevelPlot, lowerLevelPlot, color=purple, transp=95)

upperFillColor = pci > upperLevel and highlightBreakouts ? green : transparent
lowerFillColor = pci < lowerLevel and highlightBreakouts ? red : transparent

fill(maxLevelPlot, upperLevelPlot, color=upperFillColor, transp=90)
fill(minLevelPlot, lowerLevelPlot, color=lowerFillColor, transp=90)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/phase_change_index.pine | File No: 119 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/pretty_good_oscillator.pine | File No: 120 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Pretty Good Oscillator script may be freely distributed under the terms of the GPL-3.0 license.
study("Pretty Good Oscillator", shorttitle="PGO")

length = input(title="Length", type=integer, defval=14, minval=1)
upperLevel = input(title="Upper Level", type=float, step=0.1, defval=2.0)
lowerLevel = input(title="Lower Level", type=float, step=0.1, defval=-2.0)
maxLevel = input(title="Max Level", type=float, step=0.1, defval=4.0)
minLevel = input(title="Min Level", type=float, step=0.1, defval=-4.0)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

pgo = (src - sma(src, length)) / atr(length)

pgoColor = pgo > upperLevel ? #0ebb23 : pgo < lowerLevel ? #ff0000 : #f4b77d
plot(pgo, title="PGO", linewidth=2, color=pgoColor, transp=0)

transparent = color(white, 100)

maxLevelPlot = hline(maxLevel, title="Max Level", linestyle=dotted, color=transparent)
upperLevelPlot = hline(upperLevel, title="Upper Level", linestyle=dotted)
hline(0, title="Zero Level", linestyle=dotted)
lowerLevelPlot = hline(lowerLevel, title="Lower Level", linestyle=dotted)
minLevelPlot = hline(minLevel, title="Min Level", linestyle=dotted, color=transparent)

fill(upperLevelPlot, lowerLevelPlot, color=purple, transp=95)

upperFillColor = pgo > upperLevel and highlightBreakouts ? green : transparent
lowerFillColor = pgo < lowerLevel and highlightBreakouts ? red : transparent

fill(maxLevelPlot, upperLevelPlot, color=upperFillColor, transp=90)
fill(minLevelPlot, lowerLevelPlot, color=lowerFillColor, transp=90)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/pretty_good_oscillator.pine | File No: 120 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/price_momentum_oscillator.pine | File No: 121 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Price Momentum Oscillator script may be freely distributed under the terms of the GPL-3.0 license.
study("Price Momentum Oscillator", shorttitle="PMO")

firstLength = input(title="1st Smoothing Length", type=integer, minval=1, defval=35)
secondLength = input(title="2nd Smoothing Length", type=integer, minval=1, defval=20)
signalLength = input(title="Signal Length", type=integer, minval=1, defval=10)
applyFilling = input(title="Apply Filling ?", type=bool, defval=false)
src = input(title="Source", type=source, defval=close)

rocMA = 0.0
rocMA := (nz(rocMA[1]) + (roc(src, 1) - nz(rocMA[1])) * (2 / firstLength))

pmo = 0.0
pmo := nz(pmo[1]) + (10 * rocMA - nz(pmo[1])) * (2 / secondLength)

pmoSignal = 0.0
pmoSignal := (2 / signalLength) * (pmo - nz(pmoSignal[1])) + nz(pmoSignal[1])

pmoPlot = plot(pmo, title="PMO", color=#1155cc, transp=0)
pmoSignalPlot = plot(pmoSignal, title="Signal", color=red, transp=0)

fillColor = applyFilling ? (pmo > pmoSignal ? #0ebb23 : #cc0000) : color(white, 100)
fill(pmoPlot, pmoSignalPlot, color=fillColor, transp=0)

hline(0, title="Zero Level", linestyle=dotted)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/price_momentum_oscillator.pine | File No: 121 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/pring_special_k.pine | File No: 122 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Pring Special K script may be freely distributed under the terms of the GPL-3.0 license.
study("Pring Special K", shorttitle="PSK")

src = input(title="Source", type=source, defval=close)

psk = sma(roc(src, 10), 10) +
	sma(roc(src, 10), 15) * 2 +
	sma(roc(src, 10), 20) * 3 +
	sma(roc(src, 15), 30) * 4 +
	sma(roc(src, 50), 40) +
	sma(roc(src, 65), 65) * 2 +
	sma(roc(src, 75), 75) * 3 +
	sma(roc(src, 100), 100) * 4 +
	sma(roc(src, 130), 195) +
	sma(roc(src, 130), 265) * 2 +
	sma(roc(src, 130), 390) * 3 +
	sma(roc(src, 195), 530) * 4

pskColor = psk >= 0.0 ? #0ebb23 : #ff0000

plot(psk, title="PSK", linewidth=2, color=pskColor, transp=0)

hline(0, title="Zero Level", linestyle=dotted)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/pring_special_k.pine | File No: 122 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/rainbow_oscillator.pine | File No: 123 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Rainbow Oscillator script may be freely distributed under the terms of GPL-3.0 license.
study("Rainbow Oscillator", shorttitle="ROSC")

maLength = input(title="Moving Average Length", type=integer, minval=1, defval=2)
maInput = input(title="Moving Average Type", defval="SMA", options=["EMA", "SMA", "VWMA", "WMA"])
highestLookback = input(title="Highest Price Lookback", type=integer, minval=1, defval=10)
lowestLookback = input(title="Lowest Price Lookback", type=integer, minval=1, defval=10)
drawBg = input(title="Draw Backgrounds ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

getMA(src, maLength) =>
    ma = 0.0

	if maInput == "EMA"
        ma := ema(src, maLength)

	if maInput == "SMA"
        ma := sma(src, maLength)

	if maInput == "VWMA"
        ma := vwma(src, maLength)

	if maInput == "WMA"
        ma := wma(src, maLength)
    ma

ma1 = getMA(src, maLength)
ma2 = getMA(ma1, maLength)
ma3 = getMA(ma2, maLength)
ma4 = getMA(ma3, maLength)
ma5 = getMA(ma4, maLength)
ma6 = getMA(ma5, maLength)
ma7 = getMA(ma6, maLength)
ma8 = getMA(ma7, maLength)
ma9 = getMA(ma8, maLength)
ma10 = getMA(ma9, maLength)

maMax = max(ma1,
     max(ma2,
     max(ma3,
     max(ma4,
     max(ma5,
     max(ma6,
     max(ma7,
     max(ma8,
     max(ma9,
     ma10)))))))))

maMin = min(ma1,
     min(ma2,
     min(ma3,
     min(ma4,
     min(ma5,
     min(ma6,
     min(ma7,
     min(ma8,
     min(ma9,
     ma10)))))))))

hlDiff = highest(src, highestLookback) - lowest(src, lowestLookback)
average = (ma1 + ma2 + ma3 + ma4 + ma5 + ma6 + ma7 + ma8 + ma9 + ma10) / 10

rosc = hlDiff != 0
         ? 100 * (src - average) / hlDiff
         : 0

band = hlDiff != 0
         ? 100 * (maMax - maMin) / hlDiff
         : 0

roscColor = rosc > 0 ? green : red

roscPlot = plot(rosc, title="ROSC", style=histogram, linewidth=3, color=roscColor, transp=0)

upperBandColor = drawBg ? gray : green
upperBandPlot = plot(band, title="Upper", color=upperBandColor)

middlePlot = plot(0, title="Middle", color=gray)

lowerBandColor = drawBg ? gray : red
lowerBandPlot = plot(-1 * band, title="Lower", color=lowerBandColor)

transparentColor = color(white, 100)
upperFillColor = drawBg ? green : transparentColor
lowerFillColor = drawBg ? red : transparentColor

fill(middlePlot, upperBandPlot, color=upperFillColor)
fill(middlePlot, lowerBandPlot, color=lowerFillColor)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/rainbow_oscillator.pine | File No: 123 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/random_walk_index.pine | File No: 124 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Random Walk Index script may be freely distributed under the terms of the GPL-3.0 license.
study("Random Walk Index", shorttitle="RWI")

length = input(title="Length", type=integer, minval=1, defval=14)

rwiHigh = (high - nz(low[length])) / (atr(length) * sqrt(length))
rwiLow = (nz(high[length]) - low) / (atr(length) * sqrt(length))

plot(rwiHigh, title="High", linewidth=2, color=#6d1e7f, transp=0)
plot(rwiLow, title="Low", linewidth=2, color=#ff3737, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/random_walk_index.pine | File No: 124 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/range_action_verification_index.pine | File No: 125 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Range Action Verification Index (RAVI) script may be freely distributed under the terms of the GPL-3.0 license.
study("Range Action Verification Index (RAVI)", shorttitle="RAVI")

fastLength = input(title="Fast MA Length", type=integer, minval=1, defval=7)
fastMAInput = input(title="Fast MA", defval="SMA", options=["EMA", "SMA", "VWMA", "WMA"])
slowLength = input(title="Slow MA Length", type=integer, minval=1, defval=65)
slowMAInput = input(title="Slow MA", defval="SMA", options=["EMA", "SMA", "VWMA", "WMA"])
comparisonLookback = input(title="Comparison Lookback", type=integer, minval=1, defval=1)
src = input(title="Source", type=source, defval=close)

fastMA = iff(fastMAInput == "EMA", ema(src, fastLength),
	 iff(fastMAInput == "SMA", sma(src, fastLength),
	 iff(fastMAInput == "VWMA", vwma(src, fastLength),
	 iff(fastMAInput == "WMA", wma(src, fastLength),
	 na))))

slowMA = iff(slowMAInput == "EMA", ema(src, slowLength),
	 iff(slowMAInput == "SMA", sma(src, slowLength),
	 iff(slowMAInput == "VWMA", vwma(src, slowLength),
	 iff(slowMAInput == "WMA", wma(src, slowLength),
	 na))))

ravi = abs(100 * (fastMA - slowMA) / slowMA)

raviColor = ravi > nz(ravi[comparisonLookback]) ? green : red

plot(ravi, title="RAVI", linewidth=2, color=raviColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/range_action_verification_index.pine | File No: 125 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/rapid_rsi.pine | File No: 126 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Rapid RSI script may be freely distributed under the terms of the GPL-3.0 license.
study("Rapid RSI", shorttitle="RRSI")

length = input(title="Length", type=integer, minval=1, defval=14)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

upSum = sum(max(change(src), 0), length)
downSum = sum(max(-change(src), 0), length)

rrsi = downSum == 0 ? 100 : upSum == 0 ? 0 : 100 - (100 / (1 + upSum / downSum))

obLevel = 70
osLevel = 30

rrsiColor = rrsi > obLevel ? #0ebb23 : rrsi < osLevel ? #ff0000 : #f4b77d
plot(rrsi, title="RRSI", linewidth=2, color=rrsiColor, transp=0)

transparent = color(white, 100)

maxLevelPlot = hline(100, title="Max Level", linestyle=dotted, color=transparent)
obLevelPlot = hline(obLevel, title="Overbought Level", linestyle=dotted)
hline(50, title="Middle Level", linestyle=dotted)
osLevelPlot = hline(osLevel, title="Oversold Level", linestyle=dotted)
minLevelPlot = hline(0, title="Min Level", linestyle=dotted, color=transparent)

fill(obLevelPlot, osLevelPlot, color=purple, transp=95)

obFillColor = rrsi > obLevel and highlightBreakouts ? green : transparent
osFillColor = rrsi < osLevel and highlightBreakouts ? red : transparent

fill(maxLevelPlot, obLevelPlot, color=obFillColor, transp=90)
fill(minLevelPlot, osLevelPlot, color=osFillColor, transp=90)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/rapid_rsi.pine | File No: 126 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/recursive_median_oscillator.pine | File No: 127 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Recursive Median Oscillator script may be freely distributed under the terms of the GPL-3.0 license.
study("Recursive Median Oscillator", shorttitle="RMO")

medianLength = input(title="Length", type=integer, minval=1, defval=5)
lowpassLength = input(title="Lowpass Length", type=integer, minval=1, defval=12)
highpassLength = input(title="Highpass Length", type=integer, minval=1, defval=30)
src = input(title="Source", type=source, defval=close)

median(src, length) =>
	percentile_nearest_rank(src, length, 50)

PI = 2 * asin(1)

alpha1Arg = 2 * PI / lowpassLength
alpha1 = (cos(alpha1Arg) + sin(alpha1Arg) - 1) / cos(alpha1Arg)

rm = 0.0
rm := alpha1 * median(src, medianLength) + (1 - alpha1) * nz(rm[1])

alpha2Arg = 1 / sqrt(2) * 2 * PI / highpassLength
alpha2 = (cos(alpha2Arg) + sin(alpha2Arg) - 1) / cos(alpha2Arg)

rmo = 0.0
rmo := pow(1 - alpha2 / 2, 2) * (rm - 2 * nz(rm[1]) + nz(rm[2])) + 2 * (1 - alpha2) * nz(rmo[1]) - pow(1 - alpha2, 2) * nz(rmo[2])

rmoColor = rmo >= 0.0 ? #0ebb23 : #ff0000

plot(rmo, title="RMO", linewidth=2, color=rmoColor, transp=0)

hline(0, title="Zero Level", linestyle=dashed, color=#3c78d8)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/recursive_median_oscillator.pine | File No: 127 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/regression_oscillator.pine | File No: 128 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Regression Oscillator script may be freely distributed under the terms of the GPL-3.0 license.
study("Regression Oscillator", shorttitle="ROSC")

length = input(title="Length", type=integer, minval=1, defval=63)
linregOffset = input(title="Linear Regression Offset", type=integer, defval=0)
src = input(title="Source", type=source, defval=close)

rosc = 100 * (src / linreg(src, length, linregOffset) - 1)

roscColor = rosc >= 0.0 ? #0ebb23 : #ff0000

plot(rosc, title="ROSC", linewidth=2, color=roscColor, transp=0)

hline(0, title="Zero Level", linestyle=dotted, color=#989898)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/regression_oscillator.pine | File No: 128 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/relative_momentum_index.pine | File No: 129 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Relative Momentum Index script may be freely distributed under the terms of the GPL-3.0 license.
study("Relative Momentum Index", shorttitle="RMI")

length = input(title="Length", type=integer, minval=1, defval=14)
momentumLength = input(title="Momentum Length", type=integer, minval=1, defval=3)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

up = rma(max(change(src, momentumLength), 0), length)
down = rma(-min(change(src, momentumLength), 0), length)

rmi = down == 0 ? 100 : up == 0 ? 0 : 100 - (100 / (1 + up / down))

obLevel = 70
osLevel = 30

rmiColor = rmi > obLevel ? #0ebb23 : rmi < osLevel ? #ff0000 : #f4b77d
plot(rmi, title="RMI", linewidth=2, color=rmiColor, transp=0)

transparent = color(white, 100)

maxLevelPlot = hline(100, title="Max Level", linestyle=dotted, color=transparent)
obLevelPlot = hline(obLevel, title="Overbought Level", linestyle=dotted)
hline(50, title="Middle Level", linestyle=dotted)
osLevelPlot = hline(osLevel, title="Oversold Level", linestyle=dotted)
minLevelPlot = hline(0, title="Min Level", linestyle=dotted, color=transparent)

fill(obLevelPlot, osLevelPlot, color=purple, transp=95)

obFillColor = rmi > obLevel and highlightBreakouts ? green : transparent
osFillColor = rmi < osLevel and highlightBreakouts ? red : transparent

fill(maxLevelPlot, obLevelPlot, color=obFillColor, transp=90)
fill(minLevelPlot, osLevelPlot, color=osFillColor, transp=90)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/relative_momentum_index.pine | File No: 129 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/relative_spread_strength.pine | File No: 130 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Relative Spread Strength script may be freely distributed under the terms of the GPL-3.0 license.
study("Relative Spread Strength", shorttitle="RSS")

rsiLength = input(title="RSI Length", type=integer, defval=14, minval=1)
fastLength = input(title="Fast MA Length", type=integer, defval=10, minval=1)
slowLength = input(title="Slow MA Length", type=integer, defval=40, minval=1)
smoothingLength = input(title="Smoothing Length", type=integer, defval=5, minval=1)
smoothingType = input(title="Smoothing Type", defval="EMA", options=["EMA", "SMA"])
highLevel = input(title="High Level", type=integer, defval=80, maxval=100)
lowLevel = input(title="Low Level", type=integer, defval=20, minval=0)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

spread = smoothingType == "EMA" ? ema(src, fastLength) - ema(src, slowLength) : sma(src, fastLength) - sma(src, slowLength)

rs = rsi(spread, rsiLength)
rss = sma(rs, smoothingLength)

rssColor = rss > highLevel ? #0ebb23 : rss < lowLevel ? #ff0000 : #f4b77d
plot(rss, title="RSS", linewidth=2, color=rssColor, transp=0)

transparent = color(white, 100)

maxLevelPlot = hline(100, title="Max Level", linestyle=dotted, color=transparent)
highLevelPlot = hline(highLevel, title="High Level", linestyle=dotted)
hline(50, title="Middle Level", linestyle=dotted)
lowLevelPlot = hline(lowLevel, title="Low Level", linestyle=dotted)
minLevelPlot = hline(0, title="Min Level", linestyle=dotted, color=transparent)

fill(highLevelPlot, lowLevelPlot, color=purple, transp=95)

highFillColor = rss > highLevel and highlightBreakouts ? green : transparent
lowFillColor = rss < lowLevel and highlightBreakouts ? red : transparent

fill(maxLevelPlot, highLevelPlot, color=highFillColor, transp=90)
fill(minLevelPlot, lowLevelPlot, color=lowFillColor, transp=90)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/relative_spread_strength.pine | File No: 130 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/relative_volatility_index.pine | File No: 131 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Relative Volatility Index script may be freely distributed under the terms of the GPL-3.0 license.
study("Relative Volatility Index", shorttitle="RVI")

stdevLength = input(title="Standard Deviation Length", type=integer, minval=1, defval=10)
stdevType = input(title="Standard Deviation Type", defval="Population", options=["Population", "Sample"])
smoothLength = input(title="Smoothing Length", type=integer, minval=1, defval=14)
obLevel = input(title="Overbought Level", type=integer, defval=60)
osLevel = input(title="Oversold Level", type=integer, defval=40)
useRefined = input(title="Use Refined Version of RVI ?", type=bool, defval=true)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

sampleStdev(src, length) =>
	dev = src - sma(src, length)
	variance = sum(pow(dev, 2), length) / (length - 1)
	sqrt(variance)

selectedStdev = stdevType == "Population"
	 ? stdev(src, stdevLength)
	 : sampleStdev(src, stdevLength)

// Original version (1993)
rviOriginal(src) =>
	upSum = ema(change(src) >= 0 ? selectedStdev : 0, smoothLength)
	downSum = ema(change(src) >= 0 ? 0 : selectedStdev, smoothLength)
	100 * upSum / (upSum + downSum)

// Refined version (1995)
rvi = useRefined
	 ? avg(rviOriginal(high), rviOriginal(low))
	 : rviOriginal(src)

rviColor = rvi > obLevel ? #0ebb23 : rvi < osLevel ? #ff0000 : #f4b77d
plot(rvi, title="RVI", linewidth=2, color=rviColor, transp=0)

transparent = color(white, 100)

maxLevelPlot = hline(100, title="Max Level", linestyle=dotted, color=transparent)
obLevelPlot = hline(obLevel, title="Overbought Level", linestyle=dotted)
hline(50, title="Middle Level", linestyle=dotted)
osLevelPlot = hline(osLevel, title="Oversold Level", linestyle=dotted)
minLevelPlot = hline(0, title="Min Level", linestyle=dotted, color=transparent)

fill(obLevelPlot, osLevelPlot, color=purple, transp=95)

obFillColor = rvi > obLevel and highlightBreakouts ? green : transparent
osFillColor = rvi < osLevel and highlightBreakouts ? red : transparent

fill(maxLevelPlot, obLevelPlot, color=obFillColor, transp=90)
fill(minLevelPlot, osLevelPlot, color=osFillColor, transp=90)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/relative_volatility_index.pine | File No: 131 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/repulse.pine | File No: 132 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Repulse script may be freely distributed under the terms of GPL-3.0 license.
study("Repulse")

length = input(title="Length", type=integer, minval=1, defval=5)

bullPower = 100 * (3 * close - 2 * lowest(length) - open[length - 1]) / close

bearPower = 100 * (open[length - 1] + 2 * highest(length) - 3 * close) / close

repulse = ema(bullPower, 5 * length) - ema(bearPower, 5 * length)

repulseColor = repulse >= repulse[1] ? #0ebb23 : red
plot(repulse, title="Repulse", linewidth=2, color=repulseColor, transp=0)

hline(0, title="Zero Level", linestyle=dotted)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/repulse.pine | File No: 132 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/rocket_rsi.pine | File No: 133 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Rocket RSI script may be freely distributed under the terms of the GPL-3.0 license.
study("Rocket RSI", shorttitle="Rocket RSI")

rsiLength = input(title="RSI Length", type=integer, minval=1, defval=10)
smoothingLength = input(title="Smoothing Length", type=integer, minval=1, defval=8)
obosLevel = input(title="Overbought / Oversold Level", type=float, minval=0.0, defval=2.0)
applyNormalization = input(title="Apply Normalization to [-100, 100] values ?", type=bool, defval=false)
src = input(title="Source", type=source, defval=close)

PI = 2 * asin(1)

a1 = 0.0
b1 = 0.0
c1 = 0.0
c2 = 0.0
c3 = 0.0

// Compute Super Smoother coefficients
a1 := exp(-1.414 * PI / smoothingLength)
b1 := 2 * a1 * cos(1.414 * 180 / smoothingLength)
c2 := b1
c3 := -a1 * a1
c1 := 1 - c2 - c3

// Create half dominant cycle momentum
mom = change(src, rsiLength - 1)

// Super Smoother Filter
ssf = 0.0
ssf := c1 * (mom + nz(mom[1])) / 2 + c2 * nz(ssf[1]) + c3 * nz(ssf[2])

// Accumulate `Closes Up` and `Closes Down`
upSum = sum(change(ssf, 1) > 0 ? change(ssf, 1) : 0.0, rsiLength)
downSum = sum(change(ssf, 1) > 0 ? 0.0 : abs(change(ssf, 1)), rsiLength)

tmpRSI = 0.0
tmpRSI := upSum + downSum != 0 ? (upSum - downSum) / (upSum + downSum) : nz(tmpRSI[1])

// Limit RocketRSI output to +/-3 Standard Deviations
if tmpRSI > 0.999
	tmpRSI := 0.999

if tmpRSI < -0.999
	tmpRSI := -0.999

// Apply Fisher Transform to establish Gaussian Probability Distribution
rocketRSI = 0.5 * log((1 + tmpRSI) / (1 - tmpRSI))
rocketRSI := applyNormalization ? rocketRSI * 25 : rocketRSI

overboughtLevel = applyNormalization ? obosLevel * 25 : obosLevel
oversoldLevel = applyNormalization ? obosLevel * -25 : obosLevel * -1

rocketRSIColor = rocketRSI > overboughtLevel ? green : rocketRSI < oversoldLevel ? red : #ff9370

plot(rocketRSI, title="RRSI", linewidth=2, color=rocketRSIColor, transp=0)

plot(overboughtLevel, title="OB Level", style=circles, color=#3d85c6, transp=0)
hline(0, title="Zero Level", linestyle=dotted)
plot(oversoldLevel, title="OS Level", style=circles, color=#3d85c6, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/rocket_rsi.pine | File No: 133 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/rsi_relative_strength_index.pine | File No: 134 | Started --##
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Relative Strength Index (RSI) script may be freely distributed under the terms of GPL-3.0 license.
study(title="Relative Strength Index", shorttitle="RSI")

length = input(title="Length", type=integer, defval=14)
obLevel = input(title="Overbought Level", type=integer, defval=70)
osLevel = input(title="Oversold Level", type=integer, defval=30)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=bool, defval=true)
srcInput = input(title="Source", defval="close",
	 options=["open",
				 "high",
				 "low",
				 "close",
				 "oo2",
				 "oh2",
				 "ol2",
				 "oc2",
				 "hh2",
				 "hl2",
				 "hc2",
				 "ll2",
				 "lc2",
				 "cc2",
				 "hlc3",
				 "ohlc4",
				 "wc",
				 "acc/dist",
				 "on balance volume",
				 "price volume trend"])

getBaseSource(input) =>
	src = 0.0
	if input == "open"
		src := open
	if input == "high"
		src := high
	if input == "low"
		src := low
	if input == "close"
		src := close
	if input == "oo2"
		src := (open + nz(open[1])) / 2
	if input == "oh2"
		src := (open + high) / 2
	if input == "ol2"
		src := (open + low) / 2
	if input == "oc2"
		src := (open + close) / 2
	if input == "hh2"
		src := (high + nz(high[1])) / 2
	if input == "hl2" // Median Price
		src := hl2
	if input == "hc2"
		src := (high + close) / 2
	if input == "ll2"
		src := (low + nz(low[1])) / 2
	if input == "lc2"
		src := (low + close) / 2
	if input == "cc2"
		src := (close + nz(close[1])) / 2
	if input == "hlc3" // Typical Price
		src := hlc3
	if input == "ohlc4"
		src := ohlc4
	if input == "wc" // Weighted Close
		src := (2 * close + high + low) / 4
	if input == "acc/dist"
		src := accdist
	if input == "on balance volume"
		src := cum(sign(change(close)) * volume)
	if input == "price volume trend"
		src := cum(change(close) / close[1] * volume)
	src

src = getBaseSource(srcInput)

rsi = rsi(src, length)

rsiColor = rsi > obLevel ? #0ebb23 : rsi < osLevel ? red : #f4b77d
plot(rsi, title="RSI", linewidth=2, color=rsiColor, transp=0)

transparent = color(white, 100)

maxLevelPlot = hline(100, title="Max Level", linestyle=dotted, color=transparent)
obLevelPlot = hline(obLevel, title="Overbought Level", linestyle=dotted)
hline(50, title="Middle Level", linestyle=dotted)
osLevelPlot = hline(osLevel, title="Oversold Level", linestyle=dotted)
minLevelPlot = hline(0, title="Min Level", linestyle=dotted, color=transparent)
fill(obLevelPlot, osLevelPlot, color=purple, transp=95)

obFillColor = rsi > obLevel and highlightBreakouts ? green : transparent
osFillColor = rsi < osLevel and highlightBreakouts ? red : transparent

fill(maxLevelPlot, obLevelPlot, color=obFillColor, transp=90)
fill(minLevelPlot, osLevelPlot, color=osFillColor, transp=90)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/rsi_relative_strength_index.pine | File No: 134 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/rsx.pine | File No: 135 | Started --##
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Jurik RSX script may be freely distributed under the terms of the GPL-3.0 license.
study("Jurik RSX", shorttitle="RSX")

length = input(title="Length", type=integer, defval=14)
src = input(title="Source", type=source, defval=hlc3)
obLevel = input(title="OB Level", type=integer, defval=70)
osLevel = input(title="OS Level", type=integer, defval=30)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=bool, defval=true)

f8 = 100 * src
f10 = nz(f8[1])
v8 = f8 - f10

f18 = 3 / (length + 2)
f20 = 1 - f18

f28 = 0.0
f28 := f20 * nz(f28[1]) + f18 * v8

f30 = 0.0
f30 := f18 * f28 + f20 * nz(f30[1])
vC = f28 * 1.5 - f30 * 0.5

f38 = 0.0
f38 := f20 * nz(f38[1]) + f18 * vC

f40 = 0.0
f40 := f18 * f38 + f20 * nz(f40[1])
v10 = f38 * 1.5 - f40 * 0.5

f48 = 0.0
f48 := f20 * nz(f48[1]) + f18 * v10

f50 = 0.0
f50 := f18 * f48 + f20 * nz(f50[1])
v14 = f48 * 1.5 - f50 * 0.5

f58 = 0.0
f58 := f20 * nz(f58[1]) + f18 * abs(v8)

f60 = 0.0
f60 := f18 * f58 + f20 * nz(f60[1])
v18 = f58 * 1.5 - f60 * 0.5

f68 = 0.0
f68 := f20 * nz(f68[1]) + f18 * v18

f70 = 0.0
f70 := f18 * f68 + f20 * nz(f70[1])
v1C = f68 * 1.5 - f70 * 0.5

f78 = 0.0
f78 := f20 * nz(f78[1]) + f18 * v1C

f80 = 0.0
f80 := f18 * f78 + f20 * nz(f80[1])
v20 = f78 * 1.5 - f80 * 0.5

f88_ = 0.0
f90_ = 0.0

f88 = 0.0
f90_ := nz(f90_[1]) == 0 ? 1 : nz(f88[1]) <= nz(f90_[1]) ? nz(f88[1]) + 1 : nz(f90_[1]) + 1
f88 := nz(f90_[1]) == 0 and (length - 1 >= 5) ? length - 1 : 5

f0 = f88 >= f90_ and f8 != f10 ? 1 : 0
f90 = f88 == f90_ and f0 == 0 ? 0 : f90_

v4_ = f88 < f90 and v20 > 0 ? (v14 / v20 + 1) * 50 : 50
rsx = v4_ > 100 ? 100 : v4_ < 0 ? 0 : v4_

rsxColor = rsx > obLevel ? #0ebb23 : rsx < osLevel ? #ff0000 : #f4b77d
plot(rsx, title="RSX", linewidth=2, color=rsxColor, transp=0)

transparent = color(white, 100)

maxLevelPlot = hline(100, title="Max Level", linestyle=dotted, color=transparent)
obLevelPlot = hline(obLevel, title="Overbought Level", linestyle=dotted)
hline(50, title="Middle Level", linestyle=dotted)
osLevelPlot = hline(osLevel, title="Oversold Level", linestyle=dotted)
minLevelPlot = hline(0, title="Min Level", linestyle=dotted, color=transparent)

fill(obLevelPlot, osLevelPlot, color=purple, transp=95)

obFillColor = rsx > obLevel and highlightBreakouts ? green : transparent
osFillColor = rsx < osLevel and highlightBreakouts ? red : transparent

fill(maxLevelPlot, obLevelPlot, color=obFillColor, transp=90)
fill(minLevelPlot, osLevelPlot, color=osFillColor, transp=90)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/rsx.pine | File No: 135 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/self_adjusting_rsi.pine | File No: 136 | Started --##
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Self-Adjusting RSI script may be freely distributed under the terms of GPL-3.0 license.
study("Self-Adjusting RSI", shorttitle="SARSI")

rsiLength = input(title="RSI Length", type=integer, defval=14, minval=1)
adjusting = input(title="Method of Adjusting OB/OS Levels", defval="Standard Deviation", options=["Standard Deviation", "SMA"])
mult = input(title="Adjustment Multiplier", type=float, defval=2, step=0.1)
smoothingType = input(title="Smoothing Type", defval="SMA", options=["EMA", "SMA"])
smoothingLength = input(title="Smoothing Length", type=integer, defval=21, minval=1)
highlightMovements = input(title="Highlight Smoothing ?", type=bool, defval=false)
src = input(title="Source", type=source, defval=close)

rsi = rsi(src, rsiLength)

_adjusting() =>
    adjusting == "Standard Deviation" ? mult * stdev(rsi, rsiLength) :
     adjusting == "SMA" ? mult * sma(abs(rsi - sma(rsi, rsiLength)), rsiLength) :
     na

adjust = _adjusting()
obLevel = 50 + adjust
osLevel = 50 - adjust

hline(50, title="Middle Level", linestyle=dotted)
transparent = color(white, 100)

rsiColor = rsi > obLevel ? #0ebb23 : rsi < osLevel ? red : #f4b77d
rsiPlot = plot(rsi, title="SARSI", linewidth=1, color=rsiColor, transp=0)

smooth = smoothingType == "EMA" ? ema(rsi, smoothingLength) : sma(rsi, smoothingLength)
smoothColor = highlightMovements ? (smooth > smooth[1] ? #0ebb23 : red) : #6d1e7f
plot(smooth, title="Smooth", linewidth=1, color=smoothColor, transp=0)

obosColor = #f1bc05 //#7b1fa2
obLevelPlot = plot(obLevel, title="OB", color=obosColor, transp=100)
osLevelPlot = plot(osLevel, title="OS", color=obosColor, transp=100)
fill(obLevelPlot, osLevelPlot, title="OB/OS Filling", color=#f1bc05, transp=80)

obFillColor = rsi > obLevel ? green : transparent
fill(rsiPlot, obLevelPlot, title="SARSI/OB Filling", color=obFillColor, transp=85)

osFillColor = rsi < osLevel ? red : transparent
fill(rsiPlot, osLevelPlot, title="SARSI/OS Filling", color=osFillColor, transp=85)

co = crossover(rsi, obLevel)
cu = crossunder(rsi, osLevel)

alertcondition(co, title="Alert on SARSI Overbought", message="SARSI Overbought!")
alertcondition(cu, title="Alert on SARSI Oversold", message="SARSI Oversold!")

##-- File Name: tradingview-pinescript-indicators-master/oscillators/self_adjusting_rsi.pine | File No: 136 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/smoothed_rate_of_change.pine | File No: 137 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Smoothed Rate of Change script may be freely distributed under the terms of the GPL-3.0 license.
study("Smoothed Rate of Change", shorttitle="S-RoC")

rocLength = input(title="ROC Length", type=integer, minval=1, defval=21)
smoothingLength = input(title="Smoothing Length", type=integer, minval=1, defval=13)
src = input(title="Source", type=source, defval=close)

ma = ema(src, smoothingLength)

sroc = nz(ma[rocLength]) == 0
	 ? 100
	 : ma - nz(ma[rocLength]) == 0
	 	 ? 0
	 	 : 100 * (ma - nz(ma[rocLength])) / ma[rocLength]

srocColor = sroc >= 0.0 ? #0ebb23 : #ff0000

plot(sroc, title="S-RoC", linewidth=2, color=srocColor, transp=0)

hline(0, title="Zero Level", linestyle=dotted, color=#989898)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/smoothed_rate_of_change.pine | File No: 137 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/stc_schaff_trend_cycle.pine | File No: 138 | Started --##
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Schaff Trend Cycle script may be freely distributed under the terms of GPL-3.0 license.
study("Schaff Trend Cycle", shorttitle="STC")

fastLength = input(title="MACD Fast Length", type=input.integer, defval=23)
slowLength = input(title="MACD Slow Length", type=input.integer, defval=50)
cycleLength = input(title="Cycle Length", type=input.integer, defval=10)
d1Length = input(title="1st %D Length", type=input.integer, defval=3)
d2Length = input(title="2nd %D Length", type=input.integer, defval=3)
src = input(title="Source", type=input.source, defval=close)
upper = input(title="Upper Band", type=input.integer, defval=75)
lower = input(title="Lower Band", type=input.integer, defval=25)
highlightBreakouts = input(title="Highlight Breakouts ?", type=input.bool, defval=true)

macd = ema(src, fastLength) - ema(src, slowLength)
k = nz(fixnan(stoch(macd, macd, macd, cycleLength)))
d = ema(k, d1Length)
kd = nz(fixnan(stoch(d, d, d, cycleLength)))
stc = ema(kd, d2Length)
stc := max(min(stc, 100), 0)

stcColor1 = stc > stc[1] ? color.green : color.red
stcColor2 = stc > upper ? color.green : stc <= lower ? color.red : color.orange

stcColor = highlightBreakouts ? stcColor2 : stcColor1
stcPlot = plot(stc, title="STC", color=stcColor, transp=0)

upperLevel = plot(upper, title="Upper", color=color.gray)
hline(50, title="Middle", linestyle=hline.style_dotted)
lowerLevel = plot(lower, title="Lower", color=color.gray)

fill(upperLevel, lowerLevel, title="Middle Zone", color=#f9cb9c, transp=90)

upperFillColor = stc > upper and highlightBreakouts ? color.green : na
lowerFillColor = stc < lower and highlightBreakouts ? color.red : na

fill(upperLevel, stcPlot, color=upperFillColor, transp=80)
fill(lowerLevel, stcPlot, color=lowerFillColor, transp=80)

buySignal = crossover(stc, lower)
sellSignal = crossunder(stc, upper)
upperCrossover = crossover(stc, upper)
upperCrossunder = crossunder(stc, upper)
lowerCrossover = crossover(stc, lower)
lowerCrossunder = crossunder(stc, lower)

plotshape(upperCrossunder ? upper : na, title="Sell Signal", location=location.absolute, style=shape.circle, size=size.tiny, color=color.red, transp=0)
plotshape(lowerCrossover ? lower : na, title="Buy Signal", location=location.absolute, style=shape.circle, size=size.tiny, color=color.green, transp=0)

alertcondition(buySignal, title="Alert: Buy", message="STC: Buy!\nSymbol: {{exchange}}:{{ticker}}\nPrice: {{close}}")
alertcondition(sellSignal, title="Alert: Sell", message="STC: Sell!\nSymbol: {{exchange}}:{{ticker}}\nPrice: {{close}}")
alertcondition(upperCrossover, title="Alert: Upper Band Crossover", message="STC: Upper Band Crossover!\nSymbol: {{exchange}}:{{ticker}}\nPrice: {{close}}")
alertcondition(upperCrossunder, title="Alert: Upper Band Crossunder", message="STC: Upper Band Crossunder!\nSymbol: {{exchange}}:{{ticker}}\nPrice: {{close}}")
alertcondition(lowerCrossover, title="Alert: Lower Band Crossover", message="STC: Lower Band Crossover!\nSymbol: {{exchange}}:{{ticker}}\nPrice: {{close}}")
alertcondition(lowerCrossunder, title="Alert: Lower Band Crossunder", message="STC: Lower Band Crossunder!\nSymbol: {{exchange}}:{{ticker}}\nPrice: {{close}}")

##-- File Name: tradingview-pinescript-indicators-master/oscillators/stc_schaff_trend_cycle.pine | File No: 138 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/stiffness_indicator.pine | File No: 139 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Stiffness Indicator script may be freely distributed under the terms of GPL-3.0 license.
study("Stiffness Indicator", shorttitle="Stiffness")

maLength = input(title="Moving Average Length", minval=1, defval=100)
stiffLength = input(title="Stiffness Length", minval=1, defval=60)
stiffSmooth = input(title="Stiffness Smoothing Length", minval=1, defval=3)
threshold = input(title="Threshold", minval=1, defval=90)
highlightThresholdCrossovers = input(title="Highlight Threshold Crossovers ?", type=bool, defval=false)

bound = sma(close, maLength) - 0.2 * stdev(close, maLength)
sumAbove = sum(close > bound ? 1 : 0, stiffLength)
stiffness = ema(sumAbove * 100 / stiffLength, stiffSmooth)

transparent = color(white, 100)

bgColor = highlightThresholdCrossovers ? (stiffness > threshold ? #0ebb23 : red) : transparent
bgcolor(bgColor, transp=90)

plot(stiffness, title="Stiffness", style=histogram, color=#f5c75e, transp=0)
plot(threshold, title="Threshold", color=red, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/stiffness_indicator.pine | File No: 139 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/stochastic_connors_rsi.pine | File No: 140 | Started --##
//@version=3
// Copyright (c) 2017-present, Alex Orekhov (everget)
// Stochastic Connors RSI indicator script may be freely distributed under the terms of GPL-3.0 license.
study(title="Stochastic Connors RSI", shorttitle="Stoch CRSI")

stochLength = input(title="Stochastic Length", type=integer, defval=3, minval=1)
smoothK = input(title="K", type=integer, defval=3, minval=1, maxval=10000)
smoothD = input(title="D", type=integer, defval=3, minval=1, maxval=10000)

rsiLength = input(title="RSI Length", type=integer, defval=3, minval=1)
updownLength = input(title="Updown RSI Length", type=integer, defval=2, minval=1)
rocLength = input(title="ROC Length", type=integer, defval=100, minval=1)
src = input(title="RSI Source", type=source, defval=close)

updown = 0
updown_calc(s, ud) =>
    newupdown = 0
    if s > s[1]
        newupdown := nz(ud[1]) >= 0 ? nz(ud[1]) + 1 : 1
    else
        if s < s[1]
            newupdown := nz(ud[1]) <= 0 ? nz(ud[1]) - 1 : -1
        else
            newupdown := 0

updown := updown_calc(src, updown)

updownrsi = rsi(updown, updownLength)

rsi = rsi(src, rsiLength)

percentrank = percentrank(roc(src, 1), rocLength)

crsi = avg(rsi, updownrsi, percentrank)

stochcalc = stoch(crsi, crsi, crsi, stochLength)

band1 = hline(80, color=gray, linestyle=dashed)
band2 = hline(20, color=gray, linestyle=dashed)
fill(band1, band2, color=#f9cb9c0f)

band3 = hline(70, color=gray, linestyle=dashed)
band4 = hline(30, color=gray, linestyle=dashed)
fill(band3, band4, color=#de9ba6)

smaK = sma(stochcalc, smoothK)
smaD = sma(smaK, smoothD)

plot(smaK, title="K", color=#0094ff)
plot(smaD, title="D", color=#ff6a00)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/stochastic_connors_rsi.pine | File No: 140 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/stochastic_momentum_index.pine | File No: 141 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Stochastic Momentum Index script may be freely distributed under the terms of the GPL-3.0 license.
study("Stochastic Momentum Index", shorttitle="SMI")

q = input(title="Length (Stochastic Lookback)", type=integer, minval=1, defval=13)
r = input(title="First Smoothing Length", type=integer, minval=1, defval=25)
s = input(title="Second Smoothing Length", type=integer, minval=1, defval=2)
signalLength = input(title="Signal Length", type=integer, minval=1, defval=12)
overboughtLevel = input(title="Overbought Level", type=integer, defval=40)
oversoldLevel = input(title="Oversold Level", type=integer, defval=-40)
applyFilling = input(title="Apply Filling ?", type=bool, defval=false)
src = input(title="Source", type=source, defval=close)

hhq = highest(high, q)
llq = lowest(low, q)

numerator = ema(ema(src - 0.5 * (hhq + llq), r), s)

denominator = 0.5 * ema(ema(hhq - llq, r), s)

smi = 100 * numerator / denominator

signal = ema(smi, signalLength)

smiPlot = plot(smi, title="SMI", color=#ff3e7d, transp=0)
signalPlot = plot(signal, title="Signal", color=#3c78d8, transp=0)

overbought = hline(title="Overbought Level", price=overboughtLevel, linestyle=dotted, color=#e69138)
hline(title="Zero Level", price=0, linestyle=dashed, color=#989898)
oversold = hline(title="Oversold Level", price=oversoldLevel, linestyle=dotted, color=#e69138)

fillColor = applyFilling ? (smi > signal ? #0ebb23 : #cc0000) : color(white, 100)
fill(smiPlot, signalPlot, color=fillColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/stochastic_momentum_index.pine | File No: 141 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/stochastic.pine | File No: 142 | Started --##
//@version=4
// Copyright (c) 2021-present, Alex Orekhov (everget)
// Stochastic script may be freely distributed under the terms of GPL-3.0 license.
study("Stochastic", shorttitle="Stoch", precision=2)

periodK = input(title="K", minval=1, defval=14)
periodD = input(title="D", minval=1, defval=3)
smoothK = input(title="Smooth", minval=1, defval=3)
src = input(title="Source", type=input.source, defval=close)

obLevel = input(title="Overbought Level", type=input.integer, defval=80)
osLevel = input(title="Oversold Level", type=input.integer, defval=20)
maxLevel = input(title="Max Level", type=input.integer, defval=100)
minLevel = input(title="Min Level", type=input.integer, defval=0)
showHistogram = input(title="Show Histogram ?", type=input.bool, defval=false)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=input.bool, defval=true)
highlightCrossovers = input(title="Highlight K/D Crossovers ?", type=input.bool, defval=true)
highlightMiddleCrossovers = input(title="Highlight Middle Line Crossovers ?", type=input.bool, defval=true)
applyRibbonFilling = input(title="Apply Ribbon Filling ?", type=input.bool, defval=true)

k = sma(stoch(src, high, low, periodK), smoothK)
d = sma(k, periodD)

trendColor = k > d ? #0ebb23 : color.red
kColor = applyRibbonFilling ? trendColor : #ff3e7d
dColor = applyRibbonFilling? trendColor : #3c78d8

kPlot = plot(k, title="%K", color=kColor, transp=0)
dPlot = plot(d, title="%D", color=dColor, transp=0)

hist = k - d
histColor = hist >= 0 ? hist[1] < hist ? #26A69A : #B2DFDB : hist[1] < hist ? #FFCDD2 : #EF5350
plot(showHistogram ? hist : na, title="Histogram", style=plot.style_columns, color=histColor, transp=0)

var color noneColor = color.new(color.white, 100)

maxLevelPlot = hline(maxLevel, title="Max Level", linestyle=hline.style_dotted, color=noneColor)
obLevelPlot = hline(obLevel, title="Overbought Level", linestyle=hline.style_dotted, color=#00796b)
hline(50, title="Middle Level", linestyle=hline.style_dotted, color=#989898)
osLevelPlot = hline(osLevel, title="Oversold Level", linestyle=hline.style_dotted, color=#f57f17)
minLevelPlot = hline(minLevel, title="Min Level", linestyle=hline.style_dotted, color=noneColor)
fill(obLevelPlot, osLevelPlot, title="Middle Zone", color=color.purple, transp=95)

obFillColor = k > obLevel and highlightBreakouts ? color.green : na
osFillColor = k < osLevel and highlightBreakouts ? color.red : na

fill(maxLevelPlot, obLevelPlot, title="Upper Band Breakout", color=obFillColor, transp=85)
fill(minLevelPlot, osLevelPlot, title="Lower Band Breakout", color=osFillColor, transp=85)

fillColor = applyRibbonFilling ? trendColor : na
fill(kPlot, dPlot, title="Ribbon", color=fillColor, transp=70)

middleCrossBgColor = highlightMiddleCrossovers ? (k > 50 ? color.green : color.red) : na
bgcolor(middleCrossBgColor, transp=90)

plotshape(highlightCrossovers and crossover(k, d) ? k : na, title="K/D Crossover", location=location.absolute, style=shape.circle, size=size.tiny, color=color.green, transp=0)
plotshape(highlightCrossovers and crossunder(k, d) ? k : na, title="K/D Crossunder", location=location.absolute, style=shape.circle, size=size.tiny, color=color.red, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/stochastic.pine | File No: 142 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/tick_line_momentum_oscillator.pine | File No: 143 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Tick Line Momentum Oscillator script may be freely distributed under the terms of the GPL-3.0 license.
study("Tick Line Momentum Oscillator", shorttitle="TLMO")

cumoMALength = input(title="Cumo MA Length", type=integer, minval=1, defval=10)
cumoMAInput = input(title="Cumo MA", defval="EMA", options=["EMA", "SMA", "VWMA", "WMA"])
rocLength = input(title="ROC Length", type=integer, minval=1, defval=5)
smoothingLength = input(title="Smoothing Length", type=integer, minval=1, defval=5)
smoothingMAInput = input(title="Smoothing MA", defval="EMA", options=["EMA", "SMA", "VWMA", "WMA"])
obosLevel = input(title="Overbought / Oversold Level", type=integer, minval=1, defval=5)
src = input(title="Source", type=source, defval=close)

cumoMA = iff(cumoMAInput == "EMA", ema(src, cumoMALength),
	 iff(cumoMAInput == "SMA", sma(src, cumoMALength),
	 iff(cumoMAInput == "VWMA", vwma(src, cumoMALength),
	 iff(cumoMAInput == "WMA", wma(src, cumoMALength),
	 na))))

cumoExpression = src > nz(cumoMA[1])
	 ? 1
	 : src < nz(cumoMA[1])
	 	 ? -1
	 	 : 0

tlmo = iff(smoothingMAInput == "EMA", ema(roc(cum(cumoExpression), rocLength), smoothingLength),
	 iff(smoothingMAInput == "SMA", sma(roc(cum(cumoExpression), rocLength), smoothingLength),
	 iff(smoothingMAInput == "VWMA", vwma(roc(cum(cumoExpression), rocLength), smoothingLength),
	 iff(smoothingMAInput == "WMA", wma(roc(cum(cumoExpression), rocLength), smoothingLength),
	 na))))

tlmoColor = tlmo > obosLevel ? #0ebb23 : tlmo < -obosLevel ? #ff0000 : #674ea7
plot(tlmo, title="TLMO", linewidth=2, color=tlmoColor, transp=0)

hline(obosLevel, title="Overbought", linestyle=dotted, color=#0ebb23)
hline(0, title="Zero Level", linestyle=solid, color=#f6b26b)
hline(-1 * obosLevel, title="Oversold", linestyle=dotted, color=#ff0000)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/tick_line_momentum_oscillator.pine | File No: 143 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/total_power_indicator.pine | File No: 144 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Total Power Indicator script may be freely distributed under the terms of GPL-3.0 license.
study("Total Power Indicator", shorttitle="TPI")

length = input(title="Length", type=integer, defval=45)
powersLength = input(title="Elder Powers Length", type=integer, defval=10)
adjustableLevel = input(title="Adjustable Entry Level", type=integer, defval=75)
applyFilling = input(title="Apply Powers Filling ?", type=bool, defval=false)

elderBullPower = high - ema(close, powersLength)
elderBearPower = low - ema(close, powersLength)

adjust(value) => 100 * value / length

bullCount = sum(elderBullPower > 0 ? 1 : 0, length)
bearCount = sum(elderBearPower < 0 ? 1 : 0, length)
total = adjust(abs(bullCount - bearCount))
bull = adjust(bullCount)
bear = adjust(bearCount)

bullPlot = plot(bull, title="Bull", linewidth=2, color=#0ebb23, transp=0)
bearPlot = plot(bear, title="Bear", linewidth=2, color=red, transp=0)
plot(total, title="Total", linewidth=2, color=#3c78d8, transp=0)

fillColor = applyFilling ? (bull > bear ? #0ebb23 : red) : color(white, 100) 
fill(bullPlot, bearPlot, color=fillColor, transp=80)

hline(adjustableLevel, title="Adjustable Entry Level", linestyle=dotted)
hline(50, title="Middle Level", linestyle=dotted, color=#f49517)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/total_power_indicator.pine | File No: 144 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/trend_continuation_factor.pine | File No: 145 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Trend Continuation Factor script may be freely distributed under the terms of the GPL-3.0 license.
study("Trend Continuation Factor", shorttitle="TCF")

length = input(title="Length", type=integer, minval=1, defval=35)
src = input(title="Source", type=source, defval=close)

plusChange(src) => change(src) > 0 ? change(src) : 0.0
minusChange(src) => change(src) > 0 ? 0.0 : -change(src)

plusCF = 0.0
plusCF := plusChange(src) == 0 ? 0.0 : plusChange(src) + nz(plusCF[1])

minusCF = 0.0
minusCF := minusChange(src) == 0 ? 0.0 : minusChange(src) + nz(minusCF[1])

plusTCF = sum(plusChange(src) - minusCF, length)
minusTCF = sum(minusChange(src) - plusCF, length)

plot(plusTCF, title="+TCF", linewidth=2, color=#38761d, transp=0)
plot(minusTCF, title="-TCF", linewidth=2, color=#cc4125, transp=0)

hline(0, title="Zero Level", linestyle=line, color=#e69138)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/trend_continuation_factor.pine | File No: 145 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/trend_detection_index.pine | File No: 146 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Trend Detection Index script may be freely distributed under the terms of the GPL-3.0 license.
study("Trend Detection Index", shorttitle="TDI")

length = input(title="Length", type=integer, minval=1, defval=20)
src = input(title="Source", type=source, defval=close)

momentum = change(src, length)

tdi = abs(sum(momentum, length)) - (sum(abs(momentum), length * 2) - sum(abs(momentum), length))

// Direction Indicator
direction = sum(momentum, length)

plot(tdi, title="TDI", color=#ff0000, transp=0)
plot(direction, title="Direction", color=#0ebb23, transp=0)

hline(0, title="Zero Level", linestyle=dotted)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/trend_detection_index.pine | File No: 146 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/trend_intensity_index.pine | File No: 147 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Trend Intensity Index script may be freely distributed under the terms of the GPL-3.0 license.
study("Trend Intensity Index", shorttitle="TII")

majorLength = input(title="Major Length", type=integer, defval=60)
minorLength = input(title="Minor Length", type=integer, defval=30)
upperLevel = input(title="Upper Level", type=integer, defval=80)
lowerLevel = input(title="Lower Level", type=integer, defval=20)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

sma = sma(src, majorLength)

positiveSum = 0.0
negativeSum = 0.0

for i = 0 to minorLength - 1
    price = nz(src[i])
    avg = nz(sma[i])
    positiveSum := positiveSum + (price > avg ? price - avg : 0)
    negativeSum := negativeSum + (price > avg ? 0 : avg - price)

tii = 100 * positiveSum / (positiveSum + negativeSum)

tiiColor = tii > upperLevel ? #0ebb23 : tii < lowerLevel ? #ff0000 : #f4b77d
plot(tii, title="TII", linewidth=2, color=tiiColor, transp=0)

transparent = color(white, 100)

maxLevelPlot = hline(100, title="Max Level", linestyle=dotted, color=transparent)
upperLevelPlot = hline(upperLevel, title="Upper Level", linestyle=dotted)
hline(50, title="Middle Level", linestyle=dotted)
lowerLevelPlot = hline(lowerLevel, title="Lower Level", linestyle=dotted)
minLevelPlot = hline(0, title="Min Level", linestyle=dotted, color=transparent)

fill(upperLevelPlot, lowerLevelPlot, color=purple, transp=95)

upperFillColor = tii > upperLevel and highlightBreakouts ? green : transparent
lowerFillColor = tii < lowerLevel and highlightBreakouts ? red : transparent

fill(maxLevelPlot, upperLevelPlot, color=upperFillColor, transp=90)
fill(minLevelPlot, lowerLevelPlot, color=lowerFillColor, transp=90)


##-- File Name: tradingview-pinescript-indicators-master/oscillators/trend_intensity_index.pine | File No: 147 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/trend_trigger_factor.pine | File No: 148 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Trend Trigger Factor script may be freely distributed under the terms of the GPL-3.0 license.
study("Trend Trigger Factor", shorttitle="TTF")

length = input(title="Lookback Length", type=integer, defval=15)
upperLevel = input(title="Upper Trigger Level", type=integer, defval=100, minval=1)
lowerLevel = input(title="Lower Trigger Level", type=integer, defval=-100, maxval=-1)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

hh = highest(length)
ll = lowest(length)

buyPower = hh - nz(ll[length])
sellPower = nz(hh[length]) - ll

ttf = 200 * (buyPower - sellPower) / (buyPower + sellPower)

ttfColor = ttf > upperLevel ? #0ebb23 : ttf < lowerLevel ? #ff0000 : #f4b77d
plot(ttf, title="TTF", linewidth=2, color=ttfColor, transp=0)

transparent = color(white, 100)

maxLevelPlot = hline(200, title="Max Level", linestyle=dotted, color=transparent)
upperLevelPlot = hline(upperLevel, title="Upper Trigger Level", linestyle=dotted)
hline(0, title="Zero Level", linestyle=dotted)
lowerLevelPlot = hline(lowerLevel, title="Lower Trigger Level", linestyle=dotted)
minLevelPlot = hline(-200, title="Min Level", linestyle=dotted, color=transparent)

fill(upperLevelPlot, lowerLevelPlot, color=purple, transp=95)

upperFillColor = ttf > upperLevel and highlightBreakouts ? green : transparent
lowerFillColor = ttf < lowerLevel and highlightBreakouts ? red : transparent

fill(maxLevelPlot, upperLevelPlot, color=upperFillColor, transp=90)
fill(minLevelPlot, lowerLevelPlot, color=lowerFillColor, transp=90)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/trend_trigger_factor.pine | File No: 148 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/trendscore.pine | File No: 149 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Trendscore script may be freely distributed under the terms of the GPL-3.0 license.
study("Trendscore", shorttitle="Trendscore")

fromIndex = input(title="From", type=integer, minval=1, defval=11)
toIndex = input(title="To", type=integer, minval=1, defval=20)
src = input(title="Source", type=source, defval=close)

trendscore(src, fromIndex, toIndex) =>
	sum = 0.0

	for i = fromIndex to toIndex
		sum := src >= nz(src[i]) ? sum + 1 : sum - 1
	sum

plot(trendscore(src, fromIndex, toIndex), title="Trendscore", linewidth=2, color=#e69138, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/trendscore.pine | File No: 149 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/trix.pine | File No: 150 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// TRIX script may be freely distributed under the terms of GPL-3.0 license.
study("TRIX")

length = input(title="Length", type=integer, defval=14)
mult = input(title="TRIX Value Multiplier", type=integer, defval=1)
signalType = input(title="Signal Smoothing Type", defval="SMA", options=["EMA", "SMA"])
signalLength = input(title="Signal Smoothing Length", type=integer, defval=9)
src = input(title="Source", type=source, defval=close)
showSignal = input(title="Show Signal Line ?", type=bool, defval=true)
showHistogram = input(title="Show Histogram ?", type=bool, defval=false)
highlightCrossovers = input(title="Highlight TRIX/Signal Crossovers ?", type=bool, defval=true)
highlightZeroCrossovers = input(title="Highlight Zero Line Crossovers ?", type=bool, defval=false)
applyFilling = input(title="Apply Ribbon Filling ?", type=bool, defval=false)

triple = ema(ema(ema(src, length), length), length)

trix = mult * roc(triple, 1)
signal = signalType == "SMA" ? sma(trix, signalLength) : ema(trix, signalLength)

hist = trix - signal
histColor = hist >= 0 ? (hist[1] < hist ? #26A69A : #B2DFDB) : (hist[1] < hist ? #FFCDD2 : #EF5350)
plot(showHistogram ? hist : na, title="Histogram", style=columns, color=histColor, transp=0)
hline(0, title="Zero Level", linestyle=dotted)

trendColor = trix > signal ? #0ebb23 : red

trixColor = applyFilling ? trendColor : (trix > 0 ? #0ebb23 : red)
signalColor = applyFilling ? trendColor : #ff9800

trixPlot = plot(trix, title="TRIX", linewidth=2, color=trixColor, transp=0)
signalPlot = plot(showSignal ? signal : na, title="Signal", color=signalColor, transp=0)

transparent = color(white, 100)

fillColor = applyFilling ? trendColor : transparent
fill(trixPlot, signalPlot, color=fillColor, transp=70)

zeroCrossBgColor = highlightZeroCrossovers ? (trix > 0 ? green : red) : transparent
bgcolor(zeroCrossBgColor, transp=90)

plotshape(highlightCrossovers and crossover(trix, signal) ? trix : na, title="Crossover", location=location.absolute, style=shape.circle, size=size.tiny, color=green, transp=0)
plotshape(highlightCrossovers and crossunder(trix, signal) ? trix : na, title="Crossunder", location=location.absolute, style=shape.circle, size=size.tiny, color=red, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/trix.pine | File No: 150 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/true_range_double.pine | File No: 151 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// True Range Double script may be freely distributed under the terms of the GPL-3.0 license.
study("True Range Double", shorttitle="TRD")

trd = max(max(high, high[1]), close[2]) - min(min(low, low[1]), close[2])

plot(trd, title="TRD", linewidth=1, color=#741b47, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/true_range_double.pine | File No: 151 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/tsi_true_strength_index.pine | File No: 152 | Started --##
//@version=4
// Copyright (c) 2021-present, Alex Orekhov (everget)
// True Strength Index (TSI) script may be freely distributed under the terms of GPL-3.0 license.
study("True Strength Index", shorttitle="TSI")

longLength = input(title="Long Length", type=input.integer, defval=25)
shortLength = input(title="Short Length", type=input.integer, defval=13)
signalLength = input(title="Signal Length", type=input.integer, defval=13, minval=1)
src = input(title="Source", type=input.source, defval=close)

obLevel = input(title="Overbought Level", type=input.integer, defval=40)
osLevel = input(title="Oversold Level", type=input.integer, defval=-40)
maxLevel = input(title="Max Level", type=input.integer, defval=75)
minLevel = input(title="Min Level", type=input.integer, defval=-75)
showHistogram = input(title="Show Histogram ?", type=input.bool, defval=false)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=input.bool, defval=true)
highlightCrossovers = input(title="Highlight TSI/Signal Crossovers ?", type=input.bool, defval=true)
highlightZeroCrossovers = input(title="Highlight Zero Line Crossovers ?", type=input.bool, defval=true)
applyRibbonFilling = input(title="Apply Ribbon Filling ?", type=input.bool, defval=true)

mom = change(src)
numerator = ema(ema(mom, longLength), shortLength)
denominator = ema(ema(abs(mom), longLength), shortLength)
tsi = 100 * numerator / denominator
signal = ema(tsi, signalLength)

trendColor = tsi > signal ? #0ebb23 : color.red
tsiColor = applyRibbonFilling ? trendColor : #ff3e7d
signalColor = applyRibbonFilling ? trendColor : #3c78d8

tsiPlot = plot(tsi, title="TSI", color=tsiColor, transp=0)
signalPlot = plot(signal, title="Signal", color=signalColor, transp=0)

hist = tsi - signal
histColor = hist >= 0 ? hist[1] < hist ? #26A69A : #B2DFDB : hist[1] < hist ? #FFCDD2 : #EF5350
plot(showHistogram ? hist : na, title="Histogram", style=plot.style_columns, color=histColor, transp=0)

var color noneColor = color.new(color.white, 100)

maxLevelPlot = hline(maxLevel, title="Max Level", linestyle=hline.style_dotted, color=noneColor)
obLevelPlot = hline(obLevel, title="Overbought Level", linestyle=hline.style_dotted, color=#00796b)
hline(0, title="Zero Level", linestyle=hline.style_dotted, color=#989898)
osLevelPlot = hline(osLevel, title="Oversold Level", linestyle=hline.style_dotted, color=#f57f17)
minLevelPlot = hline(minLevel, title="Min Level", linestyle=hline.style_dotted, color=noneColor)
fill(obLevelPlot, osLevelPlot, title="Middle Zone", color=color.purple, transp=95)

obFillColor = tsi > obLevel and highlightBreakouts ? color.green : noneColor
osFillColor = tsi < osLevel and highlightBreakouts ? color.red : noneColor

fill(maxLevelPlot, obLevelPlot, title="Overbought Level Breakout", color=obFillColor, transp=85)
fill(minLevelPlot, osLevelPlot, title="Oversold Level Breakout", color=osFillColor, transp=85)

fillColor = applyRibbonFilling ? trendColor : noneColor
fill(tsiPlot, signalPlot, title="Ribbon", color=fillColor, transp=70)

zeroCrossBgColor = highlightZeroCrossovers ? (tsi > 0 ? color.green : color.red) : noneColor
bgcolor(zeroCrossBgColor, title="Zero Line Crossover Background", transp=90)

plotshape(highlightCrossovers and crossover(tsi, signal) ? tsi : na, title="TSI/Signal Crossover", location=location.absolute, style=shape.circle, size=size.tiny, color=color.green, transp=0)
plotshape(highlightCrossovers and crossunder(tsi, signal) ? tsi : na, title="TSI/Signal Crossunder", location=location.absolute, style=shape.circle, size=size.tiny, color=color.red, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/tsi_true_strength_index.pine | File No: 152 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/v_macd.pine | File No: 153 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// V-MACD script may be freely distributed under the terms of GPL-3.0 license.
study("V-MACD")

fastLength = input(title="Fast Length", type=integer, defval=12)
slowLength = input(title="Slow Length", type=integer, defval=26)
signalLength = input(title="Signal Length", type=integer, defval=9)
showHistogram = input(title="Show Histogram ?", type=bool, defval=true)
highlightCrossovers = input(title="Highlight V-MACD/Signal Crossovers ?", type=bool, defval=false)
highlightZeroCrossovers = input(title="Highlight Zero Line Crossovers ?", type=bool, defval=false)
applyFilling = input(title="Apply Ribbon Filling ?", type=bool, defval=false)

[vmacd, signal, hist] = macd(volume, fastLength, slowLength, signalLength)

histColor = hist >= 0 ? (hist[1] < hist ? #26A69A : #B2DFDB) : (hist[1] < hist ? #FFCDD2 : #EF5350)

plot(showHistogram ? hist : na, title="Histogram", style=columns, color=histColor, transp=0)
hline(0, title="Zero Line", linestyle=dotted)

trendColor = vmacd > signal ? #0ebb23 : red

vmacdColor = applyFilling ? trendColor : #0094ff
signalColor = applyFilling ? trendColor : #ff6a00

vmacdPlot = plot(vmacd, title="V-MACD", color=vmacdColor, transp=0)
signalPlot = plot(signal, title="Signal", color=signalColor, transp=0)

transparent = color(white, 100)

fillColor = applyFilling ? trendColor : transparent
fill(vmacdPlot, signalPlot, color=fillColor, transp=70)

zeroCrossBgColor = highlightZeroCrossovers ? (vmacd > 0 ? green : red) : transparent
bgcolor(zeroCrossBgColor, transp=90)

plotshape(highlightCrossovers and crossover(vmacd, signal) ? vmacd : na, title="Crossover", location=location.absolute, style=shape.circle, size=size.tiny, color=green, transp=0)
plotshape(highlightCrossovers and crossunder(vmacd, signal) ? vmacd : na, title="Crossunder", location=location.absolute, style=shape.circle, size=size.tiny, color=red, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/v_macd.pine | File No: 153 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/vertical_horizontal_filter.pine | File No: 154 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Vertical Horizontal Filter script may be freely distributed under the terms of the GPL-3.0 license.
study("Vertical Horizontal Filter", shorttitle="VHF")

length = input(title="Length", type=integer, minval=1, defval=28)
src = input(title="Source", type=source, defval=close)

vhf = abs(highest(src, length) - lowest(src, length)) / sum(abs(change(src)), length)

plot(vhf, title="VHF", color=#674ea7, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/vertical_horizontal_filter.pine | File No: 154 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/oscillators/vw_macd.pine | File No: 155 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// VW-MACD script may be freely distributed under the terms of GPL-3.0 license.
study("VW-MACD")

fastLength = input(title="Fast Length", type=integer, defval=12)
slowLength = input(title="Slow Length", type=integer, defval=26)
signalLength = input(title="Signal Length", type=integer, defval=9)
showHistogram = input(title="Show Histogram ?", type=bool, defval=true)
highlightCrossovers = input(title="Highlight VW-MACD/Signal Crossovers ?", type=bool, defval=false)
highlightZeroCrossovers = input(title="Highlight Zero Line Crossovers ?", type=bool, defval=false)
applyFilling = input(title="Apply Ribbon Filling ?", type=bool, defval=false)

vwmacd = vwma(close, fastLength) - vwma(close, slowLength)
signal = ema(vwmacd, signalLength)
hist = vwmacd - signal

histColor = hist >= 0 ? (hist[1] < hist ? #26A69A : #B2DFDB) : (hist[1] < hist ? #FFCDD2 : #EF5350)

plot(showHistogram ? hist : na, title="Histogram", style=columns, color=histColor, transp=0)
hline(0, title="Zero Line", linestyle=dotted)

trendColor = vwmacd > signal ? #0ebb23 : red

vwmacdColor = applyFilling ? trendColor : #0094ff
signalColor = applyFilling ? trendColor : #ff6a00

vwmacdPlot = plot(vwmacd, title="VW-MACD", color=vwmacdColor, transp=0)
signalPlot = plot(signal, title="Signal", color=signalColor, transp=0)

transparent = color(white, 100)

fillColor = applyFilling ? trendColor : transparent
fill(vwmacdPlot, signalPlot, color=fillColor, transp=70)

zeroCrossBgColor = highlightZeroCrossovers ? (vwmacd > 0 ? green : red) : transparent
bgcolor(zeroCrossBgColor, transp=90)

plotshape(highlightCrossovers and crossover(vwmacd, signal) ? vwmacd : na, title="Crossover", location=location.absolute, style=shape.circle, size=size.tiny, color=green, transp=0)
plotshape(highlightCrossovers and crossunder(vwmacd, signal) ? vwmacd : na, title="Crossunder", location=location.absolute, style=shape.circle, size=size.tiny, color=red, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/oscillators/vw_macd.pine | File No: 155 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/research/chart_type_identifier.pine | File No: 156 | Started --##
//@version=4
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Chart Type Identifier script may be freely distributed under the terms of the GPL-3.0 license.
study("Chart Type Identifier", overlay=true)

max = max(open, close)
min = min(open, close)
body = abs(close - open)

var int horizCount = -1
if open[1] == close or close[1] == open
    horizCount := horizCount + 1

var int gapsCount = -1
if low[1] > high or high[1] < low
    gapsCount := gapsCount + 1

var int noWicksCount = -1
if max == high and min == low
    noWicksCount := noWicksCount + 1

//------------------------------------------------------------------------------

_isHA() =>
    var int oc2Count = -1
    oc2Count := open == (open[1] + close[1]) / 2 ? oc2Count + 1 : oc2Count
    out = oc2Count == bar_index - 1 and oc2Count != -1 and gapsCount == -1
    out

isHA = _isHA()

_isRenko() =>
    bodySum = cum(body)
    avg = bodySum / (bar_index + 1)
    out = avg == body and gapsCount == -1
    out

isRenko = _isRenko()

_isKagi() =>
    out = noWicksCount == bar_index and horizCount == bar_index - 1 and gapsCount == -1
    out

isKagi = _isKagi()

_isPnF() =>
    var int sum = 0
    sum := close > close[1] ? sum + 1 : close < close[1] ? sum - 1 : sum
    out = (sum == 1 or sum == 0 or sum == -1) and horizCount < bar_index - 1
    out

isPnF = _isPnF()

_isLineBreak() =>
    out = noWicksCount == bar_index and horizCount < bar_index - 1 and gapsCount == -1
    out

isLineBreak = not isPnF and _isLineBreak()

monthData = security(syminfo.tickerid, "M", close)
weekData = security(syminfo.tickerid, "W", close)
dayData = security(syminfo.tickerid, "D", close)
hourData = security(syminfo.tickerid, "60", close)
minuteData = security(syminfo.tickerid, "1", close)

_isRangeBars() =>
    out =
         timeframe.period != "S" and
         minuteData == monthData and
         minuteData == weekData and
         minuteData == dayData and
         minuteData == hourData and
         minuteData == close
    out

isRangeBars = _isRangeBars()

isClassic =
     not isHA and
     not isRenko and
     not isKagi and
     not isPnF and
     not isLineBreak and
     not isRangeBars

labelText =
     bar_index < 2 ? "\nNot enough bars to identify Chart Type\n" :
     isHA ? "\nThis is Heikin-Ashi Chart\n" :
     isRenko ? "\nThis is Renko Chart\n" :
     isKagi ? "\nThis is Kagi Chart\n" :
     isRangeBars ? "\nThis is Range Bars Chart\n" :
     isPnF ? "\nThis is P&F Chart\n" :
     isLineBreak ? "\nThis is Line Break Chart\n" :
     isClassic ? "\nThis is Classic Chart\n" :
     "\nUnknown Chart Type\n"

labelColor = #1e90ff
whiteColor = color.white

var label l = label.new(
     x=bar_index,
     y=na,
     text="",
     color=labelColor,
     textcolor=whiteColor,
     style=label.style_labeldown,
     size=size.normal
     )

_highest(length) =>
    out = high
    for i = 1 to length - 1
        prev = nz(high[i])
        out := out < prev ? prev : out
    out

lookback = min(bar_index + 2, 50)
yPos = _highest(lookback)

// debug =
//      "\nBar Index: " + tostring(int(bar_index)) +
//      "\nGaps: " + tostring(gapsCount) +
//      "\nHoriz: " + tostring(horizCount) +
//      "\nNo Wicks: " + tostring(noWicksCount)

label.set_text(l, labelText) // + debug
label.set_xy(l, bar_index, yPos)

##-- File Name: tradingview-pinescript-indicators-master/research/chart_type_identifier.pine | File No: 156 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/research/custom_median_vs_built_in_median.pine | File No: 157 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Custom Median vs Built-in Median script may be freely distributed under the terms of GPL-3.0 license.
study("Custom Median vs Built-in Median", shorttitle="CMvsBM")

length = input(title="Length", type=integer, minval=1, defval=14)
src = input(title="Source", type=source, defval=close)

// Built-in Median
median(src, length) =>
    percentile_nearest_rank(src, length, 50)

sort(src, length, i) =>
	min = -10000.0

	for j = 0 to i
		min_local = 10000.0

		for l = 0 to length - 1
			if (nz(src[l]) <= min)
				continue

			min_local := min(min_local, max(min, nz(src[l])))

		if min_local != 10000
			min := min_local
	min

// Custom Median
customMedian(src, length) =>
	out = 0.0

	if length % 2 == 0
		out := (sort(src, length, length / 2 - 1) + sort(src, length, length / 2)) / 2
	else
		out := sort(src, length, length / 2 - 0.5)
	out

diff = median(src, length) - customMedian(src, length)

plot(diff, title="CMvsBM", transp=0)

##-- File Name: tradingview-pinescript-indicators-master/research/custom_median_vs_built_in_median.pine | File No: 157 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/research/dashed_line_style.pine | File No: 158 | Started --##
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Dashed Line Style script may be freely distributed under the terms of GPL-3.0 license.
study("Dashed Line Style", overlay=true)

sma = sma(close, 14)

plot(n % 3 != 0 ? sma : na, style=linebr, linewidth=3, color=black, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/research/dashed_line_style.pine | File No: 158 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/research/fancy_shapes.pine | File No: 159 | Started --##
//@version=4
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Fancy Shapes script may be freely distributed under the terms of the GPL-3.0 license.
study("Fancy Shapes")

y0 = 0
offset0 = 0

y1 = 0
offset1 = -20

y2 = 0
offset2 = -40

y3 = 0
offset3 = -60

y4 = 0
offset4 = -80

y5 = 0
offset5 = -100

y6 = 0
offset6 = -120

plotshape(y0, location=location.absolute, style=shape.flag, size=size.huge, color=color.blue, transp=80, show_last=1, offset=offset0)
plotshape(y0, location=location.absolute, style=shape.flag, size=size.large, color=color.blue, transp=80, show_last=1, offset=offset0)
plotshape(y0, location=location.absolute, style=shape.flag, size=size.normal, color=color.blue, transp=80, show_last=1, offset=offset0)
plotshape(y0, location=location.absolute, style=shape.flag, size=size.small, color=color.blue, transp=80, show_last=1, offset=offset0)
plotshape(y0, location=location.absolute, style=shape.flag, size=size.tiny, color=color.blue, transp=80, show_last=1, offset=offset0)

plotshape(y1, location=location.absolute, style=shape.square, size=size.huge, color=color.blue, transp=80, show_last=1, offset=offset1)
plotshape(y1, location=location.absolute, style=shape.square, size=size.large, color=color.blue, transp=80, show_last=1, offset=offset1)
plotshape(y1, location=location.absolute, style=shape.square, size=size.normal, color=color.blue, transp=80, show_last=1, offset=offset1)
plotshape(y1, location=location.absolute, style=shape.square, size=size.small, color=color.blue, transp=80, show_last=1, offset=offset1)
plotshape(y1, location=location.absolute, style=shape.square, size=size.tiny, color=color.blue, transp=80, show_last=1, offset=offset1)

plotshape(y2, location=location.absolute, style=shape.diamond, size=size.huge, color=color.blue, transp=80, show_last=1, offset=offset2)
plotshape(y2, location=location.absolute, style=shape.diamond, size=size.large, color=color.blue, transp=80, show_last=1, offset=offset2)
plotshape(y2, location=location.absolute, style=shape.diamond, size=size.normal, color=color.blue, transp=80, show_last=1, offset=offset2)
plotshape(y2, location=location.absolute, style=shape.diamond, size=size.small, color=color.blue, transp=80, show_last=1, offset=offset2)
plotshape(y2, location=location.absolute, style=shape.diamond, size=size.tiny, color=color.blue, transp=80, show_last=1, offset=offset2)

plotshape(y3, location=location.absolute, style=shape.triangleup, size=size.huge, color=color.blue, transp=80, show_last=1, offset=offset3)
plotshape(y3, location=location.absolute, style=shape.triangleup, size=size.large, color=color.blue, transp=80, show_last=1, offset=offset3)
plotshape(y3, location=location.absolute, style=shape.triangleup, size=size.normal, color=color.blue, transp=80, show_last=1, offset=offset3)
plotshape(y3, location=location.absolute, style=shape.triangleup, size=size.small, color=color.blue, transp=80, show_last=1, offset=offset3)
plotshape(y3, location=location.absolute, style=shape.triangleup, size=size.tiny, color=color.blue, transp=80, show_last=1, offset=offset3)

plotshape(y4, location=location.absolute, style=shape.circle, size=size.huge, color=color.blue, transp=80, show_last=1, offset=offset4)
plotshape(y4, location=location.absolute, style=shape.circle, size=size.large, color=color.blue, transp=80, show_last=1, offset=offset4)
plotshape(y4, location=location.absolute, style=shape.circle, size=size.normal, color=color.blue, transp=80, show_last=1, offset=offset4)
plotshape(y4, location=location.absolute, style=shape.circle, size=size.small, color=color.blue, transp=80, show_last=1, offset=offset4)
plotshape(y4, location=location.absolute, style=shape.circle, size=size.tiny, color=color.blue, transp=80, show_last=1, offset=offset4)

plotshape(y5, location=location.absolute, style=shape.labelup, size=size.huge, color=color.blue, transp=80, show_last=1, offset=offset5)
plotshape(y5, location=location.absolute, style=shape.labelup, size=size.large, color=color.blue, transp=80, show_last=1, offset=offset5)
plotshape(y5, location=location.absolute, style=shape.labelup, size=size.normal, color=color.blue, transp=80, show_last=1, offset=offset5)
plotshape(y5, location=location.absolute, style=shape.labelup, size=size.small, color=color.blue, transp=80, show_last=1, offset=offset5)
plotshape(y5, location=location.absolute, style=shape.labelup, size=size.tiny, color=color.blue, transp=80, show_last=1, offset=offset5)

plotshape(y6, location=location.absolute, style=shape.labeldown, size=size.huge, color=color.blue, transp=80, show_last=1, offset=offset6)
plotshape(y6, location=location.absolute, style=shape.labeldown, size=size.large, color=color.blue, transp=80, show_last=1, offset=offset6)
plotshape(y6, location=location.absolute, style=shape.labeldown, size=size.normal, color=color.blue, transp=80, show_last=1, offset=offset6)
plotshape(y6, location=location.absolute, style=shape.labeldown, size=size.small, color=color.blue, transp=80, show_last=1, offset=offset6)
plotshape(y6, location=location.absolute, style=shape.labeldown, size=size.tiny, color=color.blue, transp=80, show_last=1, offset=offset6)

##-- File Name: tradingview-pinescript-indicators-master/research/fancy_shapes.pine | File No: 159 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/research/heikin_ashi_chart_identifier.pine | File No: 160 | Started --##
//@version=4
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Heikin-Ashi Chart Identifier script may be freely distributed under the terms of the GPL-3.0 license.
study("Heikin-Ashi Chart Identifier", overlay=true)

var int gapsCount = -1
gapsCount := low[1] > high or high[1] < low ? gapsCount + 1 : gapsCount

var int matchedCandles = -1
matchedCandles := open == (open[1] + close[1]) / 2 ? matchedCandles + 1 : matchedCandles

isHA = matchedCandles == bar_index - 1 and matchedCandles != -1 and gapsCount == -1

labelText = isHA ? "This is Heikin-Ashi Chart" : "This is not Heikin-Ashi Chart"
stats = "\n------------------------------------" +
         "\nBar Index: " + tostring(int(bar_index)) +
         "\nMatched: " + tostring(matchedCandles)
         
labelColor = #1e90ff
whiteColor = color.white

var label l = label.new(
     x=bar_index,
     y=na,
     text="",
     color=labelColor,
     textcolor=whiteColor,
     style=label.style_labeldown,
     size=size.normal
     )

label.set_text(l, labelText + stats)
label.set_xy(l, bar_index, highest(high, 50))

##-- File Name: tradingview-pinescript-indicators-master/research/heikin_ashi_chart_identifier.pine | File No: 160 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/research/kagi_chart_identifier.pine | File No: 161 | Started --##
//@version=4
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Kagi Chart Identifier script may be freely distributed under the terms of the GPL-3.0 license.
study("Kagi Chart Identifier", overlay=true)

var ocCount = -1
if open[1] == close or close[1] == open
    ocCount := ocCount + 1

var hCount = -1
if open == high or close == high
    hCount := hCount + 1

var lCount = -1
if open == low or close == low
    lCount := lCount + 1

isKagi = hCount == bar_index and lCount == bar_index and ocCount == bar_index - 1

labelText = isKagi ? "This is Kagi Chart" : "This is not Kagi Chart"
stats = "\n------------------------------" +
         "\nBar Index: " + tostring(int(bar_index)) +
         "\nO==C Candles: " + tostring(ocCount) +
         "\nOC==H Candles: " + tostring(hCount) +
         "\nOC==L Candles: " + tostring(lCount)
labelColor = #1e90ff
whiteColor = color.white

var label kagiLabel = label.new(
     x=bar_index,
     y=na,
     text="",
     color=labelColor,
     textcolor=whiteColor,
     style=label.style_labeldown,
     size=size.normal
     )

label.set_text(kagiLabel, labelText + stats)
label.set_xy(kagiLabel, bar_index, highest(close, 10))

##-- File Name: tradingview-pinescript-indicators-master/research/kagi_chart_identifier.pine | File No: 161 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/research/litecoin_halving_utc_countdown.pine | File No: 162 | Started --##
//@version=4
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Litecoin Halving UTC Countdown script may be freely distributed under the terms of the GPL-3.0 license.
study("Litecoin Halving UTC Countdown", overlay=true)

halvingDay = input(title="Halving Day", minval=1, maxval=31, defval=5)
halvingHour = input(title="Halving Hour", minval=1, maxval=24, defval=11)
halvingMinute = input(title="Halving Minute", minval=1, maxval=60, defval=55)

halvingStamp = timestamp('GMT', 2019, 8, halvingDay, halvingHour, halvingMinute)

secondsRaw = floor((halvingStamp - timenow) / 1000)
minutesRaw = floor(secondsRaw / 60)
hoursRaw = floor(minutesRaw / 60)

seconds = secondsRaw % 60
minutes = minutesRaw % 60
hours = hoursRaw % 24
days = floor(hoursRaw / 24)

f_format(_val) =>
    (0 < _val and _val < 10 ? "0" : "") + tostring(_val, "##") + (_val == 0 ? "0" : "")

labelText = f_format(days) + "d  " + f_format(hours) + ":" + f_format(minutes) + ":" + f_format(seconds)

var label l = label.new(
     x=bar_index,
     y=na,
     text="",
     textcolor=color.black,
     style=label.style_none,
     size=size.huge
     )

label.set_text(l, labelText)
label.set_xy(l, bar_index, highest(100))

##-- File Name: tradingview-pinescript-indicators-master/research/litecoin_halving_utc_countdown.pine | File No: 162 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/research/mean_absolute_deviation.pine | File No: 163 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Mean Absolute Deviation script may be freely distributed under the terms of GPL-3.0 license.
study("Mean Absolute Deviation", shorttitle="MAD")

src = close
len = 14

sma = sma(src, len)

median(src, length) =>
    percentile_nearest_rank(src, length, 50)

dev0 = dev(src, len)
dev1 = src - sma
dev2 = sum(abs(src - sma), len) / len
dev3 = abs(src - sma) / len
dev4 = (src - sma) / len
dev5 = median(src - median(src, len), len)

sum = 0.0
for i = 0 to len - 1
    sum := sum + abs(src[i] - sma)

dev6 = sum / len

plot(dev0, title="Built-in", color=purple)
plot(dev1, title="1", color=olive)
plot(dev2, title="2", color=teal)
plot(dev3, title="3", color=green)
plot(dev4, title="4", color=red)
plot(dev5, title="5", color=blue)
plot(dev6, title="6", color=orange)

##-- File Name: tradingview-pinescript-indicators-master/research/mean_absolute_deviation.pine | File No: 163 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/research/momentum.pine | File No: 164 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Momentum script may be freely distributed under the terms of GPL-3.0 license.
study("Momentum")

src = close
length = 7

mom = src - src[length]

mom2 = change(src, length)

mom3 = mom(src, length)

sma = sma(src, length)
mom4 = (sma - sma[1]) * length

plot(mom, title="Simple", color=blue)
plot(mom2, title="2", color=green)
plot(mom3, title="3", color=red)
plot(mom4, title="4", color=purple)

##-- File Name: tradingview-pinescript-indicators-master/research/momentum.pine | File No: 164 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/research/percentrank_bug.pine | File No: 165 | Started --##
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Percentrank Bug script may be freely distributed under the terms of the GPL-3.0 license.
study("Percentrank Bug")

src = volume
length = input(14)

pr = percentrank(src, length)
plot(pr, title="Built-in", color=red)

_percentrank(src, length) =>
    count = 0
    for i = 1 to length
        count := count + (src >= nz(src[i]) ? 1 : 0)
    pr = 100 * count / length

pr2 = _percentrank(src, length)

plot(pr2, title="Shim", color=green)

##-- File Name: tradingview-pinescript-indicators-master/research/percentrank_bug.pine | File No: 165 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/research/point_and_figure_pnf_chart_identifier.pine | File No: 166 | Started --##
//@version=4
// Copyright (c) 2020-present, Alex Orekhov (everget)
// Point-and-Figure (P&F) Chart Identifier script may be freely distributed under the terms of the GPL-3.0 license.
study("Point-and-Figure (P&F) Chart Identifier", overlay=true)

var int ocCount = -1
ocCount := open[1] == close or close[1] == open ? ocCount + 1 : ocCount

var int sum = 0
sum := close > close[1] ? sum + 1 : close < close[1] ? sum - 1 : sum

isPnF = (sum == 1 or sum == 0 or sum == -1) and ocCount < bar_index - 1
matchedCandles = cum(isPnF ? 1 : 0)

labelText = isPnF ? "This is P&F Chart" : "This is not P&F Chart"
stats = "\n------------------------------" +
         "\nBar Index: " + tostring(int(bar_index)) +
         "\nMatched Candles: " + tostring(matchedCandles) +
         "\nO==C: " + tostring(ocCount) +
         "\nSum: " + tostring(sum)
labelColor = #1e90ff
whiteColor = color.white

var label pnfLabel = label.new(
     x=bar_index,
     y=na,
     text="",
     color=labelColor,
     textcolor=whiteColor,
     style=label.style_label_down,
     size=size.normal
     )

label.set_text(pnfLabel, labelText + stats)
label.set_xy(pnfLabel, bar_index, highest(close, 10))

##-- File Name: tradingview-pinescript-indicators-master/research/point_and_figure_pnf_chart_identifier.pine | File No: 166 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/research/rate_of_change.pine | File No: 167 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Rate of Change script may be freely distributed under the terms of GPL-3.0 license.
study("Rate of Change", shorttitle="ROC")

src = close
length = 7

roc = roc(src, length)

roc2 = change(src, length)

roc3 = change(src, length) / src[length]

roc4 = 100 * change(src, length) / src[length]

plot(roc, title="Built-in", color=blue)
plot(roc2, title="2", color=green)
plot(roc3, title="3", color=red)
plot(roc4, title="4", color=purple)

##-- File Name: tradingview-pinescript-indicators-master/research/rate_of_change.pine | File No: 167 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/research/renko_chart_identifier.pine | File No: 168 | Started --##
//@version=4
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Renko Chart Identifier script may be freely distributed under the terms of the GPL-3.0 license.
study("Renko Chart Identifier", overlay=true)

_isRenko() =>
    var int gapsCount = -1
    if low[1] > high or high[1] < low
        gapsCount := gapsCount + 1
    body = abs(close - open)
    bodySum = cum(body)
    avg = bodySum / (bar_index + 1)
    out = avg == body and gapsCount == -1
    out

labelText = _isRenko() ? "This is Renko Chart" : "This is not Renko Chart"
labelColor = #1e90ff
whiteColor = color.white

var label l = label.new(
     x=bar_index,
     y=na,
     text="",
     color=labelColor,
     textcolor=whiteColor,
     style=label.style_labeldown,
     size=size.normal
     )

label.set_text(l, labelText)
label.set_xy(l, bar_index, highest(close, 50))

##-- File Name: tradingview-pinescript-indicators-master/research/renko_chart_identifier.pine | File No: 168 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/research/script_with_expiration_time.pine | File No: 169 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
study("Script With Expiration Time")

expired = timenow >= timestamp("GMT", 2018, 12, 1, 13, 0) and (barstate.ishistory or barstate.isrealtime)

plot(expired ? na : close, color=purple)

##-- File Name: tradingview-pinescript-indicators-master/research/script_with_expiration_time.pine | File No: 169 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/research/symbol_info_helper.pine | File No: 170 | Started --##
//@version=4
// Copyright (c) 2020-present, Alex Orekhov (everget)
// Symbol Info Helper script may be freely distributed under the terms of the GPL-3.0 license.
study("Symbol Info Helper", overlay=true)

labelText =
     "Symbol Name: " + syminfo.tickerid +
     "\nSymbol Description: " + syminfo.description +
     "\nSymbol Type: " + syminfo.type +
     "\nPoint Value: " + tostring(syminfo.pointvalue) +
     "\nExchange: " + syminfo.prefix +
     "\nListed Exchange: " + "-" +
     "\nCurrency: " + syminfo.currency +
     "\nTick Size: " + tostring(syminfo.mintick) +
     "\nSector: " + "-" +
     "\nIndustry: " + "-" +
     "\nTimezone: " + syminfo.timezone +
     "\nSession: " + "-"

var label l = label.new(
     x=bar_index,
     y=na,
     text="",
     textalign=text.align_left,
     textcolor=color.white,
     color=color.blue,
     style=label.style_label_left,
     size=size.normal
     )

label.set_text(l, labelText)
label.set_xy(l, bar_index, ohlc4)

##-- File Name: tradingview-pinescript-indicators-master/research/symbol_info_helper.pine | File No: 170 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/research/utc_clock.pine | File No: 171 | Started --##
//@version=4
// Copyright (c) 2019-present, Alex Orekhov (everget)
// UTC Clock script may be freely distributed under the terms of the GPL-3.0 license.
study("UTC Clock", overlay=true)

secondsRaw = floor(timenow / 1000)
minutesRaw = floor(secondsRaw / 60)
hoursRaw = floor(minutesRaw / 60)

seconds = secondsRaw % 60
minutes = minutesRaw % 60
hours = hoursRaw % 24

f_format(_val) =>
    (0 < _val and _val < 10 ? "0" : "") + tostring(_val, "##") + (_val == 0 ? "0" : "")

labelText = f_format(hours) + ":" + f_format(minutes) + ":" + f_format(seconds)

var label l = label.new(
     x=bar_index,
     y=na,
     text="",
     textcolor=color.black,
     style=label.style_none,
     size=size.huge
     )

label.set_text(l, labelText)
label.set_xy(l, bar_index, highest(high, 50))

##-- File Name: tradingview-pinescript-indicators-master/research/utc_clock.pine | File No: 171 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/statistics/all_time_high_days.pine | File No: 172 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// All-Time High Days script may be freely distributed under the terms of GPL-3.0 license.
study("All-Time High Days", shorttitle="ATH Days", precision=0)

highlightATH = input(title="Highlight ATH ?", defval=false)

ath = high
ath := na(ath[1]) ? ath : (high > ath[1] ? high : ath[1])

cond = high == ath
transparent = color(white, 100)

bars = barssince(cond)
plot(bars, title="ATH Days", color=#674ea7)

bgcolor(cond and highlightATH ? orange : transparent)

##-- File Name: tradingview-pinescript-indicators-master/statistics/all_time_high_days.pine | File No: 172 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/statistics/all_time_high_percent_drop.pine | File No: 173 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// All-Time High % Drop script may be freely distributed under the terms of GPL-3.0 license.
study("All-Time High % Drop", shorttitle="ATH % Drop", precision=2)

ath = high
ath := na(ath[1]) ? ath : (high > ath[1] ? high : ath[1])

percent = 100 * (close - ath) / ath

plot(percent, title="ATH %", color=#351c75, transp=0)

plot(0, title="", style=circles, linewidth=0, color=gray)
hline(0, linestyle=dotted, color=gray)

plot(-10, title="", style=circles, linewidth=0, color=#F9CE02)
hline(-10, linestyle=dotted, color=#F9CE02)

plot(-20, title="", style=circles, linewidth=0, color=#F7BA05)
hline(-20, linestyle=dotted, color=#F7BA05)

plot(-30, title="", style=circles, linewidth=0, color=#F4A608)
hline(-30, linestyle=dotted, color=#F4A608)

plot(-40, title="", style=circles, linewidth=0, color=#F2920B)
hline(-40, linestyle=dotted, color=#F2920B)

plot(-50, title="", style=circles, linewidth=0, color=#F07E0E)
hline(-50, linestyle=dotted, color=#F07E0E)

plot(-60, title="", style=circles, linewidth=0, color=#ED6A10)
hline(-60, linestyle=dotted, color=#ED6A10)

plot(-70, title="", style=circles, linewidth=0, color=#EB5613)
hline(-70, linestyle=dotted, color=#EB5613)

plot(-80, title="", style=circles, linewidth=0, color=#E84216)
hline(-80, linestyle=dotted, color=#E84216)

plot(-90, title="", style=circles, linewidth=0, color=#E62E19)
hline(-90, linestyle=dotted, color=#E62E19)

plot(-100, title="", style=circles, linewidth=0, color=#E41A1C)
hline(-100, linestyle=dotted, color=#E41A1C)

##-- File Name: tradingview-pinescript-indicators-master/statistics/all_time_high_percent_drop.pine | File No: 173 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/statistics/bitcoin_ath_hash_rate_level.pine | File No: 174 | Started --##
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Bitcoin ATH Hash Rate Level script may be freely distributed under the terms of GPL-3.0 license.
study("Bitcoin ATH Hash Rate Level", shorttitle="ATH HR", overlay=true)

highlightMovements = input(title="Highlight Price Movements ?", type=bool, defval=false)

_ath(src) =>
    ath = src
    ath := na(ath[1]) ? ath : (ath > ath[1] ? ath : ath[1])

hashRate = security("QUANDL:BCHAIN/HRATE", "D", close)

hrATH = _ath(hashRate)

hrathLevel = close
hrathLevel := hrATH > hrATH[1] ? close : nz(hrathLevel[1], close) //  and close > close[1]

levelColor = highlightMovements ? (close > hrathLevel ? green : close < hrathLevel ? red : #6d1e7f) : black
plot(hrathLevel, title="Hash Rate", linewidth=2, color=levelColor, transp=0)

hrathCond = hrATH != hrATH[1]
alertcondition(hrathCond, title="Alert on New Bitcoin ATH Hash Rate", message="New Bitcoin ATH Hash Rate !")

##-- File Name: tradingview-pinescript-indicators-master/statistics/bitcoin_ath_hash_rate_level.pine | File No: 174 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/statistics/bullish_bearish_candle_series_distribution.pine | File No: 175 | Started --##
//@version=4
// Copyright (c) 2020-present, Alex Orekhov (everget)
// Bullish/Bearish Candle Series Distribution script may be freely distributed under the terms of GPL-3.0 license.
study("Bullish/Bearish Candle Series Distribution")

reboot = input(title="Reboot ?", defval=false)
mode = input(title="Mode", defval="Bullish", options=["Strict Bullish", "Bullish", "Strict Bearish", "Bearish"])
width = input(title="Columns Width", defval=10)
space = input(title="Space Between Columns", defval=5)
hide2 = input(title="Hide 2-Series ?", defval=false)

columnColor = #ffb74d
labelColor = #1e90ff
whiteColor = color.white

cond =
     mode == "Bullish" ? close >= open :
     mode == "Strict Bullish" ? close > open :
     mode == "Bearish" ? close <= open :
     mode == "Strict Bearish" ? close < open :
     false

var int count = 0
count := na(count[1]) ? count : (cond ? count[1] + 1 : 0)

// var res = '';
// var len = 60;

// for (let i = 0; i < len; i++) {
// 	res = res.concat(`var int serie${ i + 2 } = 0\n`);
// }

// res = res.concat(`\n`);
// res = res.concat(`len = nz(count[1]) + 1\n`)
// res = res.concat(`if count == 0\n`);

// for (let i = 0; i < len; i++) {
// 	res = res.concat(`	serie${ i + 2 } := len == ${ i + 2 } ? serie${ i + 2 } + 1 : serie${ i + 2 }\n`);
// }

// res = res.concat(`\n`);

// res = res.concat(
//     Array.from({ length: len })
//     .reduce((acc, _, idx) => {
//     	return acc
//     		.concat(`plot(serie${ idx + 2 }, offset=(${ -idx } * space), title="${ idx + 2 }", style=plot.style_histogram, linewidth=width, color=color.black, show_last=1)\n`);
//     }, '')
// );

var int serie2 = 0
var int serie3 = 0
var int serie4 = 0
var int serie5 = 0
var int serie6 = 0
var int serie7 = 0
var int serie8 = 0
var int serie9 = 0
var int serie10 = 0
var int serie11 = 0
var int serie12 = 0
var int serie13 = 0
var int serie14 = 0
var int serie15 = 0
var int serie16 = 0
var int serie17 = 0
var int serie18 = 0
var int serie19 = 0
var int serie20 = 0
var int serie21 = 0
var int serie22 = 0
var int serie23 = 0
var int serie24 = 0
var int serie25 = 0
var int serie26 = 0
var int serie27 = 0
var int serie28 = 0
var int serie29 = 0
var int serie30 = 0
var int serie31 = 0
var int serie32 = 0
var int serie33 = 0
var int serie34 = 0
var int serie35 = 0
var int serie36 = 0
var int serie37 = 0
var int serie38 = 0
var int serie39 = 0
var int serie40 = 0
var int serie41 = 0
var int serie42 = 0
var int serie43 = 0
var int serie44 = 0
var int serie45 = 0
var int serie46 = 0
var int serie47 = 0
var int serie48 = 0
var int serie49 = 0
var int serie50 = 0
var int serie51 = 0
var int serie52 = 0
var int serie53 = 0
var int serie54 = 0
var int serie55 = 0
var int serie56 = 0
var int serie57 = 0
var int serie58 = 0
var int serie59 = 0

len = nz(count[1]) + 1
if count == 0
	serie2 := len == 2 ? serie2 + 1 : serie2
	serie3 := len == 3 ? serie3 + 1 : serie3
	serie4 := len == 4 ? serie4 + 1 : serie4
	serie5 := len == 5 ? serie5 + 1 : serie5
	serie6 := len == 6 ? serie6 + 1 : serie6
	serie7 := len == 7 ? serie7 + 1 : serie7
	serie8 := len == 8 ? serie8 + 1 : serie8
	serie9 := len == 9 ? serie9 + 1 : serie9
	serie10 := len == 10 ? serie10 + 1 : serie10
	serie11 := len == 11 ? serie11 + 1 : serie11
	serie12 := len == 12 ? serie12 + 1 : serie12
	serie13 := len == 13 ? serie13 + 1 : serie13
	serie14 := len == 14 ? serie14 + 1 : serie14
	serie15 := len == 15 ? serie15 + 1 : serie15
	serie16 := len == 16 ? serie16 + 1 : serie16
	serie17 := len == 17 ? serie17 + 1 : serie17
	serie18 := len == 18 ? serie18 + 1 : serie18
	serie19 := len == 19 ? serie19 + 1 : serie19
	serie20 := len == 20 ? serie20 + 1 : serie20
	serie21 := len == 21 ? serie21 + 1 : serie21
	serie22 := len == 22 ? serie22 + 1 : serie22
	serie23 := len == 23 ? serie23 + 1 : serie23
	serie24 := len == 24 ? serie24 + 1 : serie24
	serie25 := len == 25 ? serie25 + 1 : serie25
	serie26 := len == 26 ? serie26 + 1 : serie26
	serie27 := len == 27 ? serie27 + 1 : serie27
	serie28 := len == 28 ? serie28 + 1 : serie28
	serie29 := len == 29 ? serie29 + 1 : serie29
	serie30 := len == 30 ? serie30 + 1 : serie30
	serie31 := len == 31 ? serie31 + 1 : serie31
	serie32 := len == 32 ? serie32 + 1 : serie32
	serie33 := len == 33 ? serie33 + 1 : serie33
	serie34 := len == 34 ? serie34 + 1 : serie34
	serie35 := len == 35 ? serie35 + 1 : serie35
	serie36 := len == 36 ? serie36 + 1 : serie36
	serie37 := len == 37 ? serie37 + 1 : serie37
	serie38 := len == 38 ? serie38 + 1 : serie38
	serie39 := len == 39 ? serie39 + 1 : serie39
	serie40 := len == 40 ? serie40 + 1 : serie40
	serie41 := len == 41 ? serie41 + 1 : serie41
	serie42 := len == 42 ? serie42 + 1 : serie42
	serie43 := len == 43 ? serie43 + 1 : serie43
	serie44 := len == 44 ? serie44 + 1 : serie44
	serie45 := len == 45 ? serie45 + 1 : serie45
	serie46 := len == 46 ? serie46 + 1 : serie46
	serie47 := len == 47 ? serie47 + 1 : serie47
	serie48 := len == 48 ? serie48 + 1 : serie48
	serie49 := len == 49 ? serie49 + 1 : serie49
	serie50 := len == 50 ? serie50 + 1 : serie50
	serie51 := len == 51 ? serie51 + 1 : serie51
	serie52 := len == 52 ? serie52 + 1 : serie52
	serie53 := len == 53 ? serie53 + 1 : serie53
	serie54 := len == 54 ? serie54 + 1 : serie54
	serie55 := len == 55 ? serie55 + 1 : serie55
	serie56 := len == 56 ? serie56 + 1 : serie56
	serie57 := len == 57 ? serie57 + 1 : serie57
	serie58 := len == 58 ? serie58 + 1 : serie58
	serie59 := len == 59 ? serie59 + 1 : serie59

plot(hide2 ? na : serie2, offset=(0 * space), title="2", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plotshape(hide2 ? na : 0, offset=(0 * space), title="2", text=" 2 ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

plot(serie3, offset=(-1 * space), title="3", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie4, offset=(-2 * space), title="4", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie5, offset=(-3 * space), title="5", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie6, offset=(-4 * space), title="6", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie7, offset=(-5 * space), title="7", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie8, offset=(-6 * space), title="8", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie9, offset=(-7 * space), title="9", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie10, offset=(-8 * space), title="10", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-8 * space), title="10", text=" 10 ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

plot(serie11, offset=(-9 * space), title="11", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie12, offset=(-10 * space), title="12", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie13, offset=(-11 * space), title="13", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie14, offset=(-12 * space), title="14", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie15, offset=(-13 * space), title="15", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie16, offset=(-14 * space), title="16", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie17, offset=(-15 * space), title="17", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie18, offset=(-16 * space), title="18", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie19, offset=(-17 * space), title="19", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie20, offset=(-18 * space), title="20", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-18 * space), title="20", text=" 20 ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

plot(serie21, offset=(-19 * space), title="21", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie22, offset=(-20 * space), title="22", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie23, offset=(-21 * space), title="23", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie24, offset=(-22 * space), title="24", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie25, offset=(-23 * space), title="25", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie26, offset=(-24 * space), title="26", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie27, offset=(-25 * space), title="27", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie28, offset=(-26 * space), title="28", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie29, offset=(-27 * space), title="29", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie30, offset=(-28 * space), title="30", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-28 * space), title="30", text=" 30 ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

plot(serie31, offset=(-29 * space), title="31", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie32, offset=(-30 * space), title="32", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie33, offset=(-31 * space), title="33", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie34, offset=(-32 * space), title="34", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie35, offset=(-33 * space), title="35", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie36, offset=(-34 * space), title="36", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie37, offset=(-35 * space), title="37", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie38, offset=(-36 * space), title="38", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie39, offset=(-37 * space), title="39", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie40, offset=(-38 * space), title="40", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-38 * space), title="40", text=" 40 ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

plot(serie41, offset=(-39 * space), title="41", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie42, offset=(-40 * space), title="42", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie43, offset=(-41 * space), title="43", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie44, offset=(-42 * space), title="44", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie45, offset=(-43 * space), title="45", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie46, offset=(-44 * space), title="46", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie47, offset=(-45 * space), title="47", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie48, offset=(-46 * space), title="48", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie49, offset=(-47 * space), title="49", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie50, offset=(-48 * space), title="50", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-48 * space), title="50", text=" 50 ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

plot(serie51, offset=(-49 * space), title="51", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie52, offset=(-50 * space), title="52", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie53, offset=(-51 * space), title="53", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie54, offset=(-52 * space), title="54", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie55, offset=(-53 * space), title="55", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie56, offset=(-54 * space), title="56", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie57, offset=(-55 * space), title="57", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie58, offset=(-56 * space), title="58", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie59, offset=(-57 * space), title="59", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

##-- File Name: tradingview-pinescript-indicators-master/statistics/bullish_bearish_candle_series_distribution.pine | File No: 175 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/statistics/candles_history.pine | File No: 176 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Candles History script may be freely distributed under the terms of GPL-3.0 license.
study("Candles History", shorttitle="CH", precision=1)

copyright = input(title="Author", defval="@everget", options=["@everget"])

mode = input(title="Display Mode", defval="Starting Year",
	 options=["Starting Year",
				 "Starting Month",
				 "Starting Day",
				 "Starting Weekday",
				 "Starting Hour",
				 "Starting Minute",
				 "Highest Volume",
				 "Lowest Volume",
				 "Longest Candle Range",
				 "Longest Candle Range in Pips",
				 "Average Candle Range",
				 "Average Candle Range in Pips",
				 "Longest Candle Body Range",
				 "Longest Candle Body Range in Pips",
				 "Average Candle Body Range",
				 "Average Candle Body Range in Pips",
				 "All-Time High",
				 "All-Time Low",
				 "Available Candles",
				 "Bullish Candles",
				 "Bullish Trend Candles",
				 "Bearish Candles",
				 "Bearish Trend Candles",
				 "Doji Candles",
				 "Bullish Marubozu Candles",
				 "Bearish Marubozu Candles",
				 "Longest Bullish Serie",
				 "Longest Bearish Serie"])

range = high - low
body = abs(open - close)

averageRange = cum(range) / (n + 1)
averageBody = cum(body) / (n + 1)

longestRange = range
longestRange := na(longestRange[1]) ? longestRange : (range > longestRange[1] ? range : longestRange[1]) 

longestBody = body
longestBody := na(longestBody[1]) ? longestBody : (body > longestBody[1] ? body : longestBody[1])

bullMax = 0
bullMax := na(bullMax[1]) ? bullMax : bullMax[1]

bullCount = 0
bullCount := na(bullCount[1]) ? bullCount : (close >= open ? bullCount[1] + 1 : 0)

if bullCount == 0 and nz(bullCount[1]) + 1 > bullMax
    bullMax := bullCount[1] + 1

bearMax = 0
bearMax := na(bearMax[1]) ? bearMax : bearMax[1]

bearCount = 0
bearCount := na(bearCount[1]) ? bearCount : (close <= open ? bearCount[1] + 1 : 0)

if bearCount == 0 and nz(bearCount[1]) + 1 > bearMax
    bearMax := bearCount[1] + 1

bullSum = cum(close > open ? 1 : 0)
bearSum = cum(close < open ? 1 : 0)

bulltrendSum = cum(close > open and body >= 0.5 * range ? 1 : 0)
beartrendSum = cum(close < open and body >= 0.5 * range ? 1 : 0)

highestVolume = volume
highestVolume := na(highestVolume[1]) ? highestVolume : (volume > highestVolume[1] ? volume : highestVolume[1])

lowestVolume = pow(10, 10)
lowestVolume := na(lowestVolume[1]) ? lowestVolume : (volume < lowestVolume[1] and volume != 0 ? volume : lowestVolume[1])

ath = high
ath := na(ath[1]) ? ath : (high > ath[1] ? high : ath[1])

atl = low
atl := na(atl[1]) ? atl : (low < atl[1] ? low : atl[1])

out = 0.0
out := mode == "Available Candles" ? n + 1 : out
out := mode == "Bullish Candles" ? bullSum : out
out := mode == "Bullish Trend Candles" ? bulltrendSum : out
out := mode == "Bearish Candles" ? bearSum : out
out := mode == "Bearish Trend Candles" ? beartrendSum : out
out := mode == "Doji Candles" ? cum(open == close ? 1 : 0) : out
out := mode == "Bullish Marubozu Candles" ? cum(high == close and low == open ? 1 : 0) : out
out := mode == "Bearish Marubozu Candles" ? cum(high == open and low == close ? 1 : 0) : out

out := mode == "Longest Candle Range" ? longestRange : out
out := mode == "Longest Candle Range in Pips" ? longestRange / syminfo.mintick : out
out := mode == "Average Candle Range" ? averageRange : out
out := mode == "Average Candle Range in Pips" ? averageRange / syminfo.mintick : out
out := mode == "Longest Candle Body Range" ? longestBody : out
out := mode == "Longest Candle Body Range in Pips" ? longestBody / syminfo.mintick : out
out := mode == "Average Candle Body Range" ? averageBody : out
out := mode == "Average Candle Body Range in Pips" ? averageBody / syminfo.mintick : out

out := mode == "Longest Bullish Serie" ? floor(bullMax) : out
out := mode == "Longest Bearish Serie" ? floor(bearMax) : out
out := mode == "Highest Volume" ? highestVolume : out
out := mode == "Lowest Volume" ? lowestVolume : out
out := mode == "All-Time High" ? ath : out
out := mode == "All-Time Low" ? atl : out
out := mode == "Starting Year" ? valuewhen(n == 0, year, 0) : out
out := mode == "Starting Month" ? valuewhen(n == 0, month, 0) : out
out := mode == "Starting Day" ? valuewhen(n == 0, dayofmonth, 0) : out
out := mode == "Starting Weekday" ? valuewhen(n == 0, dayofweek, 0) : out
out := mode == "Starting Hour" ? valuewhen(n == 0, hour, 0) : out
out := mode == "Starting Minute" ? valuewhen(n == 0, minute, 0) : out

plot(out, title="Metric", color=red)

##-- File Name: tradingview-pinescript-indicators-master/statistics/candles_history.pine | File No: 176 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/statistics/close_to_close_percent_change_distribution.pine | File No: 177 | Started --##
//@version=4
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Close-to-Close % Change Distribution script may be freely distributed under the terms of GPL-3.0 license.
study("Close-to-Close % Change Distribution")

reboot = input(title="Reboot ?", defval=false)
width = input(title="Columns Width", defval=12)
space = input(title="Space Between Columns", defval=4)

columnColor = #ffb74d
labelColor = #1e90ff
whiteColor = color.white

roc = roc(close, 1)
total = bar_index + 1

p025 = cum(0 <= roc and roc < 0.25 ? 1 : 0)
plot(100 * p025 / total, offset=(-23 * space), title="0-0.25%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-floor(23.5 * space)), title="0%", text=" 0% ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

p05 = cum(0.25 <= roc and roc < 0.5 ? 1 : 0)
plot(100 * p05 / total, offset=(-22 * space), title="0.25-0.5%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

p075 = cum(0.5 <= roc and roc < 0.75 ? 1 : 0)
plot(100 * p075 / total, offset=(-21 * space), title="0.5-0.75%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

p1 = cum(0.75 <= roc and roc < 1 ? 1 : 0)
plot(100 * p1 / total, offset=(-20 * space), title="0.75-1%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

p125 = cum(1 <= roc and roc < 1.25 ? 1 : 0)
plot(100 * p125 / total, offset=(-19 * space), title="1-1.25%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-floor(19.5 * space)), title="1%", text=" 1% ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

p15 = cum(1.25 <= roc and roc < 1.5 ? 1 : 0)
plot(100 * p15 / total, offset=(-18 * space), title="1.25-1.5%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

p175 = cum(1.5 <= roc and roc < 1.75 ? 1 : 0)
plot(100 * p175 / total, offset=(-17 * space), title="1.5-1.75%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

p2 = cum(1.75 <= roc and roc < 2 ? 1 : 0)
plot(100 * p2 / total, offset=(-16 * space), title="1.75-2%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

p225 = cum(2 <= roc and roc < 2.25 ? 1 : 0)
plot(100 * p225 / total, offset=(-15 * space), title="2-2.25%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-floor(15.5 * space)), title="2%", text=" 2% ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

p25 = cum(2.25 <= roc and roc < 2.5 ? 1 : 0)
plot(100 * p25 / total, offset=(-14 * space), title="2.25-2.5%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

p275 = cum(2.5 <= roc and roc < 2.75 ? 1 : 0)
plot(100 * p275 / total, offset=(-13 * space), title="2.5-2.75%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

p3 = cum(2.75 <= roc and roc < 3 ? 1 : 0)
plot(100 * p3 / total, offset=(-12 * space), title="2.75-3%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

p325 = cum(3 <= roc and roc < 3.25 ? 1 : 0)
plot(100 * p325 / total, offset=(-11 * space), title="3-3.25%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-floor(11.5 * space)), title="3%", text=" 3% ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

p35 = cum(3.25 <= roc and roc < 3.5 ? 1 : 0)
plot(100 * p35 / total, offset=(-10 * space), title="3.25-3.5%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

p375 = cum(3.5 <= roc and roc < 3.75 ? 1 : 0)
plot(100 * p375 / total, offset=(-9 * space), title="3.5-3.75%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

p4 = cum(3.75 <= roc and roc < 4 ? 1 : 0)
plot(100 * p4 / total, offset=(-8 * space), title="3.75-4%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

p425 = cum(4 <= roc and roc < 4.25 ? 1 : 0)
plot(100 * p425 / total, offset=(-7 * space), title="4-4.25%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-floor(7.5 * space)), title="4%", text=" 4% ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

p45 = cum(4.25 <= roc and roc < 4.5 ? 1 : 0)
plot(100 * p45 / total, offset=(-6 * space), title="4.25-4.5%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

p475 = cum(4.5 <= roc and roc < 4.75 ? 1 : 0)
plot(100 * p475 / total, offset=(-5 * space), title="4.5-4.75%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

p5 = cum(4.75 <= roc and roc < 5 ? 1 : 0)
plot(100 * p5 / total, offset=(-4 * space), title="4.75-5%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

p525 = cum(5 <= roc and roc < 5.25 ? 1 : 0)
plot(100 * p525 / total, offset=(-3 * space), title="5-5.25%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-floor(3.5 * space)), title="5%", text=" 5% ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

p55 = cum(5.25 <= roc and roc < 5.5 ? 1 : 0)
plot(100 * p55 / total, offset=(-2 * space), title="5.25-5.5%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

p575 = cum(5.5 <= roc and roc < 5.75 ? 1 : 0)
plot(100 * p575 / total, offset=(-1 * space), title="5.5-5.75%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

p6 = cum(5.75 <= roc and roc < 6 ? 1 : 0)
plot(100 * p6 / total, offset=(0 * space), title="5.75-6%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

p625 = cum(roc >= 6 ? 1 : 0)
plot(100 * p625 / total, offset=(1 * space), title="≥ 6%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(floor(0.5 * space)), title="≥ 6%", text=" ≥ 6% ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

//------------------------------------------------------------------------------

n025 = cum(-0.25 < roc and roc < 0 ? 1 : 0)
plot(100 * n025 / total, offset=(-24 * space), title="-0-0.25%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

n05 = cum(-0.5 < roc and roc <= -0.25 ? 1 : 0)
plot(100 * n05 / total, offset=(-25 * space), title="-0.25-0.5%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

n075 = cum(-0.75 < roc and roc <= -0.5 ? 1 : 0)
plot(100 * n075 / total, offset=(-26 * space), title="-0.5-0.75%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

n1 = cum(-1 < roc and roc <= -0.75 ? 1 : 0)
plot(100 * n1 / total, offset=(-27 * space), title="-0.75-1%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

n125 = cum(-1.25 < roc and roc <= -1 ? 1 : 0)
plot(100 * n125 / total, offset=(-28 * space), title="-1-1.25%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-floor(27.5 * space)), title="-1%", text=" -1% ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

n15 = cum(-1.5 < roc and roc <= -1.25 ? 1 : 0)
plot(100 * n15 / total, offset=(-29 * space), title="-1.25-1.5%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

n175 = cum(-1.75 < roc and roc <= -1.5 ? 1 : 0)
plot(100 * n175 / total, offset=(-30 * space), title="-1.5-1.75%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

n2 = cum(-2 < roc and roc <= -1.75 ? 1 : 0)
plot(100 * n2 / total, offset=(-31 * space), title="-1.75-2%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

n225 = cum(-2.25 < roc and roc <= -2 ? 1 : 0)
plot(100 * n225 / total, offset=(-32 * space), title="-2-2.25%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-floor(31.5 * space)), title="-2%", text=" -2% ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

n25 = cum(-2.5 < roc and roc <= -2.25 ? 1 : 0)
plot(100 * n25 / total, offset=(-33 * space), title="-2.25-2.5%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

n275 = cum(-2.75 < roc and roc <= -2.5 ? 1 : 0)
plot(100 * n275 / total, offset=(-34 * space), title="-2.5-2.75%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

n3 = cum(-3 < roc and roc <= -2.75 ? 1 : 0)
plot(100 * n3 / total, offset=(-35 * space), title="-2.75-3%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

n325 = cum(-3.25 < roc and roc <= -3 ? 1 : 0)
plot(100 * n325 / total, offset=(-36 * space), title="-3-3.25%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-floor(35.5 * space)), title="-3%", text=" -3% ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

n35 = cum(-3.5 < roc and roc <= -3.25 ? 1 : 0)
plot(100 * n35 / total, offset=(-37 * space), title="-3.25-3.5%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

n375 = cum(-3.75 < roc and roc <= -3.5 ? 1 : 0)
plot(100 * n375 / total, offset=(-38 * space), title="-3.5-3.75%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

n4 = cum(-4 < roc and roc <= -3.75 ? 1 : 0)
plot(100 * n4 / total, offset=(-39 * space), title="-3.75-4%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

n425 = cum(-4.25 < roc and roc <= -4 ? 1 : 0)
plot(100 * n425 / total, offset=(-40 * space), title="-4-4.25%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-floor(39.5 * space)), title="-4%", text=" -4% ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

n45 = cum(-4.5 < roc and roc <= -4.25 ? 1 : 0)
plot(100 * n45 / total, offset=(-41 * space), title="-4.25-4.5%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

n475 = cum(-4.75 < roc and roc <= -4.5 ? 1 : 0)
plot(100 * n475 / total, offset=(-42 * space), title="-4.5-4.75%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

n5 = cum(-5 < roc and roc <= -4.75 ? 1 : 0)
plot(100 * n5 / total, offset=(-43 * space), title="-4.75-5%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

n525 = cum(-5.25 < roc and roc <= -5 ? 1 : 0)
plot(100 * n525 / total, offset=(-44 * space), title="-5-5.25%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-floor(43.5 * space)), title="-5%", text=" -5% ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

n55 = cum(-5.5 < roc and roc <= -5.25 ? 1 : 0)
plot(100 * n55 / total, offset=(-45 * space), title="-5.25-5.5%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

n575 = cum(-5.75 < roc and roc <= -5.5 ? 1 : 0)
plot(100 * n575 / total, offset=(-46 * space), title="-5.5-5.75%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

n6 = cum(-6 < roc and roc <= -5.75 ? 1 : 0)
plot(100 * n6 / total, offset=(-47 * space), title="-5.75-6%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

n625 = cum(roc <= -6 ? 1 : 0)
plot(100 * n625 / total, offset=(-48 * space), title="≤ -6%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-floor(47.5 * space)), title="≤ -6%", text=" ≤ -6% ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

##-- File Name: tradingview-pinescript-indicators-master/statistics/close_to_close_percent_change_distribution.pine | File No: 177 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/statistics/dividends_per_share_dps_yearly.pine | File No: 178 | Started --##
//@version=4
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Dividends per Share (DPS, Yearly) script may be freely distributed under the terms of GPL-3.0 license.
study("Dividends per Share (DPS, Yearly)")

width = input(title="Columns Width", defval=12)
space = input(title="Space Between Columns", defval=8)

esdColor = #ffb74d
estimateColor = color.new(color.blue, 85)
labelColor = #1e90ff
whiteColor = color.white

_id(type) =>
    out = "ESD_FACTSET:" + syminfo.prefix + ";" + syminfo.ticker + ";" + type
    out

id = _id("DIVIDENDS")
estimate = security(id, "D", open, true, lookahead=true)
esd = security(id, "D", close, true, lookahead=true)

_count(src, yearTarget) =>
	var float counter = na
	counter := year != year[1] and year == yearTarget ? 0 : counter[1]
	counter := year == yearTarget ? counter + (na(src) ? 0 : src) : counter

_countESD(yearTarget) =>
	esdCount = _count(esd, yearTarget)
	estimateCount = _count(estimate, yearTarget)
	[esdCount, estimateCount]

[esd1990, est1990] = _countESD(1990)
[esd1991, est1991] = _countESD(1991)
[esd1992, est1992] = _countESD(1992)
[esd1993, est1993] = _countESD(1993)
[esd1994, est1994] = _countESD(1994)
[esd1995, est1995] = _countESD(1995)
[esd1996, est1996] = _countESD(1996)
[esd1997, est1997] = _countESD(1997)
[esd1998, est1998] = _countESD(1998)
[esd1999, est1999] = _countESD(1999)
[esd2000, est2000] = _countESD(2000)
[esd2001, est2001] = _countESD(2001)
[esd2002, est2002] = _countESD(2002)
[esd2003, est2003] = _countESD(2003)
[esd2004, est2004] = _countESD(2004)
[esd2005, est2005] = _countESD(2005)
[esd2006, est2006] = _countESD(2006)
[esd2007, est2007] = _countESD(2007)
[esd2008, est2008] = _countESD(2008)
[esd2009, est2009] = _countESD(2009)
[esd2010, est2010] = _countESD(2010)
[esd2011, est2011] = _countESD(2011)
[esd2012, est2012] = _countESD(2012)
[esd2013, est2013] = _countESD(2013)
[esd2014, est2014] = _countESD(2014)
[esd2015, est2015] = _countESD(2015)
[esd2016, est2016] = _countESD(2016)
[esd2017, est2017] = _countESD(2017)
[esd2018, est2018] = _countESD(2018)
[esd2019, est2019] = _countESD(2019)
[esd2020, est2020] = _countESD(2020)
[esd2021, est2021] = _countESD(2021)
[esd2022, est2022] = _countESD(2022)
[esd2023, est2023] = _countESD(2023)
[esd2024, est2024] = _countESD(2024)
[esd2025, est2025] = _countESD(2025)
[esd2026, est2026] = _countESD(2026)
[esd2027, est2027] = _countESD(2027)
[esd2028, est2028] = _countESD(2028)
[esd2029, est2029] = _countESD(2029)
[esd2030, est2030] = _countESD(2030)

_getCounter(mode, yearTarget) =>
	out = mode == "esd" ? esd2019 : est2019
	out := yearTarget == 2030 ? (mode == "esd" ? esd2030 : est2030) : out
	out := yearTarget == 2029 ? (mode == "esd" ? esd2029 : est2029) : out
	out := yearTarget == 2028 ? (mode == "esd" ? esd2028 : est2028) : out
	out := yearTarget == 2027 ? (mode == "esd" ? esd2027 : est2027) : out
	out := yearTarget == 2026 ? (mode == "esd" ? esd2026 : est2026) : out
	out := yearTarget == 2025 ? (mode == "esd" ? esd2025 : est2025) : out
	out := yearTarget == 2024 ? (mode == "esd" ? esd2024 : est2024) : out
	out := yearTarget == 2023 ? (mode == "esd" ? esd2023 : est2023) : out
	out := yearTarget == 2022 ? (mode == "esd" ? esd2022 : est2022) : out
	out := yearTarget == 2021 ? (mode == "esd" ? esd2021 : est2021) : out
	out := yearTarget == 2020 ? (mode == "esd" ? esd2020 : est2020) : out
	out := yearTarget == 2019 ? (mode == "esd" ? esd2019 : est2019) : out
	out := yearTarget == 2018 ? (mode == "esd" ? esd2018 : est2018) : out
	out := yearTarget == 2017 ? (mode == "esd" ? esd2017 : est2017) : out
	out := yearTarget == 2016 ? (mode == "esd" ? esd2016 : est2016) : out
	out := yearTarget == 2015 ? (mode == "esd" ? esd2015 : est2015) : out
	out := yearTarget == 2014 ? (mode == "esd" ? esd2014 : est2014) : out
	out := yearTarget == 2013 ? (mode == "esd" ? esd2013 : est2013) : out
	out := yearTarget == 2012 ? (mode == "esd" ? esd2012 : est2012) : out
	out := yearTarget == 2011 ? (mode == "esd" ? esd2011 : est2011) : out
	out := yearTarget == 2010 ? (mode == "esd" ? esd2010 : est2010) : out
	out := yearTarget == 2009 ? (mode == "esd" ? esd2009 : est2009) : out
	out := yearTarget == 2008 ? (mode == "esd" ? esd2008 : est2008) : out
	out := yearTarget == 2007 ? (mode == "esd" ? esd2007 : est2007) : out
	out := yearTarget == 2006 ? (mode == "esd" ? esd2006 : est2006) : out
	out := yearTarget == 2005 ? (mode == "esd" ? esd2005 : est2005) : out
	out := yearTarget == 2004 ? (mode == "esd" ? esd2004 : est2004) : out
	out := yearTarget == 2003 ? (mode == "esd" ? esd2003 : est2003) : out
	out := yearTarget == 2002 ? (mode == "esd" ? esd2002 : est2002) : out
	out := yearTarget == 2001 ? (mode == "esd" ? esd2001 : est2001) : out
	out := yearTarget == 2000 ? (mode == "esd" ? esd2000 : est2000) : out
	out := yearTarget == 1999 ? (mode == "esd" ? esd1999 : est1999) : out
	out := yearTarget == 1998 ? (mode == "esd" ? esd1998 : est1998) : out
	out := yearTarget == 1997 ? (mode == "esd" ? esd1997 : est1997) : out
	out := yearTarget == 1996 ? (mode == "esd" ? esd1996 : est1996) : out
	out := yearTarget == 1995 ? (mode == "esd" ? esd1995 : est1995) : out
	out := yearTarget == 1994 ? (mode == "esd" ? esd1994 : est1994) : out
	out := yearTarget == 1993 ? (mode == "esd" ? esd1993 : est1993) : out
	out := yearTarget == 1992 ? (mode == "esd" ? esd1992 : est1992) : out
	out := yearTarget == 1991 ? (mode == "esd" ? esd1991 : est1991) : out
	out := yearTarget == 1990 ? (mode == "esd" ? esd1990 : est1990) : out
	out

// var end = 20
// var res = '';
// var shapePos = [0, 3, 5, 10, 15, 20];

// for (var i = 0; i <= end; i++) {
// 	var title = i == 0 ? 'Current' : `${ i }Y ago`;
// 	res = res.concat(`plot(_getCounter("esd", year - ${ i }), offset=(-${ i } * space), title="${ title }", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)\n`);
// 	res = res.concat(`plot(_getCounter("estimate", year - ${ i }), offset=(-${ i } * space), title="", style=plot.style_histogram, linewidth=width, color=estimateColor, show_last=1, transp=0, editable=false)\n\n`);

// 	if (shapePos.includes(i)) {
// 		res = res.concat(`plotshape(0, offset=(-${ i } * space), title="${ title }", text=" ${ i == 0 ? title : title.slice(0, -4) } ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)\n`)
// 	}
// }

plot(_getCounter("esd", year - 0), offset=(-0 * space), title="Current", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-0 * space), title="Current", text=" Current ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

plot(_getCounter("esd", year - 1), offset=(-1 * space), title="1Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 2), offset=(-2 * space), title="2Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 3), offset=(-3 * space), title="3Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-3 * space), title="3Y ago", text=" 3Y ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

plot(_getCounter("esd", year - 4), offset=(-4 * space), title="4Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 5), offset=(-5 * space), title="5Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-5 * space), title="5Y ago", text=" 5Y ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

plot(_getCounter("esd", year - 6), offset=(-6 * space), title="6Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 7), offset=(-7 * space), title="7Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 8), offset=(-8 * space), title="8Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 9), offset=(-9 * space), title="9Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 10), offset=(-10 * space), title="10Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-10 * space), title="10Y ago", text=" 10Y ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

plot(_getCounter("esd", year - 11), offset=(-11 * space), title="11Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 12), offset=(-12 * space), title="12Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 13), offset=(-13 * space), title="13Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 14), offset=(-14 * space), title="14Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 15), offset=(-15 * space), title="15Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-15 * space), title="15Y ago", text=" 15Y ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

plot(_getCounter("esd", year - 16), offset=(-16 * space), title="16Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 17), offset=(-17 * space), title="17Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 18), offset=(-18 * space), title="18Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 19), offset=(-19 * space), title="19Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 20), offset=(-20 * space), title="20Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-20 * space), title="20Y ago", text=" 20Y ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

##-- File Name: tradingview-pinescript-indicators-master/statistics/dividends_per_share_dps_yearly.pine | File No: 178 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/statistics/earnings_per_share_eps_yearly.pine | File No: 179 | Started --##
//@version=4
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Earnings per Share (EPS, Yearly) script may be freely distributed under the terms of GPL-3.0 license.
study("Earnings per Share (EPS, Yearly)")

width = input(title="Columns Width", defval=12)
space = input(title="Space Between Columns", defval=8)

esdColor = #ffb74d
estimateColor = color.new(color.blue, 85)
labelColor = #1e90ff
whiteColor = color.white

_id(type) =>
    out = "ESD_FACTSET:" + syminfo.prefix + ";" + syminfo.ticker + ";" + type
    out

id = _id("EARNINGS")
estimate = security(id, "D", open, true, lookahead=true)
esd = security(id, "D", close, true, lookahead=true)

_count(src, yearTarget) =>
	var float counter = na
	counter := year != year[1] and year == yearTarget ? 0 : counter[1]
	counter := year == yearTarget ? counter + (na(src) ? 0 : src) : counter

_countESD(yearTarget) =>
	esdCount = _count(esd, yearTarget)
	estimateCount = _count(estimate, yearTarget)
	[esdCount, estimateCount]

[esd1990, est1990] = _countESD(1990)
[esd1991, est1991] = _countESD(1991)
[esd1992, est1992] = _countESD(1992)
[esd1993, est1993] = _countESD(1993)
[esd1994, est1994] = _countESD(1994)
[esd1995, est1995] = _countESD(1995)
[esd1996, est1996] = _countESD(1996)
[esd1997, est1997] = _countESD(1997)
[esd1998, est1998] = _countESD(1998)
[esd1999, est1999] = _countESD(1999)
[esd2000, est2000] = _countESD(2000)
[esd2001, est2001] = _countESD(2001)
[esd2002, est2002] = _countESD(2002)
[esd2003, est2003] = _countESD(2003)
[esd2004, est2004] = _countESD(2004)
[esd2005, est2005] = _countESD(2005)
[esd2006, est2006] = _countESD(2006)
[esd2007, est2007] = _countESD(2007)
[esd2008, est2008] = _countESD(2008)
[esd2009, est2009] = _countESD(2009)
[esd2010, est2010] = _countESD(2010)
[esd2011, est2011] = _countESD(2011)
[esd2012, est2012] = _countESD(2012)
[esd2013, est2013] = _countESD(2013)
[esd2014, est2014] = _countESD(2014)
[esd2015, est2015] = _countESD(2015)
[esd2016, est2016] = _countESD(2016)
[esd2017, est2017] = _countESD(2017)
[esd2018, est2018] = _countESD(2018)
[esd2019, est2019] = _countESD(2019)
[esd2020, est2020] = _countESD(2020)
[esd2021, est2021] = _countESD(2021)
[esd2022, est2022] = _countESD(2022)
[esd2023, est2023] = _countESD(2023)
[esd2024, est2024] = _countESD(2024)
[esd2025, est2025] = _countESD(2025)
[esd2026, est2026] = _countESD(2026)
[esd2027, est2027] = _countESD(2027)
[esd2028, est2028] = _countESD(2028)
[esd2029, est2029] = _countESD(2029)
[esd2030, est2030] = _countESD(2030)

_getCounter(mode, yearTarget) =>
	out = mode == "esd" ? esd2019 : est2019
	out := yearTarget == 2030 ? (mode == "esd" ? esd2030 : est2030) : out
	out := yearTarget == 2029 ? (mode == "esd" ? esd2029 : est2029) : out
	out := yearTarget == 2028 ? (mode == "esd" ? esd2028 : est2028) : out
	out := yearTarget == 2027 ? (mode == "esd" ? esd2027 : est2027) : out
	out := yearTarget == 2026 ? (mode == "esd" ? esd2026 : est2026) : out
	out := yearTarget == 2025 ? (mode == "esd" ? esd2025 : est2025) : out
	out := yearTarget == 2024 ? (mode == "esd" ? esd2024 : est2024) : out
	out := yearTarget == 2023 ? (mode == "esd" ? esd2023 : est2023) : out
	out := yearTarget == 2022 ? (mode == "esd" ? esd2022 : est2022) : out
	out := yearTarget == 2021 ? (mode == "esd" ? esd2021 : est2021) : out
	out := yearTarget == 2020 ? (mode == "esd" ? esd2020 : est2020) : out
	out := yearTarget == 2019 ? (mode == "esd" ? esd2019 : est2019) : out
	out := yearTarget == 2018 ? (mode == "esd" ? esd2018 : est2018) : out
	out := yearTarget == 2017 ? (mode == "esd" ? esd2017 : est2017) : out
	out := yearTarget == 2016 ? (mode == "esd" ? esd2016 : est2016) : out
	out := yearTarget == 2015 ? (mode == "esd" ? esd2015 : est2015) : out
	out := yearTarget == 2014 ? (mode == "esd" ? esd2014 : est2014) : out
	out := yearTarget == 2013 ? (mode == "esd" ? esd2013 : est2013) : out
	out := yearTarget == 2012 ? (mode == "esd" ? esd2012 : est2012) : out
	out := yearTarget == 2011 ? (mode == "esd" ? esd2011 : est2011) : out
	out := yearTarget == 2010 ? (mode == "esd" ? esd2010 : est2010) : out
	out := yearTarget == 2009 ? (mode == "esd" ? esd2009 : est2009) : out
	out := yearTarget == 2008 ? (mode == "esd" ? esd2008 : est2008) : out
	out := yearTarget == 2007 ? (mode == "esd" ? esd2007 : est2007) : out
	out := yearTarget == 2006 ? (mode == "esd" ? esd2006 : est2006) : out
	out := yearTarget == 2005 ? (mode == "esd" ? esd2005 : est2005) : out
	out := yearTarget == 2004 ? (mode == "esd" ? esd2004 : est2004) : out
	out := yearTarget == 2003 ? (mode == "esd" ? esd2003 : est2003) : out
	out := yearTarget == 2002 ? (mode == "esd" ? esd2002 : est2002) : out
	out := yearTarget == 2001 ? (mode == "esd" ? esd2001 : est2001) : out
	out := yearTarget == 2000 ? (mode == "esd" ? esd2000 : est2000) : out
	out := yearTarget == 1999 ? (mode == "esd" ? esd1999 : est1999) : out
	out := yearTarget == 1998 ? (mode == "esd" ? esd1998 : est1998) : out
	out := yearTarget == 1997 ? (mode == "esd" ? esd1997 : est1997) : out
	out := yearTarget == 1996 ? (mode == "esd" ? esd1996 : est1996) : out
	out := yearTarget == 1995 ? (mode == "esd" ? esd1995 : est1995) : out
	out := yearTarget == 1994 ? (mode == "esd" ? esd1994 : est1994) : out
	out := yearTarget == 1993 ? (mode == "esd" ? esd1993 : est1993) : out
	out := yearTarget == 1992 ? (mode == "esd" ? esd1992 : est1992) : out
	out := yearTarget == 1991 ? (mode == "esd" ? esd1991 : est1991) : out
	out := yearTarget == 1990 ? (mode == "esd" ? esd1990 : est1990) : out
	out

// var end = 20
// var res = '';
// var shapePos = [0, 3, 5, 10, 15, 20];

// for (var i = 0; i <= end; i++) {
// 	var title = i == 0 ? 'Current' : `${ i }Y ago`;
// 	res = res.concat(`plot(_getCounter("esd", year - ${ i }), offset=(-${ i } * space), title="${ title }", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)\n`);
// 	res = res.concat(`plot(_getCounter("estimate", year - ${ i }), offset=(-${ i } * space), title="", style=plot.style_histogram, linewidth=width, color=estimateColor, show_last=1, transp=0, editable=false)\n\n`);

// 	if (shapePos.includes(i)) {
// 		res = res.concat(`plotshape(0, offset=(-${ i } * space), title="${ title }", text=" ${ i == 0 ? title : title.slice(0, -4) } ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)\n`)
// 	}
// }

plot(_getCounter("esd", year - 0), offset=(-0 * space), title="Current", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-0 * space), title="Current", text=" Current ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

plot(_getCounter("esd", year - 1), offset=(-1 * space), title="1Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 2), offset=(-2 * space), title="2Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 3), offset=(-3 * space), title="3Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-3 * space), title="3Y ago", text=" 3Y ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

plot(_getCounter("esd", year - 4), offset=(-4 * space), title="4Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 5), offset=(-5 * space), title="5Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-5 * space), title="5Y ago", text=" 5Y ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

plot(_getCounter("esd", year - 6), offset=(-6 * space), title="6Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 7), offset=(-7 * space), title="7Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 8), offset=(-8 * space), title="8Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 9), offset=(-9 * space), title="9Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 10), offset=(-10 * space), title="10Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-10 * space), title="10Y ago", text=" 10Y ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

plot(_getCounter("esd", year - 11), offset=(-11 * space), title="11Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 12), offset=(-12 * space), title="12Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 13), offset=(-13 * space), title="13Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 14), offset=(-14 * space), title="14Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 15), offset=(-15 * space), title="15Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-15 * space), title="15Y ago", text=" 15Y ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

plot(_getCounter("esd", year - 16), offset=(-16 * space), title="16Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 17), offset=(-17 * space), title="17Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 18), offset=(-18 * space), title="18Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 19), offset=(-19 * space), title="19Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 20), offset=(-20 * space), title="20Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-20 * space), title="20Y ago", text=" 20Y ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

##-- File Name: tradingview-pinescript-indicators-master/statistics/earnings_per_share_eps_yearly.pine | File No: 179 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/statistics/gaps_percent_size_distribution.pine | File No: 180 | Started --##
//@version=4
// Copyright (c) 2021-present, Alex Orekhov (everget)
// Gaps % Size Distribution script may be freely distributed under the terms of GPL-3.0 license.
var int MAX_OBJECTS_COUNT = 500
study("Gaps % Size Distribution", max_lines_count=MAX_OBJECTS_COUNT, max_labels_count=MAX_OBJECTS_COUNT)

var bool reboot = input(title="Reboot (Click in case of any error)", defval=false)
// var bool useDate = input(title="", defval=false, inline=dateInline)
// int startDate = input(title="Start Aggregation from", type=input.time, defval=timestamp("01 Jan 2019 00:00"), inline=dateInline)
var float binningStep = input(title="Binning Step", type=input.float, minval=0.0001, defval=0.25, step=0.005)
var int maxColumns = input(title="Columns Number (Max: 500)", minval=2, maxval=500, defval=300)
var int columnWidth = input(title="Columns Width", defval=12)
var bool showLabels = input(title="Show Labels", defval=true)
var int nthLabel = input(title="Show Each Nth Label", minval=1, defval=5)

//------------------------------------------------------------------------------

// var int firstTime = time
// startCondition = useDate ? time(timeframe.period) >= min(firstTime, startDate) : true

var color columnColor = #ffb74d
var color labelColor = #1e90ff
var color labelTextColor = color.white

var int sizeLimit = floor(maxColumns / 2)
var int[] posValues = array.new_int(sizeLimit, 0)
var label[] posLabels = array.new_label(sizeLimit, na)

var int[] negValues = array.new_int(sizeLimit, 0)
var label[] negLabels = array.new_label(sizeLimit, na)

//------------------------------------------------------------------------------

_roc(current, basis) =>
	out = 100 * (current / basis - 1)
	out

_str(value, decimals) =>
	out = tostring(value, "#")
	out :=
		 decimals == 1 ? tostring(value, "#.#") :
		 decimals == 2 ? tostring(value, "#.##") :
		 decimals == 3 ? tostring(value, "#.###") :
		 decimals == 4 ? tostring(value, "#.####") :
		 decimals == 5 ? tostring(value, "#.#####") :
		 decimals == 6 ? tostring(value, "#.######") :
		 decimals == 7 ? tostring(value, "#.#######") :
		 decimals == 8 ? tostring(value, "#.########") :
		 decimals == 9 ? tostring(value, "#.#########") :
		 decimals == 10 ? tostring(value, "#.##########") :
		 decimals == 11 ? tostring(value, "#.###########") :
		 decimals == 12 ? tostring(value, "#.############") :
		 decimals == 13 ? tostring(value, "#.#############") :
		 decimals == 14 ? tostring(value, "#.##############") :
		 decimals == 15 ? tostring(value, "#.###############") :
		 decimals == 16 ? tostring(value, "#.################") :
		 out
	out

_format(value1, value2, decimals) =>
	out = _str(value1, decimals) + "%" + "\n-\n" + _str(value2, decimals) + "%"
	out

_labelText(value1, value2) =>
	out =
		 binningStep < 0.001 ? _format(value1, value2, 4) :
		 binningStep < 0.01 ? _format(value1, value2, 3) : 
		 _format(value1, value2, 2)
	out

_line(x, y) =>
	barTime = time[x]
	line l = line.new(
		 x1=barTime,
		 y1=0,
		 x2=barTime,
		 y2=y,
		 xloc=xloc.bar_time,
		 width=columnWidth,
		 color=columnColor
		 )
	line.delete(l[1])
	out = l
	out

_label(x, y, side, labelText, tooltipText) =>
	barTime = time[x]
	labelStyle = side == -1 ? label.style_label_up : label.style_label_down
	label l = label.new(
		 x=barTime,
		 y=y,
		 xloc=xloc.bar_time,
		 tooltip=tooltipText,
		 text=labelText,
		 textcolor=labelTextColor,
		 color=labelColor,
		 style=labelStyle,
		 size=size.small
		 )
	label.delete(l[1])
	out = l
	out

//------------------------------------------------------------------------------

isGapUp = close[1] < open
isGapDown = close[1] > open
size = _roc(open, close[1])

if isGapUp// and startCondition
	for i = 0 to sizeLimit - 1
		if i * binningStep <= size and size < (i + 1) * binningStep
			array.set(posValues, i, array.get(posValues, i) + 1)

if isGapDown// and startCondition
	for i = 0 to sizeLimit - 1
		if -(i + 1) * binningStep < size and size <= -i * binningStep
			array.set(negValues, i, array.get(negValues, i) + 1)

if barstate.islast
	for i = 0 to array.size(posValues) - 1
		posStart = sizeLimit - i
		negStart = sizeLimit + 1 + i
	
		posValue = array.get(posValues, i)
		negValue = array.get(negValues, i)
	
		_line(posStart, posValue)
		_line(negStart, negValue)

		if showLabels
			posLabel = array.get(posLabels, i)
			posText = _labelText(i * binningStep, (i + 1) * binningStep)
			posTooltip = tostring(posValue, "#")
		
			negLabel = array.get(negLabels, i)
			negText = _labelText(-i * binningStep, -(i + 1) * binningStep)
			negTooltip = tostring(negValue, "#")

			if i % nthLabel == 0
				if na(negLabel)
					negLabel := _label(negStart, 0, -1, negText, negTooltip)
					array.set(negLabels, i, negLabel)
				else
					label.set_x(negLabel, time[negStart])
					label.set_text(negLabel, negText)
					label.set_tooltip(negLabel, negTooltip)

				if na(posLabel)
					posLabel := _label(posStart, 0, -1, posText, posTooltip)
					array.set(posLabels, i, posLabel)
				else
					label.set_x(posLabel, time[posStart])
					label.set_text(posLabel, posText)
					label.set_tooltip(posLabel, posTooltip)

##-- File Name: tradingview-pinescript-indicators-master/statistics/gaps_percent_size_distribution.pine | File No: 180 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/statistics/kendall_rank_correlation_coefficient.pine | File No: 181 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Kendall Rank Correlation Coefficient script may be freely distributed under the terms of GPL-3.0 license.
study("Kendall Rank Correlation Coefficient", shorttitle="Kendall Correlation")

length = input(title="Length", type=integer, defval=20)
sym1 = input(title="1st Symbol", type=symbol, defval="FX:AUDUSD")
sym2 = input(title="2nd Symbol", type=symbol, defval="FOREXCOM:XAUUSD")
src = input(title="Source", type=source, defval=close)

data1 = security(sym1, period, src)
data2 = security(sym2, period, src)

getKendall(data1, data2, length) =>
    totalPairs = length * (length - 1) / 2
    numerator = 0.0

    for i = 0 to length - 1
        for j = 0 to i
            numerator := numerator + sign(data1[i] - data1[j]) * sign(data2[i] - data2[j])

    numerator / totalPairs

kendallCorr = sym1 == sym2 ? 1 : getKendall(data1, data2, length)
pearsonCorr = correlation(data1, data2, length)

plot(kendallCorr, title="Kendall", color=orange, transp=0)
plot(pearsonCorr, title="Pearson", color=purple, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/statistics/kendall_rank_correlation_coefficient.pine | File No: 181 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/statistics/kurtosis_indicator.pine | File No: 182 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Kurtosis Indicator script may be freely distributed under the terms of the GPL-3.0 license.
study("Kurtosis Indicator", shorttitle="Kurtosis")

momentumLength = input(title="Momentum Length", type=integer, defval=3, minval=1)
fastMAInput = input(title="Fast MA", defval="EMA", options=["EMA", "SMA", "VWMA", "WMA"])
fastLength = input(title="Fast Length", type=integer, defval=66, minval=1)
fastSlowMAInput = input(title="Fast/Slow MA", defval="SMA", options=["EMA", "SMA", "VWMA", "WMA"])
fastSlowLength = input(title="Fast/Slow Length", type=integer, defval=3, minval=1)
src = input(title="Source", type=source, defval=close)

// Kurtosis
K = change(src, momentumLength) - change(src[1], momentumLength)

// Fast Kurtosis
FK = iff(fastMAInput == "EMA", ema(K, fastLength),
	 iff(fastMAInput == "SMA", sma(K, fastLength),
	 iff(fastMAInput == "VWMA", vwma(K, fastLength),
	 iff(fastMAInput == "WMA", wma(K, fastLength),
	 na))))

// Fast / Slow Kurtosis
FSK = iff(fastSlowMAInput == "EMA", ema(FK, fastSlowLength),
	 iff(fastSlowMAInput == "SMA", sma(FK, fastSlowLength),
	 iff(fastSlowMAInput == "VWMA", vwma(FK, fastSlowLength),
	 iff(fastSlowMAInput == "WMA", wma(FK, fastSlowLength),
	 na))))

hline(title="Zero Level", price=0, linestyle=dotted, color=gray)

plot(FK, title="Fast", linewidth=2, color=#ff9370, transp=0)
plot(FSK, title="Fast / Slow", linewidth=2, color=#6d1e7f, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/statistics/kurtosis_indicator.pine | File No: 182 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/statistics/linear_regression_all_data.pine | File No: 183 | Started --##
//@version=4
// Copyright (c) 2020-present, Alex Orekhov (everget)
// Linear Regression (All Data) script may be freely distributed under the terms of the GPL-3.0 license.
var int MAX_BARS_BACK = 5000
study("Linear Regression (All Data)", overlay=true, max_bars_back=MAX_BARS_BACK)

n = bar_index + 1

X = n
Y = input(title="Source", defval=close)

sumX = cum(X)
sumY = cum(Y)
sumX2 = cum(pow(X, 2))
sumY2 = cum(pow(Y, 2))
sumXY = cum(X * Y)

// Pearson correlation coefficient
r = (n * sumXY - sumX * sumY) / sqrt((n * sumY2 - pow(sumY, 2)) * (n * sumX2 - pow(sumX, 2)))

// Coefficient of determination
r2 = pow(r, 2)

meanX = sumX / n
meanY = sumY / n

slope = (n * sumXY - sumX * sumY) / (n * sumX2 - pow(sumX, 2))
intercept = meanY - slope * meanX

int startIndex = n > MAX_BARS_BACK ? int(n - MAX_BARS_BACK) : 0
startY = slope * startIndex + intercept
endY = slope * (n - 1) + intercept

var line regLine = na
if barstate.islast
    if na(regLine)
        regLine := line.new(startIndex, startY, bar_index, endY, width=2, extend=extend.none, color=color.orange)
    else
        line.set_xy1(regLine, startIndex, startY)
        line.set_xy2(regLine, bar_index, endY)
        na

//------------------------------------------------------------------------

// Formatter
_format(value, decimals) =>
	out = tostring(value, "#.#")
	out :=
		 decimals == 2 ? tostring(value, "#.##") :
		 decimals == 3 ? tostring(value, "#.###") :
		 decimals == 4 ? tostring(value, "#.####") :
		 decimals == 5 ? tostring(value, "#.#####") :
		 decimals == 6 ? tostring(value, "#.######") :
		 decimals == 7 ? tostring(value, "#.#######") :
		 decimals == 8 ? tostring(value, "#.########") :
		 decimals == 9 ? tostring(value, "#.#########") :
		 decimals == 10 ? tostring(value, "#.##########") :
		 decimals == 11 ? tostring(value, "#.###########") :
		 decimals == 12 ? tostring(value, "#.############") :
		 decimals == 13 ? tostring(value, "#.#############") :
		 decimals == 14 ? tostring(value, "#.##############") :
		 decimals == 15 ? tostring(value, "#.###############") :
		 decimals == 16 ? tostring(value, "#.################") :
		 out
	out

summaryText =
     " Slope: " + _format(slope, 6) +
     "\n Intercept: " + _format(intercept, 6) +
     "\n r: " + _format(r, 3) +
     "\n r2: " + _format(r2, 3)

var label summaryLabel = label.new(
	 x=time,
	 y=na,
	 xloc=xloc.bar_time,
	 text="",
	 textalign=text.align_left,
	 textcolor=color.white,
	 color=#1e90ff,
	 style=label.style_label_left,
	 size=size.small
	 )

label.set_text(summaryLabel, summaryText)
label.set_xy(summaryLabel, time + 10 * (time - time[1]), endY)

##-- File Name: tradingview-pinescript-indicators-master/statistics/linear_regression_all_data.pine | File No: 183 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/statistics/roi_return_on_investment.pine | File No: 184 | Started --##
//@version=4
// Copyright (c) 2020-present, Alex Orekhov (everget)
// Return on Investment (ROI) script may be freely distributed under the terms of GPL-3.0 license.
study("Return on Investment (ROI)", shorttitle="ROI", precision=2)

// mode = input(title="Display Mode", defval="Regular", options=["Regular", "Annualized"])

useDate = input(title="Use Specific Start Date ?", defval=true)
yearStart = input(title="Start Year", defval=2019)
monthStart = input(title="Start Month", minval=1, maxval=12, defval=1)
dayStart = input(title="Start Day", minval=1, maxval=31, defval=1)

tp = input(title="Profit Level, %", type=input.integer, defval=0, minval=0)
sl = input(title="Loss Level, %", type=input.integer, defval=0, maxval=0)

startTime = timestamp(yearStart, monthStart, dayStart, 0, 0)

index = float(na)
index := na(index[1]) ? valuewhen(time(timeframe.period) >= startTime, bar_index, 0) : index[1]

initialCond = useDate ? bar_index == index : bar_index == 0
initialRegular = valuewhen(initialCond, open, 0)
// initialAnnualized = valuewhen(initialCond, close, 0)

roiRegular = 100 * (close - initialRegular) / initialRegular

// bars = bar_index - index
// power = 1 / ((useDate ? (bars != 0 ? bars : 1) : bar_index) / 365)
// roiAnnualized = 100 * (pow(close / initialAnnualized, power) - 1)

roi = roiRegular //mode == "Regular" ? roiRegular : roiAnnualized
roiPlot = plot(roi, title="ROI, %", color=color.black)

transparent = color.new(color.white, 100)
roiColor = roi < 0 ? color.red : #09b71e
labelColor = #f9ce02
levelColor = #674ea7

bgcolor(year != year[1] ? #f57f17 : transparent, title="Year Separator", transp=60)

zeroPlot = plot(0, title="", style=plot.style_circles, linewidth=0, color=labelColor, editable=false)
hline(0, title="Zero Level", linestyle=hline.style_dotted, color=levelColor)

fill(roiPlot, zeroPlot, title="Base Background", color=roiColor, transp=80)

tpPlot = plot(tp, title="Profit", style=plot.style_circles, linewidth=0, color=labelColor, editable=false)
hline(tp, title="Profit Level", linestyle=hline.style_dotted, color=levelColor)

tpFillColor = tp > 0 and roi > tp ? #09b71e : transparent
fill(tpPlot, roiPlot, title="Profit Background", color=tpFillColor, transp=60)

slPlot = plot(sl, title="Loss", style=plot.style_circles, linewidth=0, color=labelColor, editable=false)
hline(sl, title="Loss Level", linestyle=hline.style_dotted, color=levelColor)

slFillColor = sl < 0 and roi < sl ? color.red : transparent
fill(slPlot, roiPlot, title="Loss Background", color=slFillColor, transp=60)

alertcondition(crossover(roi, tp), title="ROI Profit Level Crossover", message="ROI Profit Level Crossover")
alertcondition(crossunder(roi, sl), title="ROI Loss Level Crossunder", message="ROI Loss Level Crossunder")

##-- File Name: tradingview-pinescript-indicators-master/statistics/roi_return_on_investment.pine | File No: 184 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/statistics/ticker_performance_by_us_president.pine | File No: 185 | Started --##
//@version=6
// Copyright (c) 2020-present, Alex Orekhov (everget)
indicator('Presidents Performance')

width = input.int(title = 'Columns Width', minval = 1, defval = 15)
space = input.int(title = 'Space Between Columns', minval = 0, defval = 150)

var labelColor = #1e90ff
var labelTextColor = color.white
var labelStyle = shape.labelup
var labelLocation = location.absolute
var labelSize = size.small

t = time(timeframe.period)

_ts(y, m, d, h = 0, min = 0, s = 0) =>
    out = timestamp(y, m, d, h, min, s)
    out

_perf(presidency) =>
    var float start = na
    var float out = na
    start := na(start) and presidency ? open : start
    out := not na(start) and presidency ? 100 * (close - start) / start : out
    out

hline(0.0, title = 'Zero Level', linestyle = hline.style_dotted, color = #674ea7)

//------------------------------------------------------------------------------
// Donald Trump

trump2 = _perf(t > _ts(2025, 1, 20))
trump2Offset = 0

plot(trump2, offset = trump2Offset, title = 'Donald Trump', color = #f1625e, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(trump2, 0), offset = trump2Offset, title = 'Donald Trump', text = 'Trump', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// Joe Biden

biden = _perf(_ts(2021, 1, 20) <= t and t <= _ts(2025, 1, 20))
bidenOffset = trump2Offset - space

plot(biden, offset = bidenOffset, title = 'Joe Biden', color = #9966cc, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(biden, 0), offset = bidenOffset, title = 'Joe Biden', text = 'Biden', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// Donald Trump

trump = _perf(_ts(2017, 1, 20) <= t and t <= _ts(2021, 1, 20))
trumpOffset = bidenOffset - space

plot(trump, offset = trumpOffset, title = 'Donald Trump', color = #f1625e, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(trump, 0), offset = trumpOffset, title = 'Donald Trump', text = 'Trump', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// Barack Obama

obama = _perf(_ts(2009, 1, 20) <= t and t <= _ts(2017, 1, 20))
obamaOffset = trumpOffset - space

plot(obama, offset = obamaOffset, title = 'Barack Obama', color = #9ace73, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(obama, 0), offset = obamaOffset, title = 'Barack Obama', text = 'Obama', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// George W. Bush

gw_bush = _perf(_ts(2001, 1, 20) <= t and t <= _ts(2009, 1, 20))
gw_bushOffset = obamaOffset - space

plot(gw_bush, offset = gw_bushOffset, title = 'George W. Bush', color = #ffdf82, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(gw_bush, 0), offset = gw_bushOffset, title = 'George W. Bush', text = 'G. Bush', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// Bill Clinton

clinton = _perf(_ts(1993, 1, 20) <= t and t <= _ts(2001, 1, 20))
clintonOffset = gw_bushOffset - space

plot(clinton, offset = clintonOffset, title = 'Bill Clinton', color = #bb8954, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(clinton, 0), offset = clintonOffset, title = 'Bill Clinton', text = 'Clinton', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// George H. W. Bush

ghw_bush = _perf(_ts(1989, 1, 20) <= t and t <= _ts(1993, 1, 20))
ghw_bushOffset = clintonOffset - space

plot(ghw_bush, offset = ghw_bushOffset, title = 'George H. W. Bush', color = #4363d8, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(ghw_bush, 0), offset = ghw_bushOffset, title = 'George H. W. Bush', text = 'G. H. Bush', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// Ronald Reagan

reagan = _perf(_ts(1981, 1, 20) <= t and t <= _ts(1989, 1, 20))
reaganOffset = ghw_bushOffset - space

plot(reagan, offset = reaganOffset, title = 'Ronald Reagan', color = #c46c54, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(reagan, 0), offset = reaganOffset, title = 'Ronald Reagan', text = 'Reagan', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// Jimmy Carter

carter = _perf(_ts(1977, 1, 20) <= t and t <= _ts(1981, 1, 20))
carterOffset = reaganOffset - space

plot(carter, offset = carterOffset, title = 'Jimmy Carter', color = #5ec27c, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(carter, 0), offset = carterOffset, title = 'Jimmy Carter', text = 'Carter', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// Gerald Ford

ford = _perf(_ts(1974, 8, 9) <= t and t <= _ts(1977, 1, 20))
fordOffset = carterOffset - space

plot(ford, offset = fordOffset, title = 'Gerald Ford', color = #e6194b, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(ford, 0), offset = fordOffset, title = 'Gerald Ford', text = 'Ford', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// Richard Nixon

nixon = _perf(_ts(1969, 1, 20) <= t and t <= _ts(1974, 8, 9))
nixonOffset = fordOffset - space

plot(nixon, offset = nixonOffset, title = 'Richard Nixon', color = #3cb44b, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(nixon, 0), offset = nixonOffset, title = 'Richard Nixon', text = 'Nixon', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// Lyndon B. Johnson

johnson = _perf(_ts(1963, 11, 22) <= t and t <= _ts(1969, 1, 20))
johnsonOffset = nixonOffset - space

plot(johnson, offset = johnsonOffset, title = 'Lyndon B. Johnson', color = #ffe119, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(johnson, 0), offset = johnsonOffset, title = 'Lyndon B. Johnson', text = 'Johnson', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// John F. Kennedy

kennedy = _perf(_ts(1961, 1, 20) <= t and t <= _ts(1963, 11, 22))
kennedyOffset = johnsonOffset - space

plot(kennedy, offset = kennedyOffset, title = 'John F. Kennedy', color = #f58231, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(kennedy, 0), offset = kennedyOffset, title = 'John F. Kennedy', text = 'Kennedy', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// Dwight D. Eisenhower

eisenhower = _perf(_ts(1953, 1, 20) <= t and t <= _ts(1961, 1, 20))
eisenhowerOffset = kennedyOffset - space

plot(eisenhower, offset = eisenhowerOffset, title = 'Dwight D. Eisenhower', color = #008b8b, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(eisenhower, 0), offset = eisenhowerOffset, title = 'Dwight D. Eisenhower', text = 'Eisenhower', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// Harry S. Truman

truman = _perf(_ts(1945, 4, 12) <= t and t <= _ts(1953, 1, 20))
trumanOffset = eisenhowerOffset - space

plot(truman, offset = trumanOffset, title = 'Harry S. Truman', color = #5059a5, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(truman, 0), offset = trumanOffset, title = 'Harry S. Truman', text = 'Truman', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// Franklin D. Roosevelt

f_roosevelt = _perf(_ts(1933, 3, 4) <= t and t <= _ts(1945, 4, 12))
f_rooseveltOffset = trumanOffset - space

plot(f_roosevelt, offset = f_rooseveltOffset, title = 'Franklin D. Roosevelt', color = #b22222, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(f_roosevelt, 0), offset = f_rooseveltOffset, title = 'Franklin D. Roosevelt', text = 'F. Roosevelt', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// Herbert Hoover

hoover = _perf(_ts(1929, 3, 4) <= t and t <= _ts(1933, 3, 4))
hooverOffset = f_rooseveltOffset - space

plot(hoover, offset = hooverOffset, title = 'Herbert Hoover', color = #ffd700, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(hoover, 0), offset = hooverOffset, title = 'Herbert Hoover', text = 'Hoover', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// Calvin Coolidge

coolidge = _perf(_ts(1923, 8, 2) <= t and t <= _ts(1929, 3, 4))
coolidgeOffset = hooverOffset - space

plot(coolidge, offset = coolidgeOffset, title = 'Calvin Coolidge', color = #4b0082, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(coolidge, 0), offset = coolidgeOffset, title = 'Calvin Coolidge', text = 'Coolidge', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// Warren G. Harding

harding = _perf(_ts(1921, 3, 4) <= t and t <= _ts(1923, 8, 2))
hardingOffset = coolidgeOffset - space

plot(harding, offset = hardingOffset, title = 'Warren G. Harding', color = #c71585, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(harding, 0), offset = hardingOffset, title = 'Warren G. Harding', text = 'Harding', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// Woodrow Wilson

wilson = _perf(_ts(1913, 3, 4) <= t and t <= _ts(1921, 3, 4))
wilsonOffset = hardingOffset - space

plot(wilson, offset = wilsonOffset, title = 'Woodrow Wilson', color = #5f9ea0, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(wilson, 0), offset = wilsonOffset, title = 'Woodrow Wilson', text = 'Wilson', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// William Howard Taft

taft = _perf(_ts(1909, 3, 4) <= t and t <= _ts(1913, 3, 4))
taftOffset = wilsonOffset - space

plot(taft, offset = taftOffset, title = 'William Howard Taft', color = #b8860b, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(taft, 0), offset = taftOffset, title = 'William Howard Taft', text = 'Taft', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// Theodore Roosevelt

t_roosevelt = _perf(_ts(1901, 9, 14) <= t and t <= _ts(1909, 3, 4))
t_rooseveltOffset = taftOffset - space

plot(t_roosevelt, offset = t_rooseveltOffset, title = 'Theodore Roosevelt', color = #7e5233, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(t_roosevelt, 0), offset = t_rooseveltOffset, title = 'Theodore Roosevelt', text = 'T. Roosevelt', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// William McKinley

mckinley = _perf(_ts(1897, 3, 4) <= t and t <= _ts(1901, 9, 14))
mckinleyOffset = t_rooseveltOffset - space

plot(mckinley, offset = mckinleyOffset, title = 'William McKinley', color = #3d986a, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(mckinley, 0), offset = mckinleyOffset, title = 'William McKinley', text = 'McKinley', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// Grover Cleveland

cleveland = _perf(_ts(1893, 3, 4) <= t and t <= _ts(1897, 3, 4))
clevelandOffset = mckinleyOffset - space

plot(cleveland, offset = clevelandOffset, title = 'Grover Cleveland', color = #f45b10, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(cleveland, 0), offset = clevelandOffset, title = 'Grover Cleveland', text = 'Cleveland', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

##-- File Name: tradingview-pinescript-indicators-master/statistics/ticker_performance_by_us_president.pine | File No: 185 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/statistics/us_treasury_yields.pine | File No: 186 | Started --##
//@version=4
// Copyright (c) 2020-present, Alex Orekhov (everget)
// US Treasury Yields script may be freely distributed under the terms of GPL-3.0 license.
study("US Treasury Yields", format=format.price)

mode = input(title="Display Mode", defval="Columns", options=["Lines", "Columns"])
lineWidth = input(title="Lines Width", type=input.integer, defval=2)
columnWidth = input(title="Columns Width", type=input.integer, defval=12)
space = input(title="Space Between Columns", type=input.integer, defval=8)

//------------------------------------------------------------------------------

_get(sym) =>
	out = nz(security(sym, timeframe.period, close, barmerge.gaps_off, barmerge.lookahead_on))
	out

//------------------------------------------------------------------------------

modeLines = mode == "Lines"

labelColor = #1e90ff
textColor = color.white

US30Y = _get("TVC:US30Y")

plot(not modeLines ? US30Y : na, title="30Y, %", offset=(0 * space), color=#f1625e, style=plot.style_histogram, linewidth=columnWidth, show_last=1, editable=false)
plot(modeLines ? US30Y : na, title="30Y, %", color=#f1625e, linewidth=lineWidth, editable=false)
plotshape(not modeLines ? min(US30Y, 0) : na, offset=(0 * space), title="US30Y", text=" 30Y ", color=labelColor, textcolor=textColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

US10Y = _get("TVC:US10Y")

plot(not modeLines ? US10Y : na, title="10Y, %", offset=(-1 * space), color=#9ace73, style=plot.style_histogram, linewidth=columnWidth, show_last=1, editable=false)
plot(modeLines ? US10Y : na, title="10Y, %", color=#9ace73, linewidth=lineWidth, editable=false)
plotshape(not modeLines ? min(US10Y, 0) : na, offset=(-1 * space), title="US10Y", text=" 10Y ", color=labelColor, textcolor=textColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

US07Y = _get("TVC:US07Y")

plot(not modeLines ? US07Y : na, title="7Y, %", offset=(-2 * space), color=#ffdf82, style=plot.style_histogram, linewidth=columnWidth, show_last=1, editable=false)
plot(modeLines ? US07Y : na, title="7Y, %", color=#ffdf82, linewidth=lineWidth, editable=false)
plotshape(not modeLines ? min(US07Y, 0) : na, offset=(-2 * space), title="US07Y", text=" 7Y ", color=labelColor, textcolor=textColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

US05Y = _get("TVC:US05Y")

plot(not modeLines ? US05Y : na, title="5Y, %", offset=(-3 * space), color=#bb8954, style=plot.style_histogram, linewidth=columnWidth, show_last=1, editable=false)
plot(modeLines ? US05Y : na, title="5Y, %", color=#bb8954, linewidth=lineWidth, editable=false)
plotshape(not modeLines ? min(US05Y, 0) : na, offset=(-3 * space), title="US05Y", text=" 5Y ", color=labelColor, textcolor=textColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

US03Y = _get("TVC:US03Y")

plot(not modeLines ? US03Y : na, title="3Y, %", offset=(-4 * space), color=#4363d8, style=plot.style_histogram, linewidth=columnWidth, show_last=1, editable=false)
plot(modeLines ? US03Y : na, title="3Y, %", color=#4363d8, linewidth=lineWidth, editable=false)
plotshape(not modeLines ? min(US03Y, 0) : na, offset=(-4 * space), title="US03Y", text=" 3Y ", color=labelColor, textcolor=textColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

US02Y = _get("TVC:US02Y")

plot(not modeLines ? US02Y : na, title="2Y, %", offset=(-5 * space), color=#c46c54, style=plot.style_histogram, linewidth=columnWidth, show_last=1, editable=false)
plot(modeLines ? US02Y : na, title="2Y, %", color=#c46c54, linewidth=lineWidth, editable=false)
plotshape(not modeLines ? min(US02Y, 0) : na, offset=(-5 * space), title="US02Y", text=" 2Y ", color=labelColor, textcolor=textColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

US01Y = _get("TVC:US01Y")

plot(not modeLines ? US01Y : na, title="1Y, %", offset=(-6 * space), color=#5ec27c, style=plot.style_histogram, linewidth=columnWidth, show_last=1, editable=false)
plot(modeLines ? US01Y : na, title="1Y, %", color=#5ec27c, linewidth=lineWidth, editable=false)
plotshape(not modeLines ? min(US01Y, 0) : na, offset=(-6 * space), title="US01Y", text=" 1Y ", color=labelColor, textcolor=textColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

US06MY = _get("TVC:US06MY")

plot(not modeLines ? US06MY : na, title="6M, %", offset=(-7 * space), color=#e6194b, style=plot.style_histogram, linewidth=columnWidth, show_last=1, editable=false)
plot(modeLines ? US06MY : na, title="6M, %", color=#e6194b, linewidth=lineWidth, editable=false)
plotshape(not modeLines ? min(US06MY, 0) : na, offset=(-7 * space), title="US06MY", text=" 6M ", color=labelColor, textcolor=textColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

US03MY = _get("TVC:US03MY")

plot(not modeLines ? US03MY : na, title="3M, %", offset=(-8 * space), color=#3cb44b, style=plot.style_histogram, linewidth=columnWidth, show_last=1, editable=false)
plot(modeLines ? US03MY : na, title="3M, %", color=#3cb44b, linewidth=lineWidth, editable=false)
plotshape(not modeLines ? min(US03MY, 0) : na, offset=(-8 * space), title="US03MY", text=" 3M ", color=labelColor, textcolor=textColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

US02MY = _get("TVC:US02MY")

plot(not modeLines ? US02MY : na, title="2M, %", offset=(-9 * space), color=#ffe119, style=plot.style_histogram, linewidth=columnWidth, show_last=1, editable=false)
plot(modeLines ? US02MY : na, title="2M, %", color=#ffe119, linewidth=lineWidth, editable=false)
plotshape(not modeLines ? min(US02MY, 0) : na, offset=(-9 * space), title="US02MY", text=" 2M ", color=labelColor, textcolor=textColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

US01MY = _get("TVC:US01MY")

plot(not modeLines ? US01MY : na, title="1M, %", offset=(-10 * space), color=#f58231, style=plot.style_histogram, linewidth=columnWidth, show_last=1, editable=false)
plot(modeLines ? US01MY : na, title="1M, %", color=#f58231, linewidth=lineWidth, editable=false)
plotshape(not modeLines ? min(US01MY, 0) : na, offset=(-10 * space), title="US01MY", text=" 1M ", color=labelColor, textcolor=textColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

levelLabelColor = #f9ce02
levelColor = #674ea7

plot(0.0, title="", style=plot.style_circles, linewidth=0, color=levelLabelColor, editable=false)
hline(0.0, title="Zero Level", linestyle=hline.style_dotted, color=levelColor)

##-- File Name: tradingview-pinescript-indicators-master/statistics/us_treasury_yields.pine | File No: 186 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/statistics/ytd_year_to_date_percent_return.pine | File No: 187 | Started --##
//@version=4
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Year-to-Date (YTD) % Return script may be freely distributed under the terms of GPL-3.0 license.
study("Year-to-Date (YTD) % Return", shorttitle="YTD % Return", precision=2)

level1 = input(title="Level #1", type=input.integer, defval=0)
level2 = input(title="Level #2", type=input.integer, defval=0)
level3 = input(title="Level #3", type=input.integer, defval=0)
level4 = input(title="Level #4", type=input.integer, defval=0)
level5 = input(title="Level #5", type=input.integer, defval=0)
level6 = input(title="Level #6", type=input.integer, defval=0)

_ytd(yearTarget) =>
    yearCond = year != year[1]
    yearOpen = valuewhen(yearCond, open, yearTarget)
    ytd = 100 * (close - yearOpen) / yearOpen
    ytd

labelColor = #f9ce02
levelColor = #674ea7
transparent = color.new(color.white, 100)

ytd = _ytd(0)
ytdColor = ytd < 0 ? color.red : #09b71e
ytdPlot = plot(ytd, title="YTD, %", color=color.black)

zeroPlot = plot(0, title="", style=plot.style_circles, linewidth=0, color=labelColor, editable=false)
hline(0, title="Zero Level", linestyle=hline.style_dotted, color=levelColor)

fill(ytdPlot, zeroPlot, color=ytdColor, transp=80)

plot(level1, title="", style=plot.style_circles, linewidth=0, color=labelColor, editable=false)
hline(level1, title="Level #1", linestyle=hline.style_dotted, color=levelColor)

plot(level2, title="", style=plot.style_circles, linewidth=0, color=labelColor, editable=false)
hline(level2, title="Level #2", linestyle=hline.style_dotted, color=levelColor)

plot(level3, title="", style=plot.style_circles, linewidth=0, color=labelColor, editable=false)
hline(level3, title="Level #3", linestyle=hline.style_dotted, color=levelColor)

plot(level4, title="", style=plot.style_circles, linewidth=0, color=labelColor, editable=false)
hline(level4, title="Level #4", linestyle=hline.style_dotted, color=levelColor)

plot(level5, title="", style=plot.style_circles, linewidth=0, color=labelColor, editable=false)
hline(level5, title="Level #5", linestyle=hline.style_dotted, color=levelColor)

plot(level6, title="", style=plot.style_circles, linewidth=0, color=labelColor, editable=false)
hline(level6, title="Level #6", linestyle=hline.style_dotted, color=levelColor)

bgcolor(year != year[1] ? #f57f17 : transparent, title="Year Separator", transp=60)

alertcondition(crossover(ytd, level1), title="Level #1 Crossover", message="Level #1 Crossover!")
alertcondition(crossunder(ytd, level1), title="Level #1 Crossunder", message="Level #1 Crossunder!")

alertcondition(crossover(ytd, level2), title="Level #2 Crossover", message="Level #2 Crossover!")
alertcondition(crossunder(ytd, level2), title="Level #2 Crossunder", message="Level #2 Crossunder!")

alertcondition(crossover(ytd, level3), title="Level #3 Crossover", message="Level #3 Crossover!")
alertcondition(crossunder(ytd, level3), title="Level #3 Crossunder", message="Level #3 Crossunder!")

alertcondition(crossover(ytd, level4), title="Level #4 Crossover", message="Level #4 Crossover!")
alertcondition(crossunder(ytd, level4), title="Level #4 Crossunder", message="Level #4 Crossunder!")

alertcondition(crossover(ytd, level5), title="Level #5 Crossover", message="Level #5 Crossover!")
alertcondition(crossunder(ytd, level5), title="Level #5 Crossunder", message="Level #5 Crossunder!")

alertcondition(crossover(ytd, level6), title="Level #6 Crossover", message="Level #6 Crossover!")
alertcondition(crossunder(ytd, level6), title="Level #6 Crossunder", message="Level #6 Crossunder!")

##-- File Name: tradingview-pinescript-indicators-master/statistics/ytd_year_to_date_percent_return.pine | File No: 187 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/statistics/z_score.pine | File No: 188 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Z-Score script may be freely distributed under the terms of the GPL-3.0 license.
study("Z-Score", shorttitle="ZSC")

length = input(title="Length", type=integer, minval=1, defval=14)
stdevInput = input(title="Standard Deviation", defval="Sample", options=["Population", "Sample"])
src = input(title="Source", type=source, defval=close)

sampleStdev(src, length) =>
	dev = src - sma(src, length)
	variance = sum(dev * dev, length) / (length - 1)
	sqrt(variance)

selectedStdev = stdevInput == "Sample"
	 ? sampleStdev(src, length)
	 : stdev(src, length)

zsc = (src - sma(src, length)) / selectedStdev

zscColor = zsc > 2.0 ? #0ebb23 : zsc < -2.0 ? #ff0000 : #8e7cc3

plot(zsc, title="Z-Score", linewidth=2, color=zscColor, transp=0, style=line)

hline(title="Upper Band", price=2.0, linestyle=dotted, color=#e69138)
hline(0, title="Zero Level", linestyle=dotted, color=#989898)
hline(title="Lower Band", price=-2.0, linestyle=dotted, color=#e69138)

##-- File Name: tradingview-pinescript-indicators-master/statistics/z_score.pine | File No: 188 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/trailing_stops/chandelier_exit.pine | File No: 189 | Started --##
//@version=6
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Chandelier Exit script may be freely distributed under the terms of the GPL-3.0 license.
indicator('Chandelier Exit', shorttitle = 'CE', overlay = true)

const string calcGroup = 'Calculation'
length = input.int(22, title = 'ATR Period', group = calcGroup)
mult = input.float(3.0, step = 0.1, title = 'ATR Multiplier', group = calcGroup)
useClose = input.bool(true, title = 'Use Close Price for Extremums', group = calcGroup)

const string visualGroup = 'Visuals'
showLabels = input.bool(true, title = 'Show Buy/Sell Labels', group = visualGroup)
highlightState = input.bool(true, title = 'Highlight State', group = visualGroup)

const string alertGroup = 'Alerts'
awaitBarConfirmation = input.bool(true, title = 'Await Bar Confirmation', group = alertGroup)

//---

atr = mult * ta.atr(length)

longStop = (useClose ? ta.highest(close, length) : ta.highest(length)) - atr
longStopPrev = nz(longStop[1], longStop)
longStop := close[1] > longStopPrev ? math.max(longStop, longStopPrev) : longStop

shortStop = (useClose ? ta.lowest(close, length) : ta.lowest(length)) + atr
shortStopPrev = nz(shortStop[1], shortStop)
shortStop := close[1] < shortStopPrev ? math.min(shortStop, shortStopPrev) : shortStop

var int dir = 1
dir := close > shortStopPrev ? 1 : close < longStopPrev ? -1 : dir

const color textColor = color.white
const color longColor = color.green
const color shortColor = color.red
const color longFillColor = color.new(color.green, 85)
const color shortFillColor = color.new(color.red, 85)

buySignal = dir == 1 and dir[1] == -1
longStopPlot = plot(dir == 1 ? longStop : na, title = 'Long Stop', style = plot.style_linebr, linewidth = 2, color = longColor)
plotshape(buySignal ? longStop : na, title = 'Long Stop Start', location = location.absolute, style = shape.circle, size = size.tiny, color = longColor)
plotshape(buySignal and showLabels ? longStop : na, title = 'Buy Label', text = 'Buy', location = location.absolute, style = shape.labelup, size = size.tiny, color = longColor, textcolor = textColor)

sellSignal = dir == -1 and dir[1] == 1
shortStopPlot = plot(dir == 1 ? na : shortStop, title = 'Short Stop', style = plot.style_linebr, linewidth = 2, color = shortColor)
plotshape(sellSignal ? shortStop : na, title = 'Short Stop Start', location = location.absolute, style = shape.circle, size = size.tiny, color = shortColor)
plotshape(sellSignal and showLabels ? shortStop : na, title = 'Sell Label', text = 'Sell', location = location.absolute, style = shape.labeldown, size = size.tiny, color = shortColor, textcolor = textColor)

midPricePlot = plot(ohlc4, title = '', display = display.none, editable = false)

fill(midPricePlot, longStopPlot, title = 'Long State Filling', color = (highlightState and dir == 1 ? longFillColor : na))
fill(midPricePlot, shortStopPlot, title = 'Short State Filling', color = (highlightState and dir == -1 ? shortFillColor : na))

await = awaitBarConfirmation ? barstate.isconfirmed : true
alertcondition(dir != dir[1] and await, title = 'CE Direction Change', message = 'Chandelier Exit has changed direction, {{exchange}}:{{ticker}}')
alertcondition(buySignal and await, title = 'CE Buy', message = 'Chandelier Exit Buy, {{exchange}}:{{ticker}}')
alertcondition(sellSignal and await, title = 'CE Sell', message = 'Chandelier Exit Sell, {{exchange}}:{{ticker}}')

##-- File Name: tradingview-pinescript-indicators-master/trailing_stops/chandelier_exit.pine | File No: 189 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/trailing_stops/halftrend.pine | File No: 190 | Started --##
//@version=6
// Copyright (c) 2021-present, Alex Orekhov (everget)
// HalfTrend script may be freely distributed under the terms of the GPL-3.0 license.
indicator('HalfTrend', overlay = true)

const string calcGroup = 'Calculation'
amplitude = input.int(2, title = 'Amplitude', group = calcGroup)
channelDeviation = input.int(2, title = 'Channel Deviation', group = calcGroup)

const string visualGroup = 'Visuals'
showArrows = input.bool(true, title = 'Show Arrows', group = visualGroup)
showChannels = input.bool(true, title = 'Show Channels', group = visualGroup)
showLabels = input.bool(true, title = 'Show Buy/Sell Labels', group = visualGroup)

//---

var int trend = 0
var int nextTrend = 0
var float maxLowPrice = nz(low[1], low)
var float minHighPrice = nz(high[1], high)

var float up = 0.0
var float down = 0.0
float atrHigh = 0.0
float atrLow = 0.0
float arrowUp = na
float arrowDown = na

atr2 = ta.atr(100) / 2
dev = channelDeviation * atr2

highPrice = high[math.abs(ta.highestbars(amplitude))]
lowPrice = low[math.abs(ta.lowestbars(amplitude))]
highma = ta.sma(high, amplitude)
lowma = ta.sma(low, amplitude)

if nextTrend == 1
    maxLowPrice := math.max(lowPrice, maxLowPrice)

    if highma < maxLowPrice and close < nz(low[1], low)
        trend := 1
        nextTrend := 0
        minHighPrice := highPrice
        minHighPrice
else
    minHighPrice := math.min(highPrice, minHighPrice)

    if lowma > minHighPrice and close > nz(high[1], high)
        trend := 0
        nextTrend := 1
        maxLowPrice := lowPrice
        maxLowPrice

if trend == 0
    if not na(trend[1]) and trend[1] != 0
        up := na(down[1]) ? down : down[1]
        arrowUp := up - atr2
        arrowUp
    else
        up := na(up[1]) ? maxLowPrice : math.max(maxLowPrice, up[1])
        up
    atrHigh := up + dev
    atrLow := up - dev
    atrLow
else
    if not na(trend[1]) and trend[1] != 1
        down := na(up[1]) ? up : up[1]
        arrowDown := down + atr2
        arrowDown
    else
        down := na(down[1]) ? minHighPrice : math.min(minHighPrice, down[1])
        down
    atrHigh := down + dev
    atrLow := down - dev
    atrLow

ht = trend == 0 ? up : down

const color buyColor = color.blue
const color sellColor = color.red
const color textColor = color.white
const color buyFillColor = color.new(buyColor, 85)
const color sellFillColor = color.new(sellColor, 85)

htColor = trend == 0 ? buyColor : sellColor
htPlot = plot(ht, title = 'HalfTrend', linewidth = 2, color = htColor)

atrHighPlot = plot(showChannels ? atrHigh : na, title = 'ATR High', style = plot.style_circles, color = sellColor)
atrLowPlot = plot(showChannels ? atrLow : na, title = 'ATR Low', style = plot.style_circles, color = buyColor)

fill(htPlot, atrHighPlot, title = 'ATR High Ribbon', color = sellFillColor)
fill(htPlot, atrLowPlot, title = 'ATR Low Ribbon', color = buyFillColor)

buySignal = not na(arrowUp) and trend == 0 and trend[1] == 1
sellSignal = not na(arrowDown) and trend == 1 and trend[1] == 0

plotshape(showArrows and buySignal ? atrLow : na, title = 'Arrow Up', style = shape.triangleup, location = location.absolute, size = size.tiny, color = buyColor)
plotshape(showArrows and sellSignal ? atrHigh : na, title = 'Arrow Down', style = shape.triangledown, location = location.absolute, size = size.tiny, color = sellColor)

plotshape(showLabels and buySignal ? atrLow : na, title = 'Buy Label', text = 'Buy', location = location.absolute, style = shape.labelup, size = size.tiny, color = buyColor, textcolor = textColor)
plotshape(showLabels and sellSignal ? atrHigh : na, title = 'Sell Label', text = 'Sell', location = location.absolute, style = shape.labeldown, size = size.tiny, color = sellColor, textcolor = textColor)

alertcondition(buySignal, title = 'HalfTrend Buy', message = 'HalfTrend Buy, {{exchange}}:{{ticker}}')
alertcondition(sellSignal, title = 'HalfTrend Sell', message = 'HalfTrend Sell, {{exchange}}:{{ticker}}')

##-- File Name: tradingview-pinescript-indicators-master/trailing_stops/halftrend.pine | File No: 190 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/trailing_stops/nrtr_nick_rypock_trailing_reverse.pine | File No: 191 | Started --##
//@version=6
// Copyright (c) 2021-present, Alex Orekhov (everget)
// Nick Rypock Trailing Reverse (NRTR) script may be freely distributed under the terms of the GPL-3.0 license.
indicator('Nick Rypock Trailing Reverse', shorttitle = 'NRTR', overlay = true)

const string calcGroup = 'Calculation'
percentage = input.float(2, minval = 0, maxval = 100, step = 0.1, title = 'Coefficient of Correction, %', group = calcGroup) / 100

const string visualGroup = 'Visuals'
showLabels = input.bool(true, title = 'Show Buy/Sell Labels', group = visualGroup)
highlightState = input.bool(true, title = 'Highlight State', group = visualGroup)

//---

var int trend = 0
var float hp = close
var float lp = close
nrtr = close

if trend >= 0
    if close > hp
        hp := close
        hp
    nrtr := hp * (1 - percentage)
    if close <= nrtr
        trend := -1
        lp := close
        nrtr := lp * (1 + percentage)
        nrtr
else
    if close < lp
        lp := close
        lp
    nrtr := lp * (1 + percentage)
    if close > nrtr
        trend := 1
        hp := close
        nrtr := hp * (1 - percentage)
        nrtr

const color textColor = color.white
const color longColor = color.green
const color shortColor = color.red
const color longFillColor = color.new(color.green, 85)
const color shortFillColor = color.new(color.red, 85)

longStopPlot = plot(trend == 1 ? nrtr : na, title = 'Long Stop', style = plot.style_linebr, linewidth = 2, color = longColor)
buySignal = trend == 1 and trend[1] == -1
plotshape(buySignal ? nrtr : na, title = 'Long Stop Start', location = location.absolute, style = shape.circle, size = size.tiny, color = longColor)
plotshape(buySignal and showLabels ? nrtr : na, title = 'Buy Label', text = 'Buy', location = location.absolute, style = shape.labelup, size = size.tiny, color = longColor, textcolor = textColor)

shortStopPlot = plot(trend == 1 ? na : nrtr, title = 'Short Stop', style = plot.style_linebr, linewidth = 2, color = shortColor)
sellSignal = trend == -1 and trend[1] == 1
plotshape(sellSignal ? nrtr : na, title = 'Short Stop Start', location = location.absolute, style = shape.circle, size = size.tiny, color = shortColor)
plotshape(sellSignal and showLabels ? nrtr : na, title = 'Sell Label', text = 'Sell', location = location.absolute, style = shape.labeldown, size = size.tiny, color = shortColor, textcolor = textColor)

midPricePlot = plot(ohlc4, title = '', display = display.none, editable = false)

fill(midPricePlot, longStopPlot, title = 'Long State Filling', color = (highlightState and trend == 1 ? longFillColor : na))
fill(midPricePlot, shortStopPlot, title = 'Short State Filling', color = (highlightState and trend == -1 ? shortFillColor : na))

alertcondition(trend != trend[1], title = 'NRTR Direction Change', message = 'NRTR has changed direction, {{exchange}}:{{ticker}}')
alertcondition(buySignal, title = 'NRTR Buy', message = 'NRTR Buy, {{exchange}}:{{ticker}}')
alertcondition(sellSignal, title = 'NRTR Sell', message = 'NRTR Sell, {{exchange}}:{{ticker}}')

##-- File Name: tradingview-pinescript-indicators-master/trailing_stops/nrtr_nick_rypock_trailing_reverse.pine | File No: 191 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/trailing_stops/parabolic_sar.pine | File No: 192 | Started --##
//@version=6
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Parabolic SAR script may be freely distributed under the terms of the GPL-3.0 license.
indicator('Parabolic SAR', shorttitle = 'PSAR', overlay = true)

const string calcGroup = 'Calculation'
start = input.float(0.02, step = 0.001, title = 'Start', group = calcGroup)
increment = input.float(0.02, step = 0.001, title = 'Increment', group = calcGroup)
maximum = input.float(0.2, step = 0.01, title = 'Maximum', group = calcGroup)

const string visualGroup = 'Visuals'
width = input.int(2, minval = 1, title = 'Point Width', group = visualGroup)
showLabels = input.bool(true, title = 'Show Buy/Sell Labels', group = visualGroup)
highlightStartPoints = input.bool(true, title = 'Highlight Start Points', group = visualGroup)
highlightState = input.bool(true, title = 'Highlight State', group = visualGroup)

//---

psar = ta.sar(start, increment, maximum)
dir = psar < close ? 1 : -1

psarColor = dir == 1 ? #3388bb : #fdcc02
psarPlot = plot(psar, title = 'PSAR', style = plot.style_circles, linewidth = math.max(1, width), color = psarColor)

const color textColor = color.white
const color longColor = color.green
const color shortColor = color.red
const color longFillColor = color.new(color.green, 85)
const color shortFillColor = color.new(color.red, 85)

buySignal = dir == 1 and dir[1] == -1
plotshape(buySignal and highlightStartPoints ? psar : na, title = 'Long Start', location = location.absolute, style = shape.circle, size = size.tiny, color = longColor)
plotshape(buySignal and showLabels ? psar : na, title = 'Buy Label', text = 'Buy', location = location.absolute, style = shape.labelup, size = size.tiny, color = longColor, textcolor = textColor)

sellSignal = dir == -1 and dir[1] == 1
plotshape(sellSignal and highlightStartPoints ? psar : na, title = 'Short Start', location = location.absolute, style = shape.circle, size = size.tiny, color = shortColor)
plotshape(sellSignal and showLabels ? psar : na, title = 'Sell Label', text = 'Sell', location = location.absolute, style = shape.labeldown, size = size.tiny, color = shortColor, textcolor = textColor)

midPricePlot = plot(ohlc4, title = '', display = display.none, editable = false)

fillColor = highlightState ? (dir == 1 ? longFillColor : dir == -1 ? shortFillColor : na) : na
fill(midPricePlot, psarPlot, title = 'Trade State Filling', color = fillColor)

alertcondition(dir != dir[1], title = 'Direction Change', message = 'PSAR has changed direction, {{exchange}}:{{ticker}}')
alertcondition(buySignal, title = 'Long', message = 'PSAR Long, {{exchange}}:{{ticker}}')
alertcondition(sellSignal, title = 'Short', message = 'PSAR Sell, {{exchange}}:{{ticker}}')

##-- File Name: tradingview-pinescript-indicators-master/trailing_stops/parabolic_sar.pine | File No: 192 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/trailing_stops/supertrend.pine | File No: 193 | Started --##
//@version=6
// Copyright (c) 2019-present, Alex Orekhov (everget)
// SuperTrend script may be freely distributed under the terms of the GPL-3.0 license.
indicator('SuperTrend', overlay = true)

const string calcGroup = 'Calculation'
length = input.int(22, title = 'ATR Period', group = calcGroup)
mult = input.float(3, step = 0.1, title = 'ATR Multiplier', group = calcGroup)
src = input.source(hl2, title = 'Source', group = calcGroup)
wicks = input.bool(true, title = 'Take Wicks into Account', group = calcGroup)

const string visualGroup = 'Visuals'
showLabels = input.bool(true, title = 'Show Buy/Sell Labels', group = visualGroup)
highlightState = input.bool(true, title = 'Highlight State', group = visualGroup)

//---

atr = mult * ta.atr(length)

highPrice = wicks ? high : close
lowPrice = wicks ? low : close
doji4price = open == close and open == low and open == high

longStop = src - atr
longStopPrev = nz(longStop[1], longStop)

if longStop > 0
    if doji4price
        longStop := longStopPrev
        longStop
    else
        longStop := lowPrice[1] > longStopPrev ? math.max(longStop, longStopPrev) : longStop
        longStop
else
    longStop := longStopPrev
    longStop

shortStop = src + atr
shortStopPrev = nz(shortStop[1], shortStop)

if shortStop > 0
    if doji4price
        shortStop := shortStopPrev
        shortStop
    else
        shortStop := highPrice[1] < shortStopPrev ? math.min(shortStop, shortStopPrev) : shortStop
        shortStop
else
    shortStop := shortStopPrev
    shortStop

var int dir = 1
dir := dir == -1 and highPrice > shortStopPrev ? 1 : dir == 1 and lowPrice < longStopPrev ? -1 : dir

const color textColor = color.white
const color longColor = color.green
const color shortColor = color.red
const color longFillColor = color.new(color.green, 85)
const color shortFillColor = color.new(color.red, 85)

longStopPlot = plot(dir == 1 ? longStop : na, title = 'Long Stop', style = plot.style_linebr, linewidth = 2, color = longColor)
buySignal = dir == 1 and dir[1] == -1
plotshape(buySignal ? longStop : na, title = 'Long Stop Start', location = location.absolute, style = shape.circle, size = size.tiny, color = longColor)
plotshape(buySignal and showLabels ? longStop : na, title = 'Buy Label', text = 'Buy', location = location.absolute, style = shape.labelup, size = size.tiny, color = longColor, textcolor = textColor)

shortStopPlot = plot(dir == 1 ? na : shortStop, title = 'Short Stop', style = plot.style_linebr, linewidth = 2, color = shortColor)
sellSignal = dir == -1 and dir[1] == 1
plotshape(sellSignal ? shortStop : na, title = 'Short Stop Start', location = location.absolute, style = shape.circle, size = size.tiny, color = shortColor)
plotshape(sellSignal and showLabels ? shortStop : na, title = 'Sell Label', text = 'Sell', location = location.absolute, style = shape.labeldown, size = size.tiny, color = shortColor, textcolor = textColor)

midPricePlot = plot(ohlc4, title = '', display = display.none, editable = false)

fill(midPricePlot, longStopPlot, title = 'Long State Filling', color = (highlightState and dir == 1 ? longFillColor : na))
fill(midPricePlot, shortStopPlot, title = 'Short State Filling', color = (highlightState and dir == -1 ? shortFillColor : na))

alertcondition(dir != dir[1], title = 'SuperTrend Direction Change', message = 'SuperTrend has changed direction, {{exchange}}:{{ticker}}')
alertcondition(buySignal, title = 'SuperTrend Buy', message = 'SuperTrend Buy, {{exchange}}:{{ticker}}')
alertcondition(sellSignal, title = 'SuperTrend Sell', message = 'SuperTrend Sell, {{exchange}}:{{ticker}}')

##-- File Name: tradingview-pinescript-indicators-master/trailing_stops/supertrend.pine | File No: 193 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/utils/session_input_parser.pine | File No: 194 | Started --##
//@version=4
// Copyright (c) 2021-present, Alex Orekhov (everget)
// Session Input Parser script may be freely distributed under the terms of GPL-3.0 license.
study("Session Input Parser", overlay=true)

sessionSimple = input(title="Simple Session", type=input.session, defval="0800-1530")
sessionWithWeekdays = input(title="Session With Weekdays", type=input.session, defval="0800-1530:1234567")

_str_includes(str, char) =>
    tmp = str.replace_all(str, char, "")
    out = str.length(tmp) != str.length(str)
    out

_toint(str) =>
    out = int(tonumber(str))
    out

_parseSession(session) =>
    string sessionWithoutWeekdays = na
    string weekdaysPart = na
    bool hasWeekdays = false

    int hStart = na
    int mStart = na
    int hEnd = na
    int mEnd = na
    int[] weekdays = array.new_int(0)

    if _str_includes(session, ":")
        hasWeekdays := true
        sessionSplit = str.split(session, ":")
        sessionWithoutWeekdays := array.get(sessionSplit, 0)
        weekdaysPart := array.get(sessionSplit, 1)
    else
        sessionWithoutWeekdays := session

    hhmm_hhmm = str.split(sessionWithoutWeekdays, "")
    hStart := _toint(array.get(hhmm_hhmm, 0) + array.get(hhmm_hhmm, 1))
    mStart := _toint(array.get(hhmm_hhmm, 2) + array.get(hhmm_hhmm, 3))
    hEnd := _toint(array.get(hhmm_hhmm, 5) + array.get(hhmm_hhmm, 6))
    mEnd := _toint(array.get(hhmm_hhmm, 7) + array.get(hhmm_hhmm, 8))

    if hasWeekdays
        weekdaysSplit = str.split(weekdaysPart, "")

        for i = 0 to array.size(weekdaysSplit) - 1
            array.push(weekdays, _toint(array.get(weekdaysSplit, i)))
    [hStart, mStart, hEnd, mEnd, weekdays]

[hStart1, mStart1, hEnd1, mEnd1, weekdays1] = _parseSession(sessionSimple)
[hStart2, mStart2, hEnd2, mEnd2, weekdays2] = _parseSession(sessionWithWeekdays)

labelText =
     "Simple: " + sessionSimple + "\n"
     + "\nStart Hour: " + tostring(hStart1, "#")
     + "\nStart Minute: " + tostring(mStart1, "#")
     + "\nEnd Hour: " + tostring(hEnd1, "#")
     + "\nEnd Minute: " + tostring(mEnd1, "#")
     + "\nWeekdays: " + tostring(weekdays1)
     + "\n---------------------------------------------"
     + "\nWith weekdays: " + sessionWithWeekdays + "\n"
     + "\nStart Hour: " + tostring(hStart2, "#")
     + "\nStart Minute: " + tostring(mStart2, "#")
     + "\nEnd Hour: " + tostring(hEnd2, "#")
     + "\nEnd Minute: " + tostring(mEnd2, "#")
     + "\nWeekdays: " + tostring(weekdays2)

var label l = label.new(
     x=bar_index,
     y=na,
     text="",
     textalign=text.align_left,
     textcolor=color.white,
     color=color.blue,
     style=label.style_label_left,
     size=size.normal
     )

label.set_text(l, labelText)
label.set_xy(l, bar_index, ohlc4)

##-- File Name: tradingview-pinescript-indicators-master/utils/session_input_parser.pine | File No: 194 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/utils/unit_testing_framework.pine | File No: 195 | Started --##
//@version=5
// Copyright (c) 2021-present, Alex Orekhov (everget)
// Unit Testing Framework script may be freely distributed under the terms of GPL-3.0 license.
indicator("Unit Testing Framework", overlay=true)

// Unit Testing Framework Core {

// Constants and Globals {
var string UT_FRAMEWORK_VERSION = "1.0.0"

string[] _private_suites = array.new_string(0)
string[] _private_tests = array.new_string(0)
int[] _private_testStatuses = array.new_int(0)
int[] _private_testToSuiteMap = array.new_int(0)
//}

// public _describe() {
// A function to declare a test suite
_describe(suiteName) =>
	array.push(_private_suites, suiteName)
//}

// public _it() {
// A function to run a test
_it(specTitle, actual, expected) =>
	array.push(_private_testToSuiteMap, array.size(_private_suites) - 1)
	array.push(_private_tests, specTitle)
	array.push(_private_testStatuses, actual == expected ? 1 : -1)
//}

// public _test() {
// An alias for the _it() function
_test(specTitle, actual, expected) =>
	_it(specTitle, actual, expected)
//}

// public _xit() {
// Any spec declared with `xit` is marked as skipped.
// Their names will show up in the results as skipped
_xit(specTitle, actual, expected) =>
	array.push(_private_testToSuiteMap, array.size(_private_suites) - 1)
	array.push(_private_tests, specTitle)
	array.push(_private_testStatuses, 0)
//}

// public _xtest() {
// An alias for the _xit() function
_xtest(specTitle, actual, expected) =>
	_xit(specTitle, actual, expected)
//}

// _private_factorize() {
// An utility function to convert elements of both <bool|int|float|string|color|line|label|table|box> arrays into integers to make them sortable.
// The arrays must have the same type!
// The idea is partially taken from R: https://www.stat.berkeley.edu/~s133/factors.html
// Example:
//      _factorize(["a", "b", "c"], ["a", "b", "d"])
//      => [0, 1, 2], [0, 1, 3]
_private_factorize(id_1, id_2) =>
	size_1 = array.size(id_1)
	new_id_1 = array.new_int(array.size(id_1), 0)
	new_id_2 = array.new_int(array.size(id_2), 0)

	factors = array.new_int(0)
	elements = array.concat(array.copy(id_1), id_2)
	added_elements = array.copy(elements)
	array.clear(added_elements)
	size = array.size(elements)

	if size > 0
		for i = 0 to size - 1
			el = array.get(elements, i)
			int new_factor = na

			if array.includes(added_elements, el)
				index = array.indexof(added_elements, el)
				new_factor := array.get(factors, index)
			else
				array.push(added_elements, el)
				new_factor := array.size(factors) == 0 ? 0 : 1 + array.get(factors, array.size(factors) - 1)
				array.push(factors, new_factor)
				na

			if i < size_1
				array.set(new_id_1, i, new_factor)
			else
				array.set(new_id_2, i - size_1, new_factor)
	[new_id_1, new_id_2]
//}

// public _isEqual() {
// A function to compare <bool|int|float|string|color|line|label|table|box> arrays.
// Order of elements isn't matter
_isEqual(id_1, id_2) =>
	out = false

	if array.size(id_1) == array.size(id_2)
		out := true

		[factors_1, factors_2] = _private_factorize(id_1, id_2)
		array.sort(factors_1, order.ascending)
		array.sort(factors_2, order.ascending)

		for i = 0 to array.size(factors_1) - 1
			el_1 = array.get(factors_1, i)
			el_2 = array.get(factors_2, i)
			if el_1 != el_2
				out := false
				break
		out
	out
//}

// public _isStrictEqual() {
// A function to compare <bool|int|float|string|color|line|label|table|box> arrays.
// Order of elements is matter
_isStrictEqual(id_1, id_2) =>
	out = false

	if array.size(id_1) == array.size(id_2)
		out := true

		for i = 0 to array.size(id_1) - 1
			el_1 = array.get(id_1, i)
			el_2 = array.get(id_2, i)
			if el_1 != el_2
				out := false
				break
		out
	out
//}

// public _testReporter() {
// A function to output test results
_testReporter(caption = "") =>
	var string configGroup = "Config"
	showSuiteStatuses = input.bool(title="Show test suites statuses", defval=true, group=configGroup)
	showPassedTests = input.bool(title="Show passed tests", defval=true, group=configGroup)
	showFailedTests = input.bool(title="Show failed tests", defval=true, group=configGroup)
	showSkippedTests = input.bool(title="Show skipped tests", defval=true, group=configGroup)

	var string PASSED_ICON = "✔️"
	var string FAILED_ICON = "❌"
	var string SKIPPED_ICON = "⛔"
	
	var string NO_SUITES_WARNING = "Professor, your tests must be grouped into suites!"
	var string NO_TESTS_WARNING = "Write at least 1 test, professor!"
	var string NO_SUITES_AND_TESTS_WARNING = "You haven't write any suite with tests yet"
	var string warningMessage = ""

	string[] report = array.new_string(0)
	suitesCount = array.size(_private_suites)
	passedSuitesCount = 0
	failedSuitesCount = 0
	skippedSuitesCount = 0
	
	testsCount = array.size(_private_tests)
	passedTestsCount = 0
	failedTestsCount = 0
	skippedTestsCount = 0

	if suitesCount > 0
		if testsCount > 0
			lastTestIndex = 0

			for i = 0 to suitesCount - 1
				suite = array.get(_private_suites, i)
				array.push(report, suite + ":")
				suiteIndex = array.size(report) - 1

				passedTestsInSuite = 0
				failedTestsInSuite = 0
				skippedTestsInSuite = 0

				for j = lastTestIndex to testsCount - 1
					suiteId = array.get(_private_testToSuiteMap, j)

					if suiteId == i
						test = array.get(_private_tests, j)
						status = array.get(_private_testStatuses, j)

						if status == 1
							passedTestsInSuite += 1
							passedTestsCount += 1
							if showPassedTests
								array.push(report, "\t\t" + PASSED_ICON + " " + test)
						else if status == -1
							failedTestsInSuite += 1
							failedTestsCount += 1
							if showFailedTests
								array.push(report, "\t\t" + FAILED_ICON + " " + test)
						else
							skippedTestsInSuite += 1
							skippedTestsCount += 1
							if showSkippedTests
								array.push(report, "\t\t" + SKIPPED_ICON + " " + test)
					else
						lastTestIndex := j
						break

				if failedTestsInSuite != 0
					failedSuitesCount += 1
					if showSuiteStatuses
						array.set(report, suiteIndex, FAILED_ICON + " " + array.get(report, suiteIndex))
				else if passedTestsInSuite != 0
					passedSuitesCount += 1
					if showSuiteStatuses
						array.set(report, suiteIndex, PASSED_ICON + " " + array.get(report, suiteIndex))
				else if skippedTestsInSuite != 0
					skippedSuitesCount += 1
					if showSuiteStatuses
						array.set(report, suiteIndex, SKIPPED_ICON + " " + array.get(report, suiteIndex))

				array.push(report, "")
			""
		else
			warningMessage := NO_TESTS_WARNING
	else if testsCount > 0
		warningMessage := NO_SUITES_WARNING
	else
		warningMessage := NO_SUITES_AND_TESTS_WARNING

	reportText =
		 "Unit Testing Framework Version: " + UT_FRAMEWORK_VERSION
		 + "\n\n" + "Suites: "
				 + str.tostring(passedSuitesCount, "#") + " passed"
				 + ", " + str.tostring(failedSuitesCount, "#") + " failed"
				 + ", " + str.tostring(skippedSuitesCount, "#") + " skipped"
				 + ", " + str.tostring(suitesCount, "#") + " total"
		 + "\n" + "Tests: "
				 + str.tostring(passedTestsCount, "#") + " passed"
				 + ", " + str.tostring(failedTestsCount, "#") + " failed"
				 + ", " + str.tostring(skippedTestsCount, "#") + " skipped"
				 + ", " + str.tostring(testsCount, "#") + " total"
		 + "\n" + "-------------------------------------------------------"
		 + "\n\n" + (warningMessage == "" ? (caption != "" ? caption + "\n\n" : "") + array.join(report, "\n") : warningMessage)

	var string positionUp = "Up"
	var string positionDown = "Down"
	var string positionLeft = "Left"
	var string positionRight = "Right"
	var string positionLowerLeft = "Lower Left"
	var string positionLowerRight = "Lower Right"
	var string positionUpperLeft = "Upper Left"
	var string positionUpperRight = "Upper Right"
	var string positionCenter = "Center"

	reporterPositionInput = input.string(title="Reporter Position", defval=positionUpperLeft, options=[positionUp, positionDown, positionLeft, positionRight, positionLowerLeft, positionLowerRight, positionUpperLeft, positionUpperRight, positionCenter], group=configGroup)
	var string reporterPosition = 
		 reporterPositionInput == positionUp ? label.style_label_up :
		 reporterPositionInput == positionDown ? label.style_label_down :
		 reporterPositionInput == positionLeft ? label.style_label_left :
		 reporterPositionInput == positionRight ? label.style_label_right :
		 reporterPositionInput == positionLowerLeft ? label.style_label_lower_left :
		 reporterPositionInput == positionLowerRight ? label.style_label_lower_right :
		 reporterPositionInput == positionUpperLeft ? label.style_label_upper_left :
		 reporterPositionInput == positionUpperRight ? label.style_label_upper_right :
		 label.style_label_center

	var label l = label.new(
		 x=na,
		 y=na,
		 color=input.color(title="Reporter Background Color", defval=color.black, group=configGroup),
		 text="",
		 textalign=text.align_left,
		 textcolor=input.color(title="Reporter Text Color", defval=color.white, group=configGroup),
		 style=reporterPosition,
		 size=size.normal
		 )

	label.set_text(l, reportText)
	label.set_xy(l, bar_index + 1, ohlc4)
//}

//} End of Unit Testing Framework Core

//==============================================================================
//==============================================================================
// YOUR TESTS START HERE !!!

_sum(v1, v2) =>
	out = v1 + v2
	out

// TIP: You can collapse (fold) code fragments with tests reducing them to a single visible line {
_describe("_sum()")
_it("should sum two integers", _sum(1, 2), 3)
_it("should sum two decimals", _sum(1.1, 2.4), 3.5)
_it("should sum integer and decimal numbers", _sum(1, 0.01), 1.01)
// }

//------------------------------------------------------------------------------

_multiply(v1, v2) =>
	out = v1 * v2
	out

// TIP: You can collapse (fold) code fragments with tests reducing them to a single visible line {
_describe("_multiply()")
_it("should multiply two integers", _multiply(2, 3), 6)
_it("should multiply two decimals", _multiply(0.1, 0.2), 0.02)
_it("should multiply integers and decimals", _multiply(2, 0.3), 0.6)
// }

//------------------------------------------------------------------------------

_describe("An example suite with all types of test statuses")
_it("this test is passed", true, true)
_it("this test is failed", true, false)
_xit("this test is skipped", true, true)

//------------------------------------------------------------------------------

_describe("<- A suite with at least one failed test will be marked with the cross icon")
_it("this test is failed", true, false)

//------------------------------------------------------------------------------

_describe("<- A suite with all tests passed will be marked with the check mark icon")
_it("this test is passed", true, true)

//------------------------------------------------------------------------------

_describe("<- A suite with all tests skipped will be marked with the no-entry icon")
_xit("this test is skipped", true, false)

//------------------------------------------------------------------------------

_describe("_isEqual")
_it("int[] Arrays of the different size should not be equal", _isEqual(array.from(1, 2, 3), array.from(3, 1)), false)
_it("int[] Arrays of the same size with the same elements should be equal", _isEqual(array.from(1, 2, 3), array.from(3, 1, 2)), true)
_it("int[] Arrays of the same size with different elements should not be equal", _isEqual(array.from(1, 2, 3), array.from(4, 5, 6)), false)

_it("float[] Arrays of the different size should not be equal", _isEqual(array.from(1.61803, 1.73205, 2.23606), array.from(2.71828, 3.14159)), false)
_it("float[] Arrays of the same size with the same elements should be equal", _isEqual(array.from(1.61803, 1.73205, 2.23606), array.from(2.23606, 1.61803, 1.73205)), true)
_it("float[] Arrays of the same size with different elements should not be equal", _isEqual(array.from(1.61803, 1.73205, 2.23606), array.from(2.71828, 3.14159, 2.289202)), false)

_it("bool[] Arrays of the different size should not be equal", _isEqual(array.from(true), array.from(true, true)), false)
_it("bool[] Arrays of the same size with the same elements should be equal", _isEqual(array.from(true, false, true), array.from(false, true, true)), true)
_it("bool[] Arrays of the same size with different elements should not be equal", _isEqual(array.from(true, true), array.from(false, false)), false)

_it("string[] Arrays of the different size should not be equal", _isEqual(array.from("Jeszcze", "Polska", "nie", "zginęła!"), array.from("Жыве", "Беларусь!")), false)
_it("string[] Arrays of the same size with the same elements should be equal", _isEqual(array.from("kiełba", "bimber", "pierogi"), array.from("pierogi", "kiełba", "bimber")), true)
_it("string[] Arrays of the same size with different elements should not be equal", _isEqual(array.from("a", "b", "c"), array.from("d", "e", "f")), false)

_it("color[] Arrays of the different size should not be equal", _isEqual(array.from(color.red, color.green, color.blue), array.from(#11111f, #000000)), false)
_it("color[] Arrays of the same size with the same elements should be equal", _isEqual(array.from(color.red, color.green, color.blue), array.from(color.blue, color.red, color.green)), true)
_it("color[] Arrays of the same size with different elements should not be equal", _isEqual(array.from(color.red, color.green, color.blue), array.from(color.purple, color.orange, color.teal)), false)

// TIP: If your methods/functions require some setup it is good to wrap tests in a function and then call it
_suite_isEqual_lines() =>
	line line0 = na
	line line1 = na
	line line2 = na
	line line3 = na
	line line4 = na
	line line5 = na

	if barstate.islast
		line0 := line.new(bar_index, na, bar_index, na, color=color.new(color.white, 100))
		line.delete(line0[1])

		line1 := line.new(bar_index + 1, na, bar_index + 2, na, color=color.new(color.white, 100))
		line.delete(line1[1])

		line2 := line.new(bar_index + 2, na, bar_index + 3, na, color=color.new(color.white, 100))
		line.delete(line2[1])

		line3 := line.new(bar_index + 3, na, bar_index + 4, na, color=color.new(color.white, 100))
		line.delete(line3[1])

		line4 := line.new(bar_index + 4, na, bar_index + 5, na, color=color.new(color.white, 100))
		line.delete(line4[1])

		line5 := line.new(bar_index + 5, na, bar_index + 6, na, color=color.new(color.white, 100))
		line.delete(line5[1])

	_it("lines[] Arrays of the different size should not be equal", _isEqual(array.from(line0, line1, line2), array.from(line0, line1)), false)
	_it("lines[] Arrays of the same size with the same elements should be equal", _isEqual(array.from(line0, line1, line2), array.from(line2, line0, line1)), true)
	_it("lines[] Arrays of the same size with different elements should not be equal", _isEqual(array.from(line0, line1, line2), array.from(line3, line4, line5)), false)
_suite_isEqual_lines()

// TIP: If your methods/functions require some setup it is good to wrap tests in a function and then call it
_suite_isEqual_labels() =>
	label label0 = na
	label label1 = na
	label label2 = na
	label label3 = na
	label label4 = na
	label label5 = na

	if barstate.islast
		label0 := label.new(bar_index, na, color=color.new(color.white, 100))
		label.delete(label0[1])

		label1 := label.new(bar_index + 1, na, color=color.new(color.white, 100))
		label.delete(label1[1])

		label2 := label.new(bar_index + 2, na, color=color.new(color.white, 100))
		label.delete(label2[1])

		label3 := label.new(bar_index + 3, na, color=color.new(color.white, 100))
		label.delete(label3[1])

		label4 := label.new(bar_index + 4, na, color=color.new(color.white, 100))
		label.delete(label4[1])

		label5 := label.new(bar_index + 5, na, color=color.new(color.white, 100))
		label.delete(label5[1])

	_it("label[] Arrays of the different size should not be equal", _isEqual(array.from(label0, label1, label2), array.from(label0, label1)), false)
	_it("label[] Arrays of the same size with the same elements should be equal", _isEqual(array.from(label0, label1, label2), array.from(label2, label0, label1)), true)
	_it("label[] Arrays of the same size with different elements should not be equal", _isEqual(array.from(label0, label1, label2), array.from(label3, label4, label5)), false)
_suite_isEqual_labels()

//------------------------------------------------------------------------------

_describe("_isStrictEqual")
_it("int[] Different size", _isStrictEqual(array.from(1, 2, 3), array.from(3, 1)), false)
_it("int[] Same size | same elements | same order", _isStrictEqual(array.from(1, 2, 3), array.from(1, 2, 3)), true)
_it("int[] Same size | same elements | different order", _isStrictEqual(array.from(1, 2, 3), array.from(3, 2, 1)), false)
_it("int[] Same size | different elements", _isStrictEqual(array.from(1, 2, 3), array.from(4, 5, 6)), false)

_it("float[] Different size", _isStrictEqual(array.from(1.61803, 1.73205, 2.23606), array.from(2.71828, 3.14159)), false)
_it("float[] Same size | same elements | same order", _isStrictEqual(array.from(1.61803, 1.73205, 2.23606), array.from(1.61803, 1.73205, 2.23606)), true)
_it("float[] Same size | same elements | different order", _isStrictEqual(array.from(1.61803, 1.73205, 2.23606), array.from(2.23606, 1.61803, 1.73205)), false)
_it("float[] Same size | different elements", _isStrictEqual(array.from(1.61803, 1.73205, 2.23606), array.from(2.71828, 3.14159, 2.289202)), false)

_it("bool[] Different size", _isStrictEqual(array.from(true), array.from(true, true)), false)
_it("bool[] Same size | same elements | same order", _isStrictEqual(array.from(true, false, true), array.from(true, false, true)), true)
_it("bool[] Same size | same elements | different order", _isStrictEqual(array.from(true, false, true), array.from(false, true, true)), false)
_it("bool[] Same size | different elements", _isStrictEqual(array.from(true, true), array.from(false, false)), false)

_it("string[] Different size", _isStrictEqual(array.from("Jeszcze", "Polska", "nie", "zginęła!"), array.from("Жыве", "Беларусь!")), false)
_it("string[] Same size | same elements | same order", _isStrictEqual(array.from("Слава Україні!", "Жыве Беларусь!", "Живела Србија!"), array.from("Слава Україні!", "Жыве Беларусь!", "Живела Србија!")), true)
_it("string[] Same size | same elements | different order", _isStrictEqual(array.from("kiełba", "bimber", "pierogi"), array.from("pierogi", "kiełba", "bimber")), false)
_it("string[] Same size | different elements", _isStrictEqual(array.from("a", "b", "c"), array.from("d", "e", "f")), false)

_it("color[] Different size", _isStrictEqual(array.from(color.red, color.green, color.blue), array.from(#11111f, #000000)), false)
_it("color[] Same size | same elements | same order", _isStrictEqual(array.from(color.red, color.green, color.blue), array.from(color.red, color.green, color.blue)), true)
_it("color[] Same size | same elements | different order", _isStrictEqual(array.from(color.red, color.green, color.blue), array.from(color.blue, color.red, color.green)), false)
_it("color[] Same size | different elements", _isStrictEqual(array.from(color.red, color.green, color.blue), array.from(color.purple, color.orange, color.teal)), false)

// TIP: If your methods/functions require some setup it is good to wrap tests in a function and then call it
_suite_isStrictEqual_lines() =>
	var color noneColor = color.new(color.white, 100)
	line line0 = na
	line line1 = na
	line line2 = na
	line line3 = na
	line line4 = na
	line line5 = na

	if barstate.islast
		line0 := line.new(bar_index, na, bar_index, na, color=noneColor)
		line.delete(line0[1])

		line1 := line.new(bar_index + 1, na, bar_index + 2, na, color=noneColor)
		line.delete(line1[1])

		line2 := line.new(bar_index + 2, na, bar_index + 3, na, color=noneColor)
		line.delete(line2[1])

		line3 := line.new(bar_index + 3, na, bar_index + 4, na, color=noneColor)
		line.delete(line3[1])

		line4 := line.new(bar_index + 4, na, bar_index + 5, na, color=noneColor)
		line.delete(line4[1])

		line5 := line.new(bar_index + 5, na, bar_index + 6, na, color=noneColor)
		line.delete(line5[1])

	_it("lines[] Different size", _isStrictEqual(array.from(line0, line1, line2), array.from(line2, line0)), false)
	_it("lines[] Same size | same elements | same order", _isStrictEqual(array.from(line0, line1, line2), array.from(line0, line1, line2)), true)
	_it("lines[] Same size | same elements | different order", _isStrictEqual(array.from(line0, line1, line2), array.from(line2, line1, line0)), false)
	_it("lines[] Same size | different elements", _isStrictEqual(array.from(line0, line1, line2), array.from(line3, line4, line5)), false)
_suite_isStrictEqual_lines()

// TIP: If your methods/functions require some setup it is good to wrap tests in a function and then call it
_suite_isStrictEqual_labels() =>
	var color noneColor = color.new(color.white, 100)
	label label0 = na
	label label1 = na
	label label2 = na
	label label3 = na
	label label4 = na
	label label5 = na

	if barstate.islast
		label0 := label.new(bar_index, na, color=noneColor)
		label.delete(label0[1])

		label1 := label.new(bar_index + 1, na, color=noneColor)
		label.delete(label1[1])

		label2 := label.new(bar_index + 2, na, color=noneColor)
		label.delete(label2[1])

		label3 := label.new(bar_index + 3, na, color=noneColor)
		label.delete(label3[1])

		label4 := label.new(bar_index + 4, na, color=noneColor)
		label.delete(label4[1])

		label5 := label.new(bar_index + 5, na, color=noneColor)
		label.delete(label5[1])

	_it("labels[] Different size", _isStrictEqual(array.from(label0, label1, label2), array.from(label2, label0)), false)
	_it("labels[] Same size | same elements | same order", _isStrictEqual(array.from(label0, label1, label2), array.from(label0, label1, label2)), true)
	_it("labels[] Same size | same elements | different order", _isStrictEqual(array.from(label0, label1, label2), array.from(label2, label1, label0)), false)
	_it("labels[] Same size | different elements", _isStrictEqual(array.from(label0, label1, label2), array.from(label3, label4, label5)), false)
_suite_isStrictEqual_labels()

//==============================================================================
//==============================================================================

// ATTENTION: We need to call the reporter function to see test resuts
_testReporter("<This is an optional caption that may contain your library name and version.\nUse empty string if you don't need the caption\nor call the _testReporter function without any arguments>")

##-- File Name: tradingview-pinescript-indicators-master/utils/unit_testing_framework.pine | File No: 195 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/volatility/damping_index.pine | File No: 196 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Damping Index script may be freely distributed under the terms of GPL-3.0 license.
study("Damping Index", shorttitle="DI")

smaLength = input(title="SMA Length", type=integer, defval=5)
threshold = input(title="Threshold", type=float, step=0.1, defval=1.5)

sma = sma(high - low, smaLength)

di = sma[1] / sma[6]

diColor = di >= threshold ? #ff9800 : #3c78d8
plot(di, color=diColor, transp=0)

hline(threshold, title="Threshold", linestyle=dotted)

breakoutFillColor = di >= threshold ? #ff9800 : color(white, 100)
bgcolor(breakoutFillColor, transp=90)

##-- File Name: tradingview-pinescript-indicators-master/volatility/damping_index.pine | File No: 196 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/volatility/gopalakrishnan_range_index.pine | File No: 197 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Gopalakrishnan Range Index script may be freely distributed under the terms of GPL-3.0 license.
study("Gopalakrishnan Range Index", shorttitle="GAPO")

length = input(title="Length", type=integer, defval=5)

gapo = log(highest(length) - lowest(length)) / log(length)

gapoColor = gapo >= gapo[1] ? #0ebb23 : red
plot(gapo, title="GAPO", linewidth=2, color=gapoColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/volatility/gopalakrishnan_range_index.pine | File No: 197 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/volatility/mayer_multiple.pine | File No: 198 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Mayer Multiple script may be freely distributed under the terms of GPL-3.0 license.
study("Mayer Multiple", shorttitle="MM")

smaLength = input(title="SMA Length", type=integer, defval=200)
threshold = input(title="Threshold", type=float, step=0.1, defval=2.4)

price = nz(security("BTCUSD", period, close))

mm = price / sma(price, smaLength)

mmColor = mm > threshold ? #ff9800 : #3c78d8
plot(mm, color=mmColor, transp=0)

hline(threshold, title="Threshold", linestyle=dotted)

breakoutFillColor = mm > threshold ? #ff9800 : color(white, 100)
bgcolor(breakoutFillColor, transp=90)

##-- File Name: tradingview-pinescript-indicators-master/volatility/mayer_multiple.pine | File No: 198 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/volatility/normalized_average_true_range.pine | File No: 199 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Normalized Average True Range script may be freely distributed under the terms of GPL-3.0 license.
study("Normalized Average True Range", shorttitle="NATR")

length = input(title="Length", type=integer, defval=14)

natr = 100 * atr(length) / close

plot(natr, color=#ff9800, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/volatility/normalized_average_true_range.pine | File No: 199 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/volatility/ulcer_index.pine | File No: 200 | Started --##
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Ulcer Index script may be freely distributed under the terms of GPL-3.0 license.
study("Ulcer Index")

length = input(title="Length", type=input.integer, defval=14)
smoothLength = input(title="Smoothing Length", type=input.integer, defval=14)
breakout = input(title="Breakout Level", type=input.float, step=0.1, defval=1.5)
signalType = input(title="Signal Smoothing Type", defval="SMA", options=["EMA", "SMA"])
signalLength = input(title="Signal Smoothing Length", type=input.integer, defval=52)
src = input(title="Source", type=input.source, defval=close)
showSignal = input(title="Show Signal ?", type=input.bool, defval=true)
highlightCrossovers = input(title="Highlight Signal Crossovers ?", type=input.bool, defval=true)
applyRibbonFilling = input(title="Apply Ribbon Filling ?", type=input.bool, defval=true)

highest = highest(src, length)
drawdown = 100 * (src - highest) / highest
ulcer = sqrt(sma(pow(drawdown, 2), smoothLength))
signal = signalType == "SMA" ? sma(ulcer, signalLength) : ema(ulcer, signalLength)

trendColor = ulcer > signal ? #0ebb23 : color.red
ulcerColor = applyRibbonFilling ? trendColor : (ulcer >= ulcer[1] ? #0ebb23 : color.red)
signalColor = applyRibbonFilling ? trendColor : #1155cc

ulcerPlot = plot(ulcer, title="Ulcer", linewidth=2, color=ulcerColor, transp=0)
signalPlot = plot(showSignal ? signal : na, title="Signal", color=signalColor, transp=0)

ribbonFillColor = applyRibbonFilling ? trendColor : na
fill(ulcerPlot, signalPlot, title="Ribbon", color=ribbonFillColor, transp=70)

plotshape(crossover(ulcer, signal) and highlightCrossovers ? signal : na, title="Crossover", location=location.absolute, style=shape.circle, size=size.tiny, color=color.green, transp=0)
plotshape(crossunder(ulcer, signal) and highlightCrossovers ? signal : na, title="Crossunder", location=location.absolute, style=shape.circle, size=size.tiny, color=color.red, transp=0)

hline(breakout, title="Breakout Level", linestyle=hline.style_dotted, linewidth=2)
breakoutFillColor = ulcer > breakout ? #ff9800 : na
bgcolor(breakoutFillColor, transp=90)

##-- File Name: tradingview-pinescript-indicators-master/volatility/ulcer_index.pine | File No: 200 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/volatility/volatility_ratio.pine | File No: 201 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Volatility Ratio script may be freely distributed under the terms of the GPL-3.0 license.
study("Volatility Ratio", shorttitle="VR")

length = input(title="Length", type=integer, minval=1, defval=14)
breakoutLevel = input(title="Breakout Level", type=float, step=0.1, defval=0.5)

max = max(highest(high, length), close[length + 1])
min = min(lowest(low, length), close[length + 1])

vr = tr(true) / (max - min)

vrColor = vr >= breakoutLevel ? #39b361 : #cc4125

plot(vr, title="VR", linewidth=2, color=vrColor, transp=0)

hline(title="Breakout Level", price=breakoutLevel, linestyle=dotted, color=gray)

##-- File Name: tradingview-pinescript-indicators-master/volatility/volatility_ratio.pine | File No: 201 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/volume/accumulation_distribution_line.pine | File No: 202 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Accumulation/Distribution Line script may be freely distributed under the terms of GPL-3.0 license.
study("Accumulation/Distribution Line", shorttitle="Accum/Dist", precision=0)

showSignal = input(title="Show Signal ?", type=bool, defval=true)
signalType = input(title="Signal Smoothing Type", defval="SMA", options=["EMA", "SMA"])
signalLength = input(title="Signal Smoothing Length", type=integer, defval=21)
highlightCrossovers = input(title="Highlight Crossovers ?", type=bool, defval=false)
applyFilling = input(title="Apply Ribbon Filling ?", type=bool, defval=true)

signal = signalType == "EMA" ? ema(accdist, signalLength) : sma(accdist, signalLength)

trendColor = accdist > signal ? #0ebb23 : red

adColor = applyFilling ? trendColor : #0094ff
signalColor = applyFilling ? trendColor : #ff6a00

adPlot = plot(accdist, title="Accum/Dist", linewidth=2, color=adColor, transp=0)
signalPlot = plot(showSignal ? signal : na, title="Signal", color=signalColor, transp=0)

transparent = color(white, 100)

fillColor = applyFilling ? trendColor : transparent
fill(adPlot, signalPlot, color=fillColor, transp=70)

plotshape(crossover(accdist, signal) and highlightCrossovers ? accdist : na, title="Crossover", location=location.absolute, style=shape.circle, size=size.tiny, color=green, transp=0)
plotshape(crossunder(accdist, signal) and highlightCrossovers ? accdist : na, title="Crossunder", location=location.absolute, style=shape.circle, size=size.tiny, color=red, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/volume/accumulation_distribution_line.pine | File No: 202 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/volume/klinger_volume_oscillator.pine | File No: 203 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Klinger Volume Oscillator script may be freely distributed under the terms of GPL-3.0 license.
study(title="Klinger Volume Oscillator", shorttitle="KVO", precision=0)

fastLength = input(title="Fast Length", type=integer, defval=34)
slowLength = input(title="Slow Length", type=integer, defval=55)
showSignal = input(title="Show Signal ?", type=bool, defval=true)
signalType = input(title="Signal Smoothing Type", defval="EMA", options=["EMA", "SMA"])
signalLength = input(title="Signal Smoothing Length", type=integer, defval=13)
showHistogram = input(title="Show Histogram ?", type=bool, defval=false)
highlightCrossovers = input(title="Highlight KVO/Signal Crossovers ?", type=bool, defval=true)
highlightZeroCrossovers = input(title="Highlight Zero Line Crossovers ?", type=bool, defval=true)
applyFilling = input(title="Apply Ribbon Filling ?", type=bool, defval=false)

mom = change(hlc3)

trend = 0.0
trend := na(trend[1]) ? 0.0 : (mom > 0 ? 1 : mom < 0 ? -1 : trend[1])

// Daily Measurement
dm = high - low

// Cumulative Measurement
cm = 0.0
cm := na(cm[1]) ? 0.0 : (trend == trend[1] ? cm[1] + dm : dm + dm[1])

// Volume Force
vf = cm != 0 ? 100 * volume * trend * abs(2 * dm / cm - 1) : 0

kvo = ema(vf, fastLength) - ema(vf, slowLength)
signal = signalType == "EMA" ? ema(kvo, signalLength) : sma(kvo, signalLength)

hist = kvo - signal
histColor = hist >= 0 ? (hist[1] < hist ? #26A69A : #B2DFDB) : (hist[1] < hist ? #FFCDD2 : #EF5350)
plot(showHistogram ? hist : na, title="Histogram", style=columns, color=histColor, transp=0)
hline(0, title="Zero Level", linestyle=dotted)

trendColor = kvo > signal ? #0ebb23 : red

kvoColor = applyFilling ? trendColor : (kvo > 0 ? #0ebb23 : red)
signalColor = applyFilling ? trendColor : #512da8

kvoPlot = plot(kvo, title="KVO", linewidth=2, color=kvoColor, transp=0)
signalPlot = plot(showSignal ? signal : na, title="Signal", color=signalColor, transp=0)

transparent = color(white, 100)

fillColor = applyFilling ? trendColor : transparent
fill(kvoPlot, signalPlot, title="Ribbon", color=fillColor, transp=70)

zeroCrossBgColor = highlightZeroCrossovers ? (kvo > 0 ? green : red) : transparent
bgcolor(zeroCrossBgColor, title="Background", transp=85)

plotshape(crossover(kvo, signal) and highlightCrossovers ? signal : na, title="Crossover", location=location.absolute, style=shape.circle, size=size.tiny, color=green, transp=20)
plotshape(crossunder(kvo, signal) and highlightCrossovers ? signal : na, title="Crossunder", location=location.absolute, style=shape.circle, size=size.tiny, color=red, transp=20)

##-- File Name: tradingview-pinescript-indicators-master/volume/klinger_volume_oscillator.pine | File No: 203 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/volume/negative_volume_index.pine | File No: 204 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Negative Volume Index script may be freely distributed under the terms of GPL-3.0 license.
study("Negative Volume Index", shorttitle="NVI")

initial = input(title="Initial Value", type=integer, defval=100)
signalType = input(title="Signal Smoothing Type", defval="EMA", options=["EMA", "SMA"])
signalLength = input(title="Signal Length", type=integer, defval=255)
highlightCrossovers = input(title="Highlight Crossovers", type=bool, defval=false)
applyFilling = input(title="Apply Ribbon Filling ?", type=bool, defval=true)

nvi = 0.0
nvi := na(nvi[1]) ? initial : (change(volume) < 0 ? nvi[1] * close / close[1] : nvi[1])
signal = signalType == "EMA" ? ema(nvi, signalLength) : sma(nvi, signalLength)

trendColor = nvi > signal ? #0ebb23 : red

nviColor = applyFilling ? trendColor : #0094ff
signalColor = applyFilling ? trendColor : #ff6a00

nviPlot = plot(nvi, title="NVI", color=nviColor, transp=0)
signalPlot = plot(signal, title="Signal", color=signalColor, transp=0)

transparent = color(white, 100)

fillColor = applyFilling ? trendColor : transparent
fill(nviPlot, signalPlot, color=fillColor, transp=70)

plotshape(crossover(nvi, signal) and highlightCrossovers ? nvi : na, title="Crossover", location=location.absolute, style=shape.circle, size=size.tiny, color=green, transp=0)
plotshape(crossunder(nvi, signal) and highlightCrossovers ? nvi : na, title="Crossunder", location=location.absolute, style=shape.circle, size=size.tiny, color=red, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/volume/negative_volume_index.pine | File No: 204 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/volume/net_volume.pine | File No: 205 | Started --##
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Net Volume script may be freely distributed under the terms of GPL-3.0 license.
study("Net Volume", precision=0)

src = input(title="Source", type=source, defval=close)

nv = sign(change(src)) * volume

nvColor = nv >= 0 ? (nv[1] < nv ? #26A69A : #B2DFDB) : (nv[1] < nv ? #FFCDD2 : #EF5350)

plot(nv, title="Net Volume", style=columns, linewidth=2, color=nvColor, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/volume/net_volume.pine | File No: 205 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/volume/on_balance_volume.pine | File No: 206 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// On Balance Volume script may be freely distributed under the terms of GPL-3.0 license.
study("On Balance Volume", shorttitle="OBV", precision=0)

showSignal = input(title="Show Signal ?", type=bool, defval=true)
signalType = input(title="Signal Smoothing Type", defval="SMA", options=["EMA", "SMA"])
signalLength = input(title="Signal Smoothing Length", type=integer, defval=21)
highlightCrossovers = input(title="Highlight Crossovers ?", type=bool, defval=false)
applyFilling = input(title="Apply Ribbon Filling ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

obv = cum(sign(change(src)) * volume)
signal = signalType == "EMA" ? ema(obv, signalLength) : sma(obv, signalLength)

trendColor = obv > signal ? #0ebb23 : red

obvColor = applyFilling ? trendColor : #0094ff
signalColor = applyFilling ? trendColor : #ff6a00

obvPlot = plot(obv, title="OBV", linewidth=2, color=obvColor, transp=0)
signalPlot = plot(showSignal ? signal : na, title="Signal", color=signalColor, transp=0)

transparent = color(white, 100)

fillColor = applyFilling ? trendColor : transparent
fill(obvPlot, signalPlot, color=fillColor, transp=70)

plotshape(crossover(obv, signal) and highlightCrossovers ? obv : na, title="Crossover", location=location.absolute, style=shape.circle, size=size.tiny, color=green, transp=0)
plotshape(crossunder(obv, signal) and highlightCrossovers ? obv : na, title="Crossunder", location=location.absolute, style=shape.circle, size=size.tiny, color=red, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/volume/on_balance_volume.pine | File No: 206 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/volume/percent_volume.pine | File No: 207 | Started --##
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// % Volume script may be freely distributed under the terms of GPL-3.0 license.
study("% Volume", precision=2)

length = input(title="SMA Length", type=integer, defval=21)

pv = 100 * volume / sma(volume, length)

pvColor = close > open ? #92df8bff : #fe9695ff
plot(pv, title="%V", style=columns, linewidth=2, color=pvColor, transp=0)

// purple = #674ea7
// yellow = #f9ce02

labelColor = #f9ce02
levelColor = #674ea7

plot(50, title="", style=circles, linewidth=0, color=labelColor)
hline(50, title="50% Level", linestyle=dotted, color=levelColor)

plot(100, title="", style=circles, linewidth=0, color=labelColor)
hline(100, title="100% Level", linestyle=dotted, color=levelColor)

plot(150, title="", style=circles, linewidth=0, color=labelColor)
hline(150, title="150% Level", linestyle=dotted, color=levelColor)

plot(200, title="", style=circles, linewidth=0, color=labelColor)
hline(200, title="200% Level", linestyle=dotted, color=levelColor)

plot(250, title="", style=circles, linewidth=0, color=labelColor)
hline(250, title="250% Level", linestyle=dotted, color=levelColor)

plot(300, title="", style=circles, linewidth=0, color=labelColor)
hline(300, title="300% Level", linestyle=dotted, color=levelColor)

// show300 = input(title="Show 300% Level ?", type=bool, defval=false)
// plot(show300 ? 300 : na, title="", style=circles, linewidth=0, color=#F9CE02)
// hline(show300 ? 300 : na, title="300% Level", linestyle=dotted, color=#F9CE02)

##-- File Name: tradingview-pinescript-indicators-master/volume/percent_volume.pine | File No: 207 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/volume/positive_volume_index.pine | File No: 208 | Started --##
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Positive Volume Index script may be freely distributed under the terms of GPL-3.0 license.
study("Positive Volume Index", shorttitle="PVI")

initial = input(title="Initial Value", type=integer, defval=100)
signalType = input(title="Signal Smoothing Type", defval="EMA", options=["EMA", "SMA"])
signalLength = input(title="Signal Length", type=integer, defval=255)
highlightCrossovers = input(title="Highlight Crossovers ?", type=bool, defval=false)
applyFilling = input(title="Apply Ribbon Filling ?", type=bool, defval=true)

pvi = 0.0
pvi := na(pvi[1]) ? initial : (change(volume) > 0 ? pvi[1] * close / close[1] : pvi[1])
signal = signalType == "EMA" ? ema(pvi, signalLength) : sma(pvi, signalLength)

trendColor = pvi > signal ? #0ebb23 : red

pviColor = applyFilling ? trendColor : #0094ff
signalColor = applyFilling ? trendColor : #ff6a00

pviPlot = plot(pvi, title="PVI", color=pviColor, transp=0)
signalPlot = plot(signal, title="Signal", color=signalColor, transp=0)

transparent = color(white, 100)

fillColor = applyFilling ? trendColor : transparent
fill(pviPlot, signalPlot, color=fillColor, transp=70)

plotshape(crossover(pvi, signal) and highlightCrossovers ? pvi : na, title="Crossover", location=location.absolute, style=shape.circle, size=size.tiny, color=green, transp=0)
plotshape(crossunder(pvi, signal) and highlightCrossovers ? pvi : na, title="Crossunder", location=location.absolute, style=shape.circle, size=size.tiny, color=red, transp=0)

##-- File Name: tradingview-pinescript-indicators-master/volume/positive_volume_index.pine | File No: 208 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/volume/price_volume_trend.pine | File No: 209 | Started --##
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Price Volume Trend script may be freely distributed under the terms of GPL-3.0 license.
study("Price Volume Trend", shorttitle="PVT", format=format.volume)

showSignal = input(title="Show Signal ?", type=input.bool, defval=true)
signalType = input(title="Signal Smoothing Type", defval="SMA", options=["EMA", "SMA"])
signalLength = input(title="Signal Smoothing Length", type=input.integer, defval=21)
src = input(title="Source", type=input.source, defval=close)
highlightCrossovers = input(title="Highlight Crossovers ?", type=input.bool, defval=false)
applyFilling = input(title="Apply Ribbon Filling ?", type=input.bool, defval=true)

signal = signalType == "EMA" ? ema(pvt, signalLength) : sma(pvt, signalLength)

trendColor = pvt > signal ? #0ebb23 : color.red
pvtColor = applyFilling ? trendColor : #0094ff
signalColor = applyFilling ? trendColor : #ff6a00

pvtPlot = plot(pvt, title="PVT", linewidth=2, color=pvtColor, transp=0)
signalPlot = plot(showSignal ? signal : na, title="Signal", color=signalColor, transp=0)

transparent = color.new(color.white, 100)

fillColor = applyFilling ? trendColor : transparent
fill(pvtPlot, signalPlot, color=fillColor, transp=70)

buyAlert = crossover(pvt, signal)
sellAlert = crossunder(pvt, signal)

plotshape(buyAlert and highlightCrossovers ? pvt : na, title="Crossover", location=location.absolute, style=shape.circle, size=size.tiny, color=color.green, transp=0)
plotshape(sellAlert and highlightCrossovers ? pvt : na, title="Crossunder", location=location.absolute, style=shape.circle, size=size.tiny, color=color.red, transp=0)

alertcondition(buyAlert, title="Alert: Buy", message="Buy\nSymbol: {{exchange}}:{{ticker}}\nPrice: {{close}}")
alertcondition(sellAlert, title="Alert: Sell", message="Sell\nSymbol: {{exchange}}:{{ticker}}\nPrice: {{close}}")

##-- File Name: tradingview-pinescript-indicators-master/volume/price_volume_trend.pine | File No: 209 | Ended --##

##-- File Name: tradingview-pinescript-indicators-master/volume/volume_accumulation.pine | File No: 210 | Started --##
//@version=6
// Copyright (c) 2020-present, Alex Orekhov (everget)
indicator('Volume Accumulation', format = format.volume)

accumulationType = input.string('Daily', title = 'Type', options = ['Minutely', 'Hourly', 'Session', 'Daily', 'Monthly', 'Quarterly', 'Yearly'])
sessionInput = input.session('0900-1530', title = 'Session (only for \'Session\' type)')
includeWeekends = input(true, title = 'Include Weekends')
var session = sessionInput + (includeWeekends ? ':1234567' : '')

applyBarColors = input(true, title = 'Apply Bar Colors')

//---

_inSession(res, sess) => not na(time(res, sess))

min = minute(time)
h = hour(time)
s = _inSession(timeframe.period, session) ? 1 : 0
d = dayofmonth(time)
m = month(time)
q = int(math.ceil(m / 3))
y = year(time)

int period = switch accumulationType
    'Minutely' => min
    'Hourly' => h
    'Session' => s
    'Daily' => d
    'Monthly' => m
    'Quarterly' => q
    'Yearly' => y
    => d

var acc = 0.0
acc := period != period[1] ? volume : nz(acc[1]) + volume

var accPrev = 0.0
accPrev := period != period[1] ? acc[1] : accPrev

accColor = acc > accPrev ? #92df8bff : #fe9695ff
plot(acc, title = 'Accumulation', style = plot.style_columns, color = accColor)
barcolor(applyBarColors ? accColor : na, title = 'Bar Color')

var periodChangeColor = color.new(#ffcc80, 60)
var noneColor = #ffffff00

bgcolor(period != period[1] ? periodChangeColor : noneColor, title = 'Separator')

higherAlert = acc > accPrev
alertcondition(higherAlert, title = 'Higher Accumulation', message = 'Higher Accumulation')

##-- File Name: tradingview-pinescript-indicators-master/volume/volume_accumulation.pine | File No: 210 | Ended --##


/* --- FILE: tradingview-pinescript-indicators-master/bands_and_channels/acceleration_bands.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Acceleration Bands script may be freely distributed under the terms of the GPL-3.0 license.
study(title="Acceleration Bands", shorttitle="AB", overlay=true)

length = input(title="Length", type=integer, defval=20)
factor = input(title="Factor", type=float, defval=0.001, step=0.0001)
src = input(title="Source", type=source, defval=close)

mult = 4000 * factor * (high - low) / (high + low)

upperBandSrc = high * (1 + mult)
upperBand = sma(upperBandSrc, length)

basis = sma(src, length)

lowerBandSrc = low * (1 - mult)
lowerBand = sma(lowerBandSrc, length)

upperBandPlot = plot(upperBand, title="Upper", linewidth=1, color=#138484, transp=0)

plot(basis, title="Basis", linewidth=1, color=#741b47, transp=0)

lowerBandPlot = plot(lowerBand, title="Lower", linewidth=1, color=#138484, transp=0)

fill(upperBandPlot, lowerBandPlot, title="Background", color=color(#ffd966, 84))


/* --- FILE: tradingview-pinescript-indicators-master/bands_and_channels/interquartile_range_bands.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Interquartile Range Bands script may be freely distributed under the terms of GPL-3.0 license.
study("Interquartile Range Bands", shorttitle="IQRB", overlay=true)

length = input(title="Length", type=integer, minval=1, defval=14)
mult = input(title="Multiplier", type=float, minval=0, step=0.1, defval=1.5)
src = input(title="Source", type=source, defval=close)

q1 = percentile_nearest_rank(src, length, 25)
median= percentile_nearest_rank(src, length, 50)
q3 = percentile_nearest_rank(src, length, 75)

iqr = q3 - q1

upperBand = q3 + mult * iqr
lowerBand = q1 - mult * iqr

upperBandPlot = plot(upperBand, title="Upper", color=#138484, transp=0)
plot(median, title="Median", color=#741b47, transp=0)
lowerBandPlot = plot(lowerBand, title="Lower", color=#138484, transp=0)
fill(upperBandPlot, lowerBandPlot, title="Background", color=color(#ffd966, 84))


/* --- FILE: tradingview-pinescript-indicators-master/bands_and_channels/kirshenbaum_bands.pine --- */
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Kirshenbaum Bands script may be freely distributed under the terms of the GPL-3.0 license.
study("Kirshenbaum Bands", shorttitle="KB", overlay=true)

length = input(title="Length", type=integer, defval=30)
regressionLength = input(title="Regression Length", type=integer, defval=20)
mult = input(title="Multiplier", type=float, step=0.1, defval=1.75)
src = input(title="Source", type=source, defval=close)

regression = linreg(src, regressionLength, 0)
stderror = mult * sqrt(sma(pow(src - regression, 2), regressionLength))

basis = ema(src, length)
upper = basis + stderror
lower = basis - stderror

plot(basis, title="Basis", color=#351c75, transp=0)
upperBandPlot = plot(upper, title="Upper", color=#45818e, transp=0)
lowerBandPlot = plot(lower, title="Lower", color=#45818e, transp=0)
fill(upperBandPlot, lowerBandPlot, title="Background", color=color(#ffd966, 84))


/* --- FILE: tradingview-pinescript-indicators-master/bands_and_channels/mean_absolute_deviation_bands.pine --- */
//@version=4
// Copyright (c) 2020-present, Alex Orekhov (everget)
// Mean Absolute Deviation Bands script may be freely distributed under the terms of the GPL-3.0 license.
study("Mean Absolute Deviation Bands", shorttitle="MADB", overlay=true)

length = input(title="Length", defval=20, minval=2)
mult = input(title="Bands Multiplier", defval=2.0, type=input.float, step=0.1)
src = input(title="Source", defval=close)

basis = sma(src, length)
dev = mult * dev(src, length)
upper = basis + dev
lower = basis - dev

plot(basis, title="Basis", color=#351c75, transp=0)
upperPlot = plot(upper, title="Upper", color=#45818e, transp=0)
lowerPlot = plot(lower, title="Lower", color=#45818e, transp=0)
fill(upperPlot, lowerPlot, title="MADB Background", color=color.new(#ffd966, 84))


/* --- FILE: tradingview-pinescript-indicators-master/bands_and_channels/moving_average_channel.pine --- */
//@version=4
// Copyright (c) 2017-present, Alex Orekhov (everget)
// Moving Average Channel script may be freely distributed under the terms of the GPL-3.0 license.
study("Moving Average Channel", shorttitle="MAC", overlay=true)

upperSrc = input(title="Upper Source", type=input.source, defval=high)
upperLength = input(title="Upper Length", type=input.integer, defval=20)
upperOffset = input(title="Upper Offset", type=input.integer, defval=0)

upper = sma(upperSrc, upperLength)
upperPlot = plot(upper, title="Upper", color=#3c78d8, offset=upperOffset, transp=0)

lowerSrc = input(title="Lower Source", type=input.source, defval=low)
lowerLength = input(title="Lower Length", type=input.integer, defval=20)
lowerOffset = input(title="Lower Offset", type=input.integer, defval=0)

lower = sma(lowerSrc, lowerLength)
lowerPlot = plot(lower, title="Lower", color=#f57c00, offset=lowerOffset, transp=0)

fill(upperPlot, lowerPlot, title="Background", color=color.new(#ffd966, 90))

barColor = close > upper ? color.lime : close < lower ? color.red : color.gray
barcolor(barColor, title="Bar Color")


/* --- FILE: tradingview-pinescript-indicators-master/bands_and_channels/stoller_average_range_channels.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Stoller Average Range Channels (STARC) Bands script may be freely distributed under the terms of the GPL-3.0 license.
study("Stoller Average Range Channels (STARC) Bands", shorttitle="STARC", overlay=true)

length = input(title="Length", type=integer, minval=1, defval=6)
maInput = input(title="MA", defval="SMA", options=["EMA", "SMA", "VWMA", "WMA"])
atrLength = input(title="ATR Length", type=integer, minval=1, defval=15)
mult = input(title="Multiplier", type=float, step=0.1, defval=1.33)
src = input(title="Source", type=source, defval=close)

basis = iff(maInput == "EMA", ema(src, length),
	 iff(maInput == "SMA", sma(src, length),
	 iff(maInput == "VWMA", vwma(src, length),
	 iff(maInput == "WMA", wma(src, length),
	 na))))

upperBand = basis + atr(length) * mult
lowerBand = basis - atr(length) * mult

plot(upperBand, title="Upper", linewidth=2, color=blue, transp=0)
plot(basis, title="Basis", linewidth=2, color=#6d1e7f, transp=0)
plot(lowerBand, title="Lower", linewidth=2, color=red, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/bands_and_channels/vortex_bands.pine --- */
//@version=4
// Copyright (c) 2020-present, Alex Orekhov (everget)
// Vortex Bands script may be freely distributed under the terms of the GPL-3.0 license.
study("Vortex Bands", shorttitle="VB", overlay=true)

length = input(title="Length", type=input.integer, defval=20)
mult = input(title="Multiplier", type=input.float, step=0.1, defval=2)
src = input(title="Source", type=input.source, defval=hlc3)
barColoringType = input(title="Bar Coloring", defval="None", options=["None", "Upper > Lower", "Close Above/Below Basis", "Close Inside Cloud", "Wicks Inside Cloud"])

_ema(src, alpha) =>
    out = src
    out := alpha * out + (1 - alpha) * nz(out[1], out)
    out

_mnma(src, length) =>
    alpha = 2 / (length + 1)
    ema1 = _ema(src, alpha)
    ema2 = _ema(ema1, alpha)
    out = ((2 - alpha) * ema1 - ema2) / (1 - alpha)
    out

basis = _mnma(src, length)
dev = mult * _mnma(src - basis, length)

upper = basis + dev
lower = basis - dev

plot(basis, title="Basis", color=color.maroon, transp=0)
upperBandPlot = plot(upper, title="Upper", linewidth=2, color=color.blue)
lowerBandPlot = plot(lower, title="Lower", linewidth=2, color=color.orange)
fill(upperBandPlot, lowerBandPlot, title="Background", color=color.new(#ffd966, 90))

barColor =
     barColoringType == "Upper > Lower" ? (upper > lower ? color.lime : color.red) :
     barColoringType == "Close Above/Below Basis" ? (close > basis ? color.lime : color.red) :
     barColoringType == "Close Inside Cloud" ? (min(upper, lower) < close and close < max(upper, lower) ? color.lime : color.red) :
     barColoringType == "Wicks Inside Cloud" ? (min(upper, lower) < low and high < max(upper, lower) ? color.lime : color.red) :
     na

barcolor(barColor, title="Bar Color")


/* --- FILE: tradingview-pinescript-indicators-master/highlighters/bitmex_withdrawals_cutoff_time.pine --- */
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// BitMEX Withdrawals Cutoff Time script may be freely distributed under the terms of GPL-3.0 license.
study("BitMEX Withdrawals Cutoff Time", overlay=true)

transparency = input(title="Transparency", minval=0, defval=70)

cutoff = hour(time) == 13
transparent = color(white, 100)

bgcolor(cutoff ? #f57f17 : transparent, title="Cutoff Time", transp=transparency)

/* --- FILE: tradingview-pinescript-indicators-master/highlighters/leap_years.pine --- */
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
study("Leap Years", overlay=true)

transparency = input(title="Transparency", type=integer, defval=88, minval=0, maxval=100)
showLabels = input(title="Show Labels ? ", type=bool, defval=true)

transparent = color(white, 100)
labelColor = #1e90ff
bgColor = #ffa726

isLeap = false

if year % 4 != 0 // year is not divisible by 4
    // it is a common year
    isLeap := false
else
    if year % 100 != 0 // year is not divisible by 100
        // it is a leap year
        isLeap := true
    else
        if year % 400 != 0 // year is not divisible by 400
            // it is a common year
            isLeap := false
        else
            // it is a leap year
            isLeap := true

lyText = " Leap \nYear "
lyStart = year != year[1] and isLeap
plotshape(showLabels and lyStart, title=lyText, text=lyText, color=labelColor, textcolor=white, style=shape.labelup, location=location.belowbar, size=size.small, transp=0)
bgcolor(title="Leap Year", color=isLeap ? bgColor : transparent, transp=transparency)


/* --- FILE: tradingview-pinescript-indicators-master/highlighters/quarters.pine --- */
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
study("Quarters", overlay=true)

transparency = input(title="Transparency", type=integer, defval=88, minval=0, maxval=100)
showLabels = input(title="Show Labels ? ", type=bool, defval=true)

transparent = color(white, 100)
labelColor = #1e90ff

m = month(time)

q1Text = " Q1 "
q1Start = m[1] == 12 and m == 1
q1 = m == 1 or m == 2 or m == 3
plotshape(showLabels and q1Start, title=q1Text, text=q1Text, color=labelColor, textcolor=white, style=shape.labelup, location=location.belowbar, size=size.small, transp=0)
bgcolor(title="Q1", color=q1 ? #e6194b : transparent, transp=transparency)

q2Text = " Q2 "
q2Start = m[1] == 3 and m == 4
q2 = m == 4 or m == 5 or m == 6
plotshape(showLabels and q2Start, title=q2Text, text=q2Text, color=labelColor, textcolor=white, style=shape.labelup, location=location.belowbar, size=size.small, transp=0)
bgcolor(title="Q2", color=q2 ? #3cb44b : transparent, transp=transparency)

q3Text = " Q3 "
q3Start = m[1] == 6 and m == 7
q3 = m == 7 or m == 8 or m == 9
plotshape(showLabels and q3Start, title=q3Text, text=q3Text, color=labelColor, textcolor=white, style=shape.labelup, location=location.belowbar, size=size.small, transp=0)
bgcolor(title="Q3", color=q3 ? #ffe119 : transparent, transp=transparency)

q4Text = " Q4 "
q4Start = m[1] == 9 and m == 10
q4 = m == 10 or m == 11 or m == 12
plotshape(showLabels and q4Start, title=q4Text, text=q4Text, color=labelColor, textcolor=white, style=shape.labelup, location=location.belowbar, size=size.small, transp=0)
bgcolor(title="Q4", color=q4 ? #f58231 : transparent, transp=transparency)


/* --- FILE: tradingview-pinescript-indicators-master/highlighters/range_candles.pine --- */
//@version=4
// Copyright (c) 2020-present, Alex Orekhov (everget)
// Range Candles script may be freely distributed under the terms of the GPL-3.0 license.
study("Range Candles", overlay=true)

var color bullColor = input(title="Bull Color", defval=#26a69a)
var color bearColor = input(title="Bear Color", defval=#ef5350)
candleColor = close >= open ? bullColor : bearColor

plotcandle(
	 open,
	 high,
	 low,
	 close,
	 title="",
	 color=candleColor,
	 bordercolor=candleColor,
	 wickcolor=candleColor
	 )


/* --- FILE: tradingview-pinescript-indicators-master/highlighters/weekdays_gaps.pine --- */
//@version=4
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Weekdays Gaps script may be freely distributed under the terms of the GPL-3.0 license.
study("Weekdays Gaps", overlay=true)

td = dayofweek(time)
yd = dayofweek(time[1])

mo = dayofweek.monday
tu = dayofweek.tuesday
we = dayofweek.wednesday
th = dayofweek.thursday
fr = dayofweek.friday
sa = dayofweek.saturday
su = dayofweek.sunday

gaps = td == mo and yd != su or
         td == tu and yd != mo or
         td == we and yd != tu or
         td == th and yd != we or
         td == fr and yd != th or
         td == sa and yd != fr or
         td == su and yd != sa

gapColor = color.new(#ffcc80, 70)
noneColor = color.new(color.white, 100)
bgcolor(gaps ? gapColor : noneColor, title="Gap")


/* --- FILE: tradingview-pinescript-indicators-master/movings/adaptive_laguerre_filter.pine --- */
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Adaptive Laguerre Filter script may be freely distributed under the terms of the GPL-3.0 license.
study("Adaptive Laguerre Filter", shorttitle="ALF", overlay=true)

length = input(title="Length", type=input.integer, defval=14)
medianLength = input(title="Median Length", type=input.integer, defval=5)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)
awaitBarConfirmation = input(title="Await Bar Confirmation ?", type=input.bool, defval=true)

_median(src, length) =>
	percentile_nearest_rank(src, length, 50)

alf = 0.0

diff = abs(src - nz(alf[1], src))

HH = 0.0
HH := diff

LL = 0.0
LL := diff

for i = 0 to length - 1
	if nz(diff[i]) > HH
		HH := nz(diff[i])
		HH

	if nz(diff[i]) < LL
		LL := nz(diff[i])
		LL

alpha = 0.0
alpha := HH - LL != 0.0 ? _median((diff - LL) / (HH - LL), medianLength) : nz(alpha[1], 2 / (length + 1))
alpha2 = 1 - alpha

L0 = 0.0
L0 := alpha * src + alpha2 * nz(L0[1], src)

L1 = 0.0
L1 := nz(L0[1], src) + alpha2 * (nz(L1[1], src) - L0)

L2 = 0.0
L2 := nz(L1[1], src) + alpha2 * (nz(L2[1], src) - L1)

L3 = 0.0
L3 := nz(L2[1], src) + alpha2 * (nz(L3[1], src) - L2)

alf := (L0 + 2 * L1 + 2 * L2 + L3) / 6

await = awaitBarConfirmation ? barstate.isconfirmed : true

alfColor = highlight ? (alf > alf[1] and await ? color.green : color.red) : #6d1e7f
plot(alf, title="ALF", linewidth=2, color=alfColor, transp=0)

alertCond = alfColor != alfColor[1] and await
alertcondition(alertCond, title="Color Change", message="ALF has changed its color!")


/* --- FILE: tradingview-pinescript-indicators-master/movings/adaptive_rsi_moving_average.pine --- */
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Adaptive RSI Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Adaptive RSI Moving Average", shorttitle="ARSIMA", overlay=true)

length = input(title="Length", type=input.integer, defval=14)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

alpha = 2 * abs(rsi(src, length) / 100 - 0.5)

arsima = 0.0
arsima := alpha * src + (1 - alpha) * nz(arsima[1])

arsimaColor = highlight ? arsima > arsima[1] ? color.green : color.red : #6d1e7f
plot(arsima, title="ARSIMA", linewidth=2, color=arsimaColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/ahrens_moving_average.pine --- */
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Ahrens Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Ahrens Moving Average", shorttitle="AHMA", overlay=true)

length = input(title="Length", type=input.integer, defval=9)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

ahma = 0.0
ahma1 = nz(ahma[1])
ahma := ahma1 + (src - (ahma1 + nz(ahma[length])) / 2) / length

ahmaColor = highlight ? ahma > ahma[1] ? color.green : color.red : #6d1e7f
plot(ahma, title="AHMA", linewidth=2, color=ahmaColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/alpha_decreasing_exponential_moving_average.pine --- */
//@version=4
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Alpha-Decreasing Exponential Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Alpha-Decreasing Exponential Moving Average", shorttitle="ADEMA", overlay=true)

alpha = 2 / (int(bar_index) + 1)

ema = close
ema := alpha * ema + (1 - alpha) * nz(ema[1], ema)

plot(ema, title="ADEMA", linewidth=2, color=color.orange)


/* --- FILE: tradingview-pinescript-indicators-master/movings/apirine_adaptive_exponential_moving_average.pine --- */
//@version=3
// Copyright (c) 2019-present, Vitali Apirine
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Adaptive Exponential Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Adaptive Exponential Moving Average", shorttitle="AEMA", overlay=true)

length = input(title="Length", type=integer, defval=10)
hlLookback = input(title="Highest/Lowest Lookback", type=integer, defval=10)
src = input(title="Source", type=source, defval=close)
highlightMovements = input(title="Highlight Movements ?", type=bool, defval=false)

hh = highest(hlLookback)
ll = lowest(hlLookback)

mltp1 = 2 / (length + 1)
mltp2 = hh - ll != 0 ? abs(2 * src - ll - hh) / (hh - ll) : 0

rate = mltp1 * (1 + mltp2)

ma = 0.0
if n <= length
    ma := sma(src, length)
else
    ma := nz(ma[1], src) + rate * (src - nz(ma[1], src))

maColor = highlightMovements ? (ma > ma[1] ? green : red) : #512da8
plot(ma, title="AMA", linewidth=2, color=maColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/apirine_adaptive_moving_average.pine --- */
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Apirine Adaptive Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Apirine Adaptive Moving Average", shorttitle="AAMA", overlay=true)

length = input(title="Length", type=input.integer, defval=14)
fastLength = input(title="Fast EMA Length", type=input.integer, defval=2)
slowLength = input(title="Slow EMA Length", type=input.integer, defval=30)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

fastAlpha = 2 / (fastLength + 1)
slowAlpha = 2 / (slowLength + 1)

hh = highest(length + 1)
ll = lowest(length + 1)

mltp = hh - ll != 0 ? abs(2 * src - ll - hh) / (hh - ll) : 0

ssc = mltp * (fastAlpha - slowAlpha) + slowAlpha

aama = 0.0
aama := nz(aama[1], src) + pow(ssc, 2) * (src - nz(aama[1], src))

aamaColor = highlight ? aama > aama[1] ? color.green : color.red : #6d1e7f
plot(aama, title="AAMA", linewidth=2, color=aamaColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/arnaud_legoux_moving_average.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Arnaud Legoux Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Arnaud Legoux Moving Average", shorttitle="ALMA", overlay=true)

length = input(title="Length", type=integer, minval=1, defval=9)
offset = input(title="Offset", type=float, defval=0.85)
sigma = input(title="Sigma", type=float, defval=6)
src = input(title="Source", type=source, defval=close)

plot(alma(src, length, offset, sigma), title="ALMA", linewidth=2, color=#e69138, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/bryant_adaptive_moving_average.pine --- */
//@version=3
// Copyright (c) 2014-present, Michael R. Bryant
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Bryant Adaptive Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Bryant Adaptive Moving Average", shorttitle="BAMA", overlay=true)

length = input(title="Length", type=integer, defval=14)
trendParam = input(title="Trend Parameter", type=float, defval=-1, step=0.1)
maxLength = input(title="Max Length", type=integer, defval=100)
highlightMovements = input(title="Highlight Movements ?", type=bool, defval=false)
src = input(title="Source", type=source, defval=close)

mom = abs(change(src, length))
volatility = sum(abs(change(src)), length)

// Efficiency Ratio
er = volatility != 0 ? mom / volatility : 0

// Variable Efficiency Ratio
ver = pow(er - (2 * er - 1) / 2 * (1 - trendParam) + 0.5, 2)

vlength = (length - ver + 1) / ver
vlength := vlength > maxLength ? maxLength : vlength

valpha = 2 / (vlength + 1)

bama = src
bama := valpha * src + (1 - valpha) * nz(bama[1], bama)

bamaColor = highlightMovements ? (bama > bama[1] ? green : red) : #6d1e7f
plot(bama, title="BAMA", linewidth=2, color=bamaColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/butterworth_filter.pine --- */
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Butterworth Filter script may be freely distributed under the terms of the GPL-3.0 license.
study("Butterworth Filter", shorttitle="BF", overlay=true)

length = input(title="Length", type=input.integer, minval=1, defval=14)
poles = input(title="Poles", type=input.integer, defval=2, options=[2, 3])
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

PI = 2 * asin(1)

_bf2(src, length) =>
	a = exp(-sqrt(2) * PI / length)
	b = 2 * a * cos(sqrt(2) * PI / length)

	src1 = nz(src[1], src)
	src2 = nz(src[2], src1)

	bf = 0.0
	bf1 = nz(bf[1], src)
	bf2 = nz(bf[2], bf1)

	bf :=
		 b * bf1 -
		 pow(a, 2) * bf2 +
		 (1 - b + pow(a, 2)) / 4 * (src + 2 * src1 + src2)
	bf

_bf3(src, length) =>
	a = exp(-PI / length)
	b = 2 * a * cos(1.738 * PI / length)
	c = pow(a, 2)

	src1 = nz(src[1], src)
	src2 = nz(src[2], src1)
	src3 = nz(src[3], src2)

	bf = 0.0
	bf1 = nz(bf[1], src)
	bf2 = nz(bf[2], bf1)
	bf3 = nz(bf[3], bf2)

	bf :=
		 (b + c) * bf1 -
		 (c + b * c) * bf2 +
		 pow(c, 2) * bf3 +
		 (1 - b + c) * (1 - c) / 8 * (src + 3 * src1 + 3 * src2 + src3)
	bf

bf = poles == 2
	 ? _bf2(src, length)
	 : _bf3(src, length)

bfColor = highlight ? bf > bf[1] ? color.green : color.red : #6d1e7f
plot(bf, title="BF", linewidth=2, color=bfColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/corrected_moving_average.pine --- */
//@version=4
// Copyright (c) 2020-present, Alex Orekhov (everget)
// Corrected Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Corrected Moving Average", shorttitle="CMA", overlay=true)

length = input(title="Length", type=input.integer, defval=35)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight CMA ?", type=input.bool, defval=false)
applyFilling = input(title="Apply Ribbon Filling ?", type=input.bool, defval=true)

sma = sma(src, length)
cma = sma

v1 = variance(src, length)
v2 = pow(nz(cma[1], cma) - sma, 2)
v3 = v1 == 0 or v2 == 0 ? 1 : v2 / (v1 + v2)

var tolerance = pow(10, -5)
float err = 1

// Gain Factor
float kPrev = 1
float k = 1

for i = 0 to 5000
    if err > tolerance
        k := v3 * kPrev * (2 - kPrev)
        err := kPrev - k
        kPrev := k

cma := nz(cma[1], src) + k * (sma - nz(cma[1], src))

cmaColor = highlight ? (cma > cma[1] ? color.green : color.red) : color.orange
cmaPlot = plot(cma, title="CMA", linewidth=2, color=cmaColor)
smaPlot = plot(sma, title="SMA", linewidth=2, color=color.blue)

fillColor = applyFilling ? (sma > cma ? #0ebb23 : #cc0000) : color.new(color.white, 100) 
fill(smaPlot, cmaPlot, color=fillColor, transp=80)

long = crossover(sma, cma)
short = crossunder(sma, cma)

alertcondition(long, title="Long", message="Long")
alertcondition(short, title="Short", message="Short")


/* --- FILE: tradingview-pinescript-indicators-master/movings/distance_coefficient_filter.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Ehlers Distance Coefficient Filter script may be freely distributed under the terms of the GPL-3.0 license.
study("Ehlers Distance Coefficient Filter", shorttitle="EDCF", overlay=true)

length = input(title="Length", type=integer, defval=14)
src = input(title="Source", type=source, defval=hl2)

srcSum = 0.0
coefSum = 0.0

for count = 0 to length - 1
	distance = 0.0

	for lookback = 1 to length - 1
		distance := distance + pow(src[count] - src[count + lookback], 2)

	srcSum := srcSum + distance * src[count]
	coefSum := coefSum + distance

dcf = coefSum != 0 ? srcSum / coefSum : 0.0

plot(dcf, title="EDCF", linewidth=2, color=#6d1e7f, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/distance_weighted_moving_average.pine --- */
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Distance Weighted Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Distance Weighted Moving Average", shorttitle="DWMA", overlay=true)

length = input(title="Length", type=integer, defval=14)
highlightMovements = input(title="Highlight Movements ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

sum = 0.0
weightSum = 0.0

calcWeight(src, length, i) =>
    distanceSum = 0.0
    for j = 0 to length - 1
        distanceSum := distanceSum + abs(nz(src[i]) - nz(src[j]))
    1 / distanceSum

for i = 0 to length - 1
    weight = calcWeight(src, length, i)
    sum := sum + nz(src[i]) * weight
    weightSum := weightSum + weight

dwma = sum / weightSum

dwmaColor = highlightMovements ? (dwma > dwma[1] ? green : red) : #6d1e7f
plot(dwma, title="DWMA", linewidth=2, color=dwmaColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/double_exponential_moving_average.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Double Exponential Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Double Exponential Moving Average", shorttitle="DEMA", overlay=true)

length = input(title="Length", type=integer, minval=1, defval=14)
src = input(title="Source", type=source, defval=close)

dema(src, length) =>
	ema1 = ema(src, length)
	ema2 = ema(ema1, length)
	dema = 2 * ema1 - ema2

plot(dema(src, length), title="DEMA", linewidth=2, color=#6d1e7f, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/double_weighted_moving_average.pine --- */
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Double Weighted Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Double Weighted Moving Average", shorttitle="DWMA", overlay=true)

length = input(title="Length", type=integer, defval=10)
highlightMovements = input(title="Highlight Movements ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

dwma = wma(wma(src, length), length)

dwmaColor = highlightMovements ? (dwma > dwma[1] ? green : red) : #6d1e7f
plot(dwma, title="DWMA", linewidth=2, color=dwmaColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/ehlers_deviation_scaled_moving_average.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Ehlers Deviation-Scaled Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Ehlers Deviation-Scaled Moving Average", shorttitle="EDSMA", overlay=true)

length = input(title="Length", type=integer, defval=40, minval=2)
ssfLength = input(title="Super Smoother Filter Length", type=integer, defval=20, minval=1)
numberOfPoles = input(title="Number of Poles", type=integer, defval=2, options=[2, 3])
src = input(title="Source", type=source, defval=close)

PI = 2 * asin(1)

twoPoleSuperSmootherFilter(src, length) =>
	arg = sqrt(2) * PI / length
	a1 = exp(-arg)
	b1 = 2 * a1 * cos(arg)
	c2 = b1
	c3 = -pow(a1, 2)
	c1 = 1 - c2 - c3

	ssf = 0.0
	ssf := c1 * src + c2 * nz(ssf[1]) + c3 * nz(ssf[2])

threePoleSuperSmootherFilter(src, length) =>
	arg = PI / length
	a1 = exp(-arg)
	b1 = 2 * a1 * cos(1.738 * arg)
	c1 = pow(a1, 2)

	coef2 = b1 + c1
	coef3 = -(c1 + b1 * c1)
	coef4 = pow(c1, 2)
	coef1 = 1 - coef2 - coef3 - coef4

	ssf = 0.0
	ssf := coef1 * src + coef2 * nz(ssf[1]) + coef3 * nz(ssf[2]) + coef4 * nz(ssf[3])

zeros = src - nz(src[2])

// Ehlers Super Smoother Filter
ssf = numberOfPoles == 2
	 ? twoPoleSuperSmootherFilter((zeros + zeros[1]) / 2, ssfLength)
	 : threePoleSuperSmootherFilter((zeros + zeros[1]) / 2, ssfLength)

// Rescale filter in terms of Standard Deviations
scaledFilter = stdev(ssf, length) != 0
	 ? ssf / stdev(ssf, length)
	 : 0

alpha = abs(scaledFilter) * 5 / length

edsma = 0.0
edsma := alpha * src + (1 - alpha) * nz(edsma[1])

plot(edsma, title="EDSMA", linewidth=2, color=#6d1e7f, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/ehlers_distance_coefficient_filter.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Ehlers Distance Coefficient Filter script may be freely distributed under the terms of GPL-3.0 license.
study("Ehlers Distance Coefficient Filter", shorttitle="EDCF", overlay=true)

length = input(title="Length", type=integer, defval=14)
src = input(title="Source", type=source, defval=hl2)

srcSum = 0.0
coefSum = 0.0

for count = 0 to length - 1
	distance = 0.0

	for lookback = 1 to length - 1
		distance := distance + pow(src[count] - src[count + lookback], 2)

	srcSum := srcSum + distance * src[count]
	coefSum := coefSum + distance

dcf = coefSum != 0 ? srcSum / coefSum : 0.0

plot(dcf, title="EDCF", linewidth=2, color=#6d1e7f, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/ehlers_leading_indicator.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Ehlers Leading Indicator script may be freely distributed under the terms of the GPL-3.0 license.
study("Ehlers Leading Indicator", shorttitle="ELI", overlay=true)

alpha1 = input(title="Alpha 1", type=float, step=0.1, defval=0.25)
alpha2 = input(title="Alpha 2", type=float, step=0.1, defval=0.33)
src = input(title="Source", type=source, defval=hl2)

lead = 0.0
lead := 2 * src + (alpha1 - 2) * nz(src[1]) + (1 - alpha1) * nz(lead[1])

leadingIndicator = 0.0
leadingIndicator := alpha2 * lead + (1 - alpha2) * nz(leadingIndicator[1])

plot(leadingIndicator, title="ELI", linewidth=2, color=#741b47, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/ehlers_mesa_adaptive_moving_averages.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Ehlers MESA Adaptive Moving Averages (MAMA & FAMA) script may be freely distributed under the terms of the GPL-3.0 license.
study("Ehlers MESA Adaptive Moving Averages (MAMA & FAMA)", shorttitle="MESA", overlay=true)

fastLimit = input(title="Fast Limit", type=float, defval=0.5)
slowLimit = input(title="Slow Limit", type=float, defval=0.05)
src = input(title="Source", type=source, defval=hl2)

computeMESAComponent(src, mesaPeriodMult) =>
	(0.962 * src + 0.5769 * nz(src[2]) - 0.5769 * nz(src[4]) - 0.0962 * nz(src[6])) * mesaPeriodMult

computeAlpha(src, fastLimit, slowLimit) =>
	mesaPeriod = 0.0
	mesaPeriodMult = 0.075 * nz(mesaPeriod[1]) + 0.54

	smooth = 0.0
	smooth := (4 * src + 3 * nz(src[1]) + 2 * nz(src[2]) + nz(src[3])) / 10

	detrender = 0.0
	detrender := computeMESAComponent(smooth, mesaPeriodMult)

	// Compute InPhase and Quadrature components
	I1 = nz(detrender[3])
	Q1 = computeMESAComponent(detrender, mesaPeriodMult)

	// Advance the phase of I1 and Q1 by 90 degrees
	jI = computeMESAComponent(I1, mesaPeriodMult)
	jQ = computeMESAComponent(Q1, mesaPeriodMult)

	I2 = 0.0
	Q2 = 0.0

	// Phasor addition for 3 bar averaging
	I2 := I1 - jQ
	Q2 := Q1 + jI

	// Smooth the I and Q components before applying the discriminator
	I2 := 0.2 * I2 + 0.8 * nz(I2[1])
	Q2 := 0.2 * Q2 + 0.8 * nz(Q2[1])

	// Homodyne Discriminator
	Re = I2 * nz(I2[1]) + Q2 * nz(Q2[1])
	Im = I2 * nz(Q2[1]) - Q2 * nz(I2[1])

	Re := 0.2 * Re + 0.8 * nz(Re[1])
	Im := 0.2 * Im + 0.8 * nz(Im[1])

	if Re != 0 and Im != 0
		mesaPeriod := 360 / atan(Im / Re)

	if mesaPeriod > 1.5 * nz(mesaPeriod[1])
		mesaPeriod := 1.5 * nz(mesaPeriod[1])

	if mesaPeriod < 0.67 * nz(mesaPeriod[1])
		mesaPeriod := 0.67 * nz(mesaPeriod[1])

	if mesaPeriod < 6
		mesaPeriod := 6

	if mesaPeriod > 50
		mesaPeriod := 50

	mesaPeriod := 0.2 * mesaPeriod + 0.8 * nz(mesaPeriod[1])

	smoothPeriod = 0.0
	smoothPeriod := 0.33 * mesaPeriod + 0.67 * nz(smoothPeriod[1])

	phase = 0.0

	if I1 != 0
		phase := atan(Q1 / I1)

	deltaPhase = nz(phase[1]) - phase

	if  deltaPhase < 1
		deltaPhase := 1

	alpha = fastLimit / deltaPhase

	if  alpha < slowLimit
		alpha := slowLimit

	alpha

mama(src, fastLimit, slowLimit) =>
	alpha = computeAlpha(src, fastLimit, slowLimit)

	mama = 0.0
	mama := alpha * src + (1 - alpha) * nz(mama[1])

fama(src, fastLimit, slowLimit) =>
	alpha = computeAlpha(src, fastLimit, slowLimit)
	mama = mama(src, fastLimit, slowLimit)

	fama = 0.0
	fama := (alpha / 2) * mama + (1 - alpha / 2) * nz(fama[1])

plot(mama(src, fastLimit, slowLimit), title="MAMA", linewidth=2, color=#674ea7, transp=0)
plot(fama(src, fastLimit, slowLimit), title="FAMA", linewidth=2, color=#f6b26b, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/ehlers_modified_optimum_elliptic_filter.pine --- */
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Ehlers Modified Optimum Elliptic Filter script may be freely distributed under the terms of GPL-3.0 license.
study("Ehlers Modified Optimum Elliptic Filter", shorttitle="MOEF", overlay=true)

src = input(title="Source", type=source, defval=hl2)
highlightMovements = input(title="Highlight Movements ?", type=bool, defval=false)

src1 = nz(src[1], src)
src2 = nz(src[2], src1)
src3 = nz(src[3], src2)

moef = src
moef := 0.13785 * (2 * src - src1) +
         0.0007 * (2 * src1 - src2) +
         0.13785 * (2 * src2 - src3) +
         1.2103 * nz(moef[1], moef) -
         0.4867 * nz(moef[2], moef)

moefColor = highlightMovements ? (moef > moef[1] ? green : red) : #6d1e7f
plot(moef, title="MOEF", linewidth=2, color=moefColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/ehlers_optimum_elliptic_filter.pine --- */
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Ehlers Optimum Elliptic Filter script may be freely distributed under the terms of GPL-3.0 license.
study("Ehlers Optimum Elliptic Filter", shorttitle="OEF", overlay=true)

src = input(title="Source", type=source, defval=hl2)
highlightMovements = input(title="Highlight Movements ?", type=bool, defval=false)

oef = 0.0
oef := 0.13785 * src + 0.0007 * nz(src[1]) + 0.13785 * nz(src[2]) + 1.2103 * nz(oef[1]) - 0.4867 * nz(oef[2])

oefColor = highlightMovements ? (oef > oef[1] ? green : red) : #6d1e7f
plot(oef, title="OEF", linewidth=2, color=oefColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/ehlers_super_smoother_filter.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Ehlers Super Smoother Filter script may be freely distributed under the terms of the GPL-3.0 license.
study("Ehlers Super Smoother Filter", shorttitle="ESSF", overlay=true)

length = input(title="Length", type=integer, minval=1, defval=15)
numberOfPoles = input(title="Number of Poles", type=integer, defval=2, options=[2, 3])
src = input(title="Source", type=source, defval=close)

PI = 2 * asin(1)

get2PoleSSF(src, length) =>
	arg = sqrt(2) * PI / length
	a1 = exp(-arg)
	b1 = 2 * a1 * cos(arg)
	c2 = b1
	c3 = -pow(a1, 2)
	c1 = 1 - c2 - c3

	ssf = 0.0
	ssf := c1 * src + c2 * nz(ssf[1]) + c3 * nz(ssf[2])

get3PoleSSF(src, length) =>
	arg = PI / length
	a1 = exp(-arg)
	b1 = 2 * a1 * cos(1.738 * arg)
	c1 = pow(a1, 2)

	coef2 = b1 + c1
	coef3 = -(c1 + b1 * c1)
	coef4 = pow(c1, 2)
	coef1 = 1 - coef2 - coef3 - coef4

	ssf = 0.0
	ssf := coef1 * src + coef2 * nz(ssf[1]) + coef3 * nz(ssf[2]) + coef4 * nz(ssf[3])

essf = numberOfPoles == 2
		 ? get2PoleSSF(src, length)
		 : get3PoleSSF(src, length)

plot(essf, title="ESSF", linewidth=2, color=#741b47, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/elastic_volume_weighted_moving_average.pine --- */
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Elastic Volume Weighted Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Elastic Volume Weighted Moving Average", shorttitle="EVWMA", overlay=true)

length = input(title="Length", type=input.integer, defval=14)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

volumeSum = sum(volume, length)

evwma = 0.0
evwma := ((volumeSum - volume) * nz(evwma[1]) + volume * src) / volumeSum

evwmaColor = highlight ? evwma > evwma[1] ? color.green : color.red : #6d1e7f
plot(evwma, title="EVWMA", linewidth=2, color=evwmaColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/exponential_moving_average.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Exponential Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Exponential Moving Average", shorttitle="EMA", overlay=true)

length = input(title="Length", type=integer, minval=1, defval=14)
src = input(title="Source", type=source, defval=close)

plot(ema(src, length), title="EMA", linewidth=2, color=#6d1e7f, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/farey_sequence_weighted_moving_average.pine --- */
//@version=4
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Farey Sequence Weighted Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Farey Sequence Weighted Moving Average", shorttitle="FSWMA", overlay=true)

order = input(title="Order", defval="5",
	 options=[
		 "2",
		 "3",
		 "4",
		 "5",
		 "6",
		 "7",
		 "8",
		 "9",
		 "10",
		 "11",
		 "12",
		 "13",
		 "14"
		 ])
src = input(title="Source", type=input.source, defval=close)
highlightMovements = input(title="Highlight Movements ?", type=input.bool, defval=true)

src1 = src[1]
src2 = src[2]
src3 = src[3]
src4 = src[4]
src5 = src[5]
src6 = src[6]
src7 = src[7]
src8 = src[8]
src9 = src[9]
src10 = src[10]
src11 = src[11]
src12 = src[12]
src13 = src[13]
src14 = src[14]
src15 = src[15]
src16 = src[16]
src17 = src[17]
src18 = src[18]
src19 = src[19]
src20 = src[20]
src21 = src[21]
src22 = src[22]
src23 = src[23]
src24 = src[24]
src25 = src[25]
src26 = src[26]
src27 = src[27]
src28 = src[28]
src29 = src[29]
src30 = src[30]
src31 = src[31]
src32 = src[32]
src33 = src[33]
src34 = src[34]
src35 = src[35]
src36 = src[36]
src37 = src[37]
src38 = src[38]
src39 = src[39]
src40 = src[40]
src41 = src[41]
src42 = src[42]
src43 = src[43]
src44 = src[44]
src45 = src[45]
src46 = src[46]
src47 = src[47]
src48 = src[48]
src49 = src[49]
src50 = src[50]
src51 = src[51]
src52 = src[52]
src53 = src[53]
src54 = src[54]
src55 = src[55]
src56 = src[56]
src57 = src[57]
src58 = src[58]
src59 = src[59]
src60 = src[60]
src61 = src[61]
src62 = src[62]
src63 = src[63]

// Generated by script, not manually
fswma =
     order == "2" ? (src + 0.5 * src1) / 1.5 :
     order == "3" ? (src + 0.667 * src1 + 0.5 * src2 + 0.333 * src3) / 2.5 :
     order == "4" ? (src + 0.75 * src1 + 0.667 * src2 + 0.5 * src3 + 0.333 * src4 + 0.25 * src5) / 3.5 :
     order == "5" ? (src + 0.8 * src1 + 0.75 * src2 + 0.667 * src3 + 0.6 * src4 + 0.5 * src5 + 0.4 * src6 + 0.333 * src7 + 0.25 * src8 + 0.2 * src9) / 5.5 :
     order == "6" ? (src + 0.833 * src1 + 0.8 * src2 + 0.75 * src3 + 0.667 * src4 + 0.6 * src5 + 0.5 * src6 + 0.4 * src7 + 0.333 * src8 + 0.25 * src9 + 0.2 * src10 + 0.167 * src11) / 6.5 :
     order == "7" ? (src + 0.857 * src1 + 0.833 * src2 + 0.8 * src3 + 0.75 * src4 + 0.714 * src5 + 0.667 * src6 + 0.6 * src7 + 0.571 * src8 + 0.5 * src9 + 0.429 * src10 + 0.4 * src11 + 0.333 * src12 + 0.286 * src13 + 0.25 * src14 + 0.2 * src15 + 0.167 * src16 + 0.143 * src17) / 9.5 :
     order == "8" ? (src + 0.875 * src1 + 0.857 * src2 + 0.833 * src3 + 0.8 * src4 + 0.75 * src5 + 0.714 * src6 + 0.667 * src7 + 0.625 * src8 + 0.6 * src9 + 0.571 * src10 + 0.5 * src11 + 0.429 * src12 + 0.4 * src13 + 0.375 * src14 + 0.333 * src15 + 0.286 * src16 + 0.25 * src17 + 0.2 * src18 + 0.167 * src19 + 0.143 * src20 + 0.125 * src21) / 11.5 :
     order == "9" ? (src + 0.889 * src1 + 0.875 * src2 + 0.857 * src3 + 0.833 * src4 + 0.8 * src5 + 0.778 * src6 + 0.75 * src7 + 0.714 * src8 + 0.667 * src9 + 0.625 * src10 + 0.6 * src11 + 0.571 * src12 + 0.556 * src13 + 0.5 * src14 + 0.444 * src15 + 0.429 * src16 + 0.4 * src17 + 0.375 * src18 + 0.333 * src19 + 0.286 * src20 + 0.25 * src21 + 0.222 * src22 + 0.2 * src23 + 0.167 * src24 + 0.143 * src25 + 0.125 * src26 + 0.111 * src27) / 14.5 :
     order == "10" ? (src + 0.9 * src1 + 0.889 * src2 + 0.875 * src3 + 0.857 * src4 + 0.833 * src5 + 0.8 * src6 + 0.778 * src7 + 0.75 * src8 + 0.714 * src9 + 0.7 * src10 + 0.667 * src11 + 0.625 * src12 + 0.6 * src13 + 0.571 * src14 + 0.556 * src15 + 0.5 * src16 + 0.444 * src17 + 0.429 * src18 + 0.4 * src19 + 0.375 * src20 + 0.333 * src21 + 0.3 * src22 + 0.286 * src23 + 0.25 * src24 + 0.222 * src25 + 0.2 * src26 + 0.167 * src27 + 0.143 * src28 + 0.125 * src29 + 0.111 * src30 + 0.1 * src31) / 16.5 :
     order == "11" ? (src + 0.909 * src1 + 0.9 * src2 + 0.889 * src3 + 0.875 * src4 + 0.857 * src5 + 0.833 * src6 + 0.818 * src7 + 0.8 * src8 + 0.778 * src9 + 0.75 * src10 + 0.727 * src11 + 0.714 * src12 + 0.7 * src13 + 0.667 * src14 + 0.636 * src15 + 0.625 * src16 + 0.6 * src17 + 0.571 * src18 + 0.556 * src19 + 0.545 * src20 + 0.5 * src21 + 0.455 * src22 + 0.444 * src23 + 0.429 * src24 + 0.4 * src25 + 0.375 * src26 + 0.364 * src27 + 0.333 * src28 + 0.3 * src29 + 0.286 * src30 + 0.273 * src31 + 0.25 * src32 + 0.222 * src33 + 0.2 * src34 + 0.182 * src35 + 0.167 * src36 + 0.143 * src37 + 0.125 * src38 + 0.111 * src39 + 0.1 * src40 + 0.091 * src41) / 21.5 :
     order == "12" ? (src + 0.917 * src1 + 0.909 * src2 + 0.9 * src3 + 0.889 * src4 + 0.875 * src5 + 0.857 * src6 + 0.833 * src7 + 0.818 * src8 + 0.8 * src9 + 0.778 * src10 + 0.75 * src11 + 0.727 * src12 + 0.714 * src13 + 0.7 * src14 + 0.667 * src15 + 0.636 * src16 + 0.625 * src17 + 0.6 * src18 + 0.583 * src19 + 0.571 * src20 + 0.556 * src21 + 0.545 * src22 + 0.5 * src23 + 0.455 * src24 + 0.444 * src25 + 0.429 * src26 + 0.417 * src27 + 0.4 * src28 + 0.375 * src29 + 0.364 * src30 + 0.333 * src31 + 0.3 * src32 + 0.286 * src33 + 0.273 * src34 + 0.25 * src35 + 0.222 * src36 + 0.2 * src37 + 0.182 * src38 + 0.167 * src39 + 0.143 * src40 + 0.125 * src41 + 0.111 * src42 + 0.1 * src43 + 0.091 * src44 + 0.083 * src45) / 23.5 :
     order == "13" ? (src + 0.923 * src1 + 0.917 * src2 + 0.909 * src3 + 0.9 * src4 + 0.889 * src5 + 0.875 * src6 + 0.857 * src7 + 0.846 * src8 + 0.833 * src9 + 0.818 * src10 + 0.8 * src11 + 0.778 * src12 + 0.769 * src13 + 0.75 * src14 + 0.727 * src15 + 0.714 * src16 + 0.7 * src17 + 0.692 * src18 + 0.667 * src19 + 0.636 * src20 + 0.625 * src21 + 0.615 * src22 + 0.6 * src23 + 0.583 * src24 + 0.571 * src25 + 0.556 * src26 + 0.545 * src27 + 0.538 * src28 + 0.5 * src29 + 0.462 * src30 + 0.455 * src31 + 0.444 * src32 + 0.429 * src33 + 0.417 * src34 + 0.4 * src35 + 0.385 * src36 + 0.375 * src37 + 0.364 * src38 + 0.333 * src39 + 0.308 * src40 + 0.3 * src41 + 0.286 * src42 + 0.273 * src43 + 0.25 * src44 + 0.231 * src45 + 0.222 * src46 + 0.2 * src47 + 0.182 * src48 + 0.167 * src49 + 0.154 * src50 + 0.143 * src51 + 0.125 * src52 + 0.111 * src53 + 0.1 * src54 + 0.091 * src55 + 0.083 * src56 + 0.077 * src57) / 29.5 :
     order == "14" ? (src + 0.929 * src1 + 0.923 * src2 + 0.917 * src3 + 0.909 * src4 + 0.9 * src5 + 0.889 * src6 + 0.875 * src7 + 0.857 * src8 + 0.846 * src9 + 0.833 * src10 + 0.818 * src11 + 0.8 * src12 + 0.786 * src13 + 0.778 * src14 + 0.769 * src15 + 0.75 * src16 + 0.727 * src17 + 0.714 * src18 + 0.7 * src19 + 0.692 * src20 + 0.667 * src21 + 0.643 * src22 + 0.636 * src23 + 0.625 * src24 + 0.615 * src25 + 0.6 * src26 + 0.583 * src27 + 0.571 * src28 + 0.556 * src29 + 0.545 * src30 + 0.538 * src31 + 0.5 * src32 + 0.462 * src33 + 0.455 * src34 + 0.444 * src35 + 0.429 * src36 + 0.417 * src37 + 0.4 * src38 + 0.385 * src39 + 0.375 * src40 + 0.364 * src41 + 0.357 * src42 + 0.333 * src43 + 0.308 * src44 + 0.3 * src45 + 0.286 * src46 + 0.273 * src47 + 0.25 * src48 + 0.231 * src49 + 0.222 * src50 + 0.214 * src51 + 0.2 * src52 + 0.182 * src53 + 0.167 * src54 + 0.154 * src55 + 0.143 * src56 + 0.125 * src57 + 0.111 * src58 + 0.1 * src59 + 0.091 * src60 + 0.083 * src61 + 0.077 * src62 + 0.071 * src63) / 32.5 :
     na

fswmaColor = highlightMovements ? (fswma > fswma[1] ? color.green : color.red) : #6d1e7f
plot(fswma, title="FSWMA", linewidth=2, color=fswmaColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/fibonacci_weighted_moving_average.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Fibonacci Weighted Moving Average script may be freely distributed under the terms of GPL-3.0 license.
study("Fibonacci Weighted Moving Average", shorttitle="FWMA", overlay=true)

length = input(title="Length", type=integer, defval=14)
src = input(title="Source", type=source, defval=close)

phi = (1 + sqrt(5)) / 2

fiboWeight(i) =>
    pow = pow(phi, i)
    (pow - pow(-1, i) / pow) / sqrt(5)

fwma(src, length) =>
    sum = 0.0
    weightSum = 0.0

    for i = 0 to length - 1
        weight = fiboWeight(length - i)
        sum := sum + nz(src[i]) * weight
        weightSum := weightSum + weight

    sum / weightSum

plot(fwma(src, length), title="FWMA", linewidth=2, color=#741b47, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/finite_impulse_response_filter.pine --- */
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Finite Impulse Response (FIR) Filter script may be freely distributed under the terms of the GPL-3.0 license.
study("Finite Impulse Response (FIR) Filter", shorttitle="FIRF", overlay=true)

coef1 = input(title="1st Coefficient", type=input.float, step=0.1, defval=1)
coef2 = input(title="2nd Coefficient", type=input.float, step=0.1, defval=3.5)
coef3 = input(title="3rd Coefficient", type=input.float, step=0.1, defval=4.5)
coef4 = input(title="4th Coefficient", type=input.float, step=0.1, defval=3)
coef5 = input(title="5th Coefficient", type=input.float, step=0.1, defval=0.5)
coef6 = input(title="6th Coefficient", type=input.float, step=0.1, defval=-0.5)
coef7 = input(title="7th Coefficient", type=input.float, step=0.1, defval=-1.5)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

src1 = nz(src[1], src)
src2 = nz(src[2], src1)
src3 = nz(src[3], src2)
src4 = nz(src[4], src3)
src5 = nz(src[5], src4)
src6 = nz(src[6], src5)

coefSum = coef1 + coef2 + coef3 + coef4 + coef5 + coef6 + coef7

firf = (
	 coef1 * src +
	 coef2 * src1 +
	 coef3 * src2 +
	 coef4 * src3 +
	 coef5 * src4 +
	 coef6 * src5 +
	 coef7 * src6
	 ) / coefSum

firfColor = highlight ? firf > firf[1] ? color.green : color.red : #6d1e7f
plot(firf, title="FIRF", linewidth=2, color=firfColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/fractal_adaptive_moving_average.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Fractal Adaptive Moving Average script may be freely distributed under the terms of GPL-3.0 license.
study(title="Fractal Adaptive Moving Average", shorttitle="FRAMA", overlay=true)

length = input(title="Length", type=integer, defval=14)
highlightMovements = input(title="Highlight Movements ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

length2 = floor(length / 2)

hh2 = highest(length2)
ll2 = lowest(length2)

N1 = (hh2 - ll2) / length2

N2 = (hh2[length2] - ll2[length2]) / length2

N3 = (highest(length) - lowest(length)) / length

D = (log(N1 + N2) - log(N3)) / log(2)

factor = exp(-4.6 * (D - 1))

frama = 0.0
frama := factor * src + (1 - factor) * nz(frama[1])

framaColor = highlightMovements ? (frama > frama[1] ? green : red) : #6d1e7f
plot(frama, title="FRAMA", linewidth=2, color=framaColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/gaussian_filter.pine --- */
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Gaussian Filter script may be freely distributed under the terms of the GPL-3.0 license.
study("Gaussian Filter", shorttitle="GF", overlay=true)

cyclePeriod = input(title="Cycle Period", type=input.integer, minval=1, defval=14)
polesNumber = input(title="Number of Poles", type=input.integer, defval=4, options=[1, 2, 3, 4])
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

PI = 2 * asin(1)
beta = (1 - cos(2 * PI / cyclePeriod)) / (pow(2, 1 / polesNumber) - 1)
alpha = -beta + sqrt(pow(beta, 2) + 2 * beta)

_gf(poles) =>
	filter = 0.0
	filter1 = nz(filter[1], src)
	filter2 = nz(filter[2], filter1)
	filter3 = nz(filter[3], filter2)
	filter4 = nz(filter[4], filter3)

	if poles == 1
		filter := alpha * src + (1 - alpha) * filter1

	if poles == 2
		filter :=
			 pow(alpha, 2) * src +
			 2 * (1 - alpha) * filter1 -
			 pow(1 - alpha, 2) * filter2

	if poles == 3
		filter :=
			 pow(alpha, 3) * src +
			 3 * (1 - alpha) * filter1 -
			 3 * pow(1 - alpha, 2) * filter2 +
			 pow(1 - alpha, 3) * filter3

	if poles == 4
		filter :=
			 pow(alpha, 4) * src +
			 4 * (1 - alpha) * filter1 -
			 6 * pow(1 - alpha, 2) * filter2 +
			 4 * pow(1 - alpha, 3) * filter3 -
			 pow(1 - alpha, 4) * filter4
	filter

gf = _gf(polesNumber)
gfColor = highlight ? gf > gf[1] ? color.green : color.red : #6d1e7f
plot(gf, title="GF", linewidth=2, color=gfColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/hampel_filter.pine --- */
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Hampel Filter script may be freely distributed under the terms of the GPL-3.0 license.
study("Hampel Filter", shorttitle="HF", overlay=true)

length = input(title="Length", type=input.integer, minval=1, defval=14)
scalingFactor = input(title="Scaling Factor", type=input.float, step=0.1, defval=3)
src = input(title="Source", type=input.source, defval=close)

_median(src, length) =>
	percentile_nearest_rank(src, length, 50)

sampleMedian = _median(src, length)

// Median Absolute Deviation
mad = _median(abs(src - sampleMedian), length)

hf = abs(src - sampleMedian) <= scalingFactor * mad
	 ? src
	 : sampleMedian

// Plot EMA of the filtered samples
plot(ema(hf, length), title="HF", linewidth=2, color=#6d1e7f, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/henderson_weighted_moving_average.pine --- */
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Henderson Weighted Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Henderson Weighted Moving Average", shorttitle="HWMA", overlay=true)

termsNumber = input(title="Terms Number", type=input.integer, minval=1, defval=7)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

// The general form of the weights of the (2m + 1)-term Henderson Weighted Moving Average
_weight(m, j) =>
	powj2 = pow(j, 2)
	powm22 = pow(m + 2, 2)

	numerator =
		 315 * (pow(m + 1, 2) - powj2) *
		 (powm22 - powj2) *
		 (pow(m + 3, 2) - powj2) *
		 (3 * powm22 - 11 * powj2 - 16)
	denominator =
		 8 * (m + 2) * (powm22 - 1) *
		 (4 * powm22 - 1) *
		 (4 * powm22 - 9) *
		 (4 * powm22 - 25)
	out = denominator != 0 ? numerator / denominator : 0
	out

sum = 0.0
weightSum = 0.0

termMult = floor((termsNumber - 1) / 2)

for i = 0 to termsNumber - 1
	weight = _weight(termMult, i - termMult)
	sum := sum + nz(src[i]) * weight
	weightSum := weightSum + weight

hwma = sum / weightSum

hwmaColor = highlight ? hwma > hwma[1] ? color.green : color.red : #6d1e7f
plot(hwma, title="HWMA", linewidth=2, color=hwmaColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/holt_exponential_moving_average.pine --- */
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Holt Exponential Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Holt Exponential Moving Average", shorttitle="HEMA", overlay=true)

alphaLength = input(title="Alpha Length", type=input.integer, defval=20, minval=1)
gammaLength = input(title="Gamma Length", type=input.integer, defval=20, minval=1)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

alpha = 2 / (alphaLength + 1)
gamma = 2 / (gammaLength + 1)

b = 0.0
hema = 0.0

hema := (1 - alpha) * (nz(hema[1]) + nz(b[1], src)) + alpha * src
b := (1 - gamma) * nz(b[1]) + gamma * (hema - nz(hema[1]))

hemaColor = highlight ? hema > hema[1] ? color.green : color.red : #6d1e7f
plot(hema, title="HEMA", linewidth=2, color=hemaColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/hull_moving_average.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Hull Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Hull Moving Average", shorttitle="HMA", overlay=true)

length = input(title="Length", type=integer, defval=14, minval=1)
src = input(title="Source", type=source, defval=close)

hma(src, length) =>
	wma(2 * wma(src, length / 2) - wma(src, length), round(sqrt(length)))

plot(hma(src, length), title="HMA", linewidth=2, color=#6d1e7f, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/infinite_impulse_response_filter.pine --- */
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Infinite Impulse Response (IIR) Filter script may be freely distributed under the terms of the GPL-3.0 license.
study("Infinite Impulse Response (IIR) Filter", shorttitle="IIRF", overlay=true)

length = input(title="Length", type=input.integer, defval=14, minval=2)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

iirfAlpha = 2 / (length + 1)
iirfLag = round(1 / iirfAlpha - 1)

iirf = 0.0
iirf := iirfAlpha * (src + change(src, iirfLag)) + (1 - iirfAlpha) * nz(iirf[1])

iirfColor = highlight ? iirf > iirf[1] ? color.green : color.red : #6d1e7f
plot(iirf, title="IIRF", linewidth=2, color=iirfColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/inverse_distance_weighted_moving_average.pine --- */
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Inverse Distance Weighted Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Inverse Distance Weighted Moving Average", shorttitle="IDWMA", overlay=true)

length = input(title="Length", type=integer, defval=14)
highlightMovements = input(title="Highlight Movements ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

sum = 0.0
weightSum = 0.0

calcWeight(src, length, i) =>
    distanceSum = 0.0
    for j = 0 to length - 1
        distanceSum := distanceSum + abs(nz(src[i]) - nz(src[j]))
    distanceSum

for i = 0 to length - 1
    weight = calcWeight(src, length, i)
    sum := sum + nz(src[i]) * weight
    weightSum := weightSum + weight

idwma = sum / weightSum

idwmaColor = highlightMovements ? (idwma > idwma[1] ? green : red) : #6d1e7f
plot(idwma, title="IDWMA", linewidth=2, color=idwmaColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/jurik_moving_average.pine --- */
//@version=3
// Copyright (c) 2007-present Jurik Research and Consulting. All rights reserved.
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Jurik Moving Average script may be freely distributed under the terms of GPL-3.0 license.
study("Jurik Moving Average", shorttitle="JMA", overlay=true)

length = input(title="Length", type=integer, defval=7)
phase = input(title="Phase", type=integer, defval=50)
power = input(title="Power", type=integer, defval=2)
src = input(title="Source", type=source, defval=close)
highlightMovements = input(title="Highlight Movements ?", type=bool, defval=true)

phaseRatio = phase < -100 ? 0.5 : phase > 100 ? 2.5 : phase / 100 + 1.5

beta = 0.45 * (length - 1) / (0.45 * (length - 1) + 2)
alpha = pow(beta, power)

jma = 0.0

e0 = 0.0
e0 := (1 - alpha) * src + alpha * nz(e0[1])

e1 = 0.0
e1 := (src - e0) * (1 - beta) + beta * nz(e1[1])

e2 = 0.0
e2 := (e0 + phaseRatio * e1 - nz(jma[1])) * pow(1 - alpha, 2) + pow(alpha, 2) * nz(e2[1])

jma := e2 + nz(jma[1])

jmaColor = highlightMovements ? (jma > jma[1] ? green : red) : #6d1e7f
plot(jma, title="JMA", linewidth=2, color=jmaColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/kaufman_adaptive_moving_average.pine --- */
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Kaufman Adaptive Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Kaufman Adaptive Moving Average", shorttitle="KAMA", overlay=true)

length = input(title="Length", type=input.integer, defval=14)
fastLength = input(title="Fast EMA Length", type=input.integer, defval=2)
slowLength = input(title="Slow EMA Length", type=input.integer, defval=30)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

mom = abs(change(src, length))
volatility = sum(abs(change(src)), length)

// Efficiency Ratio
er = volatility != 0 ? mom / volatility : 0

fastAlpha = 2 / (fastLength + 1)
slowAlpha = 2 / (slowLength + 1)

alpha = pow(er * (fastAlpha - slowAlpha) + slowAlpha, 2)

kama = 0.0
kama := alpha * src + (1 - alpha) * nz(kama[1], src)

kamaColor = highlight ? kama > kama[1] ? color.green : color.red : #6d1e7f
plot(kama, title="KAMA", linewidth=2, color=kamaColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/laguerre_filter.pine --- */
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Laguerre Filter script may be freely distributed under the terms of the GPL-3.0 license.
study("Laguerre Filter", shorttitle="LF", overlay=true)

alpha = input(title="Alpha", type=input.float, minval=0, maxval=1, step=0.1, defval=0.7)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

L0 = 0.0
L0 := alpha * src + (1 - alpha) * nz(L0[1])

L1 = 0.0
L1 := -(1 - alpha) * L0 + nz(L0[1]) + (1 - alpha) * nz(L1[1])

L2 = 0.0
L2 := -(1 - alpha) * L1 + nz(L1[1]) + (1 - alpha) * nz(L2[1])

L3 = 0.0
L3 := -(1 - alpha) * L2 + nz(L2[1]) + (1 - alpha) * nz(L3[1])

lf = (L0 + 2 * L1 + 2 * L2 + L3) / 6

lfColor = highlight ? lf > lf[1] ? color.green : color.red : #6d1e7f
plot(lf, title="LF", linewidth=2, color=lfColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/least_squares_moving_average.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Least Squares Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Least Squares Moving Average", shorttitle="LSMA", overlay=true)

length = input(title="Length", type=integer, minval=1, defval=14)
offset = input(title="Offset", type=integer, defval=0)
src = input(title="Source", type=source, defval=close)

plot(linreg(src, length, offset), title="LSMA", linewidth=2, color=#6d1e7f, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/leo_moving_average.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Leo Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Leo Moving Average", shorttitle="LMA", overlay=true)

length = input(title="Length", type=integer, minval=1, defval=14)
highlightMovements = input(title="Highlight Movements ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

lma = 2 * wma(src, length) - sma(src, length)

lmaColor = highlightMovements ? (lma > lma[1] ? green : red) : #6d1e7f

plot(lma, title="LMA", linewidth=2, color=lmaColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/linear_weighted_moving_average.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Linear Weighted Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Linear Weighted Moving Average", shorttitle="LWMA", overlay=true)

length = input(title="Length", type=integer, minval=1, defval=14)
src = input(title="Source", type=source, defval=close)

lwma(src, length) =>
	weightSum = 0.0
	sum = 0.0

	for i = 0 to length - 1
		weight = length - i
		weightSum := weightSum + weight
		sum := sum + nz(src[i]) * weight

	sum / weightSum

plot(lwma(src, length), title="LWMA", linewidth=2, color=#e69138, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/mcginley_dynamic.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// McGinley Dynamic script may be freely distributed under the terms of the GPL-3.0 license.
study("McGinley Dynamic", shorttitle="MD", overlay=true)

length = input(title="Length", type=integer, minval=1, defval=14)
k = input(title="K", type=float, step=0.1, defval=0.6)
src = input(title="Source", type=source, defval=close)

md(src, length, k) =>
	md = 0.0
	md := na(md[1]) ? src : md[1] + (src - md[1]) / (k * length * pow(src / md[1], 4))

plot(md(src, length, k), title="MD", linewidth=2, color=#6d1e7f, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/mcnicholl_moving_average.pine --- */
//@version=3
// Copyright (c) 1998-present, Dennis McNicholl
// Copyright (c) 2019-present, Alex Orekhov (everget)
// McNicholl Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("McNicholl Moving Average", shorttitle="MNMA", overlay=true)

length = input(title="Length", type=integer, defval=20)
highlightMovements = input(title="Highlight Movements ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

alpha = 2 / (length + 1)

ema1 = ema(src, length)
ema2 = ema(ema1, length)

mnma = ((2 - alpha) * ema1 - ema2) / (1 - alpha)

mnmaColor = highlightMovements ? (mnma > mnma[1] ? green : red) : #6d1e7f
plot(mnma, title="MNMA", linewidth=2, color=mnmaColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/middle_high_low_moving_average.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Middle-High-Low Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Middle-High-Low Moving Average", shorttitle="MHLMA", overlay=true)

length = input(title="Length", type=integer, minval=1, defval=14)
mhlRange = input(title="High-Low Range", type=integer, defval=10)
maType = input(title="MA Type", defval="EMA", options=["EMA", "SMA"])
highlightMovements = input(title="Highlight Movements ?", type=bool, defval=true)

mhl = avg(highest(mhlRange), lowest(mhlRange))
mhlma = maType == "EMA" ? ema(mhl, length) : sma(mhl, length)

mhlmaColor = highlightMovements ? (mhlma > mhlma[1] ? green : red) : #6d1e7f

plot(mhlma, title="MHLMA", linewidth=2, color=mhlmaColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/moving_geometric_mean.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Moving Geometric Mean script may be freely distributed under the terms of the GPL-3.0 license.
study("Moving Geometric Mean", shorttitle="MGM", overlay=true)

length = input(title="Length", type=integer, minval=1, defval=14)
src = input(title="Source", type=source, defval=close)

mgm(src, length) =>
	exp(sum(log(src), length) / length)

plot(mgm(src, length), title="MGM", linewidth=2, color=#6d1e7f, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/moving_harmonic_mean.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Moving Harmonic Mean script may be freely distributed under the terms of the GPL-3.0 license.
study("Moving Harmonic Mean", shorttitle="MHM", overlay=true)

length = input(title="Length", type=integer, defval=14, minval=1)
src = input(title="Source", type=source, defval=close)

mhm(src, length) =>
	sum = 0.0

	for i = 0 to length - 1
		sum := sum + 1 / (na(src[i]) ? 1 : src[i])

	length / sum

plot(mhm(src, length), title="MHM", linewidth=2, color=#6d1e7f, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/moving_median.pine --- */
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Moving Median script may be freely distributed under the terms of the GPL-3.0 license.
study("Moving Median", shorttitle="MM", overlay=true)

length = input(title="Length", type=input.integer, defval=14)
highlight = input(title="Highlight ?", type=input.bool, defval=true)
src = input(title="Source", type=input.source, defval=close)

median = percentile_nearest_rank(src, length, 50)

medianColor = highlight ? median > median[1] ? color.green : color.red : #6d1e7f
plot(median, title="MM", linewidth=2, color=medianColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/moving_quadratic_mean.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Moving Quadratic Mean (RMS) script may be freely distributed under the terms of the GPL-3.0 license.
study("Moving Quadratic Mean (RMS)", shorttitle="RMS", overlay=true)

length = input(title="Length", type=integer, minval=1, defval=14)
src = input(title="Source", type=source, defval=close)

rms(src, length) =>
	sqrt(sum(src * src, length) / length)

plot(rms(src, length), title="RMS", linewidth=2, color=#6d1e7f, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/multiple_hull_moving_average.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Multiple Hull Moving Average script may be freely distributed under the terms of GPL-3.0 license.
study("Multiple Hull Moving Average", shorttitle="HMA", overlay=true)

len1 = input(title="1st Length", type=integer, defval=20)
src1 = input(title="1st Source", type=source, defval=close)
hma1 = wma(2 * wma(src1, len1 / 2) - wma(src1, len1), round(sqrt(len1)))
plot(hma1, title="1", linewidth=2, color=#85200c, transp=0)

len2 = input(title="2nd Length", type=integer, defval=50)
src2 = input(title="2nd Source", type=source, defval=close)
hma2 = wma(2 * wma(src2, len2 / 2) - wma(src2, len2), round(sqrt(len2)))
plot(hma2, title="2", linewidth=2, color=#1155cc, transp=0)

len3 = input(title="3rd Length", type=integer, defval=100)
src3 = input(title="3rd Source", type=source, defval=close)
hma3 = wma(2 * wma(src3, len3 / 2) - wma(src3, len3), round(sqrt(len3)))
plot(hma3, title="3", linewidth=2, color=#f1c232, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/parabolic_sar.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Parabolic SAR script may be freely distributed under the terms of the GPL-3.0 license.
study(title="Parabolic SAR", shorttitle="PSAR", overlay=true)

start = input(0.02)
increment = input(0.02)
maximum = input(0.2)

psar = sar(start, increment, maximum)

plot(psar, style=cross, color=blue)


/* --- FILE: tradingview-pinescript-indicators-master/movings/parabolic_weighted_moving_average.pine --- */
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Parabolic Weighted Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Parabolic Weighted Moving Average", shorttitle="PWMA", overlay=true)

length = input(title="Length", type=integer, defval=14)
power = input(title="Power", type=integer, minval=0, defval=2)
highlightMovements = input(title="Highlight Movements ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

sum = 0.0
weightSum = 0.0

for i = 0 to length - 1
	weight = pow(length - i, power)
	sum := sum + nz(src[i]) * weight
	weightSum := weightSum + weight

pwma = sum / weightSum

pwmaColor = highlightMovements ? (pwma > pwma[1] ? green : red) : #6d1e7f
plot(pwma, title="PWMA", linewidth=2, color=pwmaColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/pentuple_exponential_moving_average.pine --- */
//@version=3
// Copyright (c) 2010-present, Bruno Pio
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Pentuple Exponential Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Pentuple Exponential Moving Average", shorttitle="PEMA", overlay=true)

length = input(title="Length", type=integer, defval=20)
highlightMovements = input(title="Highlight Movements ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

ema1 = ema(src, length)
ema2 = ema(ema1, length)
ema3 = ema(ema2, length)
ema4 = ema(ema3, length)
ema5 = ema(ema4, length)
ema6 = ema(ema5, length)
ema7 = ema(ema6, length)
ema8 = ema(ema7, length)

pema = 8 * ema1 - 28 * ema2 + 56 * ema3 - 70 * ema4 + 56 * ema5 - 28 * ema6 + 8 * ema7 - ema8

pemaColor = highlightMovements ? (pema > pema[1] ? green : red) : #6d1e7f
plot(pema, title="PEMA", linewidth=2, color=pemaColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/quadruple_exponential_moving_average.pine --- */
//@version=3
// Copyright (c) 2010-present, Bruno Pio
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Quadruple Exponential Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Quadruple Exponential Moving Average", shorttitle="QEMA", overlay=true)

length = input(title="Length", type=integer, defval=20)
highlightMovements = input(title="Highlight Movements ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

ema1 = ema(src, length)
ema2 = ema(ema1, length)
ema3 = ema(ema2, length)
ema4 = ema(ema3, length)
ema5 = ema(ema4, length)

qema = 5 * ema1 - 10 * ema2 + 10 * ema3 - 5 * ema4 + ema5

qemaColor = highlightMovements ? (qema > qema[1] ? green : red) : #6d1e7f
plot(qema, title="QEMA", linewidth=2, color=qemaColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/quick_moving_average.pine --- */
//@version=3
// Copyright (c) 2008-present, John McCormick
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Quick Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Quick Moving Average", shorttitle="QMA", overlay=true)

length = input(title="Length", type=integer, minval=1, defval=14)
src = input(title="Source", type=source, defval=close)
highlightMovements = input(title="Highlight Movements ?", type=bool, defval=false)

peak = length / 3
num = 0.0
denom = 0.0

for i = 1 to length + 1
	mult = 0.0
	if i <= peak
		mult := i / peak
	else
		mult := (length + 1 - i) / (length + 1 - peak)
	num := num + src[i - 1] * mult
	denom := denom + mult

qma = denom != 0.0 ? num / denom : src

qmaColor = highlightMovements ? (qma > qma[1] ? green : red) : #6d1e7f
plot(qma, title="QMA", linewidth=2, color=qmaColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/recursive_median_filter.pine --- */
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Recursive Median Filter script may be freely distributed under the terms of the GPL-3.0 license.
study("Recursive Median Filter", shorttitle="RMF", overlay=true)

medianLength = input(title="Median Length", type=input.integer, defval=5, minval=1)
lowpassLength = input(title="Lowpass Length", type=input.integer, defval=12, minval=1)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

_median(src, length) =>
	percentile_nearest_rank(src, length, 50)

PI = 2 * asin(1)

alphaArg = 2 * PI / lowpassLength
cos = cos(alphaArg)

alpha = 0.0
alpha := cos != 0 ? (cos + sin(alphaArg) - 1) / cos : nz(alpha[1])

rmf = 0.0
rmf := alpha * _median(src, medianLength) + (1 - alpha) * nz(rmf[1])

rmfColor = highlight ? rmf > rmf[1] ? color.green : color.red : #6d1e7f
plot(rmf, title="RMF", linewidth=2, color=rmfColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/recursive_median_oscillator.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Recursive Median Filter script may be freely distributed under the terms of the GPL-3.0 license.
study("Recursive Median Filter", shorttitle="RMF", overlay=true)

medianLength = input(title="Length", type=integer, minval=1, defval=5)
lowpassLength = input(title="Lowpass Length", type=integer, minval=1, defval=12)
src = input(title="Source", type=source, defval=close)

median(src, length) =>
	percentile_nearest_rank(src, length, 50)

PI = 2 * asin(1)

alphaArg = 2 * PI / lowpassLength

alpha = 0.0
alpha := cos(alphaArg) != 0 ? (cos(alphaArg) + sin(alphaArg) - 1) / cos(alphaArg) : nz(alpha[1])

rmf = 0.0
rmf := alpha * median(src, medianLength) + (1 - alpha) * nz(rmf[1])

plot(rmf, title="RMF", linewidth=2, color=#6d1e7f, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/recursive_moving_trend_average.pine --- */
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Recursive Moving Trend Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Recursive Moving Trend Average", shorttitle="RMTA", overlay=true)

length = input(title="Length", type=input.integer, defval=14, minval=1)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

alpha = 2 / (length + 1)

b = 0.0
b := (1 - alpha) * nz(b[1], src) + src

rmta = 0.0
rmta := (1 - alpha) * nz(rmta[1], src) + alpha * (src + b - nz(b[1]))

rmtaColor = highlight ? rmta > rmta[1] ? color.green : color.red : #6d1e7f
plot(rmta, title="RMTA", linewidth=2, color=rmtaColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/regularized_exponential_moving_average.pine --- */
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Regularized Exponential Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Regularized Exponential Moving Average", shorttitle="REMA", overlay=true)

length = input(title="Length", type=input.integer, defval=14)
lambda = input(title="Regularization Constant", type=input.float, minval=0, defval=0.5)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

alpha = 2 / (length + 1)

rema = 0.0
rema1 = nz(rema[1], src)
rema2 = nz(rema[2], rema1)

rema := (rema1 + alpha * (src - rema1) + lambda * (2 * rema1 - rema2)) / (lambda + 1)

remaColor = highlight ? rema > rema[1] ? color.green : color.red : #6d1e7f
plot(rema, title="REMA", linewidth=2, color=remaColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/self_weighted_moving_average.pine --- */
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Self-Weighted Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Self-Weighted Moving Average", shorttitle="SEWMA", overlay=true)

length = input(title="Length", type=integer, minval=1, defval=14)
highlightMovements = input(title="Highlight Movements ?", type=bool, defval=false)
src = input(title="Source", type=source, defval=close)

sum = 0.0
weightSum = 0.0

for i = 0 to length - 1
	weight = src[length + i]
	weightSum := weightSum + weight
	sum := sum + weight * src[i]

sewma = sum / weightSum

sewmaColor = highlightMovements ? (sewma > sewma[1] ? green : red) : #6d1e7f
plot(sewma, title="SEWMA", linewidth=2, color=sewmaColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/sharp_modified_moving_average.pine --- */
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Sharp Modified Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Sharp Modified Moving Average", shorttitle="SHMMA", overlay=true)

length = input(title="Length", type=input.integer, defval=14)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

factor = 0.0
slope = 0.0

for i = 1 to length
	factor := 1 + 2 * (i - 1)
	slope := slope + src[i - 1] * (length - factor) / 2

shmma = sma(src, length) + 6 * slope / ((length + 1) * length)

shmmaColor = highlight ? shmma > shmma[1] ? color.green : color.red : #6d1e7f
plot(shmma, title="SHMMA", linewidth=2, color=shmmaColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/simple_moving_average.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Simple Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Simple Moving Average", shorttitle="SMA", overlay=true)

length = input(title="Length", type=integer, minval=1, defval=14)
src = input(title="Source", type=source, defval=close)

plot(sma(src, length), title="SMA", linewidth=2, color=#6d1e7f, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/sine_weighted_moving_average.pine --- */
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Sine Weighted Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Sine Weighted Moving Average", shorttitle="SWMA", overlay=true)

length = input(title="Length", type=input.integer, defval=14)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

PI = 2 * asin(1)
sum = 0.0
weightSum = 0.0

for i = 0 to length - 1
	weight = sin((i + 1) * PI / (length + 1))
	sum := sum + nz(src[i]) * weight
	weightSum := weightSum + weight
	weightSum

swma = sum / weightSum

swmaColor = highlight ? swma > swma[1] ? color.green : color.red : #6d1e7f
plot(swma, title="SWMA", linewidth=2, color=swmaColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/spencer_15_point_moving_average.pine --- */
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Spencer 15-Point Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Spencer 15-Point Moving Average", shorttitle="SPMA 15", overlay=true)

src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

_weight(i) =>
	weight = 0.0

	if i == 0
		weight := -3
	if i == 1
		weight := -6
	if i == 2
		weight := -5
	if i == 3
		weight := 3
	if i == 4
		weight := 21
	if i == 5
		weight := 46
	if i == 6
		weight := 67
	if i == 7
		weight := 74
	if i == 8
		weight := 67
	if i == 9
		weight := 46
	if i == 10
		weight := 21
	if i == 11
		weight := 3
	if i == 12
		weight := -5
	if i == 13
		weight := -6
	if i == 14
		weight := -3
	weight

sum = 0.0
weightSum = 0.0

for i = 0 to 14
	weight = _weight(i)
	sum := sum + nz(src[i]) * weight
	weightSum := weightSum + weight

spma15 = sum / weightSum

spma15Color = highlight ? spma15 > spma15[1] ? color.green : color.red : #6d1e7f
plot(spma15, title="SPMA 15", linewidth=2, color=spma15Color, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/spencer_21_point_moving_average.pine --- */
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Spencer 21-Point Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Spencer 21-Point Moving Average", shorttitle="SPMA 21", overlay=true)

src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

_weight(i) =>
	weight = 0.0

	if i == 0
		weight := -1
	if i == 1
		weight := -3
	if i == 2
		weight := -5
	if i == 3
		weight := -5
	if i == 4
		weight := -2
	if i == 5
		weight := 6
	if i == 6
		weight := 18
	if i == 7
		weight := 33
	if i == 8
		weight := 47
	if i == 9
		weight := 57
	if i == 10
		weight := 60
	if i == 11
		weight := 57
	if i == 12
		weight := 47
	if i == 13
		weight := 33
	if i == 14
		weight := 18
	if i == 15
		weight := 6
	if i == 16
		weight := -2
	if i == 17
		weight := -5
	if i == 18
		weight := -5
	if i == 19
		weight := -3
	if i == 20
		weight := -1
	weight

sum = 0.0
weightSum = 0.0

for i = 0 to 20
	weight = _weight(i)
	sum := sum + nz(src[i]) * weight
	weightSum := weightSum + weight

spma21 = sum / weightSum

spma21Color = highlight ? spma21 > spma21[1] ? color.green : color.red : #6d1e7f
plot(spma21, title="SPMA 21", linewidth=2, color=spma21Color, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/t3_moving_average.pine --- */
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// T3 Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("T3 Moving Average", shorttitle="T3", overlay=true)

length = input(title="Length", type=input.integer, defval=5)
factor = input(title="Factor", type=input.float, minval=0, maxval=1, defval=0.7)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

_gd(src, length) =>
	ema(src, length) * (1 + factor) - ema(ema(src, length), length) * factor

t3 = _gd(_gd(_gd(src, length), length), length)

t3Color = highlight ? t3 > t3[1] ? color.green : color.red : #6d1e7f
plot(t3, title="T3", linewidth=2, color=t3Color, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/triangular_moving_average.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Triangular Moving Average script may be freely distributed under the terms of GPL-3.0 license.
study("Triangular Moving Average", shorttitle="TMA", overlay=true)

length = input(title="Length", type=integer, minval=1, defval=20)
highlightMovements = input(title="Highlight Movements ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

tma = sma(sma(src, ceil(length / 2)), floor(length / 2) + 1)
tmaColor = highlightMovements ? (tma > tma[1] ? green : red) : #6d1e7f

plot(tma, title="TMA", linewidth=2, color=tmaColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/trimean.pine --- */
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Trimean script may be freely distributed under the terms of the GPL-3.0 license.
study("Trimean", shorttitle="Trimean", overlay=true)

length = input(title="Length", type=input.integer, minval=1, defval=14)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

q1 = percentile_nearest_rank(src, length, 25)
median = percentile_nearest_rank(src, length, 50)
q3 = percentile_nearest_rank(src, length, 75)

trimean = (q1 + 2 * median + q3) / 4

trimeanColor = highlight ? trimean > trimean[1] ? color.green : color.red : #6d1e7f
plot(trimean, title="Trimean", linewidth=2, color=trimeanColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/vidya_variable_index_dynamic_average.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Variable Index Dynamic Average script may be freely distributed under the terms of GPL-3.0 license.
study(title="Variable Index Dynamic Average", shorttitle="VIDYA", overlay=true)

length = input(title="Length", type=integer, defval=14)
highlightMovements = input(title="Highlight Movements ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

// Chande Momentum Oscillator
getCMO(src, length) =>
    mom = change(src)
    upSum = sum(max(mom, 0), length)
    downSum = sum(-min(mom, 0), length)
    out = (upSum - downSum) / (upSum + downSum)
    out

cmo = abs(getCMO(src, length))

alpha = 2 / (length + 1)

vidya = 0.0
vidya := src * alpha * cmo + nz(vidya[1]) * (1 - alpha * cmo)

vidyaColor = highlightMovements ? (vidya > vidya[1] ? green : red) : #6d1e7f
plot(vidya, title="VIDYA", linewidth=2, color=vidyaColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/weighted_moving_average.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Weighted Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Weighted Moving Average", shorttitle="WMA", overlay=true)

length = input(title="Length", type=integer, minval=1, defval=14)
src = input(title="Source", type=source, defval=close)

plot(wma(src, length), title="WMA", linewidth=2, color=#6d1e7f, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/wilder_modified_moving_average.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Wilder Modified Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Wilder Modified Moving Average", shorttitle="WMMA", overlay=true)

length = input(title="Length", type=integer, minval=1, defval=14)
src = input(title="Source", type=source, defval=close)

plot(rma(src, length), title="WMMA", linewidth=2, color=#6d1e7f, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/movings/zero_lag_exponential_moving_average.pine --- */
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Zero Lag Exponential Moving Average script may be freely distributed under the terms of the GPL-3.0 license.
study("Zero Lag Exponential Moving Average", shorttitle="ZLEMA", overlay=true)

length = input(title="Length", type=input.integer, defval=14)
src = input(title="Source", type=input.source, defval=close)
highlight = input(title="Highlight ?", type=input.bool, defval=true)

lag = floor((length - 1) / 2)
zlema = ema(src + (src - src[lag]), length)

zlemaColor = highlight ? zlema > zlema[1] ? color.green : color.red : #6d1e7f
plot(zlema, title="ZLEMA", linewidth=2, color=zlemaColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/accelerator_oscillator.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Accelerator Oscillator script may be freely distributed under the terms of GPL-3.0 license.
study("Accelerator Oscillator", shorttitle="AC")

fastLength = input(title="Fast Length", type=integer, defval=5)
slowLength = input(title="Slow Length", type=integer, defval=34)
smoothLength = input(title="Smoothing Length", type=integer, defval=5)

ao = sma(hl2, fastLength) - sma(hl2, slowLength)

ac = ao - sma(ao, smoothLength)

acColor = ac >= 0 ? (ac[1] < ac ? #26A69A : #B2DFDB) : (ac[1] < ac ? #FFCDD2 : #EF5350)
plot(ac, title="AC", style=columns, color=acColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/accumulative_swing_index.pine --- */
//@version=3
// Copyright (c) 2017-present, Alex Orekhov (everget)
// Accumulative Swing Index script may be freely distributed under the terms of GPL-3.0 license.
study("Accumulative Swing Index", shorttitle="ASI")

limit = input(title="Limit Move Value", type=float, defval=10000)

// Swing Index
getSI(limit) =>
    H_C1 = abs(high - close[1])
    L_C1 = abs(low - close[1])
    H_L = abs(high - low)
    C1_O1 = abs(close[1] - open[1])
    K = max(H_C1, L_C1)
    R = iff(H_C1 >= max(L_C1, H_L), H_C1 - 0.5 * L_C1 + 0.25 * C1_O1, iff(L_C1 >= max(H_C1, H_L), L_C1 - 0.5 * H_C1 + 0.25 * C1_O1, H_L + 0.25 * C1_O1))
    result = 50 * ((close - close[1] + 0.5 * (close - open) + 0.25 * (close[1] - open[1])) / R) * K / limit
    result

// Accumulative Swing Index
asi = cum(getSI(limit))

asiColor = asi >= asi[1] ? #0ebb23 : red

plot(asi, title="ASI", color=asiColor, transp=0)

/* --- FILE: tradingview-pinescript-indicators-master/oscillators/asymmetrical_rsi.pine --- */
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Asymmetrical RSI script may be freely distributed under the terms of the GPL-3.0 license.
study("Asymmetrical RSI", shorttitle="ARSI")

length = input(title="Length", type=input.integer, defval=14)
obLevel = input(title="Overbought Level", type=input.integer, defval=70)
osLevel = input(title="Oversold Level", type=input.integer, defval=30)
src = input(title="Source", type=input.source, defval=close)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=input.bool, defval=true)

roc = roc(src, 1)

upCount = sum(roc >= 0 ? 1 : 0, length)
upAlpha = 1 / upCount

upSum = 0.0
upSum := upAlpha * (roc >= 0 ? roc : 0) + (1 - upAlpha) * nz(upSum[1], upSum)

downCount = length - upCount
downAlpha = 1 / downCount

downSum = 0.0
downSum := downAlpha * (roc >= 0 ? 0 : abs(roc)) + (1 - downAlpha) * nz(downSum[1], downSum)

arsi = fixnan(100 * upSum / (upSum + downSum))

arsiColor = arsi > obLevel ? #0ebb23 : arsi < osLevel ? #ff0000 : #f4b77d
plot(arsi, title="ARSI", linewidth=2, color=arsiColor, transp=0)

transparent = color.new(color.white, 100)

maxLevelPlot = hline(100, title="Max Level", linestyle=hline.style_dotted, color=transparent)
obLevelPlot = hline(obLevel, title="Overbought Level", linestyle=hline.style_dotted)
hline(50, title="Middle Level", linestyle=hline.style_dotted)
osLevelPlot = hline(osLevel, title="Oversold Level", linestyle=hline.style_dotted)
minLevelPlot = hline(0, title="Min Level", linestyle=hline.style_dotted, color=transparent)

fill(obLevelPlot, osLevelPlot, color=color.purple, transp=95)

obFillColor = arsi > obLevel and highlightBreakouts ? color.green : transparent
osFillColor = arsi < osLevel and highlightBreakouts ? color.red : transparent

fill(maxLevelPlot, obLevelPlot, color=obFillColor, transp=90)
fill(minLevelPlot, osLevelPlot, color=osFillColor, transp=90)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/awesome_oscillator.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Awesome Oscillator script may be freely distributed under the terms of GPL-3.0 license.
study("Awesome Oscillator", shorttitle="AO")

fastLength = input(title="Fast Length", type=integer, defval=5)
slowLength = input(title="Slow Length", type=integer, defval=34)

ao = sma(hl2, fastLength) - sma(hl2, slowLength)

aoColor = ao >= 0 ? (ao[1] < ao ? #26A69A : #B2DFDB) : (ao[1] < ao ? #FFCDD2 : #EF5350)
plot(ao, title="AO", style=columns, color=aoColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/cci_commodity_channel_index.pine --- */
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Commodity Channel Index (CCI) script may be freely distributed under the terms of the GPL-3.0 license.
study("Commodity Channel Index", shorttitle="CCI")

length = input(title="Length", type=integer, defval=20)
obLevel = input(title="Overbought Level", type=integer, defval=100)
osLevel = input(title="Oversold Level", type=integer, defval=-100)
maxLevel = input(title="Max Level", type=integer, defval=300)
minLevel = input(title="Min Level", type=integer, defval=-300)
highlightBreakouts = input(title="Highlight Breakouts ?", type=bool, defval=true)
srcInput = input(title="Source", defval="hlc3",
	 options=["open",
				 "high",
				 "low",
				 "close",
				 "oo2",
				 "oh2",
				 "ol2",
				 "oc2",
				 "hh2",
				 "hl2",
				 "hc2",
				 "ll2",
				 "lc2",
				 "cc2",
				 "hlc3",
				 "ohlc4",
				 "wc",
				 "volume",
				 "acc/dist",
				 "on balance volume",
				 "price volume trend"])

getBaseSource(input) =>
	src = 0.0
	if input == "open"
		src := open
	if input == "high"
		src := high
	if input == "low"
		src := low
	if input == "close"
		src := close
	if input == "oo2"
		src := (open + nz(open[1])) / 2
	if input == "oh2"
		src := (open + high) / 2
	if input == "ol2"
		src := (open + low) / 2
	if input == "oc2"
		src := (open + close) / 2
	if input == "hh2"
		src := (high + nz(high[1])) / 2
	if input == "hl2" // Median Price
		src := hl2
	if input == "hc2"
		src := (high + close) / 2
	if input == "ll2"
		src := (low + nz(low[1])) / 2
	if input == "lc2"
		src := (low + close) / 2
	if input == "cc2"
		src := (close + nz(close[1])) / 2
	if input == "hlc3" // Typical Price
		src := hlc3
	if input == "ohlc4"
		src := ohlc4
	if input == "wc" // Weighted Close
		src := (2 * close + high + low) / 4
	if input == "volume"
		src := volume
	if input == "acc/dist"
		src := accdist
	if input == "on balance volume"
		src := cum(sign(change(close)) * volume)
	if input == "price volume trend"
		src := cum(roc(src, 1) * volume)
	src

src = getBaseSource(srcInput)

cci = (src - sma(src, length)) / (0.015 * dev(src, length))

cciColor = cci > obLevel ? #0ebb23 : cci < osLevel ? #ff0000 : #f4b77d
plot(cci, title="CCI", linewidth=2, color=cciColor, transp=0)

transparent = color(white, 100)

maxLevelPlot = hline(maxLevel, title="Max Level", linestyle=dotted, color=transparent)
obLevelPlot = hline(obLevel, title="Overbought Level", linestyle=dotted)
hline(0, title="Zero Level", linestyle=dotted)
osLevelPlot = hline(osLevel, title="Oversold Level", linestyle=dotted)
minLevelPlot = hline(minLevel, title="Min Level", linestyle=dotted, color=transparent)

fill(obLevelPlot, osLevelPlot, color=purple, transp=95)

obFillColor = cci > obLevel and highlightBreakouts ? green : transparent
osFillColor = cci < osLevel and highlightBreakouts ? red : transparent

fill(maxLevelPlot, obLevelPlot, color=obFillColor, transp=90)
fill(minLevelPlot, osLevelPlot, color=osFillColor, transp=90)

co = crossover(cci, obLevel)
cu = crossunder(cci, osLevel)

alertcondition(co, title="Alert on CCI Overbought", message="CCI Overbought!")
alertcondition(cu, title="Alert on CCI Oversold", message="CCI Oversold!")


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/center_of_gravity_oscillator.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// CG Oscillator script may be freely distributed under the terms of the GPL-3.0 license.
study("CG Oscillator", shorttitle="CGO")

length = input(title="Length", type=integer, minval=1, defval=10)
applyFilling = input(title="Apply Filling ?", type=bool, defval=false)
src = input(title="Source", type=source, defval=hl2)

numeratorSum = 0.0
denominatorSum = 0.0

for i = 0 to length - 1
	numeratorSum := numeratorSum + (i + 1) * nz(src[i])
	denominatorSum := denominatorSum + nz(src[i])

cgo = -numeratorSum / denominatorSum

cgoPlot = plot(cgo, title="CGO", color=#3d85c6, transp=0)
cgoPrevPlot = plot(cgo[1], title="CGO Prev", color=#ff3e7d, transp=0)

fillColor = applyFilling ? (cgo > cgo[1] ? #0ebb23 : #cc0000) : color(white, 100)
fill(cgoPlot, cgoPrevPlot, color=fillColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/chande_momentum_oscillator.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Chande Momentum Oscillator script may be freely distributed under the terms of GPL-3.0 license.
study("Chande Momentum Oscillator", shorttitle="CMO")

length = input(title="Length", type=integer, defval=9)
obLevel = input(title="Overbought Level", type=integer, defval=50)
osLevel = input(title="Oversold Level", type=integer, defval=-50)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

mom = change(src)

upSum = sum(max(mom, 0), length)
downSum = sum(-min(mom, 0), length)

cmo = 100 * (upSum - downSum) / (upSum + downSum)

cmoColor = cmo > obLevel ? #0ebb23 : cmo < osLevel ? #ff0000 : #f4b77d

plot(cmo, title="CMO", linewidth=2, color=cmoColor, transp=0)

transparent = color(white, 100)

maxBand = hline(100, title="Max Level", linestyle=dotted, color=transparent)
hline(0, title="Zero Level", linestyle=dotted)
minBand = hline(-100, title="Min Level", linestyle=dotted, color=transparent)

obBand = hline(obLevel, title="Overbought Level", linestyle=dotted)
osBand = hline(osLevel, title="Oversold Level", linestyle=dotted)
fill(obBand, osBand, color=purple, transp=95)

obFillColor = cmo > obLevel and highlightBreakouts ? green : transparent
osFillColor = cmo < osLevel and highlightBreakouts ? red : transparent

fill(maxBand, obBand, color=obFillColor, transp=80)
fill(minBand, osBand, color=osFillColor, transp=80)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/coppock_curve.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Coppock Curve script may be freely distributed under the terms of GPL-3.0 license.
study("Coppock Curve")

length = input(title="Smoothing Length", type=integer, defval=10)
longRocLength = input(title="Long ROC Length", type=integer, defval=14)
shortRocLength = input(title="Short ROC Length", type=integer, defval=11)
src = input(title="Source", type=source, defval=close)

coppock = wma(roc(src, longRocLength) + roc(src, shortRocLength), length)

coppockColor = coppock > 0 ? #0ebb23 : red

plot(coppock, title="Coppock", linewidth=2, color=coppockColor, transp=0)
hline(0, title="Zero Level", linestyle=dotted)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/demarker.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// DeMarker script may be freely distributed under the terms of the GPL-3.0 license.
study("DeMarker", shorttitle="DeMarker")

length = input(title="Length", type=integer, defval=14)
maType = input(title="Smoothing Type", defval="SMA", options=["EMA", "SMA", "VWMA", "WMA"])
obLevel = input(title="Overbought Level", type=float, step=0.1, defval=0.7)
osLevel = input(title="Oversold Level", type=float, step=0.1, defval=0.3)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

getMA(type, src, length) =>
    type == "SMA" ? sma(src, length) :
     type == "EMA" ? ema(src, length) :
     type == "VWMA" ? vwma(src, length) :
     type == "WMA" ? wma(src, length) :
     na

demax = max(change(high), 0)
demin = -min(change(low), 0)

demarker = getMA(maType, demax, length) / (getMA(maType, demax, length) + getMA(maType, demin, length))

demarkerColor = demarker > obLevel ? #0ebb23 : demarker < osLevel ? #ff0000 : #f4b77d
plot(demarker, title="DeMarker", linewidth=2, color=demarkerColor, transp=0)

transparent = color(white, 100)

maxLevelPlot = hline(1, title="Max Level", linestyle=dotted, color=transparent)
obLevelPlot = hline(obLevel, title="Overbought Level", linestyle=dotted)
hline(0.5, title="Middle Level", linestyle=dotted)
osLevelPlot = hline(osLevel, title="Oversold Level", linestyle=dotted)
minLevelPlot = hline(0, title="Min Level", linestyle=dotted, color=transparent)

fill(obLevelPlot, osLevelPlot, color=purple, transp=95)

obFillColor = demarker > obLevel and highlightBreakouts ? green : transparent
osFillColor = demarker < osLevel and highlightBreakouts ? red : transparent

fill(maxLevelPlot, obLevelPlot, color=obFillColor, transp=90)
fill(minLevelPlot, osLevelPlot, color=osFillColor, transp=90)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/derivative_oscillator.pine --- */
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Derivative Oscillator script may be freely distributed under the terms of GPL-3.0 license.
study("Derivative Oscillator", shorttitle="DOSC")

rsiLength = input(title="RSI Length", type=input.integer, defval=14)
ema1Length = input(title="1st EMA Smoothing Length", type=input.integer, defval=5)
ema2Length = input(title="2nd EMA Smoothing Length", type=input.integer, defval=3)
smaLength = input(title="3rd SMA Smoothing Length", type=input.integer, defval=9)
signalLength = input(title="Signal Length", type=input.integer, defval=9)
src = input(title="Source", type=input.source, defval=close)

smoothedRSI = ema(ema(rsi(src, rsiLength), ema1Length), ema2Length)
dosc = smoothedRSI - sma(smoothedRSI, smaLength)
signal = sma(dosc, signalLength)

doscColor = dosc >= 0 ? dosc[1] < dosc ? #26A69A : #B2DFDB : dosc[1] < dosc ? #FFCDD2 : #EF5350
plot(dosc, title="DOSC", style=plot.style_columns, linewidth=2, color=doscColor, transp=0)
plot(signal, title="Signal", linewidth=2, color=color.black, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/didi_index.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Didi Index script may be freely distributed under the terms of GPL-3.0 license.
study("Didi Index")

curtaLength = input(title="Curta (Short) Length", type=integer, defval=3)
mediaLength = input(title="Media (Medium) Length", type=integer, defval=8)
longaLength = input(title="Longa (Long) Length", type=integer, defval=20)
src = input(title="Source", type=source, defval=close)
applyFilling = input(title="Apply Ribbon Filling ?", type=bool, defval=true)
highlightCrossovers = input(title="Highlight Crossovers ?", type=bool, defval=true)

media = sma(src, mediaLength)
curta = sma(src, curtaLength) / media
longa = sma(src, longaLength) / media

curtaPlot = plot(curta, title="Curta", color=green)
plot(1, title="Media", color=black, transp=0)
longaPlot = plot(longa, title="Longa", color=red)

fillColor = applyFilling ? (curta > longa ? #0ebb23 : red) : color(white, 100) 
fill(curtaPlot, longaPlot, color=fillColor, transp=80)

plotshape(crossover(curta, longa) and highlightCrossovers ? avg(longa, longa[1]) : na, title="Crossover", location=location.absolute, style=shape.circle, size=size.tiny, color=green, transp=20)
plotshape(crossunder(curta, longa) and highlightCrossovers ? avg(longa, longa[1]) : na, title="Crossunder", location=location.absolute, style=shape.circle, size=size.tiny, color=red, transp=20)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/disparity_index.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Disparity Index script may be freely distributed under the terms of the GPL-3.0 license.
study("Disparity Index", shorttitle="DI")

length = input(title="Length", type=integer, minval=1, defval=14)
src = input(title="Source", type=source, defval=close)

di = 100 * (src - sma(src, length)) / sma(src, length)

diColor = di >= 0.0 ? #0ebb23 : #ff0000
plot(di, title="Disparity Index", linewidth=2, color=diColor, transp=0)

hline(0, title="Zero Level", linestyle=dotted, color=#989898)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/dorsey_inertia.pine --- */
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Dorsey Inertia script may be freely distributed under the terms of GPL-3.0 license.
study("Dorsey Inertia", shorttitle="Inertia")

stdevLength = input(title="Standard Deviation Length", type=integer, defval=21)
rviSmoothLength = input(title="RVI Smoothing Length", type=integer, defval=14)
smoothLength = input(title="Inertia Smoothing Length", type=integer, defval=14)

// Relative Volatility Index (1993)
rviOriginal(src, stdevLength, smoothLength) =>
	stdev = stdev(src, stdevLength)
	upSum = ema(change(src) >= 0 ? stdev : 0, smoothLength)
	downSum = ema(change(src) >= 0 ? 0 : stdev, smoothLength)
	100 * upSum / (upSum + downSum)

rvi = avg(rviOriginal(high, stdevLength, rviSmoothLength), rviOriginal(low, stdevLength, rviSmoothLength))
inertia = linreg(rvi, smoothLength, 0)

inertiaColor = inertia > 50 ? #0ebb23 : red

plot(inertia, title="Inertia", linewidth=2, color=inertiaColor, transp=0)
hline(50, title="Middle Level", linestyle=dotted)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/dynamic_momentum_index.pine --- */
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Dynamic Momentum Index script may be freely distributed under the terms of the GPL-3.0 license.
study("Dynamic Momentum Index", shorttitle="DMI")

rsiLength = input(title="Initial RSI Length", type=integer, minval=1, defval=14)
stdevLength = input(title="Standard Deviation Length", type=integer, minval=1, defval=5)
maLength = input(title="Smoothing Length", type=integer, minval=1, defval=10)
lower = input(title="Lower Bound", type=integer, defval=5)
upper = input(title="Upper Bound", type=integer, defval=30)
obLevel = input(title="Overbought Level", type=integer, defval=70)
osLevel = input(title="Oversold Level", type=integer, defval=30)
src = input(title="Source", type=source, defval=close)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=bool, defval=true)

stdev = stdev(src, stdevLength)
V = stdev / sma(stdev, maLength)

T = round(rsiLength / V)
T := T > upper ? upper : T < lower ? lower : T

// Wilder's Smoothing (Running Moving Average)
_rma(src, length) =>
    out = 0.0
    out := ((length - 1) * nz(out[1]) + src) / length

_rsi(src, length) =>
	upSum = _rma(max(change(src), 0), length)
	downSum = _rma(-min(change(src), 0), length)
	rsi = downSum == 0
		 ? 100
		 : upSum == 0
			 ? 0
			 : 100 - (100 / (1 + upSum / downSum))
	rsi

dmi = _rsi(src, T)

dmiColor = dmi > obLevel ? #0ebb23 : dmi < osLevel ? red : #f4b77d
plot(dmi, title="DMI", linewidth=2, color=dmiColor, transp=0)

transparent = color(white, 100)

maxLevelPlot = hline(100, title="Max Level", linestyle=dotted, color=transparent)
obLevelPlot = hline(obLevel, title="Overbought Level", linestyle=dotted)
hline(50, title="Middle Level", linestyle=dotted)
osLevelPlot = hline(osLevel, title="Oversold Level", linestyle=dotted)
minLevelPlot = hline(0, title="Min Level", linestyle=dotted, color=transparent)

fill(obLevelPlot, osLevelPlot, color=purple, transp=95)

obFillColor = dmi > obLevel and highlightBreakouts ? green : transparent
osFillColor = dmi < osLevel and highlightBreakouts ? red : transparent

fill(maxLevelPlot, obLevelPlot, color=obFillColor, transp=90)
fill(minLevelPlot, osLevelPlot, color=osFillColor, transp=90)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/ehlers_cyber_cycle.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Ehlers Cyber Cycle script may be freely distributed under the terms of the GPL-3.0 license.
study("Ehlers Cyber Cycle", shorttitle="ECC")

length = input(title="Length", type=integer, minval=1, defval=14)
alpha = input(title="Alpha", type=float, step=0.1, defval=0.7)
applyFilling = input(title="Apply Filling ?", type=bool, defval=false)
src = input(title="Source", type=source, defval=close)

smooth = (src + 2 * nz(src[1]) + 2 * nz(src[2]) + nz(src[3])) / 6

ecc = 0.0
ecc := pow(1 - alpha / 2, 2) * (smooth - 2 * nz(smooth[1]) + nz(smooth[2])) + 2 * (1 - alpha) * nz(ecc[1]) - pow(1 - alpha, 2) * nz(ecc[2])

eccPlot = plot(ecc, title="ECC", color=#3d85c6, transp=0)
eccPrevPlot = plot(ecc[1], title="Trigger", color=#ff3e7d, transp=0)

fillColor = applyFilling ? (ecc > ecc[1] ? #0ebb23 : #cc0000) : color(white, 100)
fill(eccPlot, eccPrevPlot, color=fillColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/ehlers_decycler_oscillator.pine --- */
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Ehlers Decycler Oscillator script may be freely distributed under the terms of GPL-3.0 license.
study("Ehlers Decycler Oscillator", shorttitle="Decycler Oscillator")

hpPeriod = input(title="High-pass Filter Period", type=integer, defval=125)
k = input(title="K Multiplier", type=float, step=0.1, defval=1)
hpPeriod2 = input(title="High-pass Filter Period 2", type=integer, defval=100)
k2 = input(title="K Multiplier 2", type=float, step=0.1, defval=1.2)
src = input(title="Source", type=source, defval=close)
highlightCrossovers = input(title="Highlight Crossovers ?", type=bool, defval=true)
highlightZeroCrossovers = input(title="Highlight Zero Line Crossovers ?", type=bool, defval=false)
applyFilling = input(title="Apply Ribbon Filling ?", type=bool, defval=false)

PI = 2 * asin(1)

// High-pass Filter
_hp(src, hpPeriod, mult) =>
    alphaArg = 2 * PI / (mult * hpPeriod * sqrt(2))
    
    alpha = 0.0
    alpha := cos(alphaArg) != 0
         ? (cos(alphaArg) + sin(alphaArg) - 1) / cos(alphaArg)
         : nz(alpha[1])
    
    hp = 0.0
    hp := pow(1 - (alpha / 2), 2) * (src - 2 * nz(src[1]) + nz(src[2])) + 2 * (1 - alpha) * nz(hp[1]) - pow(1 - alpha, 2) * nz(hp[2])
    hp

hp = _hp(src, hpPeriod, 1)
decycler = src - hp
decosc = 100 * k * _hp(decycler, hpPeriod, 0.5) / src

hp2 = _hp(src, hpPeriod2, 1)
decycler2 = src - hp2
decosc2 = 100 * k2 * _hp(decycler2, hpPeriod2, 0.5) / src

trendColor = decosc2 > decosc ? #0ebb23 : red

decoscColor = applyFilling ? trendColor : #ff5048
decosc2Color = applyFilling ? trendColor : #f5c75e

decoscPlot = plot(decosc, title="1", linewidth=2, color=decoscColor, transp=0)
decosc2Plot = plot(decosc2, title="2", linewidth=2, color=decosc2Color, transp=0)
hline(0, title="Zero Level", linestyle=dotted)

transparent = color(white, 100)

fillColor = applyFilling ? trendColor : transparent
fill(decoscPlot, decosc2Plot, color=fillColor, transp=70)

zeroCrossBgColor = highlightZeroCrossovers ? (decosc > 0 or decosc2 > 0 ? green : red) : transparent
bgcolor(zeroCrossBgColor, transp=85)

plotshape(highlightCrossovers and crossover(decosc, decosc2) ? avg(decosc, decosc[1]) : na, title="Crossover", location=location.absolute, style=shape.circle, size=size.tiny, color=green, transp=0)
plotshape(highlightCrossovers and crossunder(decosc, decosc2) ? avg(decosc, decosc[1]) : na, title="Crossunder", location=location.absolute, style=shape.circle, size=size.tiny, color=red, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/ehlers_fisherized_deviation_scaled_oscillator.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Ehlers Fisherized Deviation-Scaled Oscillator script may be freely distributed under the terms of the GPL-3.0 license.
study("Ehlers Fisherized Deviation-Scaled Oscillator", shorttitle="EFDSO")

length = input(title="Length", type=integer, defval=40, minval=1)
ssfLength = input(title="Super Smoother Filter Length", type=integer, defval=20, minval=1)
numberOfPoles = input(title="Number of Poles", type=integer, defval=2, options=[2, 3])
obLevel = input(title="Overbought Level", type=float, step=0.1, defval=2)
osLevel = input(title="Oversold Level", type=float, step=0.1, defval=-2)
maxLevel = input(title="Max Level", type=float, step=0.1, defval=4.0)
minLevel = input(title="Min Level", type=float, step=0.1, defval=-4.0)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

PI = 2 * asin(1)

get2PoleSSF(src, length) =>
    arg = sqrt(2) * PI / length
    a1 = exp(-arg)
    b1 = 2 * a1 * cos(arg)
    c2 = b1
    c3 = -pow(a1, 2)
    c1 = 1 - c2 - c3

    ssf = 0.0
    ssf := c1 * src + c2 * nz(ssf[1]) + c3 * nz(ssf[2])

get3PoleSSF(src, length) =>
    arg = PI / length
    a1 = exp(-arg)
    b1 = 2 * a1 * cos(1.738 * arg)
    c1 = pow(a1, 2)

    coef2 = b1 + c1
    coef3 = -(c1 + b1 * c1)
    coef4 = pow(c1, 2)
    coef1 = 1 - coef2 - coef3 - coef4

    ssf = 0.0
    ssf := coef1 * src + coef2 * nz(ssf[1]) + coef3 * nz(ssf[2]) + coef4 * nz(ssf[3])

zeros = src - nz(src[2])
arg = avg(zeros, zeros[1])

// Ehlers Super Smoother Filter
essf = numberOfPoles == 2
     ? get2PoleSSF(arg, ssfLength)
     : get3PoleSSF(arg, ssfLength)

// Rescale filter in terms of Standard Deviations
stdev = stdev(essf, length)
scaledFilter = 0.0
scaledFilter := stdev != 0
     ? essf / stdev
     : nz(scaledFilter[1])

// Apply Fisher Transform to establish real Gaussian Probability Distribution
efdso = 0.0
efdso := abs(scaledFilter) < 2
     ? 0.5 * log((1 + scaledFilter / 2) / (1 - scaledFilter / 2))
     : nz(efdso[1])

efdsoColor = efdso > obLevel ? #0ebb23 : efdso < osLevel ? #ff0000 : #f4b77d
plot(efdso, title="EFDSO", linewidth=2, color=efdsoColor, transp=0)

transparent = color(white, 100)

maxLevelPlot = hline(maxLevel, title="Max Level", linestyle=dotted, color=transparent)
obLevelPlot = hline(obLevel, title="Overbought Level", linestyle=dotted)
hline(0, title="Zero Level", linestyle=dotted)
osLevelPlot = hline(osLevel, title="Oversold Level", linestyle=dotted)
minLevelPlot = hline(minLevel, title="Min Level", linestyle=dotted, color=transparent)

fill(obLevelPlot, osLevelPlot, color=purple, transp=95)

obFillColor = efdso > obLevel and highlightBreakouts ? green : transparent
osFillColor = efdso < osLevel and highlightBreakouts ? red : transparent

fill(maxLevelPlot, obLevelPlot, color=obFillColor, transp=90)
fill(minLevelPlot, osLevelPlot, color=osFillColor, transp=90)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/ehlers_roofing_filter.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Ehlers Roofing Filter indicator script may be freely distributed under the terms of the GPL-3.0 license.
study("Ehlers Roofing Filter", shorttitle="ERF")

highpassLength = input(title="HighPass Length", type=integer, minval=1, defval=48)
ssfLength = input(title="Super Smoother Filter Length", type=integer, minval=1, defval=10)
numberOfPoles = input(title="Number of Poles", type=integer, defval=2, options=[2, 3])
src = input(title="Source", type=source, defval=close)

PI = 2 * asin(1)

twoPoleSuperSmootherFilter(src, length) =>
	arg = sqrt(2) * PI / length
	a1 = exp(-arg)
	b1 = 2 * a1 * cos(arg)
	c2 = b1
	c3 = -pow(a1, 2)
	c1 = 1 - c2 - c3

	ssf = 0.0
	ssf := c1 * src + c2 * nz(ssf[1]) + c3 * nz(ssf[2])

threePoleSuperSmootherFilter(src, length) =>
	arg = PI / length
	a1 = exp(-arg)
	b1 = 2 * a1 * cos(1.738 * arg)
	c1 = pow(a1, 2)

	coef2 = b1 + c1
	coef3 = -(c1 + b1 * c1)
	coef4 = pow(c1, 2)
	coef1 = 1 - coef2 - coef3 - coef4

	ssf = 0.0
	ssf := coef1 * src + coef2 * nz(ssf[1]) + coef3 * nz(ssf[2]) + coef4 * nz(ssf[3])

roofingFilter(src, highpassLength, ssfLength, numberOfPoles) =>
	alphaArg = 2 * PI / (highpassLength * sqrt(2))

	alpha = 0.0
	alpha := cos(alphaArg) != 0
		 ? (cos(alphaArg) + sin(alphaArg) - 1) / cos(alphaArg)
		 : nz(alpha[1])

	highpass = 0.0
	highpass := pow(1 - (alpha / 2), 2) * (src - 2 * nz(src[1]) + nz(src[2])) + 2 * (1 - alpha) * nz(highpass[1]) - pow(1 - alpha, 2) * nz(highpass[2])

	numberOfPoles == 2
	 ? twoPoleSuperSmootherFilter((highpass + nz(highpass[1])) / 2, ssfLength)
	 : threePoleSuperSmootherFilter((highpass + nz(highpass[1])) / 2, ssfLength)

erf = roofingFilter(src, highpassLength, ssfLength, numberOfPoles)

erfColor = erf >= 0.0 ? #0ebb23 : #ff0000

plot(erf, title="ERF", linewidth=2, color=erfColor, transp=0)

hline(0, title="Zero Level", linestyle=dotted, color=#989898)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/ehlers_smoothed_adaptive_momentum.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Ehlers Smoothed Adaptive Momentum script may be freely distributed under the terms of GPL-3.0 license.
study("Ehlers Smoothed Adaptive Momentum", shorttitle="ESAM")

length = input(title="Cutoff", type=integer, defval=8)
alpha = input(title="Alpha", type=float, minval=0, step=0.1, defval=0.7)
poles = input(title="Super Smoother Filter Poles", type=integer, defval=3, options=[2, 3])
src = input(title="Source", type=source, defval=close)

median(src, length) =>
    percentile_nearest_rank(src, length, 50)

PI = 2 * asin(1)

get2PoleSSF(src, length) =>
    arg = sqrt(2) * PI / length
    a1 = exp(-arg)
    b1 = 2 * a1 * cos(arg)
    c2 = b1
    c3 = -pow(a1, 2)
    c1 = 1 - c2 - c3
    
    ssf = 0.0
    ssf := c1 * src + c2 * nz(ssf[1]) + c3 * nz(ssf[2])

get3PoleSSF(src, length) =>
    arg = PI / length
    a1 = exp(-arg)
    b1 = 2 * a1 * cos(1.738 * arg)
    c1 = pow(a1, 2)

    coef2 = b1 + c1
    coef3 = -(c1 + b1 * c1)
    coef4 = pow(c1, 2)
    coef1 = 1 - coef2 - coef3 - coef4

    ssf = 0.0
    ssf := coef1 * src + coef2 * nz(ssf[1]) + coef3 * nz(ssf[2]) + coef4 * nz(ssf[3])

hilbertTransform(src) =>
    0.0962 * src + 0.5769 * nz(src[2]) - 0.5769 * nz(src[4]) - 0.0962 * nz(src[6])

computeComponent(src, periodMult) =>
    hilbertTransform(src) * periodMult

getESAM(src, length, alpha, poles) =>
    smooth = (src + 2 * nz(src[1]) + 2 * nz(src[2]) + nz(src[3])) / 6

    cycle = 0.0
    cycle := pow(1 - alpha / 2, 2) * (smooth - 2 * nz(smooth[1]) + nz(smooth[2])) + 2 * (1 - alpha) * nz(cycle[1]) - pow(1 - alpha, 2) * nz(cycle[2])

    if n < 7
        cycle := (src - 2 * nz(src[1]) + nz(src[2])) / 4
    
    instPeriod = 0.0
    instPeriodMult = 0.8 * nz(instPeriod[1]) + 0.5
    
    I1 = 0.0
    Q1 = 0.0
    
    // Compute InPhase and Quadrature Components
    I1 := nz(cycle[3])
    Q1 := computeComponent(src, instPeriodMult)
    
    deltaPhase = 0.0
    
    if Q1 != 0 and Q1[1] != 0
        deltaPhase := (I1 / Q1 - I1[1] / Q1[1]) / (1 + I1 * I1[1] / (Q1 * Q1[1]))
    
    if deltaPhase < 0.1
        deltaPhase := 0.1
    
    if deltaPhase > 1.1
        deltaPhase := 1.1

    medianDelta = median(deltaPhase, 5)

    // Dominant Cycle
    dc = 0.0

    if medianDelta == 0
        dc := 15
    else
        dc := 2 * PI / medianDelta + 0.5

    instPeriod := 0.33 * dc + 0.67 * nz(instPeriod[1])

    lookback = 0.0
    lookback := 0.15 * instPeriod + 0.85 * nz(lookback[1])
    
    mom = src - src[floor(lookback - 1)]
    
    esam = poles == 3
         ? get3PoleSSF(mom, length)
         : get2PoleSSF(mom, length)
    esam

esam = getESAM(src, length, alpha, poles)
esamColor = esam > 0 ? #0ebb23 : red

plot(esam, title="ESAM", linewidth=2, color=esamColor, transp=0)
hline(0, title="Zero Level", linestyle=dotted)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/ehlers_stochastic_cyber_cycle.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Ehlers Stochastic Cyber Cycle script may be freely distributed under the terms of the GPL-3.0 license.
study("Ehlers Stochastic Cyber Cycle", shorttitle="ESCC")

length = input(title="Length", type=integer, minval=1, defval=14)
alpha = input(title="Alpha", type=float, step=0.1, defval=0.7)
applyFilling = input(title="Apply Filling ?", type=bool, defval=false)
src = input(title="Source", type=source, defval=close)

smooth = (src + 2 * nz(src[1]) + 2 * nz(src[2]) + nz(src[3])) / 6

cycle = 0.0
cycle := pow(1 - alpha / 2, 2) * (smooth - 2 * nz(smooth[1]) + nz(smooth[2])) + 2 * (1 - alpha) * nz(cycle[1]) - pow(1 - alpha, 2) * nz(cycle[2])

maxCycle = highest(cycle, length)
minCycle = lowest(cycle, length)

stoch = (cycle - minCycle) / (maxCycle - minCycle)

escc = 2 * ((4 * stoch + 3 * nz(stoch[1]) + 2 * nz(stoch[2]) + nz(stoch[3])) / 10 - 0.5)
esccPrev = 0.96 * (escc[1] + 0.02)

esccPlot = plot(escc, title="ESCC", color=#3d85c6, transp=0)
esccPrevPlot = plot(esccPrev, title="Trigger", color=#ff3e7d, transp=0)

hline(0, title="Zero Level", linestyle=dotted)

fillColor = applyFilling ? (escc > esccPrev ? #0ebb23 : #cc0000) : color(white, 100)
fill(esccPlot, esccPrevPlot, color=fillColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/ehlers_stochastic.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Ehlers Stochastic script may be freely distributed under the terms of the GPL-3.0 license.
study("Ehlers Stochastic", shorttitle="EStoch")

highpassLength = input(title="HighPass Length", type=integer, minval=1, defval=48)
ssfLength = input(title="Super Smoother Filter Length", type=integer, minval=1, defval=10)
stochLength = input(title="Stochastic Length", type=integer, minval=1, defval=20)
numberOfPoles = input(title="Number of Poles", type=integer, defval=2, options=[2, 3])
overboughtLevel = input(title="Overbought Level", type=float, step=0.1, defval=0.8)
oversoldLevel = input(title="Oversold Level", type=float, step=0.1, defval=0.2)
src = input(title="Source", type=source, defval=close)

PI = 2 * asin(1)

twoPoleSuperSmootherFilter(src, length) =>
	arg = sqrt(2) * PI / length
	a1 = exp(-arg)
	b1 = 2 * a1 * cos(arg)
	c2 = b1
	c3 = -pow(a1, 2)
	c1 = 1 - c2 - c3

	ssf = 0.0
	ssf := c1 * src + c2 * nz(ssf[1]) + c3 * nz(ssf[2])

threePoleSuperSmootherFilter(src, length) =>
	arg = PI / length
	a1 = exp(-arg)
	b1 = 2 * a1 * cos(1.738 * arg)
	c1 = pow(a1, 2)

	coef2 = b1 + c1
	coef3 = -(c1 + b1 * c1)
	coef4 = pow(c1, 2)
	coef1 = 1 - coef2 - coef3 - coef4

	ssf = 0.0
	ssf := coef1 * src + coef2 * nz(ssf[1]) + coef3 * nz(ssf[2]) + coef4 * nz(ssf[3])

roofingFilter(src, highpassLength, ssfLength, numberOfPoles) =>
	alphaArg = 2 * PI / (highpassLength * sqrt(2))

	alpha = 0.0
	alpha := cos(alphaArg) != 0
		 ? (cos(alphaArg) + sin(alphaArg) - 1) / cos(alphaArg)
		 : nz(alpha[1])

	highpass = 0.0
	highpass := pow(1 - (alpha / 2), 2) * (src - 2 * nz(src[1]) + nz(src[2])) + 2 * (1 - alpha) * nz(highpass[1]) - pow(1 - alpha, 2) * nz(highpass[2])

	numberOfPoles == 2
		 ? twoPoleSuperSmootherFilter((highpass + nz(highpass[1])) / 2, ssfLength)
		 : threePoleSuperSmootherFilter((highpass + nz(highpass[1])) / 2, ssfLength)

ehlersStochastic(roofingFilter, stochLength, ssfLength, numberOfPoles) =>
	rfHighest = highest(roofingFilter, stochLength)
	rfLowest = lowest(roofingFilter, stochLength)

	stoch = rfHighest - rfLowest != 0
		 ? (roofingFilter - rfLowest) / (rfHighest - rfLowest)
		 : 0

	numberOfPoles == 2
		 ? twoPoleSuperSmootherFilter((stoch + nz(stoch[1])) / 2, ssfLength)
		 : threePoleSuperSmootherFilter((stoch + nz(stoch[1])) / 2, ssfLength)

erf = roofingFilter(src, highpassLength, ssfLength, numberOfPoles)
estoch = ehlersStochastic(erf, stochLength, ssfLength, numberOfPoles)

estochColor = estoch > overboughtLevel ? #0ebb23 : estoch < oversoldLevel ? #cc0000 : #674ea7
plot(estoch, title="EStoch", linewidth=2, color=estochColor, transp=0)

hline(overboughtLevel, title="Overbought Level", linestyle=dotted, color=#e69138)
hline(0.5, title="Middle Level", linestyle=dotted, color=#989898)
hline(oversoldLevel, title="Oversold Level", linestyle=dotted, color=#e69138)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/ehlers_super_passband_filter.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Ehlers Super Passband Filter script may be freely distributed under the terms of the GPL-3.0 license.
study("Ehlers Super Passband Filter", shorttitle="ESPF")

fastLength = input(title="Fast Length", type=integer, minval=1, defval=40)
slowLength = input(title="Slow Length", type=integer, minval=1, defval=60)
src = input(title="Source", type=source, defval=close)

ehlersSuperPassbandFilter(src, fastLength, slowLength) =>
	a1 = 5 / fastLength
	a2 = 5 / slowLength

	espf = 0.0
	espf := (a1 - a2) * src +
		 (a2 * (1 - a1) - a1 * (1 - a2)) * nz(src[1]) +
		 ((1 - a1) + (1 - a2)) * nz(espf[1]) -
		 (1 - a1) * (1 - a2) * nz(espf[2])

espf = ehlersSuperPassbandFilter(src, fastLength, slowLength)

// Compute Root Mean Square
rms = sqrt(sum(espf * espf, 50) / 50)

spbColor = espf > rms ? #0ebb23 : espf < -rms ? #ff0000 : #674ea7

plot(rms, title="+RMS", linewidth=1, color=#f6b26b, transp=0)
plot(espf, title="ESPF", linewidth=2, color=spbColor, transp=0)
plot(-rms, title="-RMS", linewidth=1, color=#f6b26b, transp=0)

hline(0, title="Zero Level", linestyle=dotted, color=#989898)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/ehlers_triple_delay_line_detrender.pine --- */
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Ehlers Triple Delay-Line Detrender script may be freely distributed under the terms of GPL-3.0 license.
study("Ehlers Triple Delay-Line Detrender", shorttitle="TDLD")

src = input(title="Source", type=source, defval=hl2)
showSignal = input(title="Show Signal Line ?", type=bool, defval=true)
showHistogram = input(title="Show Histogram ?", type=bool, defval=false)
highlightCrossovers = input(title="Highlight Signal Crossovers ?", type=bool, defval=true)
highlightZeroCrossovers = input(title="Highlight Zero Line Crossovers ?", type=bool, defval=false)
applyFilling = input(title="Apply Ribbon Filling ?", type=bool, defval=false)

tmp1 = 0.0
tmp1 := src + .088 * nz(tmp1[6])

tmp2 = 0.0
tmp2 := tmp1 - nz(tmp1[6]) + 1.2 * nz(tmp2[6]) - 0.7 * nz(tmp2[12])

detrender = nz(tmp2[12]) - 2 * nz(tmp2[6]) + tmp2

_moef(src) =>
    src1 = nz(src[1], src)
    src2 = nz(src[2], src1)
    src3 = nz(src[3], src2)
    
    moef = src
    moef := 0.13785 * (2 * src - src1) +
             0.0007 * (2 * src1 - src2) +
             0.13785 * (2 * src2 - src3) +
             1.2103 * nz(moef[1], moef) -
             0.4867 * nz(moef[2], moef)
    moef

tdld = _moef(detrender)
signal = _moef(tdld)

hist = tdld - signal
histColor = hist >= 0 ? (hist[1] < hist ? #26a69a : #b2dfdb) : (hist[1] < hist ? #ffcdd2 : #ef5350)
plot(showHistogram ? hist : na, title="Histogram", style=columns, color=histColor, transp=0)
hline(0, title="Zero Level", linestyle=dotted)

trendColor = tdld > signal ? #0ebb23 : red

tdldColor = applyFilling ? trendColor : (tdld > 0 ? #0ebb23 : red)
signalColor = applyFilling ? trendColor : #ff9800

tdldPlot = plot(tdld, title="TDLD", linewidth=2, color=tdldColor, transp=0)
signalPlot = plot(showSignal ? signal : na, title="Signal", color=signalColor, transp=0)

transparent = color(white, 100)

fillColor = applyFilling ? trendColor : transparent
fill(tdldPlot, signalPlot, color=fillColor, transp=70)

zeroCrossBgColor = highlightZeroCrossovers ? (tdld > 0 ? green : red) : transparent
bgcolor(zeroCrossBgColor, transp=80)

plotshape(highlightCrossovers and crossover(tdld, signal) ? avg(tdld, tdld[1]) : na, title="Crossover", location=location.absolute, style=shape.circle, size=size.tiny, color=green, transp=0)
plotshape(highlightCrossovers and crossunder(tdld, signal) ? avg(tdld, tdld[1]) : na, title="Crossunder", location=location.absolute, style=shape.circle, size=size.tiny, color=red, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/ergodic_oscillator.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Ergodic Oscillator script may be freely distributed under the terms of the GPL-3.0 license.
study("Ergodic Oscillator", shorttitle="EOSC")

firstSmoothingLength = input(title="1st Smoothing Length", type=integer, minval=1, defval=8)
secondSmoothingLength = input(title="2nd Smoothing Length", type=integer, minval=1, defval=5)
signalLength = input(title="Signal Length", type=integer, minval=1, defval=5)
ergodicLength = input(title="Ergodic Length", type=integer, minval=1, defval=5)
ergodicSignalLength = input(title="Ergodic Signal Length", type=integer, minval=1, defval=14)
overboughtLevel = input(title="Overbought Level", type=integer, defval=20)
oversoldLevel = input(title="Oversold Level", type=integer, defval=-20)
src = input(title="Source", type=source, defval=close)

momentum = change(src)

ema1 = ema(momentum, firstSmoothingLength)
ema1Abs = ema(abs(momentum), firstSmoothingLength)

ema2 = ema(ema1, secondSmoothingLength)
ema2Abs = ema(abs(ema1Abs), secondSmoothingLength)

tsi = 100 * ema2 / ema2Abs

signal = ema(tsi, signalLength)

ergodic = ema(signal, ergodicLength)

ergodicSignal = ema(ergodic, ergodicSignalLength)

plot(ergodic, title="Ergodic", linewidth=2, color=#3c78d8, transp=0)
plot(ergodicSignal, title="Signal", linewidth=2, color=#cc0000, transp=0)

hline(overboughtLevel, title="Overbought Level", linestyle=dotted, linewidth=2, color=#0ebb23)
hline(oversoldLevel, title="Oversold Level", linestyle=dotted, linewidth=2, color=#ff9370)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/forecast_oscillator.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Forecast Oscillator script may be freely distributed under the terms of the GPL-3.0 license.
study("Forecast Oscillator", shorttitle="FOSC")

length = input(title="Length", type=integer, minval=1, defval=14)
src = input(title="Source", type=source, defval=close)

fosc = 100 * (src - linreg(src, length, 0)) / src

foscColor = fosc >= 0.0 ? #0ebb23 : #ff0000

plot(fosc, title="FOSC", linewidth=2, color=foscColor, transp=0)

hline(0, title="Zero Level", linestyle=dotted, color=#989898)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/gator_oscillator.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Gator Oscillator script may be freely distributed under the terms of GPL-3.0 license.
study("Gator Oscillator", shorttitle="Gator")

jawLength = input(title="Jaw Length", type=integer, defval=13)
teethLength = input(title="Teeth Length", type=integer, defval=8)
lipsLength = input(title="Lips Length", type=integer, defval=5)

jaw = offset(rma(hl2, jawLength), 8)
teeth = offset(rma(hl2, teethLength), 5)
lips = offset(rma(hl2, lipsLength), 3)

upper = abs(jaw - teeth)
lower = -abs(teeth - lips)

upperColor = (upper[1] < upper ? #26A69A : #EF5350)
lowerColor = (lower[1] > lower ? #26A69A : #EF5350)

plot(upper, title="Upper", style=columns, color=upperColor, transp=0)
plot(lower, title="Lower", style=columns, color=lowerColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/intraday_momentum_index.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Intraday Momentum Index script may be freely distributed under the terms of the GPL-3.0 license.
study("Intraday Momentum Index", shorttitle="IMI")

length = input(title="Length", type=integer, minval=1, defval=14)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

gain = close > open ? close - open : 0
loss = close > open ? 0 : open - close

upSum = sum(gain, length)
downSum = sum(loss, length)

imi = 100 * upSum / (upSum + downSum)

obLevel = 70
osLevel = 30

imiColor = imi > obLevel ? #0ebb23 : imi < osLevel ? #ff0000 : #f4b77d
plot(imi, title="IMI", linewidth=2, color=imiColor, transp=0)

transparent = color(white, 100)

maxLevelPlot = hline(100, title="Max Level", linestyle=dotted, color=transparent)
obLevelPlot = hline(obLevel, title="Overbought Level", linestyle=dotted)
hline(50, title="Middle Level", linestyle=dotted)
osLevelPlot = hline(osLevel, title="Oversold Level", linestyle=dotted)
minLevelPlot = hline(0, title="Min Level", linestyle=dotted, color=transparent)

fill(obLevelPlot, osLevelPlot, color=purple, transp=95)

obFillColor = imi > obLevel and highlightBreakouts ? green : transparent
osFillColor = imi < osLevel and highlightBreakouts ? red : transparent

fill(maxLevelPlot, obLevelPlot, color=obFillColor, transp=90)
fill(minLevelPlot, osLevelPlot, color=osFillColor, transp=90)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/jurik_rsx.pine --- */
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Jurik RSX script may be freely distributed under the terms of GPL-3.0 license.
study("Jurik RSX", shorttitle="RSX")

length = input(title="Length", type=integer, defval=14)
src = input(title="Source", type=source, defval=hlc3)
obLevel = input(title="OB Level", type=integer, defval=70)
osLevel = input(title="OS Level", type=integer, defval=30)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=bool, defval=true)

f8 = 100 * src
f10 = nz(f8[1])
v8 = f8 - f10

f18 = 3 / (length + 2)
f20 = 1 - f18

f28 = 0.0
f28 := f20 * nz(f28[1]) + f18 * v8

f30 = 0.0
f30 := f18 * f28 + f20 * nz(f30[1])
vC = f28 * 1.5 - f30 * 0.5

f38 = 0.0
f38 := f20 * nz(f38[1]) + f18 * vC

f40 = 0.0
f40 := f18 * f38 + f20 * nz(f40[1])
v10 = f38 * 1.5 - f40 * 0.5

f48 = 0.0
f48 := f20 * nz(f48[1]) + f18 * v10

f50 = 0.0
f50 := f18 * f48 + f20 * nz(f50[1])
v14 = f48 * 1.5 - f50 * 0.5

f58 = 0.0
f58 := f20 * nz(f58[1]) + f18 * abs(v8)

f60 = 0.0
f60 := f18 * f58 + f20 * nz(f60[1])
v18 = f58 * 1.5 - f60 * 0.5

f68 = 0.0
f68 := f20 * nz(f68[1]) + f18 * v18

f70 = 0.0
f70 := f18 * f68 + f20 * nz(f70[1])
v1C = f68 * 1.5 - f70 * 0.5

f78 = 0.0
f78 := f20 * nz(f78[1]) + f18 * v1C

f80 = 0.0
f80 := f18 * f78 + f20 * nz(f80[1])
v20 = f78 * 1.5 - f80 * 0.5

f88_ = 0.0
f90_ = 0.0

f88 = 0.0
f90_ := nz(f90_[1]) == 0 ? 1 : nz(f88[1]) <= nz(f90_[1]) ? nz(f88[1]) + 1 : nz(f90_[1]) + 1
f88 := nz(f90_[1]) == 0 and (length - 1 >= 5) ? length - 1 : 5

f0 = f88 >= f90_ and f8 != f10 ? 1 : 0
f90 = f88 == f90_ and f0 == 0 ? 0 : f90_

v4_ = f88 < f90 and v20 > 0 ? (v14 / v20 + 1) * 50 : 50
rsx = v4_ > 100 ? 100 : v4_ < 0 ? 0 : v4_

rsxColor = rsx > obLevel ? #0ebb23 : rsx < osLevel ? #ff0000 : #f4b77d
plot(rsx, title="RSX", linewidth=2, color=rsxColor, transp=0)

transparent = color(white, 100)

maxLevelPlot = hline(100, title="Max Level", linestyle=dotted, color=transparent)
obLevelPlot = hline(obLevel, title="Overbought Level", linestyle=dotted)
hline(50, title="Middle Level", linestyle=dotted)
osLevelPlot = hline(osLevel, title="Oversold Level", linestyle=dotted)
minLevelPlot = hline(0, title="Min Level", linestyle=dotted, color=transparent)

fill(obLevelPlot, osLevelPlot, color=purple, transp=95)

obFillColor = rsx > obLevel and highlightBreakouts ? green : transparent
osFillColor = rsx < osLevel and highlightBreakouts ? red : transparent

fill(maxLevelPlot, obLevelPlot, color=obFillColor, transp=90)
fill(minLevelPlot, osLevelPlot, color=osFillColor, transp=90)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/kairi_relative_index.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Kairi Relative Index script may be freely distributed under the terms of the GPL-3.0 license.
study("Kairi Relative Index", shorttitle="KRI")

length = input(title="Length", type=integer, minval=1, defval=14)
src = input(title="Source", type=source, defval=close)

kri = 100 * (src - sma(src, length)) / sma(src, length)

plot(kri, title="KRI", linewidth=1, color=#134f5c, transp=0)

hline(0, title="Zero Level", linestyle=dotted, color=#989898)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/laguerre_rsi_self_adjusting_alpha_with_fractals_energy.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Laguerre RSI (Self Adjusting Alpha with Fractals Energy) script may be freely distributed under the terms of the GPL-3.0 license.
study("Laguerre RSI (Self Adjusting Alpha with Fractals Energy)", shorttitle="LRSI")

alpha = input(title="Alpha", type=float, minval=0, step=0.1, defval=0.7)
applyFractalEnergy = input(title="Apply Fractal Energy ?", type=bool, defval=true)
feLength = input(title="Fractals Energy Length", type=integer, minval=1, defval=13)
src = input(title="Source", type=source, defval=close)

OC = (open + nz(close[1])) / 2
HC = max(high, nz(close[1]))
LC = min(low, nz(close[1]))

feSrc = (OC + HC + LC + close) / 4

feAlpha = log(sum((max(high, nz(close[1])) - min(low, nz(close[1]))) / (highest(high, feLength) - lowest(low, feLength)), feLength)) / log(feLength)

L0 = 0.0
L1 = 0.0
L2 = 0.0
L3 = 0.0

lrsiAlpha = applyFractalEnergy ? feAlpha : alpha

L0 := lrsiAlpha * (applyFractalEnergy ? feSrc : src) + (1 - lrsiAlpha) * nz(L0[1])
L1 := -(1 - lrsiAlpha) * L0 + nz(L0[1]) + (1 - lrsiAlpha) * nz(L1[1])
L2 := -(1 - lrsiAlpha) * L1 + nz(L1[1]) + (1 - lrsiAlpha) * nz(L2[1])
L3 := -(1 - lrsiAlpha) * L2 + nz(L2[1]) + (1 - lrsiAlpha) * nz(L3[1])

CU = 0.0
CD = 0.0

CU := (L0 >= L1 ? L0 - L1 : 0) + (L1 >= L2 ? L1 - L2 : 0) + (L2 >= L3 ? L2 - L3 : 0)
CD := (L0 >= L1 ? 0 : L1 - L0) + (L1 >= L2 ? 0 : L2 - L1) + (L2 >= L3 ? 0 : L3 - L2)

lrsi = iff(CU + CD != 0, CU / (CU + CD), 0)

overboughtLevel = hline(0.8, title="Overbought Level", linestyle=dashed, color=#686868)
oversoldLevel = hline(0.2, title="Oversold Level", linestyle=dashed, color=#686868)

plot(lrsi, title="LRSI", linewidth=2, color=#ff3e7d, transp=0)
plot(applyFractalEnergy ? feAlpha : na, title="FE Alpha", linewidth=2, color=#674ea7, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/laguerre_rsi.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Laguerre RSI script may be freely distributed under the terms of the GPL-3.0 license.
study("Laguerre RSI", shorttitle="LRSI")

alpha = input(title="Alpha", type=float, minval=0, step=0.1, defval=0.7)
src = input(title="Source", type=source, defval=close)

L0 = 0.0
L1 = 0.0
L2 = 0.0
L3 = 0.0

L0 := alpha * src + (1 - alpha) * nz(L0[1])
L1 := -(1 - alpha) * L0 + nz(L0[1]) + (1 - alpha) * nz(L1[1])
L2 := -(1 - alpha) * L1 + nz(L1[1]) + (1 - alpha) * nz(L2[1])
L3 := -(1 - alpha) * L2 + nz(L2[1]) + (1 - alpha) * nz(L3[1])

CU = 0.0
CD = 0.0

CU := (L0 >= L1 ? L0 - L1 : 0) + (L1 >= L2 ? L1 - L2 : 0) + (L2 >= L3 ? L2 - L3 : 0)
CD := (L0 >= L1 ? 0 : L1 - L0) + (L1 >= L2 ? 0 : L2 - L1) + (L2 >= L3 ? 0 : L3 - L2)

lrsi = iff(CU + CD != 0, CU / (CU + CD), 0)

overboughtLevel = hline(0.8, title="Overbought Level", linestyle=dashed, color=#686868)
oversoldLevel = hline(0.2, title="Oversold Level", linestyle=dashed, color=#686868)

plot(lrsi, title="LRSI", linewidth=2, color=#ff3e7d, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/mass_index.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Mass Index script may be freely distributed under the terms of GPL-3.0 license.
study("Mass Index")

smoothLength = input(title="Smoothing Length", type=integer, defval=9)
sumLength = input(title="Summation Length", type=integer, defval=25)
breakout = input(title="Breakout Level", type=integer, defval=27)

mi = sum(ema(high - low, smoothLength) / ema(ema(high - low, smoothLength), smoothLength), sumLength)

miColor = mi > breakout - 0.5 ? #ff9800 : #3c78d8

plot(mi, title="Mass Index", linewidth=2, color=miColor, transp=0)

transparent = color(white, 100)

maxLevel = hline(29, title="Max Level", linestyle=dotted, color=transparent)
breakoutLevel = hline(breakout, title="Breakout Level", linestyle=dotted)
hline(breakout - 0.5, title="Confirmation Level", linestyle=dotted)

breakoutFillColor = mi > breakout ? #e06666 : transparent

fill(maxLevel, breakoutLevel, color=breakoutFillColor, transp=80)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/mfi_money_flow_index.pine --- */
//@version=4
// Copyright (c) 2021-present, Alex Orekhov (everget)
// Money Flow Index script may be freely distributed under the terms of GPL-3.0 license.
study("Money Flow Index", shorttitle="MFI", precision=2)

length = input(title="Length", type=input.integer, defval=14, minval=1)
signalLength = input(title="Signal Length", type=input.integer, defval=9, minval=1)
src = input(title="Source", type=input.source, defval=hlc3)
obLevel = input(title="Overbought Level", type=input.integer, defval=80)
osLevel = input(title="Oversold Level", type=input.integer, defval=20)
maxLevel = input(title="Max Level", type=input.integer, defval=100)
minLevel = input(title="Min Level", type=input.integer, defval=0)
showHistogram = input(title="Show Histogram ?", type=input.bool, defval=false)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=input.bool, defval=true)
highlightCrossovers = input(title="Highlight MFI/Signal Crossovers ?", type=input.bool, defval=true)
highlightMiddleCrossovers = input(title="Highlight Middle Line Crossovers ?", type=input.bool, defval=true)
applyRibbonFilling = input(title="Apply Ribbon Filling ?", type=input.bool, defval=true)

mfi = mfi(src, length)
signal = ema(mfi, signalLength)

trendColor = mfi > signal ? #0ebb23 : color.red
smiColor = applyRibbonFilling ? trendColor : #ff3e7d
signalColor = applyRibbonFilling ? trendColor : #3c78d8

mfiPlot = plot(mfi, title="MFI", color=smiColor, transp=0)
signalPlot = plot(signal, title="Signal", color=signalColor, transp=0)

hist = mfi - signal
histColor = hist >= 0 ? hist[1] < hist ? #26A69A : #B2DFDB : hist[1] < hist ? #FFCDD2 : #EF5350
plot(showHistogram ? hist : na, title="Histogram", style=plot.style_columns, color=histColor, transp=0)

var color noneColor = color.new(color.white, 100)

maxLevelPlot = hline(maxLevel, title="Max Level", linestyle=hline.style_dotted, color=noneColor)
obLevelPlot = hline(obLevel, title="Overbought Level", linestyle=hline.style_dotted, color=#00796b)
hline(50, title="Middle Level", linestyle=hline.style_dotted, color=#989898)
osLevelPlot = hline(osLevel, title="Oversold Level", linestyle=hline.style_dotted, color=#f57f17)
minLevelPlot = hline(minLevel, title="Min Level", linestyle=hline.style_dotted, color=noneColor)
fill(obLevelPlot, osLevelPlot, title="Middle Zone", color=color.purple, transp=95)

obFillColor = mfi > obLevel and highlightBreakouts ? color.green : noneColor
osFillColor = mfi < osLevel and highlightBreakouts ? color.red : noneColor

fill(maxLevelPlot, obLevelPlot, title="Overbought Level Breakout", color=obFillColor, transp=85)
fill(minLevelPlot, osLevelPlot, title="Oversold Level Breakout", color=osFillColor, transp=85)

fillColor = applyRibbonFilling ? trendColor : noneColor
fill(mfiPlot, signalPlot, title="Ribbon", color=fillColor, transp=70)

middleCrossBgColor = highlightMiddleCrossovers ? mfi > 50 ? color.green : color.red : noneColor
bgcolor(middleCrossBgColor, title="Middle Line Crossover Background", transp=90)

plotshape(highlightCrossovers and crossover(mfi, signal) ? mfi : na, title="MFI/Signal Crossover", location=location.absolute, style=shape.circle, size=size.tiny, color=color.green, transp=0)
plotshape(highlightCrossovers and crossunder(mfi, signal) ? mfi : na, title="MFI/Signal Crossunder", location=location.absolute, style=shape.circle, size=size.tiny, color=color.red, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/normalized_relative_vigor_index.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Normalized Relative Vigor Index script may be freely distributed under the terms of the GPL-3.0 license.
study("Normalized Relative Vigor Index", shorttitle="NRVGI")

length = input(title="Length", type=integer, defval=10, minval=1)
applyFilling = input(title="Apply Filling ?", type=bool, defval=false)

rvgi = sum(swma(close - open), length) / sum(swma(high - low), length)
signal = swma(rvgi)

rvgiPlot = plot(100 * rvgi, title="NRVGI", color=green, transp=0)
signalPlot = plot(100 * signal, title="Signal", color=red, transp=0)

fillColor = applyFilling ? (rvgi > signal ? #0ebb23 : #cc0000) : color(white, 100)
fill(rvgiPlot, signalPlot, color=fillColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/percentage_price_oscillator.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Percentage Price Oscillator script may be freely distributed under the terms of the GPL-3.0 license.
study("Percentage Price Oscillator", shorttitle="PPO")

fastLength = input(title="Fast Length", type=integer, minval=1, defval=12)
slowLength = input(title="Slow Length", type=integer, minval=1, defval=26)
signalLength = input(title="Signal Length", type=integer, minval=1, defval=9)
applyFilling = input(title="Apply Filling ?", type=bool, defval=false)
src = input(title="Source", type=source, defval=close)

ppo = 100 * (ema(src, fastLength) - ema(src, slowLength)) / ema(src, slowLength)

signal = ema(ppo, signalLength)

hist = ppo - signal

plot(hist, title="Histogram", style=histogram, transp=0, color=#ff006e)
ppoPlot = plot(ppo, title="PPO", transp=0, color=#0094ff)
signalPlot = plot(signal, title="Signal", transp=0, color=#ff6a00)

fillColor = applyFilling ? (ppo > signal ? #0ebb23 : #cc0000) : color(white, 100)
fill(ppoPlot, signalPlot, color=fillColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/percentage_volume_oscillator.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Percentage Volume Oscillator script may be freely distributed under the terms of GPL-3.0 license.
study("Percentage Volume Oscillator", shorttitle="PVO")

fastLength = input(title="Fast Length", type=integer, defval=12)
slowLength = input(title="Slow Length", type=integer, defval=26)
signalLength = input(title="Signal Length", type=integer, defval=9)
showHistogram = input(title="Show Histogram ?", type=bool, defval=true)
highlightCrossovers = input(title="Highlight PVO/Signal Crossovers ?", type=bool, defval=true)
highlightZeroCrossovers = input(title="Highlight Zero Line Crossovers ?", type=bool, defval=false)
applyFilling = input(title="Apply Ribbon Filling ?", type=bool, defval=false)

src = volume

pvo = 100 * (ema(src, fastLength) - ema(src, slowLength)) / ema(src, slowLength)
signal = ema(pvo, signalLength)

hist = pvo - signal
histColor = hist >= 0 ? (hist[1] < hist ? #26A69A : #B2DFDB) : (hist[1] < hist ? #FFCDD2 : #EF5350)

plot(showHistogram ? hist : na, title="Histogram", style=columns, color=histColor, transp=0)
hline(0, title="Zero Line", linestyle=dotted)

trendColor = pvo > signal ? #0ebb23 : red
pvoColor = applyFilling ? trendColor : #0094ff
signalColor = applyFilling ? trendColor : #ff6a00

pvoPlot = plot(pvo, title="PVO", color=pvoColor, transp=0)
signalPlot = plot(signal, title="Signal", color=signalColor, transp=0)

transparent = color(white, 100)

fillColor = applyFilling ? trendColor : transparent
fill(pvoPlot, signalPlot, color=fillColor, transp=70)

zeroCrossBgColor = highlightZeroCrossovers ? (pvo > 0 ? green : red) : transparent
bgcolor(zeroCrossBgColor, transp=90)

plotshape(highlightCrossovers and crossover(pvo, signal) ? pvo : na, title="Crossover", location=location.absolute, style=shape.circle, size=size.tiny, color=green, transp=0)
plotshape(highlightCrossovers and crossunder(pvo, signal) ? pvo : na, title="Crossunder", location=location.absolute, style=shape.circle, size=size.tiny, color=red, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/phase_change_index.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Phase Change Index script may be freely distributed under the terms of GPL-3.0 license.
study("Phase Change Index", shorttitle="PCI")

length = input(title="Length", type=integer, minval=1, defval=35)
upperLevel = input(title="Upper Level", type=integer, defval=80)
lowerLevel = input(title="Lower Level", type=integer, defval=20)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=bool, defval=true)
applySmoothing = input(title="Apply Smoothing ?", type=bool, defval=false)
smoothingType = input(title="Smoothing Type", defval="SMA", options=["EMA", "SMA", "VWMA", "WMA"])
smoothingLength = input(title="Smoothing Length", type=integer, minval=1, defval=3)
src = input(title="Source", type=source, defval=close)

getMA(src, length) =>
	ma = 0.0
	if smoothingType == "EMA"
		ma := ema(src, length)
	if smoothingType == "SMA"
		ma := sma(src, length)
	if smoothingType == "VWMA"
		ma := vwma(src, length)
	if smoothingType == "WMA"
		ma := wma(src, length)
	ma

mom = change(src, length)

positiveSum = 0.0
negativeSum = 0.0

for i = 0 to length - 1
	gradient = nz(src[length]) + mom * (length - i) / (length - 1)
	deviation = nz(src[length - i]) - gradient

	if deviation > 0
		positiveSum := positiveSum + deviation
	else
		negativeSum := negativeSum - deviation

sum = positiveSum + negativeSum
pci = sum != 0 ? 100 * positiveSum / sum : 0
pci := applySmoothing ? getMA(pci, smoothingLength) : pci

pciColor = pci > upperLevel ? #0ebb23 : pci < lowerLevel ? #ff0000 : #f4b77d
plot(pci, title="PCI", linewidth=2, color=pciColor, transp=0)

transparent = color(white, 100)

maxLevelPlot = hline(100, title="Max Level", linestyle=dotted, color=transparent)
upperLevelPlot = hline(upperLevel, title="Upper Level", linestyle=dotted)
hline(50, title="Middle Level", linestyle=dotted)
lowerLevelPlot = hline(lowerLevel, title="Lower Level", linestyle=dotted)
minLevelPlot = hline(0, title="Min Level", linestyle=dotted, color=transparent)

fill(upperLevelPlot, lowerLevelPlot, color=purple, transp=95)

upperFillColor = pci > upperLevel and highlightBreakouts ? green : transparent
lowerFillColor = pci < lowerLevel and highlightBreakouts ? red : transparent

fill(maxLevelPlot, upperLevelPlot, color=upperFillColor, transp=90)
fill(minLevelPlot, lowerLevelPlot, color=lowerFillColor, transp=90)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/pretty_good_oscillator.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Pretty Good Oscillator script may be freely distributed under the terms of the GPL-3.0 license.
study("Pretty Good Oscillator", shorttitle="PGO")

length = input(title="Length", type=integer, defval=14, minval=1)
upperLevel = input(title="Upper Level", type=float, step=0.1, defval=2.0)
lowerLevel = input(title="Lower Level", type=float, step=0.1, defval=-2.0)
maxLevel = input(title="Max Level", type=float, step=0.1, defval=4.0)
minLevel = input(title="Min Level", type=float, step=0.1, defval=-4.0)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

pgo = (src - sma(src, length)) / atr(length)

pgoColor = pgo > upperLevel ? #0ebb23 : pgo < lowerLevel ? #ff0000 : #f4b77d
plot(pgo, title="PGO", linewidth=2, color=pgoColor, transp=0)

transparent = color(white, 100)

maxLevelPlot = hline(maxLevel, title="Max Level", linestyle=dotted, color=transparent)
upperLevelPlot = hline(upperLevel, title="Upper Level", linestyle=dotted)
hline(0, title="Zero Level", linestyle=dotted)
lowerLevelPlot = hline(lowerLevel, title="Lower Level", linestyle=dotted)
minLevelPlot = hline(minLevel, title="Min Level", linestyle=dotted, color=transparent)

fill(upperLevelPlot, lowerLevelPlot, color=purple, transp=95)

upperFillColor = pgo > upperLevel and highlightBreakouts ? green : transparent
lowerFillColor = pgo < lowerLevel and highlightBreakouts ? red : transparent

fill(maxLevelPlot, upperLevelPlot, color=upperFillColor, transp=90)
fill(minLevelPlot, lowerLevelPlot, color=lowerFillColor, transp=90)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/price_momentum_oscillator.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Price Momentum Oscillator script may be freely distributed under the terms of the GPL-3.0 license.
study("Price Momentum Oscillator", shorttitle="PMO")

firstLength = input(title="1st Smoothing Length", type=integer, minval=1, defval=35)
secondLength = input(title="2nd Smoothing Length", type=integer, minval=1, defval=20)
signalLength = input(title="Signal Length", type=integer, minval=1, defval=10)
applyFilling = input(title="Apply Filling ?", type=bool, defval=false)
src = input(title="Source", type=source, defval=close)

rocMA = 0.0
rocMA := (nz(rocMA[1]) + (roc(src, 1) - nz(rocMA[1])) * (2 / firstLength))

pmo = 0.0
pmo := nz(pmo[1]) + (10 * rocMA - nz(pmo[1])) * (2 / secondLength)

pmoSignal = 0.0
pmoSignal := (2 / signalLength) * (pmo - nz(pmoSignal[1])) + nz(pmoSignal[1])

pmoPlot = plot(pmo, title="PMO", color=#1155cc, transp=0)
pmoSignalPlot = plot(pmoSignal, title="Signal", color=red, transp=0)

fillColor = applyFilling ? (pmo > pmoSignal ? #0ebb23 : #cc0000) : color(white, 100)
fill(pmoPlot, pmoSignalPlot, color=fillColor, transp=0)

hline(0, title="Zero Level", linestyle=dotted)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/pring_special_k.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Pring Special K script may be freely distributed under the terms of the GPL-3.0 license.
study("Pring Special K", shorttitle="PSK")

src = input(title="Source", type=source, defval=close)

psk = sma(roc(src, 10), 10) +
	sma(roc(src, 10), 15) * 2 +
	sma(roc(src, 10), 20) * 3 +
	sma(roc(src, 15), 30) * 4 +
	sma(roc(src, 50), 40) +
	sma(roc(src, 65), 65) * 2 +
	sma(roc(src, 75), 75) * 3 +
	sma(roc(src, 100), 100) * 4 +
	sma(roc(src, 130), 195) +
	sma(roc(src, 130), 265) * 2 +
	sma(roc(src, 130), 390) * 3 +
	sma(roc(src, 195), 530) * 4

pskColor = psk >= 0.0 ? #0ebb23 : #ff0000

plot(psk, title="PSK", linewidth=2, color=pskColor, transp=0)

hline(0, title="Zero Level", linestyle=dotted)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/rainbow_oscillator.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Rainbow Oscillator script may be freely distributed under the terms of GPL-3.0 license.
study("Rainbow Oscillator", shorttitle="ROSC")

maLength = input(title="Moving Average Length", type=integer, minval=1, defval=2)
maInput = input(title="Moving Average Type", defval="SMA", options=["EMA", "SMA", "VWMA", "WMA"])
highestLookback = input(title="Highest Price Lookback", type=integer, minval=1, defval=10)
lowestLookback = input(title="Lowest Price Lookback", type=integer, minval=1, defval=10)
drawBg = input(title="Draw Backgrounds ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

getMA(src, maLength) =>
    ma = 0.0

	if maInput == "EMA"
        ma := ema(src, maLength)

	if maInput == "SMA"
        ma := sma(src, maLength)

	if maInput == "VWMA"
        ma := vwma(src, maLength)

	if maInput == "WMA"
        ma := wma(src, maLength)
    ma

ma1 = getMA(src, maLength)
ma2 = getMA(ma1, maLength)
ma3 = getMA(ma2, maLength)
ma4 = getMA(ma3, maLength)
ma5 = getMA(ma4, maLength)
ma6 = getMA(ma5, maLength)
ma7 = getMA(ma6, maLength)
ma8 = getMA(ma7, maLength)
ma9 = getMA(ma8, maLength)
ma10 = getMA(ma9, maLength)

maMax = max(ma1,
     max(ma2,
     max(ma3,
     max(ma4,
     max(ma5,
     max(ma6,
     max(ma7,
     max(ma8,
     max(ma9,
     ma10)))))))))

maMin = min(ma1,
     min(ma2,
     min(ma3,
     min(ma4,
     min(ma5,
     min(ma6,
     min(ma7,
     min(ma8,
     min(ma9,
     ma10)))))))))

hlDiff = highest(src, highestLookback) - lowest(src, lowestLookback)
average = (ma1 + ma2 + ma3 + ma4 + ma5 + ma6 + ma7 + ma8 + ma9 + ma10) / 10

rosc = hlDiff != 0
         ? 100 * (src - average) / hlDiff
         : 0

band = hlDiff != 0
         ? 100 * (maMax - maMin) / hlDiff
         : 0

roscColor = rosc > 0 ? green : red

roscPlot = plot(rosc, title="ROSC", style=histogram, linewidth=3, color=roscColor, transp=0)

upperBandColor = drawBg ? gray : green
upperBandPlot = plot(band, title="Upper", color=upperBandColor)

middlePlot = plot(0, title="Middle", color=gray)

lowerBandColor = drawBg ? gray : red
lowerBandPlot = plot(-1 * band, title="Lower", color=lowerBandColor)

transparentColor = color(white, 100)
upperFillColor = drawBg ? green : transparentColor
lowerFillColor = drawBg ? red : transparentColor

fill(middlePlot, upperBandPlot, color=upperFillColor)
fill(middlePlot, lowerBandPlot, color=lowerFillColor)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/random_walk_index.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Random Walk Index script may be freely distributed under the terms of the GPL-3.0 license.
study("Random Walk Index", shorttitle="RWI")

length = input(title="Length", type=integer, minval=1, defval=14)

rwiHigh = (high - nz(low[length])) / (atr(length) * sqrt(length))
rwiLow = (nz(high[length]) - low) / (atr(length) * sqrt(length))

plot(rwiHigh, title="High", linewidth=2, color=#6d1e7f, transp=0)
plot(rwiLow, title="Low", linewidth=2, color=#ff3737, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/range_action_verification_index.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Range Action Verification Index (RAVI) script may be freely distributed under the terms of the GPL-3.0 license.
study("Range Action Verification Index (RAVI)", shorttitle="RAVI")

fastLength = input(title="Fast MA Length", type=integer, minval=1, defval=7)
fastMAInput = input(title="Fast MA", defval="SMA", options=["EMA", "SMA", "VWMA", "WMA"])
slowLength = input(title="Slow MA Length", type=integer, minval=1, defval=65)
slowMAInput = input(title="Slow MA", defval="SMA", options=["EMA", "SMA", "VWMA", "WMA"])
comparisonLookback = input(title="Comparison Lookback", type=integer, minval=1, defval=1)
src = input(title="Source", type=source, defval=close)

fastMA = iff(fastMAInput == "EMA", ema(src, fastLength),
	 iff(fastMAInput == "SMA", sma(src, fastLength),
	 iff(fastMAInput == "VWMA", vwma(src, fastLength),
	 iff(fastMAInput == "WMA", wma(src, fastLength),
	 na))))

slowMA = iff(slowMAInput == "EMA", ema(src, slowLength),
	 iff(slowMAInput == "SMA", sma(src, slowLength),
	 iff(slowMAInput == "VWMA", vwma(src, slowLength),
	 iff(slowMAInput == "WMA", wma(src, slowLength),
	 na))))

ravi = abs(100 * (fastMA - slowMA) / slowMA)

raviColor = ravi > nz(ravi[comparisonLookback]) ? green : red

plot(ravi, title="RAVI", linewidth=2, color=raviColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/rapid_rsi.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Rapid RSI script may be freely distributed under the terms of the GPL-3.0 license.
study("Rapid RSI", shorttitle="RRSI")

length = input(title="Length", type=integer, minval=1, defval=14)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

upSum = sum(max(change(src), 0), length)
downSum = sum(max(-change(src), 0), length)

rrsi = downSum == 0 ? 100 : upSum == 0 ? 0 : 100 - (100 / (1 + upSum / downSum))

obLevel = 70
osLevel = 30

rrsiColor = rrsi > obLevel ? #0ebb23 : rrsi < osLevel ? #ff0000 : #f4b77d
plot(rrsi, title="RRSI", linewidth=2, color=rrsiColor, transp=0)

transparent = color(white, 100)

maxLevelPlot = hline(100, title="Max Level", linestyle=dotted, color=transparent)
obLevelPlot = hline(obLevel, title="Overbought Level", linestyle=dotted)
hline(50, title="Middle Level", linestyle=dotted)
osLevelPlot = hline(osLevel, title="Oversold Level", linestyle=dotted)
minLevelPlot = hline(0, title="Min Level", linestyle=dotted, color=transparent)

fill(obLevelPlot, osLevelPlot, color=purple, transp=95)

obFillColor = rrsi > obLevel and highlightBreakouts ? green : transparent
osFillColor = rrsi < osLevel and highlightBreakouts ? red : transparent

fill(maxLevelPlot, obLevelPlot, color=obFillColor, transp=90)
fill(minLevelPlot, osLevelPlot, color=osFillColor, transp=90)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/recursive_median_oscillator.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Recursive Median Oscillator script may be freely distributed under the terms of the GPL-3.0 license.
study("Recursive Median Oscillator", shorttitle="RMO")

medianLength = input(title="Length", type=integer, minval=1, defval=5)
lowpassLength = input(title="Lowpass Length", type=integer, minval=1, defval=12)
highpassLength = input(title="Highpass Length", type=integer, minval=1, defval=30)
src = input(title="Source", type=source, defval=close)

median(src, length) =>
	percentile_nearest_rank(src, length, 50)

PI = 2 * asin(1)

alpha1Arg = 2 * PI / lowpassLength
alpha1 = (cos(alpha1Arg) + sin(alpha1Arg) - 1) / cos(alpha1Arg)

rm = 0.0
rm := alpha1 * median(src, medianLength) + (1 - alpha1) * nz(rm[1])

alpha2Arg = 1 / sqrt(2) * 2 * PI / highpassLength
alpha2 = (cos(alpha2Arg) + sin(alpha2Arg) - 1) / cos(alpha2Arg)

rmo = 0.0
rmo := pow(1 - alpha2 / 2, 2) * (rm - 2 * nz(rm[1]) + nz(rm[2])) + 2 * (1 - alpha2) * nz(rmo[1]) - pow(1 - alpha2, 2) * nz(rmo[2])

rmoColor = rmo >= 0.0 ? #0ebb23 : #ff0000

plot(rmo, title="RMO", linewidth=2, color=rmoColor, transp=0)

hline(0, title="Zero Level", linestyle=dashed, color=#3c78d8)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/regression_oscillator.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Regression Oscillator script may be freely distributed under the terms of the GPL-3.0 license.
study("Regression Oscillator", shorttitle="ROSC")

length = input(title="Length", type=integer, minval=1, defval=63)
linregOffset = input(title="Linear Regression Offset", type=integer, defval=0)
src = input(title="Source", type=source, defval=close)

rosc = 100 * (src / linreg(src, length, linregOffset) - 1)

roscColor = rosc >= 0.0 ? #0ebb23 : #ff0000

plot(rosc, title="ROSC", linewidth=2, color=roscColor, transp=0)

hline(0, title="Zero Level", linestyle=dotted, color=#989898)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/relative_momentum_index.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Relative Momentum Index script may be freely distributed under the terms of the GPL-3.0 license.
study("Relative Momentum Index", shorttitle="RMI")

length = input(title="Length", type=integer, minval=1, defval=14)
momentumLength = input(title="Momentum Length", type=integer, minval=1, defval=3)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

up = rma(max(change(src, momentumLength), 0), length)
down = rma(-min(change(src, momentumLength), 0), length)

rmi = down == 0 ? 100 : up == 0 ? 0 : 100 - (100 / (1 + up / down))

obLevel = 70
osLevel = 30

rmiColor = rmi > obLevel ? #0ebb23 : rmi < osLevel ? #ff0000 : #f4b77d
plot(rmi, title="RMI", linewidth=2, color=rmiColor, transp=0)

transparent = color(white, 100)

maxLevelPlot = hline(100, title="Max Level", linestyle=dotted, color=transparent)
obLevelPlot = hline(obLevel, title="Overbought Level", linestyle=dotted)
hline(50, title="Middle Level", linestyle=dotted)
osLevelPlot = hline(osLevel, title="Oversold Level", linestyle=dotted)
minLevelPlot = hline(0, title="Min Level", linestyle=dotted, color=transparent)

fill(obLevelPlot, osLevelPlot, color=purple, transp=95)

obFillColor = rmi > obLevel and highlightBreakouts ? green : transparent
osFillColor = rmi < osLevel and highlightBreakouts ? red : transparent

fill(maxLevelPlot, obLevelPlot, color=obFillColor, transp=90)
fill(minLevelPlot, osLevelPlot, color=osFillColor, transp=90)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/relative_spread_strength.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Relative Spread Strength script may be freely distributed under the terms of the GPL-3.0 license.
study("Relative Spread Strength", shorttitle="RSS")

rsiLength = input(title="RSI Length", type=integer, defval=14, minval=1)
fastLength = input(title="Fast MA Length", type=integer, defval=10, minval=1)
slowLength = input(title="Slow MA Length", type=integer, defval=40, minval=1)
smoothingLength = input(title="Smoothing Length", type=integer, defval=5, minval=1)
smoothingType = input(title="Smoothing Type", defval="EMA", options=["EMA", "SMA"])
highLevel = input(title="High Level", type=integer, defval=80, maxval=100)
lowLevel = input(title="Low Level", type=integer, defval=20, minval=0)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

spread = smoothingType == "EMA" ? ema(src, fastLength) - ema(src, slowLength) : sma(src, fastLength) - sma(src, slowLength)

rs = rsi(spread, rsiLength)
rss = sma(rs, smoothingLength)

rssColor = rss > highLevel ? #0ebb23 : rss < lowLevel ? #ff0000 : #f4b77d
plot(rss, title="RSS", linewidth=2, color=rssColor, transp=0)

transparent = color(white, 100)

maxLevelPlot = hline(100, title="Max Level", linestyle=dotted, color=transparent)
highLevelPlot = hline(highLevel, title="High Level", linestyle=dotted)
hline(50, title="Middle Level", linestyle=dotted)
lowLevelPlot = hline(lowLevel, title="Low Level", linestyle=dotted)
minLevelPlot = hline(0, title="Min Level", linestyle=dotted, color=transparent)

fill(highLevelPlot, lowLevelPlot, color=purple, transp=95)

highFillColor = rss > highLevel and highlightBreakouts ? green : transparent
lowFillColor = rss < lowLevel and highlightBreakouts ? red : transparent

fill(maxLevelPlot, highLevelPlot, color=highFillColor, transp=90)
fill(minLevelPlot, lowLevelPlot, color=lowFillColor, transp=90)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/relative_volatility_index.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Relative Volatility Index script may be freely distributed under the terms of the GPL-3.0 license.
study("Relative Volatility Index", shorttitle="RVI")

stdevLength = input(title="Standard Deviation Length", type=integer, minval=1, defval=10)
stdevType = input(title="Standard Deviation Type", defval="Population", options=["Population", "Sample"])
smoothLength = input(title="Smoothing Length", type=integer, minval=1, defval=14)
obLevel = input(title="Overbought Level", type=integer, defval=60)
osLevel = input(title="Oversold Level", type=integer, defval=40)
useRefined = input(title="Use Refined Version of RVI ?", type=bool, defval=true)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

sampleStdev(src, length) =>
	dev = src - sma(src, length)
	variance = sum(pow(dev, 2), length) / (length - 1)
	sqrt(variance)

selectedStdev = stdevType == "Population"
	 ? stdev(src, stdevLength)
	 : sampleStdev(src, stdevLength)

// Original version (1993)
rviOriginal(src) =>
	upSum = ema(change(src) >= 0 ? selectedStdev : 0, smoothLength)
	downSum = ema(change(src) >= 0 ? 0 : selectedStdev, smoothLength)
	100 * upSum / (upSum + downSum)

// Refined version (1995)
rvi = useRefined
	 ? avg(rviOriginal(high), rviOriginal(low))
	 : rviOriginal(src)

rviColor = rvi > obLevel ? #0ebb23 : rvi < osLevel ? #ff0000 : #f4b77d
plot(rvi, title="RVI", linewidth=2, color=rviColor, transp=0)

transparent = color(white, 100)

maxLevelPlot = hline(100, title="Max Level", linestyle=dotted, color=transparent)
obLevelPlot = hline(obLevel, title="Overbought Level", linestyle=dotted)
hline(50, title="Middle Level", linestyle=dotted)
osLevelPlot = hline(osLevel, title="Oversold Level", linestyle=dotted)
minLevelPlot = hline(0, title="Min Level", linestyle=dotted, color=transparent)

fill(obLevelPlot, osLevelPlot, color=purple, transp=95)

obFillColor = rvi > obLevel and highlightBreakouts ? green : transparent
osFillColor = rvi < osLevel and highlightBreakouts ? red : transparent

fill(maxLevelPlot, obLevelPlot, color=obFillColor, transp=90)
fill(minLevelPlot, osLevelPlot, color=osFillColor, transp=90)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/repulse.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Repulse script may be freely distributed under the terms of GPL-3.0 license.
study("Repulse")

length = input(title="Length", type=integer, minval=1, defval=5)

bullPower = 100 * (3 * close - 2 * lowest(length) - open[length - 1]) / close

bearPower = 100 * (open[length - 1] + 2 * highest(length) - 3 * close) / close

repulse = ema(bullPower, 5 * length) - ema(bearPower, 5 * length)

repulseColor = repulse >= repulse[1] ? #0ebb23 : red
plot(repulse, title="Repulse", linewidth=2, color=repulseColor, transp=0)

hline(0, title="Zero Level", linestyle=dotted)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/rocket_rsi.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Rocket RSI script may be freely distributed under the terms of the GPL-3.0 license.
study("Rocket RSI", shorttitle="Rocket RSI")

rsiLength = input(title="RSI Length", type=integer, minval=1, defval=10)
smoothingLength = input(title="Smoothing Length", type=integer, minval=1, defval=8)
obosLevel = input(title="Overbought / Oversold Level", type=float, minval=0.0, defval=2.0)
applyNormalization = input(title="Apply Normalization to [-100, 100] values ?", type=bool, defval=false)
src = input(title="Source", type=source, defval=close)

PI = 2 * asin(1)

a1 = 0.0
b1 = 0.0
c1 = 0.0
c2 = 0.0
c3 = 0.0

// Compute Super Smoother coefficients
a1 := exp(-1.414 * PI / smoothingLength)
b1 := 2 * a1 * cos(1.414 * 180 / smoothingLength)
c2 := b1
c3 := -a1 * a1
c1 := 1 - c2 - c3

// Create half dominant cycle momentum
mom = change(src, rsiLength - 1)

// Super Smoother Filter
ssf = 0.0
ssf := c1 * (mom + nz(mom[1])) / 2 + c2 * nz(ssf[1]) + c3 * nz(ssf[2])

// Accumulate `Closes Up` and `Closes Down`
upSum = sum(change(ssf, 1) > 0 ? change(ssf, 1) : 0.0, rsiLength)
downSum = sum(change(ssf, 1) > 0 ? 0.0 : abs(change(ssf, 1)), rsiLength)

tmpRSI = 0.0
tmpRSI := upSum + downSum != 0 ? (upSum - downSum) / (upSum + downSum) : nz(tmpRSI[1])

// Limit RocketRSI output to +/-3 Standard Deviations
if tmpRSI > 0.999
	tmpRSI := 0.999

if tmpRSI < -0.999
	tmpRSI := -0.999

// Apply Fisher Transform to establish Gaussian Probability Distribution
rocketRSI = 0.5 * log((1 + tmpRSI) / (1 - tmpRSI))
rocketRSI := applyNormalization ? rocketRSI * 25 : rocketRSI

overboughtLevel = applyNormalization ? obosLevel * 25 : obosLevel
oversoldLevel = applyNormalization ? obosLevel * -25 : obosLevel * -1

rocketRSIColor = rocketRSI > overboughtLevel ? green : rocketRSI < oversoldLevel ? red : #ff9370

plot(rocketRSI, title="RRSI", linewidth=2, color=rocketRSIColor, transp=0)

plot(overboughtLevel, title="OB Level", style=circles, color=#3d85c6, transp=0)
hline(0, title="Zero Level", linestyle=dotted)
plot(oversoldLevel, title="OS Level", style=circles, color=#3d85c6, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/rsi_relative_strength_index.pine --- */
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Relative Strength Index (RSI) script may be freely distributed under the terms of GPL-3.0 license.
study(title="Relative Strength Index", shorttitle="RSI")

length = input(title="Length", type=integer, defval=14)
obLevel = input(title="Overbought Level", type=integer, defval=70)
osLevel = input(title="Oversold Level", type=integer, defval=30)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=bool, defval=true)
srcInput = input(title="Source", defval="close",
	 options=["open",
				 "high",
				 "low",
				 "close",
				 "oo2",
				 "oh2",
				 "ol2",
				 "oc2",
				 "hh2",
				 "hl2",
				 "hc2",
				 "ll2",
				 "lc2",
				 "cc2",
				 "hlc3",
				 "ohlc4",
				 "wc",
				 "acc/dist",
				 "on balance volume",
				 "price volume trend"])

getBaseSource(input) =>
	src = 0.0
	if input == "open"
		src := open
	if input == "high"
		src := high
	if input == "low"
		src := low
	if input == "close"
		src := close
	if input == "oo2"
		src := (open + nz(open[1])) / 2
	if input == "oh2"
		src := (open + high) / 2
	if input == "ol2"
		src := (open + low) / 2
	if input == "oc2"
		src := (open + close) / 2
	if input == "hh2"
		src := (high + nz(high[1])) / 2
	if input == "hl2" // Median Price
		src := hl2
	if input == "hc2"
		src := (high + close) / 2
	if input == "ll2"
		src := (low + nz(low[1])) / 2
	if input == "lc2"
		src := (low + close) / 2
	if input == "cc2"
		src := (close + nz(close[1])) / 2
	if input == "hlc3" // Typical Price
		src := hlc3
	if input == "ohlc4"
		src := ohlc4
	if input == "wc" // Weighted Close
		src := (2 * close + high + low) / 4
	if input == "acc/dist"
		src := accdist
	if input == "on balance volume"
		src := cum(sign(change(close)) * volume)
	if input == "price volume trend"
		src := cum(change(close) / close[1] * volume)
	src

src = getBaseSource(srcInput)

rsi = rsi(src, length)

rsiColor = rsi > obLevel ? #0ebb23 : rsi < osLevel ? red : #f4b77d
plot(rsi, title="RSI", linewidth=2, color=rsiColor, transp=0)

transparent = color(white, 100)

maxLevelPlot = hline(100, title="Max Level", linestyle=dotted, color=transparent)
obLevelPlot = hline(obLevel, title="Overbought Level", linestyle=dotted)
hline(50, title="Middle Level", linestyle=dotted)
osLevelPlot = hline(osLevel, title="Oversold Level", linestyle=dotted)
minLevelPlot = hline(0, title="Min Level", linestyle=dotted, color=transparent)
fill(obLevelPlot, osLevelPlot, color=purple, transp=95)

obFillColor = rsi > obLevel and highlightBreakouts ? green : transparent
osFillColor = rsi < osLevel and highlightBreakouts ? red : transparent

fill(maxLevelPlot, obLevelPlot, color=obFillColor, transp=90)
fill(minLevelPlot, osLevelPlot, color=osFillColor, transp=90)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/rsx.pine --- */
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Jurik RSX script may be freely distributed under the terms of the GPL-3.0 license.
study("Jurik RSX", shorttitle="RSX")

length = input(title="Length", type=integer, defval=14)
src = input(title="Source", type=source, defval=hlc3)
obLevel = input(title="OB Level", type=integer, defval=70)
osLevel = input(title="OS Level", type=integer, defval=30)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=bool, defval=true)

f8 = 100 * src
f10 = nz(f8[1])
v8 = f8 - f10

f18 = 3 / (length + 2)
f20 = 1 - f18

f28 = 0.0
f28 := f20 * nz(f28[1]) + f18 * v8

f30 = 0.0
f30 := f18 * f28 + f20 * nz(f30[1])
vC = f28 * 1.5 - f30 * 0.5

f38 = 0.0
f38 := f20 * nz(f38[1]) + f18 * vC

f40 = 0.0
f40 := f18 * f38 + f20 * nz(f40[1])
v10 = f38 * 1.5 - f40 * 0.5

f48 = 0.0
f48 := f20 * nz(f48[1]) + f18 * v10

f50 = 0.0
f50 := f18 * f48 + f20 * nz(f50[1])
v14 = f48 * 1.5 - f50 * 0.5

f58 = 0.0
f58 := f20 * nz(f58[1]) + f18 * abs(v8)

f60 = 0.0
f60 := f18 * f58 + f20 * nz(f60[1])
v18 = f58 * 1.5 - f60 * 0.5

f68 = 0.0
f68 := f20 * nz(f68[1]) + f18 * v18

f70 = 0.0
f70 := f18 * f68 + f20 * nz(f70[1])
v1C = f68 * 1.5 - f70 * 0.5

f78 = 0.0
f78 := f20 * nz(f78[1]) + f18 * v1C

f80 = 0.0
f80 := f18 * f78 + f20 * nz(f80[1])
v20 = f78 * 1.5 - f80 * 0.5

f88_ = 0.0
f90_ = 0.0

f88 = 0.0
f90_ := nz(f90_[1]) == 0 ? 1 : nz(f88[1]) <= nz(f90_[1]) ? nz(f88[1]) + 1 : nz(f90_[1]) + 1
f88 := nz(f90_[1]) == 0 and (length - 1 >= 5) ? length - 1 : 5

f0 = f88 >= f90_ and f8 != f10 ? 1 : 0
f90 = f88 == f90_ and f0 == 0 ? 0 : f90_

v4_ = f88 < f90 and v20 > 0 ? (v14 / v20 + 1) * 50 : 50
rsx = v4_ > 100 ? 100 : v4_ < 0 ? 0 : v4_

rsxColor = rsx > obLevel ? #0ebb23 : rsx < osLevel ? #ff0000 : #f4b77d
plot(rsx, title="RSX", linewidth=2, color=rsxColor, transp=0)

transparent = color(white, 100)

maxLevelPlot = hline(100, title="Max Level", linestyle=dotted, color=transparent)
obLevelPlot = hline(obLevel, title="Overbought Level", linestyle=dotted)
hline(50, title="Middle Level", linestyle=dotted)
osLevelPlot = hline(osLevel, title="Oversold Level", linestyle=dotted)
minLevelPlot = hline(0, title="Min Level", linestyle=dotted, color=transparent)

fill(obLevelPlot, osLevelPlot, color=purple, transp=95)

obFillColor = rsx > obLevel and highlightBreakouts ? green : transparent
osFillColor = rsx < osLevel and highlightBreakouts ? red : transparent

fill(maxLevelPlot, obLevelPlot, color=obFillColor, transp=90)
fill(minLevelPlot, osLevelPlot, color=osFillColor, transp=90)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/self_adjusting_rsi.pine --- */
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Self-Adjusting RSI script may be freely distributed under the terms of GPL-3.0 license.
study("Self-Adjusting RSI", shorttitle="SARSI")

rsiLength = input(title="RSI Length", type=integer, defval=14, minval=1)
adjusting = input(title="Method of Adjusting OB/OS Levels", defval="Standard Deviation", options=["Standard Deviation", "SMA"])
mult = input(title="Adjustment Multiplier", type=float, defval=2, step=0.1)
smoothingType = input(title="Smoothing Type", defval="SMA", options=["EMA", "SMA"])
smoothingLength = input(title="Smoothing Length", type=integer, defval=21, minval=1)
highlightMovements = input(title="Highlight Smoothing ?", type=bool, defval=false)
src = input(title="Source", type=source, defval=close)

rsi = rsi(src, rsiLength)

_adjusting() =>
    adjusting == "Standard Deviation" ? mult * stdev(rsi, rsiLength) :
     adjusting == "SMA" ? mult * sma(abs(rsi - sma(rsi, rsiLength)), rsiLength) :
     na

adjust = _adjusting()
obLevel = 50 + adjust
osLevel = 50 - adjust

hline(50, title="Middle Level", linestyle=dotted)
transparent = color(white, 100)

rsiColor = rsi > obLevel ? #0ebb23 : rsi < osLevel ? red : #f4b77d
rsiPlot = plot(rsi, title="SARSI", linewidth=1, color=rsiColor, transp=0)

smooth = smoothingType == "EMA" ? ema(rsi, smoothingLength) : sma(rsi, smoothingLength)
smoothColor = highlightMovements ? (smooth > smooth[1] ? #0ebb23 : red) : #6d1e7f
plot(smooth, title="Smooth", linewidth=1, color=smoothColor, transp=0)

obosColor = #f1bc05 //#7b1fa2
obLevelPlot = plot(obLevel, title="OB", color=obosColor, transp=100)
osLevelPlot = plot(osLevel, title="OS", color=obosColor, transp=100)
fill(obLevelPlot, osLevelPlot, title="OB/OS Filling", color=#f1bc05, transp=80)

obFillColor = rsi > obLevel ? green : transparent
fill(rsiPlot, obLevelPlot, title="SARSI/OB Filling", color=obFillColor, transp=85)

osFillColor = rsi < osLevel ? red : transparent
fill(rsiPlot, osLevelPlot, title="SARSI/OS Filling", color=osFillColor, transp=85)

co = crossover(rsi, obLevel)
cu = crossunder(rsi, osLevel)

alertcondition(co, title="Alert on SARSI Overbought", message="SARSI Overbought!")
alertcondition(cu, title="Alert on SARSI Oversold", message="SARSI Oversold!")


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/smoothed_rate_of_change.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Smoothed Rate of Change script may be freely distributed under the terms of the GPL-3.0 license.
study("Smoothed Rate of Change", shorttitle="S-RoC")

rocLength = input(title="ROC Length", type=integer, minval=1, defval=21)
smoothingLength = input(title="Smoothing Length", type=integer, minval=1, defval=13)
src = input(title="Source", type=source, defval=close)

ma = ema(src, smoothingLength)

sroc = nz(ma[rocLength]) == 0
	 ? 100
	 : ma - nz(ma[rocLength]) == 0
	 	 ? 0
	 	 : 100 * (ma - nz(ma[rocLength])) / ma[rocLength]

srocColor = sroc >= 0.0 ? #0ebb23 : #ff0000

plot(sroc, title="S-RoC", linewidth=2, color=srocColor, transp=0)

hline(0, title="Zero Level", linestyle=dotted, color=#989898)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/stc_schaff_trend_cycle.pine --- */
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Schaff Trend Cycle script may be freely distributed under the terms of GPL-3.0 license.
study("Schaff Trend Cycle", shorttitle="STC")

fastLength = input(title="MACD Fast Length", type=input.integer, defval=23)
slowLength = input(title="MACD Slow Length", type=input.integer, defval=50)
cycleLength = input(title="Cycle Length", type=input.integer, defval=10)
d1Length = input(title="1st %D Length", type=input.integer, defval=3)
d2Length = input(title="2nd %D Length", type=input.integer, defval=3)
src = input(title="Source", type=input.source, defval=close)
upper = input(title="Upper Band", type=input.integer, defval=75)
lower = input(title="Lower Band", type=input.integer, defval=25)
highlightBreakouts = input(title="Highlight Breakouts ?", type=input.bool, defval=true)

macd = ema(src, fastLength) - ema(src, slowLength)
k = nz(fixnan(stoch(macd, macd, macd, cycleLength)))
d = ema(k, d1Length)
kd = nz(fixnan(stoch(d, d, d, cycleLength)))
stc = ema(kd, d2Length)
stc := max(min(stc, 100), 0)

stcColor1 = stc > stc[1] ? color.green : color.red
stcColor2 = stc > upper ? color.green : stc <= lower ? color.red : color.orange

stcColor = highlightBreakouts ? stcColor2 : stcColor1
stcPlot = plot(stc, title="STC", color=stcColor, transp=0)

upperLevel = plot(upper, title="Upper", color=color.gray)
hline(50, title="Middle", linestyle=hline.style_dotted)
lowerLevel = plot(lower, title="Lower", color=color.gray)

fill(upperLevel, lowerLevel, title="Middle Zone", color=#f9cb9c, transp=90)

upperFillColor = stc > upper and highlightBreakouts ? color.green : na
lowerFillColor = stc < lower and highlightBreakouts ? color.red : na

fill(upperLevel, stcPlot, color=upperFillColor, transp=80)
fill(lowerLevel, stcPlot, color=lowerFillColor, transp=80)

buySignal = crossover(stc, lower)
sellSignal = crossunder(stc, upper)
upperCrossover = crossover(stc, upper)
upperCrossunder = crossunder(stc, upper)
lowerCrossover = crossover(stc, lower)
lowerCrossunder = crossunder(stc, lower)

plotshape(upperCrossunder ? upper : na, title="Sell Signal", location=location.absolute, style=shape.circle, size=size.tiny, color=color.red, transp=0)
plotshape(lowerCrossover ? lower : na, title="Buy Signal", location=location.absolute, style=shape.circle, size=size.tiny, color=color.green, transp=0)

alertcondition(buySignal, title="Alert: Buy", message="STC: Buy!\nSymbol: {{exchange}}:{{ticker}}\nPrice: {{close}}")
alertcondition(sellSignal, title="Alert: Sell", message="STC: Sell!\nSymbol: {{exchange}}:{{ticker}}\nPrice: {{close}}")
alertcondition(upperCrossover, title="Alert: Upper Band Crossover", message="STC: Upper Band Crossover!\nSymbol: {{exchange}}:{{ticker}}\nPrice: {{close}}")
alertcondition(upperCrossunder, title="Alert: Upper Band Crossunder", message="STC: Upper Band Crossunder!\nSymbol: {{exchange}}:{{ticker}}\nPrice: {{close}}")
alertcondition(lowerCrossover, title="Alert: Lower Band Crossover", message="STC: Lower Band Crossover!\nSymbol: {{exchange}}:{{ticker}}\nPrice: {{close}}")
alertcondition(lowerCrossunder, title="Alert: Lower Band Crossunder", message="STC: Lower Band Crossunder!\nSymbol: {{exchange}}:{{ticker}}\nPrice: {{close}}")


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/stiffness_indicator.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Stiffness Indicator script may be freely distributed under the terms of GPL-3.0 license.
study("Stiffness Indicator", shorttitle="Stiffness")

maLength = input(title="Moving Average Length", minval=1, defval=100)
stiffLength = input(title="Stiffness Length", minval=1, defval=60)
stiffSmooth = input(title="Stiffness Smoothing Length", minval=1, defval=3)
threshold = input(title="Threshold", minval=1, defval=90)
highlightThresholdCrossovers = input(title="Highlight Threshold Crossovers ?", type=bool, defval=false)

bound = sma(close, maLength) - 0.2 * stdev(close, maLength)
sumAbove = sum(close > bound ? 1 : 0, stiffLength)
stiffness = ema(sumAbove * 100 / stiffLength, stiffSmooth)

transparent = color(white, 100)

bgColor = highlightThresholdCrossovers ? (stiffness > threshold ? #0ebb23 : red) : transparent
bgcolor(bgColor, transp=90)

plot(stiffness, title="Stiffness", style=histogram, color=#f5c75e, transp=0)
plot(threshold, title="Threshold", color=red, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/stochastic_connors_rsi.pine --- */
//@version=3
// Copyright (c) 2017-present, Alex Orekhov (everget)
// Stochastic Connors RSI indicator script may be freely distributed under the terms of GPL-3.0 license.
study(title="Stochastic Connors RSI", shorttitle="Stoch CRSI")

stochLength = input(title="Stochastic Length", type=integer, defval=3, minval=1)
smoothK = input(title="K", type=integer, defval=3, minval=1, maxval=10000)
smoothD = input(title="D", type=integer, defval=3, minval=1, maxval=10000)

rsiLength = input(title="RSI Length", type=integer, defval=3, minval=1)
updownLength = input(title="Updown RSI Length", type=integer, defval=2, minval=1)
rocLength = input(title="ROC Length", type=integer, defval=100, minval=1)
src = input(title="RSI Source", type=source, defval=close)

updown = 0
updown_calc(s, ud) =>
    newupdown = 0
    if s > s[1]
        newupdown := nz(ud[1]) >= 0 ? nz(ud[1]) + 1 : 1
    else
        if s < s[1]
            newupdown := nz(ud[1]) <= 0 ? nz(ud[1]) - 1 : -1
        else
            newupdown := 0

updown := updown_calc(src, updown)

updownrsi = rsi(updown, updownLength)

rsi = rsi(src, rsiLength)

percentrank = percentrank(roc(src, 1), rocLength)

crsi = avg(rsi, updownrsi, percentrank)

stochcalc = stoch(crsi, crsi, crsi, stochLength)

band1 = hline(80, color=gray, linestyle=dashed)
band2 = hline(20, color=gray, linestyle=dashed)
fill(band1, band2, color=#f9cb9c0f)

band3 = hline(70, color=gray, linestyle=dashed)
band4 = hline(30, color=gray, linestyle=dashed)
fill(band3, band4, color=#de9ba6)

smaK = sma(stochcalc, smoothK)
smaD = sma(smaK, smoothD)

plot(smaK, title="K", color=#0094ff)
plot(smaD, title="D", color=#ff6a00)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/stochastic_momentum_index.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Stochastic Momentum Index script may be freely distributed under the terms of the GPL-3.0 license.
study("Stochastic Momentum Index", shorttitle="SMI")

q = input(title="Length (Stochastic Lookback)", type=integer, minval=1, defval=13)
r = input(title="First Smoothing Length", type=integer, minval=1, defval=25)
s = input(title="Second Smoothing Length", type=integer, minval=1, defval=2)
signalLength = input(title="Signal Length", type=integer, minval=1, defval=12)
overboughtLevel = input(title="Overbought Level", type=integer, defval=40)
oversoldLevel = input(title="Oversold Level", type=integer, defval=-40)
applyFilling = input(title="Apply Filling ?", type=bool, defval=false)
src = input(title="Source", type=source, defval=close)

hhq = highest(high, q)
llq = lowest(low, q)

numerator = ema(ema(src - 0.5 * (hhq + llq), r), s)

denominator = 0.5 * ema(ema(hhq - llq, r), s)

smi = 100 * numerator / denominator

signal = ema(smi, signalLength)

smiPlot = plot(smi, title="SMI", color=#ff3e7d, transp=0)
signalPlot = plot(signal, title="Signal", color=#3c78d8, transp=0)

overbought = hline(title="Overbought Level", price=overboughtLevel, linestyle=dotted, color=#e69138)
hline(title="Zero Level", price=0, linestyle=dashed, color=#989898)
oversold = hline(title="Oversold Level", price=oversoldLevel, linestyle=dotted, color=#e69138)

fillColor = applyFilling ? (smi > signal ? #0ebb23 : #cc0000) : color(white, 100)
fill(smiPlot, signalPlot, color=fillColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/stochastic.pine --- */
//@version=4
// Copyright (c) 2021-present, Alex Orekhov (everget)
// Stochastic script may be freely distributed under the terms of GPL-3.0 license.
study("Stochastic", shorttitle="Stoch", precision=2)

periodK = input(title="K", minval=1, defval=14)
periodD = input(title="D", minval=1, defval=3)
smoothK = input(title="Smooth", minval=1, defval=3)
src = input(title="Source", type=input.source, defval=close)

obLevel = input(title="Overbought Level", type=input.integer, defval=80)
osLevel = input(title="Oversold Level", type=input.integer, defval=20)
maxLevel = input(title="Max Level", type=input.integer, defval=100)
minLevel = input(title="Min Level", type=input.integer, defval=0)
showHistogram = input(title="Show Histogram ?", type=input.bool, defval=false)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=input.bool, defval=true)
highlightCrossovers = input(title="Highlight K/D Crossovers ?", type=input.bool, defval=true)
highlightMiddleCrossovers = input(title="Highlight Middle Line Crossovers ?", type=input.bool, defval=true)
applyRibbonFilling = input(title="Apply Ribbon Filling ?", type=input.bool, defval=true)

k = sma(stoch(src, high, low, periodK), smoothK)
d = sma(k, periodD)

trendColor = k > d ? #0ebb23 : color.red
kColor = applyRibbonFilling ? trendColor : #ff3e7d
dColor = applyRibbonFilling? trendColor : #3c78d8

kPlot = plot(k, title="%K", color=kColor, transp=0)
dPlot = plot(d, title="%D", color=dColor, transp=0)

hist = k - d
histColor = hist >= 0 ? hist[1] < hist ? #26A69A : #B2DFDB : hist[1] < hist ? #FFCDD2 : #EF5350
plot(showHistogram ? hist : na, title="Histogram", style=plot.style_columns, color=histColor, transp=0)

var color noneColor = color.new(color.white, 100)

maxLevelPlot = hline(maxLevel, title="Max Level", linestyle=hline.style_dotted, color=noneColor)
obLevelPlot = hline(obLevel, title="Overbought Level", linestyle=hline.style_dotted, color=#00796b)
hline(50, title="Middle Level", linestyle=hline.style_dotted, color=#989898)
osLevelPlot = hline(osLevel, title="Oversold Level", linestyle=hline.style_dotted, color=#f57f17)
minLevelPlot = hline(minLevel, title="Min Level", linestyle=hline.style_dotted, color=noneColor)
fill(obLevelPlot, osLevelPlot, title="Middle Zone", color=color.purple, transp=95)

obFillColor = k > obLevel and highlightBreakouts ? color.green : na
osFillColor = k < osLevel and highlightBreakouts ? color.red : na

fill(maxLevelPlot, obLevelPlot, title="Upper Band Breakout", color=obFillColor, transp=85)
fill(minLevelPlot, osLevelPlot, title="Lower Band Breakout", color=osFillColor, transp=85)

fillColor = applyRibbonFilling ? trendColor : na
fill(kPlot, dPlot, title="Ribbon", color=fillColor, transp=70)

middleCrossBgColor = highlightMiddleCrossovers ? (k > 50 ? color.green : color.red) : na
bgcolor(middleCrossBgColor, transp=90)

plotshape(highlightCrossovers and crossover(k, d) ? k : na, title="K/D Crossover", location=location.absolute, style=shape.circle, size=size.tiny, color=color.green, transp=0)
plotshape(highlightCrossovers and crossunder(k, d) ? k : na, title="K/D Crossunder", location=location.absolute, style=shape.circle, size=size.tiny, color=color.red, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/tick_line_momentum_oscillator.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Tick Line Momentum Oscillator script may be freely distributed under the terms of the GPL-3.0 license.
study("Tick Line Momentum Oscillator", shorttitle="TLMO")

cumoMALength = input(title="Cumo MA Length", type=integer, minval=1, defval=10)
cumoMAInput = input(title="Cumo MA", defval="EMA", options=["EMA", "SMA", "VWMA", "WMA"])
rocLength = input(title="ROC Length", type=integer, minval=1, defval=5)
smoothingLength = input(title="Smoothing Length", type=integer, minval=1, defval=5)
smoothingMAInput = input(title="Smoothing MA", defval="EMA", options=["EMA", "SMA", "VWMA", "WMA"])
obosLevel = input(title="Overbought / Oversold Level", type=integer, minval=1, defval=5)
src = input(title="Source", type=source, defval=close)

cumoMA = iff(cumoMAInput == "EMA", ema(src, cumoMALength),
	 iff(cumoMAInput == "SMA", sma(src, cumoMALength),
	 iff(cumoMAInput == "VWMA", vwma(src, cumoMALength),
	 iff(cumoMAInput == "WMA", wma(src, cumoMALength),
	 na))))

cumoExpression = src > nz(cumoMA[1])
	 ? 1
	 : src < nz(cumoMA[1])
	 	 ? -1
	 	 : 0

tlmo = iff(smoothingMAInput == "EMA", ema(roc(cum(cumoExpression), rocLength), smoothingLength),
	 iff(smoothingMAInput == "SMA", sma(roc(cum(cumoExpression), rocLength), smoothingLength),
	 iff(smoothingMAInput == "VWMA", vwma(roc(cum(cumoExpression), rocLength), smoothingLength),
	 iff(smoothingMAInput == "WMA", wma(roc(cum(cumoExpression), rocLength), smoothingLength),
	 na))))

tlmoColor = tlmo > obosLevel ? #0ebb23 : tlmo < -obosLevel ? #ff0000 : #674ea7
plot(tlmo, title="TLMO", linewidth=2, color=tlmoColor, transp=0)

hline(obosLevel, title="Overbought", linestyle=dotted, color=#0ebb23)
hline(0, title="Zero Level", linestyle=solid, color=#f6b26b)
hline(-1 * obosLevel, title="Oversold", linestyle=dotted, color=#ff0000)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/total_power_indicator.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Total Power Indicator script may be freely distributed under the terms of GPL-3.0 license.
study("Total Power Indicator", shorttitle="TPI")

length = input(title="Length", type=integer, defval=45)
powersLength = input(title="Elder Powers Length", type=integer, defval=10)
adjustableLevel = input(title="Adjustable Entry Level", type=integer, defval=75)
applyFilling = input(title="Apply Powers Filling ?", type=bool, defval=false)

elderBullPower = high - ema(close, powersLength)
elderBearPower = low - ema(close, powersLength)

adjust(value) => 100 * value / length

bullCount = sum(elderBullPower > 0 ? 1 : 0, length)
bearCount = sum(elderBearPower < 0 ? 1 : 0, length)
total = adjust(abs(bullCount - bearCount))
bull = adjust(bullCount)
bear = adjust(bearCount)

bullPlot = plot(bull, title="Bull", linewidth=2, color=#0ebb23, transp=0)
bearPlot = plot(bear, title="Bear", linewidth=2, color=red, transp=0)
plot(total, title="Total", linewidth=2, color=#3c78d8, transp=0)

fillColor = applyFilling ? (bull > bear ? #0ebb23 : red) : color(white, 100) 
fill(bullPlot, bearPlot, color=fillColor, transp=80)

hline(adjustableLevel, title="Adjustable Entry Level", linestyle=dotted)
hline(50, title="Middle Level", linestyle=dotted, color=#f49517)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/trend_continuation_factor.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Trend Continuation Factor script may be freely distributed under the terms of the GPL-3.0 license.
study("Trend Continuation Factor", shorttitle="TCF")

length = input(title="Length", type=integer, minval=1, defval=35)
src = input(title="Source", type=source, defval=close)

plusChange(src) => change(src) > 0 ? change(src) : 0.0
minusChange(src) => change(src) > 0 ? 0.0 : -change(src)

plusCF = 0.0
plusCF := plusChange(src) == 0 ? 0.0 : plusChange(src) + nz(plusCF[1])

minusCF = 0.0
minusCF := minusChange(src) == 0 ? 0.0 : minusChange(src) + nz(minusCF[1])

plusTCF = sum(plusChange(src) - minusCF, length)
minusTCF = sum(minusChange(src) - plusCF, length)

plot(plusTCF, title="+TCF", linewidth=2, color=#38761d, transp=0)
plot(minusTCF, title="-TCF", linewidth=2, color=#cc4125, transp=0)

hline(0, title="Zero Level", linestyle=line, color=#e69138)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/trend_detection_index.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Trend Detection Index script may be freely distributed under the terms of the GPL-3.0 license.
study("Trend Detection Index", shorttitle="TDI")

length = input(title="Length", type=integer, minval=1, defval=20)
src = input(title="Source", type=source, defval=close)

momentum = change(src, length)

tdi = abs(sum(momentum, length)) - (sum(abs(momentum), length * 2) - sum(abs(momentum), length))

// Direction Indicator
direction = sum(momentum, length)

plot(tdi, title="TDI", color=#ff0000, transp=0)
plot(direction, title="Direction", color=#0ebb23, transp=0)

hline(0, title="Zero Level", linestyle=dotted)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/trend_intensity_index.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Trend Intensity Index script may be freely distributed under the terms of the GPL-3.0 license.
study("Trend Intensity Index", shorttitle="TII")

majorLength = input(title="Major Length", type=integer, defval=60)
minorLength = input(title="Minor Length", type=integer, defval=30)
upperLevel = input(title="Upper Level", type=integer, defval=80)
lowerLevel = input(title="Lower Level", type=integer, defval=20)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

sma = sma(src, majorLength)

positiveSum = 0.0
negativeSum = 0.0

for i = 0 to minorLength - 1
    price = nz(src[i])
    avg = nz(sma[i])
    positiveSum := positiveSum + (price > avg ? price - avg : 0)
    negativeSum := negativeSum + (price > avg ? 0 : avg - price)

tii = 100 * positiveSum / (positiveSum + negativeSum)

tiiColor = tii > upperLevel ? #0ebb23 : tii < lowerLevel ? #ff0000 : #f4b77d
plot(tii, title="TII", linewidth=2, color=tiiColor, transp=0)

transparent = color(white, 100)

maxLevelPlot = hline(100, title="Max Level", linestyle=dotted, color=transparent)
upperLevelPlot = hline(upperLevel, title="Upper Level", linestyle=dotted)
hline(50, title="Middle Level", linestyle=dotted)
lowerLevelPlot = hline(lowerLevel, title="Lower Level", linestyle=dotted)
minLevelPlot = hline(0, title="Min Level", linestyle=dotted, color=transparent)

fill(upperLevelPlot, lowerLevelPlot, color=purple, transp=95)

upperFillColor = tii > upperLevel and highlightBreakouts ? green : transparent
lowerFillColor = tii < lowerLevel and highlightBreakouts ? red : transparent

fill(maxLevelPlot, upperLevelPlot, color=upperFillColor, transp=90)
fill(minLevelPlot, lowerLevelPlot, color=lowerFillColor, transp=90)



/* --- FILE: tradingview-pinescript-indicators-master/oscillators/trend_trigger_factor.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Trend Trigger Factor script may be freely distributed under the terms of the GPL-3.0 license.
study("Trend Trigger Factor", shorttitle="TTF")

length = input(title="Lookback Length", type=integer, defval=15)
upperLevel = input(title="Upper Trigger Level", type=integer, defval=100, minval=1)
lowerLevel = input(title="Lower Trigger Level", type=integer, defval=-100, maxval=-1)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

hh = highest(length)
ll = lowest(length)

buyPower = hh - nz(ll[length])
sellPower = nz(hh[length]) - ll

ttf = 200 * (buyPower - sellPower) / (buyPower + sellPower)

ttfColor = ttf > upperLevel ? #0ebb23 : ttf < lowerLevel ? #ff0000 : #f4b77d
plot(ttf, title="TTF", linewidth=2, color=ttfColor, transp=0)

transparent = color(white, 100)

maxLevelPlot = hline(200, title="Max Level", linestyle=dotted, color=transparent)
upperLevelPlot = hline(upperLevel, title="Upper Trigger Level", linestyle=dotted)
hline(0, title="Zero Level", linestyle=dotted)
lowerLevelPlot = hline(lowerLevel, title="Lower Trigger Level", linestyle=dotted)
minLevelPlot = hline(-200, title="Min Level", linestyle=dotted, color=transparent)

fill(upperLevelPlot, lowerLevelPlot, color=purple, transp=95)

upperFillColor = ttf > upperLevel and highlightBreakouts ? green : transparent
lowerFillColor = ttf < lowerLevel and highlightBreakouts ? red : transparent

fill(maxLevelPlot, upperLevelPlot, color=upperFillColor, transp=90)
fill(minLevelPlot, lowerLevelPlot, color=lowerFillColor, transp=90)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/trendscore.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Trendscore script may be freely distributed under the terms of the GPL-3.0 license.
study("Trendscore", shorttitle="Trendscore")

fromIndex = input(title="From", type=integer, minval=1, defval=11)
toIndex = input(title="To", type=integer, minval=1, defval=20)
src = input(title="Source", type=source, defval=close)

trendscore(src, fromIndex, toIndex) =>
	sum = 0.0

	for i = fromIndex to toIndex
		sum := src >= nz(src[i]) ? sum + 1 : sum - 1
	sum

plot(trendscore(src, fromIndex, toIndex), title="Trendscore", linewidth=2, color=#e69138, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/trix.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// TRIX script may be freely distributed under the terms of GPL-3.0 license.
study("TRIX")

length = input(title="Length", type=integer, defval=14)
mult = input(title="TRIX Value Multiplier", type=integer, defval=1)
signalType = input(title="Signal Smoothing Type", defval="SMA", options=["EMA", "SMA"])
signalLength = input(title="Signal Smoothing Length", type=integer, defval=9)
src = input(title="Source", type=source, defval=close)
showSignal = input(title="Show Signal Line ?", type=bool, defval=true)
showHistogram = input(title="Show Histogram ?", type=bool, defval=false)
highlightCrossovers = input(title="Highlight TRIX/Signal Crossovers ?", type=bool, defval=true)
highlightZeroCrossovers = input(title="Highlight Zero Line Crossovers ?", type=bool, defval=false)
applyFilling = input(title="Apply Ribbon Filling ?", type=bool, defval=false)

triple = ema(ema(ema(src, length), length), length)

trix = mult * roc(triple, 1)
signal = signalType == "SMA" ? sma(trix, signalLength) : ema(trix, signalLength)

hist = trix - signal
histColor = hist >= 0 ? (hist[1] < hist ? #26A69A : #B2DFDB) : (hist[1] < hist ? #FFCDD2 : #EF5350)
plot(showHistogram ? hist : na, title="Histogram", style=columns, color=histColor, transp=0)
hline(0, title="Zero Level", linestyle=dotted)

trendColor = trix > signal ? #0ebb23 : red

trixColor = applyFilling ? trendColor : (trix > 0 ? #0ebb23 : red)
signalColor = applyFilling ? trendColor : #ff9800

trixPlot = plot(trix, title="TRIX", linewidth=2, color=trixColor, transp=0)
signalPlot = plot(showSignal ? signal : na, title="Signal", color=signalColor, transp=0)

transparent = color(white, 100)

fillColor = applyFilling ? trendColor : transparent
fill(trixPlot, signalPlot, color=fillColor, transp=70)

zeroCrossBgColor = highlightZeroCrossovers ? (trix > 0 ? green : red) : transparent
bgcolor(zeroCrossBgColor, transp=90)

plotshape(highlightCrossovers and crossover(trix, signal) ? trix : na, title="Crossover", location=location.absolute, style=shape.circle, size=size.tiny, color=green, transp=0)
plotshape(highlightCrossovers and crossunder(trix, signal) ? trix : na, title="Crossunder", location=location.absolute, style=shape.circle, size=size.tiny, color=red, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/true_range_double.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// True Range Double script may be freely distributed under the terms of the GPL-3.0 license.
study("True Range Double", shorttitle="TRD")

trd = max(max(high, high[1]), close[2]) - min(min(low, low[1]), close[2])

plot(trd, title="TRD", linewidth=1, color=#741b47, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/tsi_true_strength_index.pine --- */
//@version=4
// Copyright (c) 2021-present, Alex Orekhov (everget)
// True Strength Index (TSI) script may be freely distributed under the terms of GPL-3.0 license.
study("True Strength Index", shorttitle="TSI")

longLength = input(title="Long Length", type=input.integer, defval=25)
shortLength = input(title="Short Length", type=input.integer, defval=13)
signalLength = input(title="Signal Length", type=input.integer, defval=13, minval=1)
src = input(title="Source", type=input.source, defval=close)

obLevel = input(title="Overbought Level", type=input.integer, defval=40)
osLevel = input(title="Oversold Level", type=input.integer, defval=-40)
maxLevel = input(title="Max Level", type=input.integer, defval=75)
minLevel = input(title="Min Level", type=input.integer, defval=-75)
showHistogram = input(title="Show Histogram ?", type=input.bool, defval=false)
highlightBreakouts = input(title="Highlight Overbought/Oversold Breakouts ?", type=input.bool, defval=true)
highlightCrossovers = input(title="Highlight TSI/Signal Crossovers ?", type=input.bool, defval=true)
highlightZeroCrossovers = input(title="Highlight Zero Line Crossovers ?", type=input.bool, defval=true)
applyRibbonFilling = input(title="Apply Ribbon Filling ?", type=input.bool, defval=true)

mom = change(src)
numerator = ema(ema(mom, longLength), shortLength)
denominator = ema(ema(abs(mom), longLength), shortLength)
tsi = 100 * numerator / denominator
signal = ema(tsi, signalLength)

trendColor = tsi > signal ? #0ebb23 : color.red
tsiColor = applyRibbonFilling ? trendColor : #ff3e7d
signalColor = applyRibbonFilling ? trendColor : #3c78d8

tsiPlot = plot(tsi, title="TSI", color=tsiColor, transp=0)
signalPlot = plot(signal, title="Signal", color=signalColor, transp=0)

hist = tsi - signal
histColor = hist >= 0 ? hist[1] < hist ? #26A69A : #B2DFDB : hist[1] < hist ? #FFCDD2 : #EF5350
plot(showHistogram ? hist : na, title="Histogram", style=plot.style_columns, color=histColor, transp=0)

var color noneColor = color.new(color.white, 100)

maxLevelPlot = hline(maxLevel, title="Max Level", linestyle=hline.style_dotted, color=noneColor)
obLevelPlot = hline(obLevel, title="Overbought Level", linestyle=hline.style_dotted, color=#00796b)
hline(0, title="Zero Level", linestyle=hline.style_dotted, color=#989898)
osLevelPlot = hline(osLevel, title="Oversold Level", linestyle=hline.style_dotted, color=#f57f17)
minLevelPlot = hline(minLevel, title="Min Level", linestyle=hline.style_dotted, color=noneColor)
fill(obLevelPlot, osLevelPlot, title="Middle Zone", color=color.purple, transp=95)

obFillColor = tsi > obLevel and highlightBreakouts ? color.green : noneColor
osFillColor = tsi < osLevel and highlightBreakouts ? color.red : noneColor

fill(maxLevelPlot, obLevelPlot, title="Overbought Level Breakout", color=obFillColor, transp=85)
fill(minLevelPlot, osLevelPlot, title="Oversold Level Breakout", color=osFillColor, transp=85)

fillColor = applyRibbonFilling ? trendColor : noneColor
fill(tsiPlot, signalPlot, title="Ribbon", color=fillColor, transp=70)

zeroCrossBgColor = highlightZeroCrossovers ? (tsi > 0 ? color.green : color.red) : noneColor
bgcolor(zeroCrossBgColor, title="Zero Line Crossover Background", transp=90)

plotshape(highlightCrossovers and crossover(tsi, signal) ? tsi : na, title="TSI/Signal Crossover", location=location.absolute, style=shape.circle, size=size.tiny, color=color.green, transp=0)
plotshape(highlightCrossovers and crossunder(tsi, signal) ? tsi : na, title="TSI/Signal Crossunder", location=location.absolute, style=shape.circle, size=size.tiny, color=color.red, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/v_macd.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// V-MACD script may be freely distributed under the terms of GPL-3.0 license.
study("V-MACD")

fastLength = input(title="Fast Length", type=integer, defval=12)
slowLength = input(title="Slow Length", type=integer, defval=26)
signalLength = input(title="Signal Length", type=integer, defval=9)
showHistogram = input(title="Show Histogram ?", type=bool, defval=true)
highlightCrossovers = input(title="Highlight V-MACD/Signal Crossovers ?", type=bool, defval=false)
highlightZeroCrossovers = input(title="Highlight Zero Line Crossovers ?", type=bool, defval=false)
applyFilling = input(title="Apply Ribbon Filling ?", type=bool, defval=false)

[vmacd, signal, hist] = macd(volume, fastLength, slowLength, signalLength)

histColor = hist >= 0 ? (hist[1] < hist ? #26A69A : #B2DFDB) : (hist[1] < hist ? #FFCDD2 : #EF5350)

plot(showHistogram ? hist : na, title="Histogram", style=columns, color=histColor, transp=0)
hline(0, title="Zero Line", linestyle=dotted)

trendColor = vmacd > signal ? #0ebb23 : red

vmacdColor = applyFilling ? trendColor : #0094ff
signalColor = applyFilling ? trendColor : #ff6a00

vmacdPlot = plot(vmacd, title="V-MACD", color=vmacdColor, transp=0)
signalPlot = plot(signal, title="Signal", color=signalColor, transp=0)

transparent = color(white, 100)

fillColor = applyFilling ? trendColor : transparent
fill(vmacdPlot, signalPlot, color=fillColor, transp=70)

zeroCrossBgColor = highlightZeroCrossovers ? (vmacd > 0 ? green : red) : transparent
bgcolor(zeroCrossBgColor, transp=90)

plotshape(highlightCrossovers and crossover(vmacd, signal) ? vmacd : na, title="Crossover", location=location.absolute, style=shape.circle, size=size.tiny, color=green, transp=0)
plotshape(highlightCrossovers and crossunder(vmacd, signal) ? vmacd : na, title="Crossunder", location=location.absolute, style=shape.circle, size=size.tiny, color=red, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/vertical_horizontal_filter.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Vertical Horizontal Filter script may be freely distributed under the terms of the GPL-3.0 license.
study("Vertical Horizontal Filter", shorttitle="VHF")

length = input(title="Length", type=integer, minval=1, defval=28)
src = input(title="Source", type=source, defval=close)

vhf = abs(highest(src, length) - lowest(src, length)) / sum(abs(change(src)), length)

plot(vhf, title="VHF", color=#674ea7, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/oscillators/vw_macd.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// VW-MACD script may be freely distributed under the terms of GPL-3.0 license.
study("VW-MACD")

fastLength = input(title="Fast Length", type=integer, defval=12)
slowLength = input(title="Slow Length", type=integer, defval=26)
signalLength = input(title="Signal Length", type=integer, defval=9)
showHistogram = input(title="Show Histogram ?", type=bool, defval=true)
highlightCrossovers = input(title="Highlight VW-MACD/Signal Crossovers ?", type=bool, defval=false)
highlightZeroCrossovers = input(title="Highlight Zero Line Crossovers ?", type=bool, defval=false)
applyFilling = input(title="Apply Ribbon Filling ?", type=bool, defval=false)

vwmacd = vwma(close, fastLength) - vwma(close, slowLength)
signal = ema(vwmacd, signalLength)
hist = vwmacd - signal

histColor = hist >= 0 ? (hist[1] < hist ? #26A69A : #B2DFDB) : (hist[1] < hist ? #FFCDD2 : #EF5350)

plot(showHistogram ? hist : na, title="Histogram", style=columns, color=histColor, transp=0)
hline(0, title="Zero Line", linestyle=dotted)

trendColor = vwmacd > signal ? #0ebb23 : red

vwmacdColor = applyFilling ? trendColor : #0094ff
signalColor = applyFilling ? trendColor : #ff6a00

vwmacdPlot = plot(vwmacd, title="VW-MACD", color=vwmacdColor, transp=0)
signalPlot = plot(signal, title="Signal", color=signalColor, transp=0)

transparent = color(white, 100)

fillColor = applyFilling ? trendColor : transparent
fill(vwmacdPlot, signalPlot, color=fillColor, transp=70)

zeroCrossBgColor = highlightZeroCrossovers ? (vwmacd > 0 ? green : red) : transparent
bgcolor(zeroCrossBgColor, transp=90)

plotshape(highlightCrossovers and crossover(vwmacd, signal) ? vwmacd : na, title="Crossover", location=location.absolute, style=shape.circle, size=size.tiny, color=green, transp=0)
plotshape(highlightCrossovers and crossunder(vwmacd, signal) ? vwmacd : na, title="Crossunder", location=location.absolute, style=shape.circle, size=size.tiny, color=red, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/research/chart_type_identifier.pine --- */
//@version=4
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Chart Type Identifier script may be freely distributed under the terms of the GPL-3.0 license.
study("Chart Type Identifier", overlay=true)

max = max(open, close)
min = min(open, close)
body = abs(close - open)

var int horizCount = -1
if open[1] == close or close[1] == open
    horizCount := horizCount + 1

var int gapsCount = -1
if low[1] > high or high[1] < low
    gapsCount := gapsCount + 1

var int noWicksCount = -1
if max == high and min == low
    noWicksCount := noWicksCount + 1

//------------------------------------------------------------------------------

_isHA() =>
    var int oc2Count = -1
    oc2Count := open == (open[1] + close[1]) / 2 ? oc2Count + 1 : oc2Count
    out = oc2Count == bar_index - 1 and oc2Count != -1 and gapsCount == -1
    out

isHA = _isHA()

_isRenko() =>
    bodySum = cum(body)
    avg = bodySum / (bar_index + 1)
    out = avg == body and gapsCount == -1
    out

isRenko = _isRenko()

_isKagi() =>
    out = noWicksCount == bar_index and horizCount == bar_index - 1 and gapsCount == -1
    out

isKagi = _isKagi()

_isPnF() =>
    var int sum = 0
    sum := close > close[1] ? sum + 1 : close < close[1] ? sum - 1 : sum
    out = (sum == 1 or sum == 0 or sum == -1) and horizCount < bar_index - 1
    out

isPnF = _isPnF()

_isLineBreak() =>
    out = noWicksCount == bar_index and horizCount < bar_index - 1 and gapsCount == -1
    out

isLineBreak = not isPnF and _isLineBreak()

monthData = security(syminfo.tickerid, "M", close)
weekData = security(syminfo.tickerid, "W", close)
dayData = security(syminfo.tickerid, "D", close)
hourData = security(syminfo.tickerid, "60", close)
minuteData = security(syminfo.tickerid, "1", close)

_isRangeBars() =>
    out =
         timeframe.period != "S" and
         minuteData == monthData and
         minuteData == weekData and
         minuteData == dayData and
         minuteData == hourData and
         minuteData == close
    out

isRangeBars = _isRangeBars()

isClassic =
     not isHA and
     not isRenko and
     not isKagi and
     not isPnF and
     not isLineBreak and
     not isRangeBars

labelText =
     bar_index < 2 ? "\nNot enough bars to identify Chart Type\n" :
     isHA ? "\nThis is Heikin-Ashi Chart\n" :
     isRenko ? "\nThis is Renko Chart\n" :
     isKagi ? "\nThis is Kagi Chart\n" :
     isRangeBars ? "\nThis is Range Bars Chart\n" :
     isPnF ? "\nThis is P&F Chart\n" :
     isLineBreak ? "\nThis is Line Break Chart\n" :
     isClassic ? "\nThis is Classic Chart\n" :
     "\nUnknown Chart Type\n"

labelColor = #1e90ff
whiteColor = color.white

var label l = label.new(
     x=bar_index,
     y=na,
     text="",
     color=labelColor,
     textcolor=whiteColor,
     style=label.style_labeldown,
     size=size.normal
     )

_highest(length) =>
    out = high
    for i = 1 to length - 1
        prev = nz(high[i])
        out := out < prev ? prev : out
    out

lookback = min(bar_index + 2, 50)
yPos = _highest(lookback)

// debug =
//      "\nBar Index: " + tostring(int(bar_index)) +
//      "\nGaps: " + tostring(gapsCount) +
//      "\nHoriz: " + tostring(horizCount) +
//      "\nNo Wicks: " + tostring(noWicksCount)

label.set_text(l, labelText) // + debug
label.set_xy(l, bar_index, yPos)


/* --- FILE: tradingview-pinescript-indicators-master/research/custom_median_vs_built_in_median.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Custom Median vs Built-in Median script may be freely distributed under the terms of GPL-3.0 license.
study("Custom Median vs Built-in Median", shorttitle="CMvsBM")

length = input(title="Length", type=integer, minval=1, defval=14)
src = input(title="Source", type=source, defval=close)

// Built-in Median
median(src, length) =>
    percentile_nearest_rank(src, length, 50)

sort(src, length, i) =>
	min = -10000.0

	for j = 0 to i
		min_local = 10000.0

		for l = 0 to length - 1
			if (nz(src[l]) <= min)
				continue

			min_local := min(min_local, max(min, nz(src[l])))

		if min_local != 10000
			min := min_local
	min

// Custom Median
customMedian(src, length) =>
	out = 0.0

	if length % 2 == 0
		out := (sort(src, length, length / 2 - 1) + sort(src, length, length / 2)) / 2
	else
		out := sort(src, length, length / 2 - 0.5)
	out

diff = median(src, length) - customMedian(src, length)

plot(diff, title="CMvsBM", transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/research/dashed_line_style.pine --- */
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Dashed Line Style script may be freely distributed under the terms of GPL-3.0 license.
study("Dashed Line Style", overlay=true)

sma = sma(close, 14)

plot(n % 3 != 0 ? sma : na, style=linebr, linewidth=3, color=black, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/research/fancy_shapes.pine --- */
//@version=4
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Fancy Shapes script may be freely distributed under the terms of the GPL-3.0 license.
study("Fancy Shapes")

y0 = 0
offset0 = 0

y1 = 0
offset1 = -20

y2 = 0
offset2 = -40

y3 = 0
offset3 = -60

y4 = 0
offset4 = -80

y5 = 0
offset5 = -100

y6 = 0
offset6 = -120

plotshape(y0, location=location.absolute, style=shape.flag, size=size.huge, color=color.blue, transp=80, show_last=1, offset=offset0)
plotshape(y0, location=location.absolute, style=shape.flag, size=size.large, color=color.blue, transp=80, show_last=1, offset=offset0)
plotshape(y0, location=location.absolute, style=shape.flag, size=size.normal, color=color.blue, transp=80, show_last=1, offset=offset0)
plotshape(y0, location=location.absolute, style=shape.flag, size=size.small, color=color.blue, transp=80, show_last=1, offset=offset0)
plotshape(y0, location=location.absolute, style=shape.flag, size=size.tiny, color=color.blue, transp=80, show_last=1, offset=offset0)

plotshape(y1, location=location.absolute, style=shape.square, size=size.huge, color=color.blue, transp=80, show_last=1, offset=offset1)
plotshape(y1, location=location.absolute, style=shape.square, size=size.large, color=color.blue, transp=80, show_last=1, offset=offset1)
plotshape(y1, location=location.absolute, style=shape.square, size=size.normal, color=color.blue, transp=80, show_last=1, offset=offset1)
plotshape(y1, location=location.absolute, style=shape.square, size=size.small, color=color.blue, transp=80, show_last=1, offset=offset1)
plotshape(y1, location=location.absolute, style=shape.square, size=size.tiny, color=color.blue, transp=80, show_last=1, offset=offset1)

plotshape(y2, location=location.absolute, style=shape.diamond, size=size.huge, color=color.blue, transp=80, show_last=1, offset=offset2)
plotshape(y2, location=location.absolute, style=shape.diamond, size=size.large, color=color.blue, transp=80, show_last=1, offset=offset2)
plotshape(y2, location=location.absolute, style=shape.diamond, size=size.normal, color=color.blue, transp=80, show_last=1, offset=offset2)
plotshape(y2, location=location.absolute, style=shape.diamond, size=size.small, color=color.blue, transp=80, show_last=1, offset=offset2)
plotshape(y2, location=location.absolute, style=shape.diamond, size=size.tiny, color=color.blue, transp=80, show_last=1, offset=offset2)

plotshape(y3, location=location.absolute, style=shape.triangleup, size=size.huge, color=color.blue, transp=80, show_last=1, offset=offset3)
plotshape(y3, location=location.absolute, style=shape.triangleup, size=size.large, color=color.blue, transp=80, show_last=1, offset=offset3)
plotshape(y3, location=location.absolute, style=shape.triangleup, size=size.normal, color=color.blue, transp=80, show_last=1, offset=offset3)
plotshape(y3, location=location.absolute, style=shape.triangleup, size=size.small, color=color.blue, transp=80, show_last=1, offset=offset3)
plotshape(y3, location=location.absolute, style=shape.triangleup, size=size.tiny, color=color.blue, transp=80, show_last=1, offset=offset3)

plotshape(y4, location=location.absolute, style=shape.circle, size=size.huge, color=color.blue, transp=80, show_last=1, offset=offset4)
plotshape(y4, location=location.absolute, style=shape.circle, size=size.large, color=color.blue, transp=80, show_last=1, offset=offset4)
plotshape(y4, location=location.absolute, style=shape.circle, size=size.normal, color=color.blue, transp=80, show_last=1, offset=offset4)
plotshape(y4, location=location.absolute, style=shape.circle, size=size.small, color=color.blue, transp=80, show_last=1, offset=offset4)
plotshape(y4, location=location.absolute, style=shape.circle, size=size.tiny, color=color.blue, transp=80, show_last=1, offset=offset4)

plotshape(y5, location=location.absolute, style=shape.labelup, size=size.huge, color=color.blue, transp=80, show_last=1, offset=offset5)
plotshape(y5, location=location.absolute, style=shape.labelup, size=size.large, color=color.blue, transp=80, show_last=1, offset=offset5)
plotshape(y5, location=location.absolute, style=shape.labelup, size=size.normal, color=color.blue, transp=80, show_last=1, offset=offset5)
plotshape(y5, location=location.absolute, style=shape.labelup, size=size.small, color=color.blue, transp=80, show_last=1, offset=offset5)
plotshape(y5, location=location.absolute, style=shape.labelup, size=size.tiny, color=color.blue, transp=80, show_last=1, offset=offset5)

plotshape(y6, location=location.absolute, style=shape.labeldown, size=size.huge, color=color.blue, transp=80, show_last=1, offset=offset6)
plotshape(y6, location=location.absolute, style=shape.labeldown, size=size.large, color=color.blue, transp=80, show_last=1, offset=offset6)
plotshape(y6, location=location.absolute, style=shape.labeldown, size=size.normal, color=color.blue, transp=80, show_last=1, offset=offset6)
plotshape(y6, location=location.absolute, style=shape.labeldown, size=size.small, color=color.blue, transp=80, show_last=1, offset=offset6)
plotshape(y6, location=location.absolute, style=shape.labeldown, size=size.tiny, color=color.blue, transp=80, show_last=1, offset=offset6)


/* --- FILE: tradingview-pinescript-indicators-master/research/heikin_ashi_chart_identifier.pine --- */
//@version=4
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Heikin-Ashi Chart Identifier script may be freely distributed under the terms of the GPL-3.0 license.
study("Heikin-Ashi Chart Identifier", overlay=true)

var int gapsCount = -1
gapsCount := low[1] > high or high[1] < low ? gapsCount + 1 : gapsCount

var int matchedCandles = -1
matchedCandles := open == (open[1] + close[1]) / 2 ? matchedCandles + 1 : matchedCandles

isHA = matchedCandles == bar_index - 1 and matchedCandles != -1 and gapsCount == -1

labelText = isHA ? "This is Heikin-Ashi Chart" : "This is not Heikin-Ashi Chart"
stats = "\n------------------------------------" +
         "\nBar Index: " + tostring(int(bar_index)) +
         "\nMatched: " + tostring(matchedCandles)
         
labelColor = #1e90ff
whiteColor = color.white

var label l = label.new(
     x=bar_index,
     y=na,
     text="",
     color=labelColor,
     textcolor=whiteColor,
     style=label.style_labeldown,
     size=size.normal
     )

label.set_text(l, labelText + stats)
label.set_xy(l, bar_index, highest(high, 50))


/* --- FILE: tradingview-pinescript-indicators-master/research/kagi_chart_identifier.pine --- */
//@version=4
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Kagi Chart Identifier script may be freely distributed under the terms of the GPL-3.0 license.
study("Kagi Chart Identifier", overlay=true)

var ocCount = -1
if open[1] == close or close[1] == open
    ocCount := ocCount + 1

var hCount = -1
if open == high or close == high
    hCount := hCount + 1

var lCount = -1
if open == low or close == low
    lCount := lCount + 1

isKagi = hCount == bar_index and lCount == bar_index and ocCount == bar_index - 1

labelText = isKagi ? "This is Kagi Chart" : "This is not Kagi Chart"
stats = "\n------------------------------" +
         "\nBar Index: " + tostring(int(bar_index)) +
         "\nO==C Candles: " + tostring(ocCount) +
         "\nOC==H Candles: " + tostring(hCount) +
         "\nOC==L Candles: " + tostring(lCount)
labelColor = #1e90ff
whiteColor = color.white

var label kagiLabel = label.new(
     x=bar_index,
     y=na,
     text="",
     color=labelColor,
     textcolor=whiteColor,
     style=label.style_labeldown,
     size=size.normal
     )

label.set_text(kagiLabel, labelText + stats)
label.set_xy(kagiLabel, bar_index, highest(close, 10))


/* --- FILE: tradingview-pinescript-indicators-master/research/litecoin_halving_utc_countdown.pine --- */
//@version=4
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Litecoin Halving UTC Countdown script may be freely distributed under the terms of the GPL-3.0 license.
study("Litecoin Halving UTC Countdown", overlay=true)

halvingDay = input(title="Halving Day", minval=1, maxval=31, defval=5)
halvingHour = input(title="Halving Hour", minval=1, maxval=24, defval=11)
halvingMinute = input(title="Halving Minute", minval=1, maxval=60, defval=55)

halvingStamp = timestamp('GMT', 2019, 8, halvingDay, halvingHour, halvingMinute)

secondsRaw = floor((halvingStamp - timenow) / 1000)
minutesRaw = floor(secondsRaw / 60)
hoursRaw = floor(minutesRaw / 60)

seconds = secondsRaw % 60
minutes = minutesRaw % 60
hours = hoursRaw % 24
days = floor(hoursRaw / 24)

f_format(_val) =>
    (0 < _val and _val < 10 ? "0" : "") + tostring(_val, "##") + (_val == 0 ? "0" : "")

labelText = f_format(days) + "d  " + f_format(hours) + ":" + f_format(minutes) + ":" + f_format(seconds)

var label l = label.new(
     x=bar_index,
     y=na,
     text="",
     textcolor=color.black,
     style=label.style_none,
     size=size.huge
     )

label.set_text(l, labelText)
label.set_xy(l, bar_index, highest(100))


/* --- FILE: tradingview-pinescript-indicators-master/research/mean_absolute_deviation.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Mean Absolute Deviation script may be freely distributed under the terms of GPL-3.0 license.
study("Mean Absolute Deviation", shorttitle="MAD")

src = close
len = 14

sma = sma(src, len)

median(src, length) =>
    percentile_nearest_rank(src, length, 50)

dev0 = dev(src, len)
dev1 = src - sma
dev2 = sum(abs(src - sma), len) / len
dev3 = abs(src - sma) / len
dev4 = (src - sma) / len
dev5 = median(src - median(src, len), len)

sum = 0.0
for i = 0 to len - 1
    sum := sum + abs(src[i] - sma)

dev6 = sum / len

plot(dev0, title="Built-in", color=purple)
plot(dev1, title="1", color=olive)
plot(dev2, title="2", color=teal)
plot(dev3, title="3", color=green)
plot(dev4, title="4", color=red)
plot(dev5, title="5", color=blue)
plot(dev6, title="6", color=orange)


/* --- FILE: tradingview-pinescript-indicators-master/research/momentum.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Momentum script may be freely distributed under the terms of GPL-3.0 license.
study("Momentum")

src = close
length = 7

mom = src - src[length]

mom2 = change(src, length)

mom3 = mom(src, length)

sma = sma(src, length)
mom4 = (sma - sma[1]) * length

plot(mom, title="Simple", color=blue)
plot(mom2, title="2", color=green)
plot(mom3, title="3", color=red)
plot(mom4, title="4", color=purple)


/* --- FILE: tradingview-pinescript-indicators-master/research/percentrank_bug.pine --- */
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Percentrank Bug script may be freely distributed under the terms of the GPL-3.0 license.
study("Percentrank Bug")

src = volume
length = input(14)

pr = percentrank(src, length)
plot(pr, title="Built-in", color=red)

_percentrank(src, length) =>
    count = 0
    for i = 1 to length
        count := count + (src >= nz(src[i]) ? 1 : 0)
    pr = 100 * count / length

pr2 = _percentrank(src, length)

plot(pr2, title="Shim", color=green)


/* --- FILE: tradingview-pinescript-indicators-master/research/point_and_figure_pnf_chart_identifier.pine --- */
//@version=4
// Copyright (c) 2020-present, Alex Orekhov (everget)
// Point-and-Figure (P&F) Chart Identifier script may be freely distributed under the terms of the GPL-3.0 license.
study("Point-and-Figure (P&F) Chart Identifier", overlay=true)

var int ocCount = -1
ocCount := open[1] == close or close[1] == open ? ocCount + 1 : ocCount

var int sum = 0
sum := close > close[1] ? sum + 1 : close < close[1] ? sum - 1 : sum

isPnF = (sum == 1 or sum == 0 or sum == -1) and ocCount < bar_index - 1
matchedCandles = cum(isPnF ? 1 : 0)

labelText = isPnF ? "This is P&F Chart" : "This is not P&F Chart"
stats = "\n------------------------------" +
         "\nBar Index: " + tostring(int(bar_index)) +
         "\nMatched Candles: " + tostring(matchedCandles) +
         "\nO==C: " + tostring(ocCount) +
         "\nSum: " + tostring(sum)
labelColor = #1e90ff
whiteColor = color.white

var label pnfLabel = label.new(
     x=bar_index,
     y=na,
     text="",
     color=labelColor,
     textcolor=whiteColor,
     style=label.style_label_down,
     size=size.normal
     )

label.set_text(pnfLabel, labelText + stats)
label.set_xy(pnfLabel, bar_index, highest(close, 10))


/* --- FILE: tradingview-pinescript-indicators-master/research/rate_of_change.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Rate of Change script may be freely distributed under the terms of GPL-3.0 license.
study("Rate of Change", shorttitle="ROC")

src = close
length = 7

roc = roc(src, length)

roc2 = change(src, length)

roc3 = change(src, length) / src[length]

roc4 = 100 * change(src, length) / src[length]

plot(roc, title="Built-in", color=blue)
plot(roc2, title="2", color=green)
plot(roc3, title="3", color=red)
plot(roc4, title="4", color=purple)


/* --- FILE: tradingview-pinescript-indicators-master/research/renko_chart_identifier.pine --- */
//@version=4
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Renko Chart Identifier script may be freely distributed under the terms of the GPL-3.0 license.
study("Renko Chart Identifier", overlay=true)

_isRenko() =>
    var int gapsCount = -1
    if low[1] > high or high[1] < low
        gapsCount := gapsCount + 1
    body = abs(close - open)
    bodySum = cum(body)
    avg = bodySum / (bar_index + 1)
    out = avg == body and gapsCount == -1
    out

labelText = _isRenko() ? "This is Renko Chart" : "This is not Renko Chart"
labelColor = #1e90ff
whiteColor = color.white

var label l = label.new(
     x=bar_index,
     y=na,
     text="",
     color=labelColor,
     textcolor=whiteColor,
     style=label.style_labeldown,
     size=size.normal
     )

label.set_text(l, labelText)
label.set_xy(l, bar_index, highest(close, 50))


/* --- FILE: tradingview-pinescript-indicators-master/research/script_with_expiration_time.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
study("Script With Expiration Time")

expired = timenow >= timestamp("GMT", 2018, 12, 1, 13, 0) and (barstate.ishistory or barstate.isrealtime)

plot(expired ? na : close, color=purple)


/* --- FILE: tradingview-pinescript-indicators-master/research/symbol_info_helper.pine --- */
//@version=4
// Copyright (c) 2020-present, Alex Orekhov (everget)
// Symbol Info Helper script may be freely distributed under the terms of the GPL-3.0 license.
study("Symbol Info Helper", overlay=true)

labelText =
     "Symbol Name: " + syminfo.tickerid +
     "\nSymbol Description: " + syminfo.description +
     "\nSymbol Type: " + syminfo.type +
     "\nPoint Value: " + tostring(syminfo.pointvalue) +
     "\nExchange: " + syminfo.prefix +
     "\nListed Exchange: " + "-" +
     "\nCurrency: " + syminfo.currency +
     "\nTick Size: " + tostring(syminfo.mintick) +
     "\nSector: " + "-" +
     "\nIndustry: " + "-" +
     "\nTimezone: " + syminfo.timezone +
     "\nSession: " + "-"

var label l = label.new(
     x=bar_index,
     y=na,
     text="",
     textalign=text.align_left,
     textcolor=color.white,
     color=color.blue,
     style=label.style_label_left,
     size=size.normal
     )

label.set_text(l, labelText)
label.set_xy(l, bar_index, ohlc4)


/* --- FILE: tradingview-pinescript-indicators-master/research/utc_clock.pine --- */
//@version=4
// Copyright (c) 2019-present, Alex Orekhov (everget)
// UTC Clock script may be freely distributed under the terms of the GPL-3.0 license.
study("UTC Clock", overlay=true)

secondsRaw = floor(timenow / 1000)
minutesRaw = floor(secondsRaw / 60)
hoursRaw = floor(minutesRaw / 60)

seconds = secondsRaw % 60
minutes = minutesRaw % 60
hours = hoursRaw % 24

f_format(_val) =>
    (0 < _val and _val < 10 ? "0" : "") + tostring(_val, "##") + (_val == 0 ? "0" : "")

labelText = f_format(hours) + ":" + f_format(minutes) + ":" + f_format(seconds)

var label l = label.new(
     x=bar_index,
     y=na,
     text="",
     textcolor=color.black,
     style=label.style_none,
     size=size.huge
     )

label.set_text(l, labelText)
label.set_xy(l, bar_index, highest(high, 50))


/* --- FILE: tradingview-pinescript-indicators-master/statistics/all_time_high_days.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// All-Time High Days script may be freely distributed under the terms of GPL-3.0 license.
study("All-Time High Days", shorttitle="ATH Days", precision=0)

highlightATH = input(title="Highlight ATH ?", defval=false)

ath = high
ath := na(ath[1]) ? ath : (high > ath[1] ? high : ath[1])

cond = high == ath
transparent = color(white, 100)

bars = barssince(cond)
plot(bars, title="ATH Days", color=#674ea7)

bgcolor(cond and highlightATH ? orange : transparent)


/* --- FILE: tradingview-pinescript-indicators-master/statistics/all_time_high_percent_drop.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// All-Time High % Drop script may be freely distributed under the terms of GPL-3.0 license.
study("All-Time High % Drop", shorttitle="ATH % Drop", precision=2)

ath = high
ath := na(ath[1]) ? ath : (high > ath[1] ? high : ath[1])

percent = 100 * (close - ath) / ath

plot(percent, title="ATH %", color=#351c75, transp=0)

plot(0, title="", style=circles, linewidth=0, color=gray)
hline(0, linestyle=dotted, color=gray)

plot(-10, title="", style=circles, linewidth=0, color=#F9CE02)
hline(-10, linestyle=dotted, color=#F9CE02)

plot(-20, title="", style=circles, linewidth=0, color=#F7BA05)
hline(-20, linestyle=dotted, color=#F7BA05)

plot(-30, title="", style=circles, linewidth=0, color=#F4A608)
hline(-30, linestyle=dotted, color=#F4A608)

plot(-40, title="", style=circles, linewidth=0, color=#F2920B)
hline(-40, linestyle=dotted, color=#F2920B)

plot(-50, title="", style=circles, linewidth=0, color=#F07E0E)
hline(-50, linestyle=dotted, color=#F07E0E)

plot(-60, title="", style=circles, linewidth=0, color=#ED6A10)
hline(-60, linestyle=dotted, color=#ED6A10)

plot(-70, title="", style=circles, linewidth=0, color=#EB5613)
hline(-70, linestyle=dotted, color=#EB5613)

plot(-80, title="", style=circles, linewidth=0, color=#E84216)
hline(-80, linestyle=dotted, color=#E84216)

plot(-90, title="", style=circles, linewidth=0, color=#E62E19)
hline(-90, linestyle=dotted, color=#E62E19)

plot(-100, title="", style=circles, linewidth=0, color=#E41A1C)
hline(-100, linestyle=dotted, color=#E41A1C)


/* --- FILE: tradingview-pinescript-indicators-master/statistics/bitcoin_ath_hash_rate_level.pine --- */
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Bitcoin ATH Hash Rate Level script may be freely distributed under the terms of GPL-3.0 license.
study("Bitcoin ATH Hash Rate Level", shorttitle="ATH HR", overlay=true)

highlightMovements = input(title="Highlight Price Movements ?", type=bool, defval=false)

_ath(src) =>
    ath = src
    ath := na(ath[1]) ? ath : (ath > ath[1] ? ath : ath[1])

hashRate = security("QUANDL:BCHAIN/HRATE", "D", close)

hrATH = _ath(hashRate)

hrathLevel = close
hrathLevel := hrATH > hrATH[1] ? close : nz(hrathLevel[1], close) //  and close > close[1]

levelColor = highlightMovements ? (close > hrathLevel ? green : close < hrathLevel ? red : #6d1e7f) : black
plot(hrathLevel, title="Hash Rate", linewidth=2, color=levelColor, transp=0)

hrathCond = hrATH != hrATH[1]
alertcondition(hrathCond, title="Alert on New Bitcoin ATH Hash Rate", message="New Bitcoin ATH Hash Rate !")


/* --- FILE: tradingview-pinescript-indicators-master/statistics/bullish_bearish_candle_series_distribution.pine --- */
//@version=4
// Copyright (c) 2020-present, Alex Orekhov (everget)
// Bullish/Bearish Candle Series Distribution script may be freely distributed under the terms of GPL-3.0 license.
study("Bullish/Bearish Candle Series Distribution")

reboot = input(title="Reboot ?", defval=false)
mode = input(title="Mode", defval="Bullish", options=["Strict Bullish", "Bullish", "Strict Bearish", "Bearish"])
width = input(title="Columns Width", defval=10)
space = input(title="Space Between Columns", defval=5)
hide2 = input(title="Hide 2-Series ?", defval=false)

columnColor = #ffb74d
labelColor = #1e90ff
whiteColor = color.white

cond =
     mode == "Bullish" ? close >= open :
     mode == "Strict Bullish" ? close > open :
     mode == "Bearish" ? close <= open :
     mode == "Strict Bearish" ? close < open :
     false

var int count = 0
count := na(count[1]) ? count : (cond ? count[1] + 1 : 0)

// var res = '';
// var len = 60;

// for (let i = 0; i < len; i++) {
// 	res = res.concat(`var int serie${ i + 2 } = 0\n`);
// }

// res = res.concat(`\n`);
// res = res.concat(`len = nz(count[1]) + 1\n`)
// res = res.concat(`if count == 0\n`);

// for (let i = 0; i < len; i++) {
// 	res = res.concat(`	serie${ i + 2 } := len == ${ i + 2 } ? serie${ i + 2 } + 1 : serie${ i + 2 }\n`);
// }

// res = res.concat(`\n`);

// res = res.concat(
//     Array.from({ length: len })
//     .reduce((acc, _, idx) => {
//     	return acc
//     		.concat(`plot(serie${ idx + 2 }, offset=(${ -idx } * space), title="${ idx + 2 }", style=plot.style_histogram, linewidth=width, color=color.black, show_last=1)\n`);
//     }, '')
// );

var int serie2 = 0
var int serie3 = 0
var int serie4 = 0
var int serie5 = 0
var int serie6 = 0
var int serie7 = 0
var int serie8 = 0
var int serie9 = 0
var int serie10 = 0
var int serie11 = 0
var int serie12 = 0
var int serie13 = 0
var int serie14 = 0
var int serie15 = 0
var int serie16 = 0
var int serie17 = 0
var int serie18 = 0
var int serie19 = 0
var int serie20 = 0
var int serie21 = 0
var int serie22 = 0
var int serie23 = 0
var int serie24 = 0
var int serie25 = 0
var int serie26 = 0
var int serie27 = 0
var int serie28 = 0
var int serie29 = 0
var int serie30 = 0
var int serie31 = 0
var int serie32 = 0
var int serie33 = 0
var int serie34 = 0
var int serie35 = 0
var int serie36 = 0
var int serie37 = 0
var int serie38 = 0
var int serie39 = 0
var int serie40 = 0
var int serie41 = 0
var int serie42 = 0
var int serie43 = 0
var int serie44 = 0
var int serie45 = 0
var int serie46 = 0
var int serie47 = 0
var int serie48 = 0
var int serie49 = 0
var int serie50 = 0
var int serie51 = 0
var int serie52 = 0
var int serie53 = 0
var int serie54 = 0
var int serie55 = 0
var int serie56 = 0
var int serie57 = 0
var int serie58 = 0
var int serie59 = 0

len = nz(count[1]) + 1
if count == 0
	serie2 := len == 2 ? serie2 + 1 : serie2
	serie3 := len == 3 ? serie3 + 1 : serie3
	serie4 := len == 4 ? serie4 + 1 : serie4
	serie5 := len == 5 ? serie5 + 1 : serie5
	serie6 := len == 6 ? serie6 + 1 : serie6
	serie7 := len == 7 ? serie7 + 1 : serie7
	serie8 := len == 8 ? serie8 + 1 : serie8
	serie9 := len == 9 ? serie9 + 1 : serie9
	serie10 := len == 10 ? serie10 + 1 : serie10
	serie11 := len == 11 ? serie11 + 1 : serie11
	serie12 := len == 12 ? serie12 + 1 : serie12
	serie13 := len == 13 ? serie13 + 1 : serie13
	serie14 := len == 14 ? serie14 + 1 : serie14
	serie15 := len == 15 ? serie15 + 1 : serie15
	serie16 := len == 16 ? serie16 + 1 : serie16
	serie17 := len == 17 ? serie17 + 1 : serie17
	serie18 := len == 18 ? serie18 + 1 : serie18
	serie19 := len == 19 ? serie19 + 1 : serie19
	serie20 := len == 20 ? serie20 + 1 : serie20
	serie21 := len == 21 ? serie21 + 1 : serie21
	serie22 := len == 22 ? serie22 + 1 : serie22
	serie23 := len == 23 ? serie23 + 1 : serie23
	serie24 := len == 24 ? serie24 + 1 : serie24
	serie25 := len == 25 ? serie25 + 1 : serie25
	serie26 := len == 26 ? serie26 + 1 : serie26
	serie27 := len == 27 ? serie27 + 1 : serie27
	serie28 := len == 28 ? serie28 + 1 : serie28
	serie29 := len == 29 ? serie29 + 1 : serie29
	serie30 := len == 30 ? serie30 + 1 : serie30
	serie31 := len == 31 ? serie31 + 1 : serie31
	serie32 := len == 32 ? serie32 + 1 : serie32
	serie33 := len == 33 ? serie33 + 1 : serie33
	serie34 := len == 34 ? serie34 + 1 : serie34
	serie35 := len == 35 ? serie35 + 1 : serie35
	serie36 := len == 36 ? serie36 + 1 : serie36
	serie37 := len == 37 ? serie37 + 1 : serie37
	serie38 := len == 38 ? serie38 + 1 : serie38
	serie39 := len == 39 ? serie39 + 1 : serie39
	serie40 := len == 40 ? serie40 + 1 : serie40
	serie41 := len == 41 ? serie41 + 1 : serie41
	serie42 := len == 42 ? serie42 + 1 : serie42
	serie43 := len == 43 ? serie43 + 1 : serie43
	serie44 := len == 44 ? serie44 + 1 : serie44
	serie45 := len == 45 ? serie45 + 1 : serie45
	serie46 := len == 46 ? serie46 + 1 : serie46
	serie47 := len == 47 ? serie47 + 1 : serie47
	serie48 := len == 48 ? serie48 + 1 : serie48
	serie49 := len == 49 ? serie49 + 1 : serie49
	serie50 := len == 50 ? serie50 + 1 : serie50
	serie51 := len == 51 ? serie51 + 1 : serie51
	serie52 := len == 52 ? serie52 + 1 : serie52
	serie53 := len == 53 ? serie53 + 1 : serie53
	serie54 := len == 54 ? serie54 + 1 : serie54
	serie55 := len == 55 ? serie55 + 1 : serie55
	serie56 := len == 56 ? serie56 + 1 : serie56
	serie57 := len == 57 ? serie57 + 1 : serie57
	serie58 := len == 58 ? serie58 + 1 : serie58
	serie59 := len == 59 ? serie59 + 1 : serie59

plot(hide2 ? na : serie2, offset=(0 * space), title="2", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plotshape(hide2 ? na : 0, offset=(0 * space), title="2", text=" 2 ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

plot(serie3, offset=(-1 * space), title="3", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie4, offset=(-2 * space), title="4", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie5, offset=(-3 * space), title="5", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie6, offset=(-4 * space), title="6", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie7, offset=(-5 * space), title="7", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie8, offset=(-6 * space), title="8", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie9, offset=(-7 * space), title="9", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie10, offset=(-8 * space), title="10", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-8 * space), title="10", text=" 10 ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

plot(serie11, offset=(-9 * space), title="11", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie12, offset=(-10 * space), title="12", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie13, offset=(-11 * space), title="13", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie14, offset=(-12 * space), title="14", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie15, offset=(-13 * space), title="15", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie16, offset=(-14 * space), title="16", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie17, offset=(-15 * space), title="17", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie18, offset=(-16 * space), title="18", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie19, offset=(-17 * space), title="19", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie20, offset=(-18 * space), title="20", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-18 * space), title="20", text=" 20 ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

plot(serie21, offset=(-19 * space), title="21", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie22, offset=(-20 * space), title="22", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie23, offset=(-21 * space), title="23", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie24, offset=(-22 * space), title="24", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie25, offset=(-23 * space), title="25", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie26, offset=(-24 * space), title="26", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie27, offset=(-25 * space), title="27", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie28, offset=(-26 * space), title="28", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie29, offset=(-27 * space), title="29", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie30, offset=(-28 * space), title="30", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-28 * space), title="30", text=" 30 ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

plot(serie31, offset=(-29 * space), title="31", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie32, offset=(-30 * space), title="32", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie33, offset=(-31 * space), title="33", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie34, offset=(-32 * space), title="34", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie35, offset=(-33 * space), title="35", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie36, offset=(-34 * space), title="36", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie37, offset=(-35 * space), title="37", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie38, offset=(-36 * space), title="38", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie39, offset=(-37 * space), title="39", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie40, offset=(-38 * space), title="40", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-38 * space), title="40", text=" 40 ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

plot(serie41, offset=(-39 * space), title="41", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie42, offset=(-40 * space), title="42", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie43, offset=(-41 * space), title="43", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie44, offset=(-42 * space), title="44", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie45, offset=(-43 * space), title="45", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie46, offset=(-44 * space), title="46", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie47, offset=(-45 * space), title="47", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie48, offset=(-46 * space), title="48", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie49, offset=(-47 * space), title="49", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie50, offset=(-48 * space), title="50", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-48 * space), title="50", text=" 50 ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

plot(serie51, offset=(-49 * space), title="51", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie52, offset=(-50 * space), title="52", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie53, offset=(-51 * space), title="53", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie54, offset=(-52 * space), title="54", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie55, offset=(-53 * space), title="55", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie56, offset=(-54 * space), title="56", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie57, offset=(-55 * space), title="57", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie58, offset=(-56 * space), title="58", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plot(serie59, offset=(-57 * space), title="59", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)


/* --- FILE: tradingview-pinescript-indicators-master/statistics/candles_history.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Candles History script may be freely distributed under the terms of GPL-3.0 license.
study("Candles History", shorttitle="CH", precision=1)

copyright = input(title="Author", defval="@everget", options=["@everget"])

mode = input(title="Display Mode", defval="Starting Year",
	 options=["Starting Year",
				 "Starting Month",
				 "Starting Day",
				 "Starting Weekday",
				 "Starting Hour",
				 "Starting Minute",
				 "Highest Volume",
				 "Lowest Volume",
				 "Longest Candle Range",
				 "Longest Candle Range in Pips",
				 "Average Candle Range",
				 "Average Candle Range in Pips",
				 "Longest Candle Body Range",
				 "Longest Candle Body Range in Pips",
				 "Average Candle Body Range",
				 "Average Candle Body Range in Pips",
				 "All-Time High",
				 "All-Time Low",
				 "Available Candles",
				 "Bullish Candles",
				 "Bullish Trend Candles",
				 "Bearish Candles",
				 "Bearish Trend Candles",
				 "Doji Candles",
				 "Bullish Marubozu Candles",
				 "Bearish Marubozu Candles",
				 "Longest Bullish Serie",
				 "Longest Bearish Serie"])

range = high - low
body = abs(open - close)

averageRange = cum(range) / (n + 1)
averageBody = cum(body) / (n + 1)

longestRange = range
longestRange := na(longestRange[1]) ? longestRange : (range > longestRange[1] ? range : longestRange[1]) 

longestBody = body
longestBody := na(longestBody[1]) ? longestBody : (body > longestBody[1] ? body : longestBody[1])

bullMax = 0
bullMax := na(bullMax[1]) ? bullMax : bullMax[1]

bullCount = 0
bullCount := na(bullCount[1]) ? bullCount : (close >= open ? bullCount[1] + 1 : 0)

if bullCount == 0 and nz(bullCount[1]) + 1 > bullMax
    bullMax := bullCount[1] + 1

bearMax = 0
bearMax := na(bearMax[1]) ? bearMax : bearMax[1]

bearCount = 0
bearCount := na(bearCount[1]) ? bearCount : (close <= open ? bearCount[1] + 1 : 0)

if bearCount == 0 and nz(bearCount[1]) + 1 > bearMax
    bearMax := bearCount[1] + 1

bullSum = cum(close > open ? 1 : 0)
bearSum = cum(close < open ? 1 : 0)

bulltrendSum = cum(close > open and body >= 0.5 * range ? 1 : 0)
beartrendSum = cum(close < open and body >= 0.5 * range ? 1 : 0)

highestVolume = volume
highestVolume := na(highestVolume[1]) ? highestVolume : (volume > highestVolume[1] ? volume : highestVolume[1])

lowestVolume = pow(10, 10)
lowestVolume := na(lowestVolume[1]) ? lowestVolume : (volume < lowestVolume[1] and volume != 0 ? volume : lowestVolume[1])

ath = high
ath := na(ath[1]) ? ath : (high > ath[1] ? high : ath[1])

atl = low
atl := na(atl[1]) ? atl : (low < atl[1] ? low : atl[1])

out = 0.0
out := mode == "Available Candles" ? n + 1 : out
out := mode == "Bullish Candles" ? bullSum : out
out := mode == "Bullish Trend Candles" ? bulltrendSum : out
out := mode == "Bearish Candles" ? bearSum : out
out := mode == "Bearish Trend Candles" ? beartrendSum : out
out := mode == "Doji Candles" ? cum(open == close ? 1 : 0) : out
out := mode == "Bullish Marubozu Candles" ? cum(high == close and low == open ? 1 : 0) : out
out := mode == "Bearish Marubozu Candles" ? cum(high == open and low == close ? 1 : 0) : out

out := mode == "Longest Candle Range" ? longestRange : out
out := mode == "Longest Candle Range in Pips" ? longestRange / syminfo.mintick : out
out := mode == "Average Candle Range" ? averageRange : out
out := mode == "Average Candle Range in Pips" ? averageRange / syminfo.mintick : out
out := mode == "Longest Candle Body Range" ? longestBody : out
out := mode == "Longest Candle Body Range in Pips" ? longestBody / syminfo.mintick : out
out := mode == "Average Candle Body Range" ? averageBody : out
out := mode == "Average Candle Body Range in Pips" ? averageBody / syminfo.mintick : out

out := mode == "Longest Bullish Serie" ? floor(bullMax) : out
out := mode == "Longest Bearish Serie" ? floor(bearMax) : out
out := mode == "Highest Volume" ? highestVolume : out
out := mode == "Lowest Volume" ? lowestVolume : out
out := mode == "All-Time High" ? ath : out
out := mode == "All-Time Low" ? atl : out
out := mode == "Starting Year" ? valuewhen(n == 0, year, 0) : out
out := mode == "Starting Month" ? valuewhen(n == 0, month, 0) : out
out := mode == "Starting Day" ? valuewhen(n == 0, dayofmonth, 0) : out
out := mode == "Starting Weekday" ? valuewhen(n == 0, dayofweek, 0) : out
out := mode == "Starting Hour" ? valuewhen(n == 0, hour, 0) : out
out := mode == "Starting Minute" ? valuewhen(n == 0, minute, 0) : out

plot(out, title="Metric", color=red)


/* --- FILE: tradingview-pinescript-indicators-master/statistics/close_to_close_percent_change_distribution.pine --- */
//@version=4
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Close-to-Close % Change Distribution script may be freely distributed under the terms of GPL-3.0 license.
study("Close-to-Close % Change Distribution")

reboot = input(title="Reboot ?", defval=false)
width = input(title="Columns Width", defval=12)
space = input(title="Space Between Columns", defval=4)

columnColor = #ffb74d
labelColor = #1e90ff
whiteColor = color.white

roc = roc(close, 1)
total = bar_index + 1

p025 = cum(0 <= roc and roc < 0.25 ? 1 : 0)
plot(100 * p025 / total, offset=(-23 * space), title="0-0.25%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-floor(23.5 * space)), title="0%", text=" 0% ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

p05 = cum(0.25 <= roc and roc < 0.5 ? 1 : 0)
plot(100 * p05 / total, offset=(-22 * space), title="0.25-0.5%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

p075 = cum(0.5 <= roc and roc < 0.75 ? 1 : 0)
plot(100 * p075 / total, offset=(-21 * space), title="0.5-0.75%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

p1 = cum(0.75 <= roc and roc < 1 ? 1 : 0)
plot(100 * p1 / total, offset=(-20 * space), title="0.75-1%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

p125 = cum(1 <= roc and roc < 1.25 ? 1 : 0)
plot(100 * p125 / total, offset=(-19 * space), title="1-1.25%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-floor(19.5 * space)), title="1%", text=" 1% ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

p15 = cum(1.25 <= roc and roc < 1.5 ? 1 : 0)
plot(100 * p15 / total, offset=(-18 * space), title="1.25-1.5%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

p175 = cum(1.5 <= roc and roc < 1.75 ? 1 : 0)
plot(100 * p175 / total, offset=(-17 * space), title="1.5-1.75%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

p2 = cum(1.75 <= roc and roc < 2 ? 1 : 0)
plot(100 * p2 / total, offset=(-16 * space), title="1.75-2%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

p225 = cum(2 <= roc and roc < 2.25 ? 1 : 0)
plot(100 * p225 / total, offset=(-15 * space), title="2-2.25%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-floor(15.5 * space)), title="2%", text=" 2% ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

p25 = cum(2.25 <= roc and roc < 2.5 ? 1 : 0)
plot(100 * p25 / total, offset=(-14 * space), title="2.25-2.5%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

p275 = cum(2.5 <= roc and roc < 2.75 ? 1 : 0)
plot(100 * p275 / total, offset=(-13 * space), title="2.5-2.75%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

p3 = cum(2.75 <= roc and roc < 3 ? 1 : 0)
plot(100 * p3 / total, offset=(-12 * space), title="2.75-3%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

p325 = cum(3 <= roc and roc < 3.25 ? 1 : 0)
plot(100 * p325 / total, offset=(-11 * space), title="3-3.25%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-floor(11.5 * space)), title="3%", text=" 3% ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

p35 = cum(3.25 <= roc and roc < 3.5 ? 1 : 0)
plot(100 * p35 / total, offset=(-10 * space), title="3.25-3.5%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

p375 = cum(3.5 <= roc and roc < 3.75 ? 1 : 0)
plot(100 * p375 / total, offset=(-9 * space), title="3.5-3.75%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

p4 = cum(3.75 <= roc and roc < 4 ? 1 : 0)
plot(100 * p4 / total, offset=(-8 * space), title="3.75-4%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

p425 = cum(4 <= roc and roc < 4.25 ? 1 : 0)
plot(100 * p425 / total, offset=(-7 * space), title="4-4.25%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-floor(7.5 * space)), title="4%", text=" 4% ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

p45 = cum(4.25 <= roc and roc < 4.5 ? 1 : 0)
plot(100 * p45 / total, offset=(-6 * space), title="4.25-4.5%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

p475 = cum(4.5 <= roc and roc < 4.75 ? 1 : 0)
plot(100 * p475 / total, offset=(-5 * space), title="4.5-4.75%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

p5 = cum(4.75 <= roc and roc < 5 ? 1 : 0)
plot(100 * p5 / total, offset=(-4 * space), title="4.75-5%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

p525 = cum(5 <= roc and roc < 5.25 ? 1 : 0)
plot(100 * p525 / total, offset=(-3 * space), title="5-5.25%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-floor(3.5 * space)), title="5%", text=" 5% ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

p55 = cum(5.25 <= roc and roc < 5.5 ? 1 : 0)
plot(100 * p55 / total, offset=(-2 * space), title="5.25-5.5%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

p575 = cum(5.5 <= roc and roc < 5.75 ? 1 : 0)
plot(100 * p575 / total, offset=(-1 * space), title="5.5-5.75%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

p6 = cum(5.75 <= roc and roc < 6 ? 1 : 0)
plot(100 * p6 / total, offset=(0 * space), title="5.75-6%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

p625 = cum(roc >= 6 ? 1 : 0)
plot(100 * p625 / total, offset=(1 * space), title="≥ 6%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(floor(0.5 * space)), title="≥ 6%", text=" ≥ 6% ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

//------------------------------------------------------------------------------

n025 = cum(-0.25 < roc and roc < 0 ? 1 : 0)
plot(100 * n025 / total, offset=(-24 * space), title="-0-0.25%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

n05 = cum(-0.5 < roc and roc <= -0.25 ? 1 : 0)
plot(100 * n05 / total, offset=(-25 * space), title="-0.25-0.5%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

n075 = cum(-0.75 < roc and roc <= -0.5 ? 1 : 0)
plot(100 * n075 / total, offset=(-26 * space), title="-0.5-0.75%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

n1 = cum(-1 < roc and roc <= -0.75 ? 1 : 0)
plot(100 * n1 / total, offset=(-27 * space), title="-0.75-1%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

n125 = cum(-1.25 < roc and roc <= -1 ? 1 : 0)
plot(100 * n125 / total, offset=(-28 * space), title="-1-1.25%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-floor(27.5 * space)), title="-1%", text=" -1% ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

n15 = cum(-1.5 < roc and roc <= -1.25 ? 1 : 0)
plot(100 * n15 / total, offset=(-29 * space), title="-1.25-1.5%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

n175 = cum(-1.75 < roc and roc <= -1.5 ? 1 : 0)
plot(100 * n175 / total, offset=(-30 * space), title="-1.5-1.75%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

n2 = cum(-2 < roc and roc <= -1.75 ? 1 : 0)
plot(100 * n2 / total, offset=(-31 * space), title="-1.75-2%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

n225 = cum(-2.25 < roc and roc <= -2 ? 1 : 0)
plot(100 * n225 / total, offset=(-32 * space), title="-2-2.25%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-floor(31.5 * space)), title="-2%", text=" -2% ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

n25 = cum(-2.5 < roc and roc <= -2.25 ? 1 : 0)
plot(100 * n25 / total, offset=(-33 * space), title="-2.25-2.5%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

n275 = cum(-2.75 < roc and roc <= -2.5 ? 1 : 0)
plot(100 * n275 / total, offset=(-34 * space), title="-2.5-2.75%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

n3 = cum(-3 < roc and roc <= -2.75 ? 1 : 0)
plot(100 * n3 / total, offset=(-35 * space), title="-2.75-3%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

n325 = cum(-3.25 < roc and roc <= -3 ? 1 : 0)
plot(100 * n325 / total, offset=(-36 * space), title="-3-3.25%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-floor(35.5 * space)), title="-3%", text=" -3% ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

n35 = cum(-3.5 < roc and roc <= -3.25 ? 1 : 0)
plot(100 * n35 / total, offset=(-37 * space), title="-3.25-3.5%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

n375 = cum(-3.75 < roc and roc <= -3.5 ? 1 : 0)
plot(100 * n375 / total, offset=(-38 * space), title="-3.5-3.75%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

n4 = cum(-4 < roc and roc <= -3.75 ? 1 : 0)
plot(100 * n4 / total, offset=(-39 * space), title="-3.75-4%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

n425 = cum(-4.25 < roc and roc <= -4 ? 1 : 0)
plot(100 * n425 / total, offset=(-40 * space), title="-4-4.25%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-floor(39.5 * space)), title="-4%", text=" -4% ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

n45 = cum(-4.5 < roc and roc <= -4.25 ? 1 : 0)
plot(100 * n45 / total, offset=(-41 * space), title="-4.25-4.5%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

n475 = cum(-4.75 < roc and roc <= -4.5 ? 1 : 0)
plot(100 * n475 / total, offset=(-42 * space), title="-4.5-4.75%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

n5 = cum(-5 < roc and roc <= -4.75 ? 1 : 0)
plot(100 * n5 / total, offset=(-43 * space), title="-4.75-5%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

n525 = cum(-5.25 < roc and roc <= -5 ? 1 : 0)
plot(100 * n525 / total, offset=(-44 * space), title="-5-5.25%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-floor(43.5 * space)), title="-5%", text=" -5% ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

n55 = cum(-5.5 < roc and roc <= -5.25 ? 1 : 0)
plot(100 * n55 / total, offset=(-45 * space), title="-5.25-5.5%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

n575 = cum(-5.75 < roc and roc <= -5.5 ? 1 : 0)
plot(100 * n575 / total, offset=(-46 * space), title="-5.5-5.75%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

n6 = cum(-6 < roc and roc <= -5.75 ? 1 : 0)
plot(100 * n6 / total, offset=(-47 * space), title="-5.75-6%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)

n625 = cum(roc <= -6 ? 1 : 0)
plot(100 * n625 / total, offset=(-48 * space), title="≤ -6%", style=plot.style_histogram, linewidth=width, color=columnColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-floor(47.5 * space)), title="≤ -6%", text=" ≤ -6% ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)


/* --- FILE: tradingview-pinescript-indicators-master/statistics/dividends_per_share_dps_yearly.pine --- */
//@version=4
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Dividends per Share (DPS, Yearly) script may be freely distributed under the terms of GPL-3.0 license.
study("Dividends per Share (DPS, Yearly)")

width = input(title="Columns Width", defval=12)
space = input(title="Space Between Columns", defval=8)

esdColor = #ffb74d
estimateColor = color.new(color.blue, 85)
labelColor = #1e90ff
whiteColor = color.white

_id(type) =>
    out = "ESD_FACTSET:" + syminfo.prefix + ";" + syminfo.ticker + ";" + type
    out

id = _id("DIVIDENDS")
estimate = security(id, "D", open, true, lookahead=true)
esd = security(id, "D", close, true, lookahead=true)

_count(src, yearTarget) =>
	var float counter = na
	counter := year != year[1] and year == yearTarget ? 0 : counter[1]
	counter := year == yearTarget ? counter + (na(src) ? 0 : src) : counter

_countESD(yearTarget) =>
	esdCount = _count(esd, yearTarget)
	estimateCount = _count(estimate, yearTarget)
	[esdCount, estimateCount]

[esd1990, est1990] = _countESD(1990)
[esd1991, est1991] = _countESD(1991)
[esd1992, est1992] = _countESD(1992)
[esd1993, est1993] = _countESD(1993)
[esd1994, est1994] = _countESD(1994)
[esd1995, est1995] = _countESD(1995)
[esd1996, est1996] = _countESD(1996)
[esd1997, est1997] = _countESD(1997)
[esd1998, est1998] = _countESD(1998)
[esd1999, est1999] = _countESD(1999)
[esd2000, est2000] = _countESD(2000)
[esd2001, est2001] = _countESD(2001)
[esd2002, est2002] = _countESD(2002)
[esd2003, est2003] = _countESD(2003)
[esd2004, est2004] = _countESD(2004)
[esd2005, est2005] = _countESD(2005)
[esd2006, est2006] = _countESD(2006)
[esd2007, est2007] = _countESD(2007)
[esd2008, est2008] = _countESD(2008)
[esd2009, est2009] = _countESD(2009)
[esd2010, est2010] = _countESD(2010)
[esd2011, est2011] = _countESD(2011)
[esd2012, est2012] = _countESD(2012)
[esd2013, est2013] = _countESD(2013)
[esd2014, est2014] = _countESD(2014)
[esd2015, est2015] = _countESD(2015)
[esd2016, est2016] = _countESD(2016)
[esd2017, est2017] = _countESD(2017)
[esd2018, est2018] = _countESD(2018)
[esd2019, est2019] = _countESD(2019)
[esd2020, est2020] = _countESD(2020)
[esd2021, est2021] = _countESD(2021)
[esd2022, est2022] = _countESD(2022)
[esd2023, est2023] = _countESD(2023)
[esd2024, est2024] = _countESD(2024)
[esd2025, est2025] = _countESD(2025)
[esd2026, est2026] = _countESD(2026)
[esd2027, est2027] = _countESD(2027)
[esd2028, est2028] = _countESD(2028)
[esd2029, est2029] = _countESD(2029)
[esd2030, est2030] = _countESD(2030)

_getCounter(mode, yearTarget) =>
	out = mode == "esd" ? esd2019 : est2019
	out := yearTarget == 2030 ? (mode == "esd" ? esd2030 : est2030) : out
	out := yearTarget == 2029 ? (mode == "esd" ? esd2029 : est2029) : out
	out := yearTarget == 2028 ? (mode == "esd" ? esd2028 : est2028) : out
	out := yearTarget == 2027 ? (mode == "esd" ? esd2027 : est2027) : out
	out := yearTarget == 2026 ? (mode == "esd" ? esd2026 : est2026) : out
	out := yearTarget == 2025 ? (mode == "esd" ? esd2025 : est2025) : out
	out := yearTarget == 2024 ? (mode == "esd" ? esd2024 : est2024) : out
	out := yearTarget == 2023 ? (mode == "esd" ? esd2023 : est2023) : out
	out := yearTarget == 2022 ? (mode == "esd" ? esd2022 : est2022) : out
	out := yearTarget == 2021 ? (mode == "esd" ? esd2021 : est2021) : out
	out := yearTarget == 2020 ? (mode == "esd" ? esd2020 : est2020) : out
	out := yearTarget == 2019 ? (mode == "esd" ? esd2019 : est2019) : out
	out := yearTarget == 2018 ? (mode == "esd" ? esd2018 : est2018) : out
	out := yearTarget == 2017 ? (mode == "esd" ? esd2017 : est2017) : out
	out := yearTarget == 2016 ? (mode == "esd" ? esd2016 : est2016) : out
	out := yearTarget == 2015 ? (mode == "esd" ? esd2015 : est2015) : out
	out := yearTarget == 2014 ? (mode == "esd" ? esd2014 : est2014) : out
	out := yearTarget == 2013 ? (mode == "esd" ? esd2013 : est2013) : out
	out := yearTarget == 2012 ? (mode == "esd" ? esd2012 : est2012) : out
	out := yearTarget == 2011 ? (mode == "esd" ? esd2011 : est2011) : out
	out := yearTarget == 2010 ? (mode == "esd" ? esd2010 : est2010) : out
	out := yearTarget == 2009 ? (mode == "esd" ? esd2009 : est2009) : out
	out := yearTarget == 2008 ? (mode == "esd" ? esd2008 : est2008) : out
	out := yearTarget == 2007 ? (mode == "esd" ? esd2007 : est2007) : out
	out := yearTarget == 2006 ? (mode == "esd" ? esd2006 : est2006) : out
	out := yearTarget == 2005 ? (mode == "esd" ? esd2005 : est2005) : out
	out := yearTarget == 2004 ? (mode == "esd" ? esd2004 : est2004) : out
	out := yearTarget == 2003 ? (mode == "esd" ? esd2003 : est2003) : out
	out := yearTarget == 2002 ? (mode == "esd" ? esd2002 : est2002) : out
	out := yearTarget == 2001 ? (mode == "esd" ? esd2001 : est2001) : out
	out := yearTarget == 2000 ? (mode == "esd" ? esd2000 : est2000) : out
	out := yearTarget == 1999 ? (mode == "esd" ? esd1999 : est1999) : out
	out := yearTarget == 1998 ? (mode == "esd" ? esd1998 : est1998) : out
	out := yearTarget == 1997 ? (mode == "esd" ? esd1997 : est1997) : out
	out := yearTarget == 1996 ? (mode == "esd" ? esd1996 : est1996) : out
	out := yearTarget == 1995 ? (mode == "esd" ? esd1995 : est1995) : out
	out := yearTarget == 1994 ? (mode == "esd" ? esd1994 : est1994) : out
	out := yearTarget == 1993 ? (mode == "esd" ? esd1993 : est1993) : out
	out := yearTarget == 1992 ? (mode == "esd" ? esd1992 : est1992) : out
	out := yearTarget == 1991 ? (mode == "esd" ? esd1991 : est1991) : out
	out := yearTarget == 1990 ? (mode == "esd" ? esd1990 : est1990) : out
	out

// var end = 20
// var res = '';
// var shapePos = [0, 3, 5, 10, 15, 20];

// for (var i = 0; i <= end; i++) {
// 	var title = i == 0 ? 'Current' : `${ i }Y ago`;
// 	res = res.concat(`plot(_getCounter("esd", year - ${ i }), offset=(-${ i } * space), title="${ title }", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)\n`);
// 	res = res.concat(`plot(_getCounter("estimate", year - ${ i }), offset=(-${ i } * space), title="", style=plot.style_histogram, linewidth=width, color=estimateColor, show_last=1, transp=0, editable=false)\n\n`);

// 	if (shapePos.includes(i)) {
// 		res = res.concat(`plotshape(0, offset=(-${ i } * space), title="${ title }", text=" ${ i == 0 ? title : title.slice(0, -4) } ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)\n`)
// 	}
// }

plot(_getCounter("esd", year - 0), offset=(-0 * space), title="Current", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-0 * space), title="Current", text=" Current ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

plot(_getCounter("esd", year - 1), offset=(-1 * space), title="1Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 2), offset=(-2 * space), title="2Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 3), offset=(-3 * space), title="3Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-3 * space), title="3Y ago", text=" 3Y ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

plot(_getCounter("esd", year - 4), offset=(-4 * space), title="4Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 5), offset=(-5 * space), title="5Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-5 * space), title="5Y ago", text=" 5Y ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

plot(_getCounter("esd", year - 6), offset=(-6 * space), title="6Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 7), offset=(-7 * space), title="7Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 8), offset=(-8 * space), title="8Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 9), offset=(-9 * space), title="9Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 10), offset=(-10 * space), title="10Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-10 * space), title="10Y ago", text=" 10Y ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

plot(_getCounter("esd", year - 11), offset=(-11 * space), title="11Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 12), offset=(-12 * space), title="12Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 13), offset=(-13 * space), title="13Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 14), offset=(-14 * space), title="14Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 15), offset=(-15 * space), title="15Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-15 * space), title="15Y ago", text=" 15Y ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

plot(_getCounter("esd", year - 16), offset=(-16 * space), title="16Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 17), offset=(-17 * space), title="17Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 18), offset=(-18 * space), title="18Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 19), offset=(-19 * space), title="19Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 20), offset=(-20 * space), title="20Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-20 * space), title="20Y ago", text=" 20Y ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)


/* --- FILE: tradingview-pinescript-indicators-master/statistics/earnings_per_share_eps_yearly.pine --- */
//@version=4
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Earnings per Share (EPS, Yearly) script may be freely distributed under the terms of GPL-3.0 license.
study("Earnings per Share (EPS, Yearly)")

width = input(title="Columns Width", defval=12)
space = input(title="Space Between Columns", defval=8)

esdColor = #ffb74d
estimateColor = color.new(color.blue, 85)
labelColor = #1e90ff
whiteColor = color.white

_id(type) =>
    out = "ESD_FACTSET:" + syminfo.prefix + ";" + syminfo.ticker + ";" + type
    out

id = _id("EARNINGS")
estimate = security(id, "D", open, true, lookahead=true)
esd = security(id, "D", close, true, lookahead=true)

_count(src, yearTarget) =>
	var float counter = na
	counter := year != year[1] and year == yearTarget ? 0 : counter[1]
	counter := year == yearTarget ? counter + (na(src) ? 0 : src) : counter

_countESD(yearTarget) =>
	esdCount = _count(esd, yearTarget)
	estimateCount = _count(estimate, yearTarget)
	[esdCount, estimateCount]

[esd1990, est1990] = _countESD(1990)
[esd1991, est1991] = _countESD(1991)
[esd1992, est1992] = _countESD(1992)
[esd1993, est1993] = _countESD(1993)
[esd1994, est1994] = _countESD(1994)
[esd1995, est1995] = _countESD(1995)
[esd1996, est1996] = _countESD(1996)
[esd1997, est1997] = _countESD(1997)
[esd1998, est1998] = _countESD(1998)
[esd1999, est1999] = _countESD(1999)
[esd2000, est2000] = _countESD(2000)
[esd2001, est2001] = _countESD(2001)
[esd2002, est2002] = _countESD(2002)
[esd2003, est2003] = _countESD(2003)
[esd2004, est2004] = _countESD(2004)
[esd2005, est2005] = _countESD(2005)
[esd2006, est2006] = _countESD(2006)
[esd2007, est2007] = _countESD(2007)
[esd2008, est2008] = _countESD(2008)
[esd2009, est2009] = _countESD(2009)
[esd2010, est2010] = _countESD(2010)
[esd2011, est2011] = _countESD(2011)
[esd2012, est2012] = _countESD(2012)
[esd2013, est2013] = _countESD(2013)
[esd2014, est2014] = _countESD(2014)
[esd2015, est2015] = _countESD(2015)
[esd2016, est2016] = _countESD(2016)
[esd2017, est2017] = _countESD(2017)
[esd2018, est2018] = _countESD(2018)
[esd2019, est2019] = _countESD(2019)
[esd2020, est2020] = _countESD(2020)
[esd2021, est2021] = _countESD(2021)
[esd2022, est2022] = _countESD(2022)
[esd2023, est2023] = _countESD(2023)
[esd2024, est2024] = _countESD(2024)
[esd2025, est2025] = _countESD(2025)
[esd2026, est2026] = _countESD(2026)
[esd2027, est2027] = _countESD(2027)
[esd2028, est2028] = _countESD(2028)
[esd2029, est2029] = _countESD(2029)
[esd2030, est2030] = _countESD(2030)

_getCounter(mode, yearTarget) =>
	out = mode == "esd" ? esd2019 : est2019
	out := yearTarget == 2030 ? (mode == "esd" ? esd2030 : est2030) : out
	out := yearTarget == 2029 ? (mode == "esd" ? esd2029 : est2029) : out
	out := yearTarget == 2028 ? (mode == "esd" ? esd2028 : est2028) : out
	out := yearTarget == 2027 ? (mode == "esd" ? esd2027 : est2027) : out
	out := yearTarget == 2026 ? (mode == "esd" ? esd2026 : est2026) : out
	out := yearTarget == 2025 ? (mode == "esd" ? esd2025 : est2025) : out
	out := yearTarget == 2024 ? (mode == "esd" ? esd2024 : est2024) : out
	out := yearTarget == 2023 ? (mode == "esd" ? esd2023 : est2023) : out
	out := yearTarget == 2022 ? (mode == "esd" ? esd2022 : est2022) : out
	out := yearTarget == 2021 ? (mode == "esd" ? esd2021 : est2021) : out
	out := yearTarget == 2020 ? (mode == "esd" ? esd2020 : est2020) : out
	out := yearTarget == 2019 ? (mode == "esd" ? esd2019 : est2019) : out
	out := yearTarget == 2018 ? (mode == "esd" ? esd2018 : est2018) : out
	out := yearTarget == 2017 ? (mode == "esd" ? esd2017 : est2017) : out
	out := yearTarget == 2016 ? (mode == "esd" ? esd2016 : est2016) : out
	out := yearTarget == 2015 ? (mode == "esd" ? esd2015 : est2015) : out
	out := yearTarget == 2014 ? (mode == "esd" ? esd2014 : est2014) : out
	out := yearTarget == 2013 ? (mode == "esd" ? esd2013 : est2013) : out
	out := yearTarget == 2012 ? (mode == "esd" ? esd2012 : est2012) : out
	out := yearTarget == 2011 ? (mode == "esd" ? esd2011 : est2011) : out
	out := yearTarget == 2010 ? (mode == "esd" ? esd2010 : est2010) : out
	out := yearTarget == 2009 ? (mode == "esd" ? esd2009 : est2009) : out
	out := yearTarget == 2008 ? (mode == "esd" ? esd2008 : est2008) : out
	out := yearTarget == 2007 ? (mode == "esd" ? esd2007 : est2007) : out
	out := yearTarget == 2006 ? (mode == "esd" ? esd2006 : est2006) : out
	out := yearTarget == 2005 ? (mode == "esd" ? esd2005 : est2005) : out
	out := yearTarget == 2004 ? (mode == "esd" ? esd2004 : est2004) : out
	out := yearTarget == 2003 ? (mode == "esd" ? esd2003 : est2003) : out
	out := yearTarget == 2002 ? (mode == "esd" ? esd2002 : est2002) : out
	out := yearTarget == 2001 ? (mode == "esd" ? esd2001 : est2001) : out
	out := yearTarget == 2000 ? (mode == "esd" ? esd2000 : est2000) : out
	out := yearTarget == 1999 ? (mode == "esd" ? esd1999 : est1999) : out
	out := yearTarget == 1998 ? (mode == "esd" ? esd1998 : est1998) : out
	out := yearTarget == 1997 ? (mode == "esd" ? esd1997 : est1997) : out
	out := yearTarget == 1996 ? (mode == "esd" ? esd1996 : est1996) : out
	out := yearTarget == 1995 ? (mode == "esd" ? esd1995 : est1995) : out
	out := yearTarget == 1994 ? (mode == "esd" ? esd1994 : est1994) : out
	out := yearTarget == 1993 ? (mode == "esd" ? esd1993 : est1993) : out
	out := yearTarget == 1992 ? (mode == "esd" ? esd1992 : est1992) : out
	out := yearTarget == 1991 ? (mode == "esd" ? esd1991 : est1991) : out
	out := yearTarget == 1990 ? (mode == "esd" ? esd1990 : est1990) : out
	out

// var end = 20
// var res = '';
// var shapePos = [0, 3, 5, 10, 15, 20];

// for (var i = 0; i <= end; i++) {
// 	var title = i == 0 ? 'Current' : `${ i }Y ago`;
// 	res = res.concat(`plot(_getCounter("esd", year - ${ i }), offset=(-${ i } * space), title="${ title }", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)\n`);
// 	res = res.concat(`plot(_getCounter("estimate", year - ${ i }), offset=(-${ i } * space), title="", style=plot.style_histogram, linewidth=width, color=estimateColor, show_last=1, transp=0, editable=false)\n\n`);

// 	if (shapePos.includes(i)) {
// 		res = res.concat(`plotshape(0, offset=(-${ i } * space), title="${ title }", text=" ${ i == 0 ? title : title.slice(0, -4) } ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)\n`)
// 	}
// }

plot(_getCounter("esd", year - 0), offset=(-0 * space), title="Current", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-0 * space), title="Current", text=" Current ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

plot(_getCounter("esd", year - 1), offset=(-1 * space), title="1Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 2), offset=(-2 * space), title="2Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 3), offset=(-3 * space), title="3Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-3 * space), title="3Y ago", text=" 3Y ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

plot(_getCounter("esd", year - 4), offset=(-4 * space), title="4Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 5), offset=(-5 * space), title="5Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-5 * space), title="5Y ago", text=" 5Y ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

plot(_getCounter("esd", year - 6), offset=(-6 * space), title="6Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 7), offset=(-7 * space), title="7Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 8), offset=(-8 * space), title="8Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 9), offset=(-9 * space), title="9Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 10), offset=(-10 * space), title="10Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-10 * space), title="10Y ago", text=" 10Y ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

plot(_getCounter("esd", year - 11), offset=(-11 * space), title="11Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 12), offset=(-12 * space), title="12Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 13), offset=(-13 * space), title="13Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 14), offset=(-14 * space), title="14Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 15), offset=(-15 * space), title="15Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-15 * space), title="15Y ago", text=" 15Y ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

plot(_getCounter("esd", year - 16), offset=(-16 * space), title="16Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 17), offset=(-17 * space), title="17Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 18), offset=(-18 * space), title="18Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 19), offset=(-19 * space), title="19Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plot(_getCounter("esd", year - 20), offset=(-20 * space), title="20Y ago", style=plot.style_histogram, linewidth=width, color=esdColor, show_last=1, transp=0, editable=false)
plotshape(0, offset=(-20 * space), title="20Y ago", text=" 20Y ", color=labelColor, textcolor=whiteColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)


/* --- FILE: tradingview-pinescript-indicators-master/statistics/gaps_percent_size_distribution.pine --- */
//@version=4
// Copyright (c) 2021-present, Alex Orekhov (everget)
// Gaps % Size Distribution script may be freely distributed under the terms of GPL-3.0 license.
var int MAX_OBJECTS_COUNT = 500
study("Gaps % Size Distribution", max_lines_count=MAX_OBJECTS_COUNT, max_labels_count=MAX_OBJECTS_COUNT)

var bool reboot = input(title="Reboot (Click in case of any error)", defval=false)
// var bool useDate = input(title="", defval=false, inline=dateInline)
// int startDate = input(title="Start Aggregation from", type=input.time, defval=timestamp("01 Jan 2019 00:00"), inline=dateInline)
var float binningStep = input(title="Binning Step", type=input.float, minval=0.0001, defval=0.25, step=0.005)
var int maxColumns = input(title="Columns Number (Max: 500)", minval=2, maxval=500, defval=300)
var int columnWidth = input(title="Columns Width", defval=12)
var bool showLabels = input(title="Show Labels", defval=true)
var int nthLabel = input(title="Show Each Nth Label", minval=1, defval=5)

//------------------------------------------------------------------------------

// var int firstTime = time
// startCondition = useDate ? time(timeframe.period) >= min(firstTime, startDate) : true

var color columnColor = #ffb74d
var color labelColor = #1e90ff
var color labelTextColor = color.white

var int sizeLimit = floor(maxColumns / 2)
var int[] posValues = array.new_int(sizeLimit, 0)
var label[] posLabels = array.new_label(sizeLimit, na)

var int[] negValues = array.new_int(sizeLimit, 0)
var label[] negLabels = array.new_label(sizeLimit, na)

//------------------------------------------------------------------------------

_roc(current, basis) =>
	out = 100 * (current / basis - 1)
	out

_str(value, decimals) =>
	out = tostring(value, "#")
	out :=
		 decimals == 1 ? tostring(value, "#.#") :
		 decimals == 2 ? tostring(value, "#.##") :
		 decimals == 3 ? tostring(value, "#.###") :
		 decimals == 4 ? tostring(value, "#.####") :
		 decimals == 5 ? tostring(value, "#.#####") :
		 decimals == 6 ? tostring(value, "#.######") :
		 decimals == 7 ? tostring(value, "#.#######") :
		 decimals == 8 ? tostring(value, "#.########") :
		 decimals == 9 ? tostring(value, "#.#########") :
		 decimals == 10 ? tostring(value, "#.##########") :
		 decimals == 11 ? tostring(value, "#.###########") :
		 decimals == 12 ? tostring(value, "#.############") :
		 decimals == 13 ? tostring(value, "#.#############") :
		 decimals == 14 ? tostring(value, "#.##############") :
		 decimals == 15 ? tostring(value, "#.###############") :
		 decimals == 16 ? tostring(value, "#.################") :
		 out
	out

_format(value1, value2, decimals) =>
	out = _str(value1, decimals) + "%" + "\n-\n" + _str(value2, decimals) + "%"
	out

_labelText(value1, value2) =>
	out =
		 binningStep < 0.001 ? _format(value1, value2, 4) :
		 binningStep < 0.01 ? _format(value1, value2, 3) : 
		 _format(value1, value2, 2)
	out

_line(x, y) =>
	barTime = time[x]
	line l = line.new(
		 x1=barTime,
		 y1=0,
		 x2=barTime,
		 y2=y,
		 xloc=xloc.bar_time,
		 width=columnWidth,
		 color=columnColor
		 )
	line.delete(l[1])
	out = l
	out

_label(x, y, side, labelText, tooltipText) =>
	barTime = time[x]
	labelStyle = side == -1 ? label.style_label_up : label.style_label_down
	label l = label.new(
		 x=barTime,
		 y=y,
		 xloc=xloc.bar_time,
		 tooltip=tooltipText,
		 text=labelText,
		 textcolor=labelTextColor,
		 color=labelColor,
		 style=labelStyle,
		 size=size.small
		 )
	label.delete(l[1])
	out = l
	out

//------------------------------------------------------------------------------

isGapUp = close[1] < open
isGapDown = close[1] > open
size = _roc(open, close[1])

if isGapUp// and startCondition
	for i = 0 to sizeLimit - 1
		if i * binningStep <= size and size < (i + 1) * binningStep
			array.set(posValues, i, array.get(posValues, i) + 1)

if isGapDown// and startCondition
	for i = 0 to sizeLimit - 1
		if -(i + 1) * binningStep < size and size <= -i * binningStep
			array.set(negValues, i, array.get(negValues, i) + 1)

if barstate.islast
	for i = 0 to array.size(posValues) - 1
		posStart = sizeLimit - i
		negStart = sizeLimit + 1 + i
	
		posValue = array.get(posValues, i)
		negValue = array.get(negValues, i)
	
		_line(posStart, posValue)
		_line(negStart, negValue)

		if showLabels
			posLabel = array.get(posLabels, i)
			posText = _labelText(i * binningStep, (i + 1) * binningStep)
			posTooltip = tostring(posValue, "#")
		
			negLabel = array.get(negLabels, i)
			negText = _labelText(-i * binningStep, -(i + 1) * binningStep)
			negTooltip = tostring(negValue, "#")

			if i % nthLabel == 0
				if na(negLabel)
					negLabel := _label(negStart, 0, -1, negText, negTooltip)
					array.set(negLabels, i, negLabel)
				else
					label.set_x(negLabel, time[negStart])
					label.set_text(negLabel, negText)
					label.set_tooltip(negLabel, negTooltip)

				if na(posLabel)
					posLabel := _label(posStart, 0, -1, posText, posTooltip)
					array.set(posLabels, i, posLabel)
				else
					label.set_x(posLabel, time[posStart])
					label.set_text(posLabel, posText)
					label.set_tooltip(posLabel, posTooltip)


/* --- FILE: tradingview-pinescript-indicators-master/statistics/kendall_rank_correlation_coefficient.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Kendall Rank Correlation Coefficient script may be freely distributed under the terms of GPL-3.0 license.
study("Kendall Rank Correlation Coefficient", shorttitle="Kendall Correlation")

length = input(title="Length", type=integer, defval=20)
sym1 = input(title="1st Symbol", type=symbol, defval="FX:AUDUSD")
sym2 = input(title="2nd Symbol", type=symbol, defval="FOREXCOM:XAUUSD")
src = input(title="Source", type=source, defval=close)

data1 = security(sym1, period, src)
data2 = security(sym2, period, src)

getKendall(data1, data2, length) =>
    totalPairs = length * (length - 1) / 2
    numerator = 0.0

    for i = 0 to length - 1
        for j = 0 to i
            numerator := numerator + sign(data1[i] - data1[j]) * sign(data2[i] - data2[j])

    numerator / totalPairs

kendallCorr = sym1 == sym2 ? 1 : getKendall(data1, data2, length)
pearsonCorr = correlation(data1, data2, length)

plot(kendallCorr, title="Kendall", color=orange, transp=0)
plot(pearsonCorr, title="Pearson", color=purple, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/statistics/kurtosis_indicator.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Kurtosis Indicator script may be freely distributed under the terms of the GPL-3.0 license.
study("Kurtosis Indicator", shorttitle="Kurtosis")

momentumLength = input(title="Momentum Length", type=integer, defval=3, minval=1)
fastMAInput = input(title="Fast MA", defval="EMA", options=["EMA", "SMA", "VWMA", "WMA"])
fastLength = input(title="Fast Length", type=integer, defval=66, minval=1)
fastSlowMAInput = input(title="Fast/Slow MA", defval="SMA", options=["EMA", "SMA", "VWMA", "WMA"])
fastSlowLength = input(title="Fast/Slow Length", type=integer, defval=3, minval=1)
src = input(title="Source", type=source, defval=close)

// Kurtosis
K = change(src, momentumLength) - change(src[1], momentumLength)

// Fast Kurtosis
FK = iff(fastMAInput == "EMA", ema(K, fastLength),
	 iff(fastMAInput == "SMA", sma(K, fastLength),
	 iff(fastMAInput == "VWMA", vwma(K, fastLength),
	 iff(fastMAInput == "WMA", wma(K, fastLength),
	 na))))

// Fast / Slow Kurtosis
FSK = iff(fastSlowMAInput == "EMA", ema(FK, fastSlowLength),
	 iff(fastSlowMAInput == "SMA", sma(FK, fastSlowLength),
	 iff(fastSlowMAInput == "VWMA", vwma(FK, fastSlowLength),
	 iff(fastSlowMAInput == "WMA", wma(FK, fastSlowLength),
	 na))))

hline(title="Zero Level", price=0, linestyle=dotted, color=gray)

plot(FK, title="Fast", linewidth=2, color=#ff9370, transp=0)
plot(FSK, title="Fast / Slow", linewidth=2, color=#6d1e7f, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/statistics/linear_regression_all_data.pine --- */
//@version=4
// Copyright (c) 2020-present, Alex Orekhov (everget)
// Linear Regression (All Data) script may be freely distributed under the terms of the GPL-3.0 license.
var int MAX_BARS_BACK = 5000
study("Linear Regression (All Data)", overlay=true, max_bars_back=MAX_BARS_BACK)

n = bar_index + 1

X = n
Y = input(title="Source", defval=close)

sumX = cum(X)
sumY = cum(Y)
sumX2 = cum(pow(X, 2))
sumY2 = cum(pow(Y, 2))
sumXY = cum(X * Y)

// Pearson correlation coefficient
r = (n * sumXY - sumX * sumY) / sqrt((n * sumY2 - pow(sumY, 2)) * (n * sumX2 - pow(sumX, 2)))

// Coefficient of determination
r2 = pow(r, 2)

meanX = sumX / n
meanY = sumY / n

slope = (n * sumXY - sumX * sumY) / (n * sumX2 - pow(sumX, 2))
intercept = meanY - slope * meanX

int startIndex = n > MAX_BARS_BACK ? int(n - MAX_BARS_BACK) : 0
startY = slope * startIndex + intercept
endY = slope * (n - 1) + intercept

var line regLine = na
if barstate.islast
    if na(regLine)
        regLine := line.new(startIndex, startY, bar_index, endY, width=2, extend=extend.none, color=color.orange)
    else
        line.set_xy1(regLine, startIndex, startY)
        line.set_xy2(regLine, bar_index, endY)
        na

//------------------------------------------------------------------------

// Formatter
_format(value, decimals) =>
	out = tostring(value, "#.#")
	out :=
		 decimals == 2 ? tostring(value, "#.##") :
		 decimals == 3 ? tostring(value, "#.###") :
		 decimals == 4 ? tostring(value, "#.####") :
		 decimals == 5 ? tostring(value, "#.#####") :
		 decimals == 6 ? tostring(value, "#.######") :
		 decimals == 7 ? tostring(value, "#.#######") :
		 decimals == 8 ? tostring(value, "#.########") :
		 decimals == 9 ? tostring(value, "#.#########") :
		 decimals == 10 ? tostring(value, "#.##########") :
		 decimals == 11 ? tostring(value, "#.###########") :
		 decimals == 12 ? tostring(value, "#.############") :
		 decimals == 13 ? tostring(value, "#.#############") :
		 decimals == 14 ? tostring(value, "#.##############") :
		 decimals == 15 ? tostring(value, "#.###############") :
		 decimals == 16 ? tostring(value, "#.################") :
		 out
	out

summaryText =
     " Slope: " + _format(slope, 6) +
     "\n Intercept: " + _format(intercept, 6) +
     "\n r: " + _format(r, 3) +
     "\n r2: " + _format(r2, 3)

var label summaryLabel = label.new(
	 x=time,
	 y=na,
	 xloc=xloc.bar_time,
	 text="",
	 textalign=text.align_left,
	 textcolor=color.white,
	 color=#1e90ff,
	 style=label.style_label_left,
	 size=size.small
	 )

label.set_text(summaryLabel, summaryText)
label.set_xy(summaryLabel, time + 10 * (time - time[1]), endY)


/* --- FILE: tradingview-pinescript-indicators-master/statistics/roi_return_on_investment.pine --- */
//@version=4
// Copyright (c) 2020-present, Alex Orekhov (everget)
// Return on Investment (ROI) script may be freely distributed under the terms of GPL-3.0 license.
study("Return on Investment (ROI)", shorttitle="ROI", precision=2)

// mode = input(title="Display Mode", defval="Regular", options=["Regular", "Annualized"])

useDate = input(title="Use Specific Start Date ?", defval=true)
yearStart = input(title="Start Year", defval=2019)
monthStart = input(title="Start Month", minval=1, maxval=12, defval=1)
dayStart = input(title="Start Day", minval=1, maxval=31, defval=1)

tp = input(title="Profit Level, %", type=input.integer, defval=0, minval=0)
sl = input(title="Loss Level, %", type=input.integer, defval=0, maxval=0)

startTime = timestamp(yearStart, monthStart, dayStart, 0, 0)

index = float(na)
index := na(index[1]) ? valuewhen(time(timeframe.period) >= startTime, bar_index, 0) : index[1]

initialCond = useDate ? bar_index == index : bar_index == 0
initialRegular = valuewhen(initialCond, open, 0)
// initialAnnualized = valuewhen(initialCond, close, 0)

roiRegular = 100 * (close - initialRegular) / initialRegular

// bars = bar_index - index
// power = 1 / ((useDate ? (bars != 0 ? bars : 1) : bar_index) / 365)
// roiAnnualized = 100 * (pow(close / initialAnnualized, power) - 1)

roi = roiRegular //mode == "Regular" ? roiRegular : roiAnnualized
roiPlot = plot(roi, title="ROI, %", color=color.black)

transparent = color.new(color.white, 100)
roiColor = roi < 0 ? color.red : #09b71e
labelColor = #f9ce02
levelColor = #674ea7

bgcolor(year != year[1] ? #f57f17 : transparent, title="Year Separator", transp=60)

zeroPlot = plot(0, title="", style=plot.style_circles, linewidth=0, color=labelColor, editable=false)
hline(0, title="Zero Level", linestyle=hline.style_dotted, color=levelColor)

fill(roiPlot, zeroPlot, title="Base Background", color=roiColor, transp=80)

tpPlot = plot(tp, title="Profit", style=plot.style_circles, linewidth=0, color=labelColor, editable=false)
hline(tp, title="Profit Level", linestyle=hline.style_dotted, color=levelColor)

tpFillColor = tp > 0 and roi > tp ? #09b71e : transparent
fill(tpPlot, roiPlot, title="Profit Background", color=tpFillColor, transp=60)

slPlot = plot(sl, title="Loss", style=plot.style_circles, linewidth=0, color=labelColor, editable=false)
hline(sl, title="Loss Level", linestyle=hline.style_dotted, color=levelColor)

slFillColor = sl < 0 and roi < sl ? color.red : transparent
fill(slPlot, roiPlot, title="Loss Background", color=slFillColor, transp=60)

alertcondition(crossover(roi, tp), title="ROI Profit Level Crossover", message="ROI Profit Level Crossover")
alertcondition(crossunder(roi, sl), title="ROI Loss Level Crossunder", message="ROI Loss Level Crossunder")


/* --- FILE: tradingview-pinescript-indicators-master/statistics/ticker_performance_by_us_president.pine --- */
//@version=6
// Copyright (c) 2020-present, Alex Orekhov (everget)
indicator('Presidents Performance')

width = input.int(title = 'Columns Width', minval = 1, defval = 15)
space = input.int(title = 'Space Between Columns', minval = 0, defval = 150)

var labelColor = #1e90ff
var labelTextColor = color.white
var labelStyle = shape.labelup
var labelLocation = location.absolute
var labelSize = size.small

t = time(timeframe.period)

_ts(y, m, d, h = 0, min = 0, s = 0) =>
    out = timestamp(y, m, d, h, min, s)
    out

_perf(presidency) =>
    var float start = na
    var float out = na
    start := na(start) and presidency ? open : start
    out := not na(start) and presidency ? 100 * (close - start) / start : out
    out

hline(0.0, title = 'Zero Level', linestyle = hline.style_dotted, color = #674ea7)

//------------------------------------------------------------------------------
// Donald Trump

trump2 = _perf(t > _ts(2025, 1, 20))
trump2Offset = 0

plot(trump2, offset = trump2Offset, title = 'Donald Trump', color = #f1625e, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(trump2, 0), offset = trump2Offset, title = 'Donald Trump', text = 'Trump', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// Joe Biden

biden = _perf(_ts(2021, 1, 20) <= t and t <= _ts(2025, 1, 20))
bidenOffset = trump2Offset - space

plot(biden, offset = bidenOffset, title = 'Joe Biden', color = #9966cc, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(biden, 0), offset = bidenOffset, title = 'Joe Biden', text = 'Biden', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// Donald Trump

trump = _perf(_ts(2017, 1, 20) <= t and t <= _ts(2021, 1, 20))
trumpOffset = bidenOffset - space

plot(trump, offset = trumpOffset, title = 'Donald Trump', color = #f1625e, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(trump, 0), offset = trumpOffset, title = 'Donald Trump', text = 'Trump', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// Barack Obama

obama = _perf(_ts(2009, 1, 20) <= t and t <= _ts(2017, 1, 20))
obamaOffset = trumpOffset - space

plot(obama, offset = obamaOffset, title = 'Barack Obama', color = #9ace73, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(obama, 0), offset = obamaOffset, title = 'Barack Obama', text = 'Obama', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// George W. Bush

gw_bush = _perf(_ts(2001, 1, 20) <= t and t <= _ts(2009, 1, 20))
gw_bushOffset = obamaOffset - space

plot(gw_bush, offset = gw_bushOffset, title = 'George W. Bush', color = #ffdf82, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(gw_bush, 0), offset = gw_bushOffset, title = 'George W. Bush', text = 'G. Bush', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// Bill Clinton

clinton = _perf(_ts(1993, 1, 20) <= t and t <= _ts(2001, 1, 20))
clintonOffset = gw_bushOffset - space

plot(clinton, offset = clintonOffset, title = 'Bill Clinton', color = #bb8954, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(clinton, 0), offset = clintonOffset, title = 'Bill Clinton', text = 'Clinton', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// George H. W. Bush

ghw_bush = _perf(_ts(1989, 1, 20) <= t and t <= _ts(1993, 1, 20))
ghw_bushOffset = clintonOffset - space

plot(ghw_bush, offset = ghw_bushOffset, title = 'George H. W. Bush', color = #4363d8, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(ghw_bush, 0), offset = ghw_bushOffset, title = 'George H. W. Bush', text = 'G. H. Bush', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// Ronald Reagan

reagan = _perf(_ts(1981, 1, 20) <= t and t <= _ts(1989, 1, 20))
reaganOffset = ghw_bushOffset - space

plot(reagan, offset = reaganOffset, title = 'Ronald Reagan', color = #c46c54, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(reagan, 0), offset = reaganOffset, title = 'Ronald Reagan', text = 'Reagan', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// Jimmy Carter

carter = _perf(_ts(1977, 1, 20) <= t and t <= _ts(1981, 1, 20))
carterOffset = reaganOffset - space

plot(carter, offset = carterOffset, title = 'Jimmy Carter', color = #5ec27c, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(carter, 0), offset = carterOffset, title = 'Jimmy Carter', text = 'Carter', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// Gerald Ford

ford = _perf(_ts(1974, 8, 9) <= t and t <= _ts(1977, 1, 20))
fordOffset = carterOffset - space

plot(ford, offset = fordOffset, title = 'Gerald Ford', color = #e6194b, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(ford, 0), offset = fordOffset, title = 'Gerald Ford', text = 'Ford', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// Richard Nixon

nixon = _perf(_ts(1969, 1, 20) <= t and t <= _ts(1974, 8, 9))
nixonOffset = fordOffset - space

plot(nixon, offset = nixonOffset, title = 'Richard Nixon', color = #3cb44b, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(nixon, 0), offset = nixonOffset, title = 'Richard Nixon', text = 'Nixon', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// Lyndon B. Johnson

johnson = _perf(_ts(1963, 11, 22) <= t and t <= _ts(1969, 1, 20))
johnsonOffset = nixonOffset - space

plot(johnson, offset = johnsonOffset, title = 'Lyndon B. Johnson', color = #ffe119, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(johnson, 0), offset = johnsonOffset, title = 'Lyndon B. Johnson', text = 'Johnson', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// John F. Kennedy

kennedy = _perf(_ts(1961, 1, 20) <= t and t <= _ts(1963, 11, 22))
kennedyOffset = johnsonOffset - space

plot(kennedy, offset = kennedyOffset, title = 'John F. Kennedy', color = #f58231, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(kennedy, 0), offset = kennedyOffset, title = 'John F. Kennedy', text = 'Kennedy', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// Dwight D. Eisenhower

eisenhower = _perf(_ts(1953, 1, 20) <= t and t <= _ts(1961, 1, 20))
eisenhowerOffset = kennedyOffset - space

plot(eisenhower, offset = eisenhowerOffset, title = 'Dwight D. Eisenhower', color = #008b8b, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(eisenhower, 0), offset = eisenhowerOffset, title = 'Dwight D. Eisenhower', text = 'Eisenhower', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// Harry S. Truman

truman = _perf(_ts(1945, 4, 12) <= t and t <= _ts(1953, 1, 20))
trumanOffset = eisenhowerOffset - space

plot(truman, offset = trumanOffset, title = 'Harry S. Truman', color = #5059a5, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(truman, 0), offset = trumanOffset, title = 'Harry S. Truman', text = 'Truman', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// Franklin D. Roosevelt

f_roosevelt = _perf(_ts(1933, 3, 4) <= t and t <= _ts(1945, 4, 12))
f_rooseveltOffset = trumanOffset - space

plot(f_roosevelt, offset = f_rooseveltOffset, title = 'Franklin D. Roosevelt', color = #b22222, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(f_roosevelt, 0), offset = f_rooseveltOffset, title = 'Franklin D. Roosevelt', text = 'F. Roosevelt', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// Herbert Hoover

hoover = _perf(_ts(1929, 3, 4) <= t and t <= _ts(1933, 3, 4))
hooverOffset = f_rooseveltOffset - space

plot(hoover, offset = hooverOffset, title = 'Herbert Hoover', color = #ffd700, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(hoover, 0), offset = hooverOffset, title = 'Herbert Hoover', text = 'Hoover', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// Calvin Coolidge

coolidge = _perf(_ts(1923, 8, 2) <= t and t <= _ts(1929, 3, 4))
coolidgeOffset = hooverOffset - space

plot(coolidge, offset = coolidgeOffset, title = 'Calvin Coolidge', color = #4b0082, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(coolidge, 0), offset = coolidgeOffset, title = 'Calvin Coolidge', text = 'Coolidge', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// Warren G. Harding

harding = _perf(_ts(1921, 3, 4) <= t and t <= _ts(1923, 8, 2))
hardingOffset = coolidgeOffset - space

plot(harding, offset = hardingOffset, title = 'Warren G. Harding', color = #c71585, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(harding, 0), offset = hardingOffset, title = 'Warren G. Harding', text = 'Harding', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// Woodrow Wilson

wilson = _perf(_ts(1913, 3, 4) <= t and t <= _ts(1921, 3, 4))
wilsonOffset = hardingOffset - space

plot(wilson, offset = wilsonOffset, title = 'Woodrow Wilson', color = #5f9ea0, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(wilson, 0), offset = wilsonOffset, title = 'Woodrow Wilson', text = 'Wilson', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// William Howard Taft

taft = _perf(_ts(1909, 3, 4) <= t and t <= _ts(1913, 3, 4))
taftOffset = wilsonOffset - space

plot(taft, offset = taftOffset, title = 'William Howard Taft', color = #b8860b, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(taft, 0), offset = taftOffset, title = 'William Howard Taft', text = 'Taft', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// Theodore Roosevelt

t_roosevelt = _perf(_ts(1901, 9, 14) <= t and t <= _ts(1909, 3, 4))
t_rooseveltOffset = taftOffset - space

plot(t_roosevelt, offset = t_rooseveltOffset, title = 'Theodore Roosevelt', color = #7e5233, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(t_roosevelt, 0), offset = t_rooseveltOffset, title = 'Theodore Roosevelt', text = 'T. Roosevelt', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// William McKinley

mckinley = _perf(_ts(1897, 3, 4) <= t and t <= _ts(1901, 9, 14))
mckinleyOffset = t_rooseveltOffset - space

plot(mckinley, offset = mckinleyOffset, title = 'William McKinley', color = #3d986a, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(mckinley, 0), offset = mckinleyOffset, title = 'William McKinley', text = 'McKinley', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)

//------------------------------------------------------------------------------
// Grover Cleveland

cleveland = _perf(_ts(1893, 3, 4) <= t and t <= _ts(1897, 3, 4))
clevelandOffset = mckinleyOffset - space

plot(cleveland, offset = clevelandOffset, title = 'Grover Cleveland', color = #f45b10, style = plot.style_histogram, linewidth = width, show_last = 1)
plotshape(math.min(cleveland, 0), offset = clevelandOffset, title = 'Grover Cleveland', text = 'Cleveland', color = labelColor, textcolor = labelTextColor, style = labelStyle, location = labelLocation, size = labelSize, show_last = 1)


/* --- FILE: tradingview-pinescript-indicators-master/statistics/us_treasury_yields.pine --- */
//@version=4
// Copyright (c) 2020-present, Alex Orekhov (everget)
// US Treasury Yields script may be freely distributed under the terms of GPL-3.0 license.
study("US Treasury Yields", format=format.price)

mode = input(title="Display Mode", defval="Columns", options=["Lines", "Columns"])
lineWidth = input(title="Lines Width", type=input.integer, defval=2)
columnWidth = input(title="Columns Width", type=input.integer, defval=12)
space = input(title="Space Between Columns", type=input.integer, defval=8)

//------------------------------------------------------------------------------

_get(sym) =>
	out = nz(security(sym, timeframe.period, close, barmerge.gaps_off, barmerge.lookahead_on))
	out

//------------------------------------------------------------------------------

modeLines = mode == "Lines"

labelColor = #1e90ff
textColor = color.white

US30Y = _get("TVC:US30Y")

plot(not modeLines ? US30Y : na, title="30Y, %", offset=(0 * space), color=#f1625e, style=plot.style_histogram, linewidth=columnWidth, show_last=1, editable=false)
plot(modeLines ? US30Y : na, title="30Y, %", color=#f1625e, linewidth=lineWidth, editable=false)
plotshape(not modeLines ? min(US30Y, 0) : na, offset=(0 * space), title="US30Y", text=" 30Y ", color=labelColor, textcolor=textColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

US10Y = _get("TVC:US10Y")

plot(not modeLines ? US10Y : na, title="10Y, %", offset=(-1 * space), color=#9ace73, style=plot.style_histogram, linewidth=columnWidth, show_last=1, editable=false)
plot(modeLines ? US10Y : na, title="10Y, %", color=#9ace73, linewidth=lineWidth, editable=false)
plotshape(not modeLines ? min(US10Y, 0) : na, offset=(-1 * space), title="US10Y", text=" 10Y ", color=labelColor, textcolor=textColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

US07Y = _get("TVC:US07Y")

plot(not modeLines ? US07Y : na, title="7Y, %", offset=(-2 * space), color=#ffdf82, style=plot.style_histogram, linewidth=columnWidth, show_last=1, editable=false)
plot(modeLines ? US07Y : na, title="7Y, %", color=#ffdf82, linewidth=lineWidth, editable=false)
plotshape(not modeLines ? min(US07Y, 0) : na, offset=(-2 * space), title="US07Y", text=" 7Y ", color=labelColor, textcolor=textColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

US05Y = _get("TVC:US05Y")

plot(not modeLines ? US05Y : na, title="5Y, %", offset=(-3 * space), color=#bb8954, style=plot.style_histogram, linewidth=columnWidth, show_last=1, editable=false)
plot(modeLines ? US05Y : na, title="5Y, %", color=#bb8954, linewidth=lineWidth, editable=false)
plotshape(not modeLines ? min(US05Y, 0) : na, offset=(-3 * space), title="US05Y", text=" 5Y ", color=labelColor, textcolor=textColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

US03Y = _get("TVC:US03Y")

plot(not modeLines ? US03Y : na, title="3Y, %", offset=(-4 * space), color=#4363d8, style=plot.style_histogram, linewidth=columnWidth, show_last=1, editable=false)
plot(modeLines ? US03Y : na, title="3Y, %", color=#4363d8, linewidth=lineWidth, editable=false)
plotshape(not modeLines ? min(US03Y, 0) : na, offset=(-4 * space), title="US03Y", text=" 3Y ", color=labelColor, textcolor=textColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

US02Y = _get("TVC:US02Y")

plot(not modeLines ? US02Y : na, title="2Y, %", offset=(-5 * space), color=#c46c54, style=plot.style_histogram, linewidth=columnWidth, show_last=1, editable=false)
plot(modeLines ? US02Y : na, title="2Y, %", color=#c46c54, linewidth=lineWidth, editable=false)
plotshape(not modeLines ? min(US02Y, 0) : na, offset=(-5 * space), title="US02Y", text=" 2Y ", color=labelColor, textcolor=textColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

US01Y = _get("TVC:US01Y")

plot(not modeLines ? US01Y : na, title="1Y, %", offset=(-6 * space), color=#5ec27c, style=plot.style_histogram, linewidth=columnWidth, show_last=1, editable=false)
plot(modeLines ? US01Y : na, title="1Y, %", color=#5ec27c, linewidth=lineWidth, editable=false)
plotshape(not modeLines ? min(US01Y, 0) : na, offset=(-6 * space), title="US01Y", text=" 1Y ", color=labelColor, textcolor=textColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

US06MY = _get("TVC:US06MY")

plot(not modeLines ? US06MY : na, title="6M, %", offset=(-7 * space), color=#e6194b, style=plot.style_histogram, linewidth=columnWidth, show_last=1, editable=false)
plot(modeLines ? US06MY : na, title="6M, %", color=#e6194b, linewidth=lineWidth, editable=false)
plotshape(not modeLines ? min(US06MY, 0) : na, offset=(-7 * space), title="US06MY", text=" 6M ", color=labelColor, textcolor=textColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

US03MY = _get("TVC:US03MY")

plot(not modeLines ? US03MY : na, title="3M, %", offset=(-8 * space), color=#3cb44b, style=plot.style_histogram, linewidth=columnWidth, show_last=1, editable=false)
plot(modeLines ? US03MY : na, title="3M, %", color=#3cb44b, linewidth=lineWidth, editable=false)
plotshape(not modeLines ? min(US03MY, 0) : na, offset=(-8 * space), title="US03MY", text=" 3M ", color=labelColor, textcolor=textColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

US02MY = _get("TVC:US02MY")

plot(not modeLines ? US02MY : na, title="2M, %", offset=(-9 * space), color=#ffe119, style=plot.style_histogram, linewidth=columnWidth, show_last=1, editable=false)
plot(modeLines ? US02MY : na, title="2M, %", color=#ffe119, linewidth=lineWidth, editable=false)
plotshape(not modeLines ? min(US02MY, 0) : na, offset=(-9 * space), title="US02MY", text=" 2M ", color=labelColor, textcolor=textColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

US01MY = _get("TVC:US01MY")

plot(not modeLines ? US01MY : na, title="1M, %", offset=(-10 * space), color=#f58231, style=plot.style_histogram, linewidth=columnWidth, show_last=1, editable=false)
plot(modeLines ? US01MY : na, title="1M, %", color=#f58231, linewidth=lineWidth, editable=false)
plotshape(not modeLines ? min(US01MY, 0) : na, offset=(-10 * space), title="US01MY", text=" 1M ", color=labelColor, textcolor=textColor, style=shape.labelup, location=location.absolute, size=size.small, show_last=1, transp=0, editable=false)

levelLabelColor = #f9ce02
levelColor = #674ea7

plot(0.0, title="", style=plot.style_circles, linewidth=0, color=levelLabelColor, editable=false)
hline(0.0, title="Zero Level", linestyle=hline.style_dotted, color=levelColor)


/* --- FILE: tradingview-pinescript-indicators-master/statistics/ytd_year_to_date_percent_return.pine --- */
//@version=4
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Year-to-Date (YTD) % Return script may be freely distributed under the terms of GPL-3.0 license.
study("Year-to-Date (YTD) % Return", shorttitle="YTD % Return", precision=2)

level1 = input(title="Level #1", type=input.integer, defval=0)
level2 = input(title="Level #2", type=input.integer, defval=0)
level3 = input(title="Level #3", type=input.integer, defval=0)
level4 = input(title="Level #4", type=input.integer, defval=0)
level5 = input(title="Level #5", type=input.integer, defval=0)
level6 = input(title="Level #6", type=input.integer, defval=0)

_ytd(yearTarget) =>
    yearCond = year != year[1]
    yearOpen = valuewhen(yearCond, open, yearTarget)
    ytd = 100 * (close - yearOpen) / yearOpen
    ytd

labelColor = #f9ce02
levelColor = #674ea7
transparent = color.new(color.white, 100)

ytd = _ytd(0)
ytdColor = ytd < 0 ? color.red : #09b71e
ytdPlot = plot(ytd, title="YTD, %", color=color.black)

zeroPlot = plot(0, title="", style=plot.style_circles, linewidth=0, color=labelColor, editable=false)
hline(0, title="Zero Level", linestyle=hline.style_dotted, color=levelColor)

fill(ytdPlot, zeroPlot, color=ytdColor, transp=80)

plot(level1, title="", style=plot.style_circles, linewidth=0, color=labelColor, editable=false)
hline(level1, title="Level #1", linestyle=hline.style_dotted, color=levelColor)

plot(level2, title="", style=plot.style_circles, linewidth=0, color=labelColor, editable=false)
hline(level2, title="Level #2", linestyle=hline.style_dotted, color=levelColor)

plot(level3, title="", style=plot.style_circles, linewidth=0, color=labelColor, editable=false)
hline(level3, title="Level #3", linestyle=hline.style_dotted, color=levelColor)

plot(level4, title="", style=plot.style_circles, linewidth=0, color=labelColor, editable=false)
hline(level4, title="Level #4", linestyle=hline.style_dotted, color=levelColor)

plot(level5, title="", style=plot.style_circles, linewidth=0, color=labelColor, editable=false)
hline(level5, title="Level #5", linestyle=hline.style_dotted, color=levelColor)

plot(level6, title="", style=plot.style_circles, linewidth=0, color=labelColor, editable=false)
hline(level6, title="Level #6", linestyle=hline.style_dotted, color=levelColor)

bgcolor(year != year[1] ? #f57f17 : transparent, title="Year Separator", transp=60)

alertcondition(crossover(ytd, level1), title="Level #1 Crossover", message="Level #1 Crossover!")
alertcondition(crossunder(ytd, level1), title="Level #1 Crossunder", message="Level #1 Crossunder!")

alertcondition(crossover(ytd, level2), title="Level #2 Crossover", message="Level #2 Crossover!")
alertcondition(crossunder(ytd, level2), title="Level #2 Crossunder", message="Level #2 Crossunder!")

alertcondition(crossover(ytd, level3), title="Level #3 Crossover", message="Level #3 Crossover!")
alertcondition(crossunder(ytd, level3), title="Level #3 Crossunder", message="Level #3 Crossunder!")

alertcondition(crossover(ytd, level4), title="Level #4 Crossover", message="Level #4 Crossover!")
alertcondition(crossunder(ytd, level4), title="Level #4 Crossunder", message="Level #4 Crossunder!")

alertcondition(crossover(ytd, level5), title="Level #5 Crossover", message="Level #5 Crossover!")
alertcondition(crossunder(ytd, level5), title="Level #5 Crossunder", message="Level #5 Crossunder!")

alertcondition(crossover(ytd, level6), title="Level #6 Crossover", message="Level #6 Crossover!")
alertcondition(crossunder(ytd, level6), title="Level #6 Crossunder", message="Level #6 Crossunder!")


/* --- FILE: tradingview-pinescript-indicators-master/statistics/z_score.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Z-Score script may be freely distributed under the terms of the GPL-3.0 license.
study("Z-Score", shorttitle="ZSC")

length = input(title="Length", type=integer, minval=1, defval=14)
stdevInput = input(title="Standard Deviation", defval="Sample", options=["Population", "Sample"])
src = input(title="Source", type=source, defval=close)

sampleStdev(src, length) =>
	dev = src - sma(src, length)
	variance = sum(dev * dev, length) / (length - 1)
	sqrt(variance)

selectedStdev = stdevInput == "Sample"
	 ? sampleStdev(src, length)
	 : stdev(src, length)

zsc = (src - sma(src, length)) / selectedStdev

zscColor = zsc > 2.0 ? #0ebb23 : zsc < -2.0 ? #ff0000 : #8e7cc3

plot(zsc, title="Z-Score", linewidth=2, color=zscColor, transp=0, style=line)

hline(title="Upper Band", price=2.0, linestyle=dotted, color=#e69138)
hline(0, title="Zero Level", linestyle=dotted, color=#989898)
hline(title="Lower Band", price=-2.0, linestyle=dotted, color=#e69138)


/* --- FILE: tradingview-pinescript-indicators-master/trailing_stops/chandelier_exit.pine --- */
//@version=6
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Chandelier Exit script may be freely distributed under the terms of the GPL-3.0 license.
indicator('Chandelier Exit', shorttitle = 'CE', overlay = true)

const string calcGroup = 'Calculation'
length = input.int(22, title = 'ATR Period', group = calcGroup)
mult = input.float(3.0, step = 0.1, title = 'ATR Multiplier', group = calcGroup)
useClose = input.bool(true, title = 'Use Close Price for Extremums', group = calcGroup)

const string visualGroup = 'Visuals'
showLabels = input.bool(true, title = 'Show Buy/Sell Labels', group = visualGroup)
highlightState = input.bool(true, title = 'Highlight State', group = visualGroup)

const string alertGroup = 'Alerts'
awaitBarConfirmation = input.bool(true, title = 'Await Bar Confirmation', group = alertGroup)

//---

atr = mult * ta.atr(length)

longStop = (useClose ? ta.highest(close, length) : ta.highest(length)) - atr
longStopPrev = nz(longStop[1], longStop)
longStop := close[1] > longStopPrev ? math.max(longStop, longStopPrev) : longStop

shortStop = (useClose ? ta.lowest(close, length) : ta.lowest(length)) + atr
shortStopPrev = nz(shortStop[1], shortStop)
shortStop := close[1] < shortStopPrev ? math.min(shortStop, shortStopPrev) : shortStop

var int dir = 1
dir := close > shortStopPrev ? 1 : close < longStopPrev ? -1 : dir

const color textColor = color.white
const color longColor = color.green
const color shortColor = color.red
const color longFillColor = color.new(color.green, 85)
const color shortFillColor = color.new(color.red, 85)

buySignal = dir == 1 and dir[1] == -1
longStopPlot = plot(dir == 1 ? longStop : na, title = 'Long Stop', style = plot.style_linebr, linewidth = 2, color = longColor)
plotshape(buySignal ? longStop : na, title = 'Long Stop Start', location = location.absolute, style = shape.circle, size = size.tiny, color = longColor)
plotshape(buySignal and showLabels ? longStop : na, title = 'Buy Label', text = 'Buy', location = location.absolute, style = shape.labelup, size = size.tiny, color = longColor, textcolor = textColor)

sellSignal = dir == -1 and dir[1] == 1
shortStopPlot = plot(dir == 1 ? na : shortStop, title = 'Short Stop', style = plot.style_linebr, linewidth = 2, color = shortColor)
plotshape(sellSignal ? shortStop : na, title = 'Short Stop Start', location = location.absolute, style = shape.circle, size = size.tiny, color = shortColor)
plotshape(sellSignal and showLabels ? shortStop : na, title = 'Sell Label', text = 'Sell', location = location.absolute, style = shape.labeldown, size = size.tiny, color = shortColor, textcolor = textColor)

midPricePlot = plot(ohlc4, title = '', display = display.none, editable = false)

fill(midPricePlot, longStopPlot, title = 'Long State Filling', color = (highlightState and dir == 1 ? longFillColor : na))
fill(midPricePlot, shortStopPlot, title = 'Short State Filling', color = (highlightState and dir == -1 ? shortFillColor : na))

await = awaitBarConfirmation ? barstate.isconfirmed : true
alertcondition(dir != dir[1] and await, title = 'CE Direction Change', message = 'Chandelier Exit has changed direction, {{exchange}}:{{ticker}}')
alertcondition(buySignal and await, title = 'CE Buy', message = 'Chandelier Exit Buy, {{exchange}}:{{ticker}}')
alertcondition(sellSignal and await, title = 'CE Sell', message = 'Chandelier Exit Sell, {{exchange}}:{{ticker}}')


/* --- FILE: tradingview-pinescript-indicators-master/trailing_stops/halftrend.pine --- */
//@version=6
// Copyright (c) 2021-present, Alex Orekhov (everget)
// HalfTrend script may be freely distributed under the terms of the GPL-3.0 license.
indicator('HalfTrend', overlay = true)

const string calcGroup = 'Calculation'
amplitude = input.int(2, title = 'Amplitude', group = calcGroup)
channelDeviation = input.int(2, title = 'Channel Deviation', group = calcGroup)

const string visualGroup = 'Visuals'
showArrows = input.bool(true, title = 'Show Arrows', group = visualGroup)
showChannels = input.bool(true, title = 'Show Channels', group = visualGroup)
showLabels = input.bool(true, title = 'Show Buy/Sell Labels', group = visualGroup)

//---

var int trend = 0
var int nextTrend = 0
var float maxLowPrice = nz(low[1], low)
var float minHighPrice = nz(high[1], high)

var float up = 0.0
var float down = 0.0
float atrHigh = 0.0
float atrLow = 0.0
float arrowUp = na
float arrowDown = na

atr2 = ta.atr(100) / 2
dev = channelDeviation * atr2

highPrice = high[math.abs(ta.highestbars(amplitude))]
lowPrice = low[math.abs(ta.lowestbars(amplitude))]
highma = ta.sma(high, amplitude)
lowma = ta.sma(low, amplitude)

if nextTrend == 1
    maxLowPrice := math.max(lowPrice, maxLowPrice)

    if highma < maxLowPrice and close < nz(low[1], low)
        trend := 1
        nextTrend := 0
        minHighPrice := highPrice
        minHighPrice
else
    minHighPrice := math.min(highPrice, minHighPrice)

    if lowma > minHighPrice and close > nz(high[1], high)
        trend := 0
        nextTrend := 1
        maxLowPrice := lowPrice
        maxLowPrice

if trend == 0
    if not na(trend[1]) and trend[1] != 0
        up := na(down[1]) ? down : down[1]
        arrowUp := up - atr2
        arrowUp
    else
        up := na(up[1]) ? maxLowPrice : math.max(maxLowPrice, up[1])
        up
    atrHigh := up + dev
    atrLow := up - dev
    atrLow
else
    if not na(trend[1]) and trend[1] != 1
        down := na(up[1]) ? up : up[1]
        arrowDown := down + atr2
        arrowDown
    else
        down := na(down[1]) ? minHighPrice : math.min(minHighPrice, down[1])
        down
    atrHigh := down + dev
    atrLow := down - dev
    atrLow

ht = trend == 0 ? up : down

const color buyColor = color.blue
const color sellColor = color.red
const color textColor = color.white
const color buyFillColor = color.new(buyColor, 85)
const color sellFillColor = color.new(sellColor, 85)

htColor = trend == 0 ? buyColor : sellColor
htPlot = plot(ht, title = 'HalfTrend', linewidth = 2, color = htColor)

atrHighPlot = plot(showChannels ? atrHigh : na, title = 'ATR High', style = plot.style_circles, color = sellColor)
atrLowPlot = plot(showChannels ? atrLow : na, title = 'ATR Low', style = plot.style_circles, color = buyColor)

fill(htPlot, atrHighPlot, title = 'ATR High Ribbon', color = sellFillColor)
fill(htPlot, atrLowPlot, title = 'ATR Low Ribbon', color = buyFillColor)

buySignal = not na(arrowUp) and trend == 0 and trend[1] == 1
sellSignal = not na(arrowDown) and trend == 1 and trend[1] == 0

plotshape(showArrows and buySignal ? atrLow : na, title = 'Arrow Up', style = shape.triangleup, location = location.absolute, size = size.tiny, color = buyColor)
plotshape(showArrows and sellSignal ? atrHigh : na, title = 'Arrow Down', style = shape.triangledown, location = location.absolute, size = size.tiny, color = sellColor)

plotshape(showLabels and buySignal ? atrLow : na, title = 'Buy Label', text = 'Buy', location = location.absolute, style = shape.labelup, size = size.tiny, color = buyColor, textcolor = textColor)
plotshape(showLabels and sellSignal ? atrHigh : na, title = 'Sell Label', text = 'Sell', location = location.absolute, style = shape.labeldown, size = size.tiny, color = sellColor, textcolor = textColor)

alertcondition(buySignal, title = 'HalfTrend Buy', message = 'HalfTrend Buy, {{exchange}}:{{ticker}}')
alertcondition(sellSignal, title = 'HalfTrend Sell', message = 'HalfTrend Sell, {{exchange}}:{{ticker}}')


/* --- FILE: tradingview-pinescript-indicators-master/trailing_stops/nrtr_nick_rypock_trailing_reverse.pine --- */
//@version=6
// Copyright (c) 2021-present, Alex Orekhov (everget)
// Nick Rypock Trailing Reverse (NRTR) script may be freely distributed under the terms of the GPL-3.0 license.
indicator('Nick Rypock Trailing Reverse', shorttitle = 'NRTR', overlay = true)

const string calcGroup = 'Calculation'
percentage = input.float(2, minval = 0, maxval = 100, step = 0.1, title = 'Coefficient of Correction, %', group = calcGroup) / 100

const string visualGroup = 'Visuals'
showLabels = input.bool(true, title = 'Show Buy/Sell Labels', group = visualGroup)
highlightState = input.bool(true, title = 'Highlight State', group = visualGroup)

//---

var int trend = 0
var float hp = close
var float lp = close
nrtr = close

if trend >= 0
    if close > hp
        hp := close
        hp
    nrtr := hp * (1 - percentage)
    if close <= nrtr
        trend := -1
        lp := close
        nrtr := lp * (1 + percentage)
        nrtr
else
    if close < lp
        lp := close
        lp
    nrtr := lp * (1 + percentage)
    if close > nrtr
        trend := 1
        hp := close
        nrtr := hp * (1 - percentage)
        nrtr

const color textColor = color.white
const color longColor = color.green
const color shortColor = color.red
const color longFillColor = color.new(color.green, 85)
const color shortFillColor = color.new(color.red, 85)

longStopPlot = plot(trend == 1 ? nrtr : na, title = 'Long Stop', style = plot.style_linebr, linewidth = 2, color = longColor)
buySignal = trend == 1 and trend[1] == -1
plotshape(buySignal ? nrtr : na, title = 'Long Stop Start', location = location.absolute, style = shape.circle, size = size.tiny, color = longColor)
plotshape(buySignal and showLabels ? nrtr : na, title = 'Buy Label', text = 'Buy', location = location.absolute, style = shape.labelup, size = size.tiny, color = longColor, textcolor = textColor)

shortStopPlot = plot(trend == 1 ? na : nrtr, title = 'Short Stop', style = plot.style_linebr, linewidth = 2, color = shortColor)
sellSignal = trend == -1 and trend[1] == 1
plotshape(sellSignal ? nrtr : na, title = 'Short Stop Start', location = location.absolute, style = shape.circle, size = size.tiny, color = shortColor)
plotshape(sellSignal and showLabels ? nrtr : na, title = 'Sell Label', text = 'Sell', location = location.absolute, style = shape.labeldown, size = size.tiny, color = shortColor, textcolor = textColor)

midPricePlot = plot(ohlc4, title = '', display = display.none, editable = false)

fill(midPricePlot, longStopPlot, title = 'Long State Filling', color = (highlightState and trend == 1 ? longFillColor : na))
fill(midPricePlot, shortStopPlot, title = 'Short State Filling', color = (highlightState and trend == -1 ? shortFillColor : na))

alertcondition(trend != trend[1], title = 'NRTR Direction Change', message = 'NRTR has changed direction, {{exchange}}:{{ticker}}')
alertcondition(buySignal, title = 'NRTR Buy', message = 'NRTR Buy, {{exchange}}:{{ticker}}')
alertcondition(sellSignal, title = 'NRTR Sell', message = 'NRTR Sell, {{exchange}}:{{ticker}}')


/* --- FILE: tradingview-pinescript-indicators-master/trailing_stops/parabolic_sar.pine --- */
//@version=6
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Parabolic SAR script may be freely distributed under the terms of the GPL-3.0 license.
indicator('Parabolic SAR', shorttitle = 'PSAR', overlay = true)

const string calcGroup = 'Calculation'
start = input.float(0.02, step = 0.001, title = 'Start', group = calcGroup)
increment = input.float(0.02, step = 0.001, title = 'Increment', group = calcGroup)
maximum = input.float(0.2, step = 0.01, title = 'Maximum', group = calcGroup)

const string visualGroup = 'Visuals'
width = input.int(2, minval = 1, title = 'Point Width', group = visualGroup)
showLabels = input.bool(true, title = 'Show Buy/Sell Labels', group = visualGroup)
highlightStartPoints = input.bool(true, title = 'Highlight Start Points', group = visualGroup)
highlightState = input.bool(true, title = 'Highlight State', group = visualGroup)

//---

psar = ta.sar(start, increment, maximum)
dir = psar < close ? 1 : -1

psarColor = dir == 1 ? #3388bb : #fdcc02
psarPlot = plot(psar, title = 'PSAR', style = plot.style_circles, linewidth = math.max(1, width), color = psarColor)

const color textColor = color.white
const color longColor = color.green
const color shortColor = color.red
const color longFillColor = color.new(color.green, 85)
const color shortFillColor = color.new(color.red, 85)

buySignal = dir == 1 and dir[1] == -1
plotshape(buySignal and highlightStartPoints ? psar : na, title = 'Long Start', location = location.absolute, style = shape.circle, size = size.tiny, color = longColor)
plotshape(buySignal and showLabels ? psar : na, title = 'Buy Label', text = 'Buy', location = location.absolute, style = shape.labelup, size = size.tiny, color = longColor, textcolor = textColor)

sellSignal = dir == -1 and dir[1] == 1
plotshape(sellSignal and highlightStartPoints ? psar : na, title = 'Short Start', location = location.absolute, style = shape.circle, size = size.tiny, color = shortColor)
plotshape(sellSignal and showLabels ? psar : na, title = 'Sell Label', text = 'Sell', location = location.absolute, style = shape.labeldown, size = size.tiny, color = shortColor, textcolor = textColor)

midPricePlot = plot(ohlc4, title = '', display = display.none, editable = false)

fillColor = highlightState ? (dir == 1 ? longFillColor : dir == -1 ? shortFillColor : na) : na
fill(midPricePlot, psarPlot, title = 'Trade State Filling', color = fillColor)

alertcondition(dir != dir[1], title = 'Direction Change', message = 'PSAR has changed direction, {{exchange}}:{{ticker}}')
alertcondition(buySignal, title = 'Long', message = 'PSAR Long, {{exchange}}:{{ticker}}')
alertcondition(sellSignal, title = 'Short', message = 'PSAR Sell, {{exchange}}:{{ticker}}')


/* --- FILE: tradingview-pinescript-indicators-master/trailing_stops/supertrend.pine --- */
//@version=6
// Copyright (c) 2019-present, Alex Orekhov (everget)
// SuperTrend script may be freely distributed under the terms of the GPL-3.0 license.
indicator('SuperTrend', overlay = true)

const string calcGroup = 'Calculation'
length = input.int(22, title = 'ATR Period', group = calcGroup)
mult = input.float(3, step = 0.1, title = 'ATR Multiplier', group = calcGroup)
src = input.source(hl2, title = 'Source', group = calcGroup)
wicks = input.bool(true, title = 'Take Wicks into Account', group = calcGroup)

const string visualGroup = 'Visuals'
showLabels = input.bool(true, title = 'Show Buy/Sell Labels', group = visualGroup)
highlightState = input.bool(true, title = 'Highlight State', group = visualGroup)

//---

atr = mult * ta.atr(length)

highPrice = wicks ? high : close
lowPrice = wicks ? low : close
doji4price = open == close and open == low and open == high

longStop = src - atr
longStopPrev = nz(longStop[1], longStop)

if longStop > 0
    if doji4price
        longStop := longStopPrev
        longStop
    else
        longStop := lowPrice[1] > longStopPrev ? math.max(longStop, longStopPrev) : longStop
        longStop
else
    longStop := longStopPrev
    longStop

shortStop = src + atr
shortStopPrev = nz(shortStop[1], shortStop)

if shortStop > 0
    if doji4price
        shortStop := shortStopPrev
        shortStop
    else
        shortStop := highPrice[1] < shortStopPrev ? math.min(shortStop, shortStopPrev) : shortStop
        shortStop
else
    shortStop := shortStopPrev
    shortStop

var int dir = 1
dir := dir == -1 and highPrice > shortStopPrev ? 1 : dir == 1 and lowPrice < longStopPrev ? -1 : dir

const color textColor = color.white
const color longColor = color.green
const color shortColor = color.red
const color longFillColor = color.new(color.green, 85)
const color shortFillColor = color.new(color.red, 85)

longStopPlot = plot(dir == 1 ? longStop : na, title = 'Long Stop', style = plot.style_linebr, linewidth = 2, color = longColor)
buySignal = dir == 1 and dir[1] == -1
plotshape(buySignal ? longStop : na, title = 'Long Stop Start', location = location.absolute, style = shape.circle, size = size.tiny, color = longColor)
plotshape(buySignal and showLabels ? longStop : na, title = 'Buy Label', text = 'Buy', location = location.absolute, style = shape.labelup, size = size.tiny, color = longColor, textcolor = textColor)

shortStopPlot = plot(dir == 1 ? na : shortStop, title = 'Short Stop', style = plot.style_linebr, linewidth = 2, color = shortColor)
sellSignal = dir == -1 and dir[1] == 1
plotshape(sellSignal ? shortStop : na, title = 'Short Stop Start', location = location.absolute, style = shape.circle, size = size.tiny, color = shortColor)
plotshape(sellSignal and showLabels ? shortStop : na, title = 'Sell Label', text = 'Sell', location = location.absolute, style = shape.labeldown, size = size.tiny, color = shortColor, textcolor = textColor)

midPricePlot = plot(ohlc4, title = '', display = display.none, editable = false)

fill(midPricePlot, longStopPlot, title = 'Long State Filling', color = (highlightState and dir == 1 ? longFillColor : na))
fill(midPricePlot, shortStopPlot, title = 'Short State Filling', color = (highlightState and dir == -1 ? shortFillColor : na))

alertcondition(dir != dir[1], title = 'SuperTrend Direction Change', message = 'SuperTrend has changed direction, {{exchange}}:{{ticker}}')
alertcondition(buySignal, title = 'SuperTrend Buy', message = 'SuperTrend Buy, {{exchange}}:{{ticker}}')
alertcondition(sellSignal, title = 'SuperTrend Sell', message = 'SuperTrend Sell, {{exchange}}:{{ticker}}')


/* --- FILE: tradingview-pinescript-indicators-master/utils/session_input_parser.pine --- */
//@version=4
// Copyright (c) 2021-present, Alex Orekhov (everget)
// Session Input Parser script may be freely distributed under the terms of GPL-3.0 license.
study("Session Input Parser", overlay=true)

sessionSimple = input(title="Simple Session", type=input.session, defval="0800-1530")
sessionWithWeekdays = input(title="Session With Weekdays", type=input.session, defval="0800-1530:1234567")

_str_includes(str, char) =>
    tmp = str.replace_all(str, char, "")
    out = str.length(tmp) != str.length(str)
    out

_toint(str) =>
    out = int(tonumber(str))
    out

_parseSession(session) =>
    string sessionWithoutWeekdays = na
    string weekdaysPart = na
    bool hasWeekdays = false

    int hStart = na
    int mStart = na
    int hEnd = na
    int mEnd = na
    int[] weekdays = array.new_int(0)

    if _str_includes(session, ":")
        hasWeekdays := true
        sessionSplit = str.split(session, ":")
        sessionWithoutWeekdays := array.get(sessionSplit, 0)
        weekdaysPart := array.get(sessionSplit, 1)
    else
        sessionWithoutWeekdays := session

    hhmm_hhmm = str.split(sessionWithoutWeekdays, "")
    hStart := _toint(array.get(hhmm_hhmm, 0) + array.get(hhmm_hhmm, 1))
    mStart := _toint(array.get(hhmm_hhmm, 2) + array.get(hhmm_hhmm, 3))
    hEnd := _toint(array.get(hhmm_hhmm, 5) + array.get(hhmm_hhmm, 6))
    mEnd := _toint(array.get(hhmm_hhmm, 7) + array.get(hhmm_hhmm, 8))

    if hasWeekdays
        weekdaysSplit = str.split(weekdaysPart, "")

        for i = 0 to array.size(weekdaysSplit) - 1
            array.push(weekdays, _toint(array.get(weekdaysSplit, i)))
    [hStart, mStart, hEnd, mEnd, weekdays]

[hStart1, mStart1, hEnd1, mEnd1, weekdays1] = _parseSession(sessionSimple)
[hStart2, mStart2, hEnd2, mEnd2, weekdays2] = _parseSession(sessionWithWeekdays)

labelText =
     "Simple: " + sessionSimple + "\n"
     + "\nStart Hour: " + tostring(hStart1, "#")
     + "\nStart Minute: " + tostring(mStart1, "#")
     + "\nEnd Hour: " + tostring(hEnd1, "#")
     + "\nEnd Minute: " + tostring(mEnd1, "#")
     + "\nWeekdays: " + tostring(weekdays1)
     + "\n---------------------------------------------"
     + "\nWith weekdays: " + sessionWithWeekdays + "\n"
     + "\nStart Hour: " + tostring(hStart2, "#")
     + "\nStart Minute: " + tostring(mStart2, "#")
     + "\nEnd Hour: " + tostring(hEnd2, "#")
     + "\nEnd Minute: " + tostring(mEnd2, "#")
     + "\nWeekdays: " + tostring(weekdays2)

var label l = label.new(
     x=bar_index,
     y=na,
     text="",
     textalign=text.align_left,
     textcolor=color.white,
     color=color.blue,
     style=label.style_label_left,
     size=size.normal
     )

label.set_text(l, labelText)
label.set_xy(l, bar_index, ohlc4)


/* --- FILE: tradingview-pinescript-indicators-master/utils/unit_testing_framework.pine --- */
//@version=5
// Copyright (c) 2021-present, Alex Orekhov (everget)
// Unit Testing Framework script may be freely distributed under the terms of GPL-3.0 license.
indicator("Unit Testing Framework", overlay=true)

// Unit Testing Framework Core {

// Constants and Globals {
var string UT_FRAMEWORK_VERSION = "1.0.0"

string[] _private_suites = array.new_string(0)
string[] _private_tests = array.new_string(0)
int[] _private_testStatuses = array.new_int(0)
int[] _private_testToSuiteMap = array.new_int(0)
//}

// public _describe() {
// A function to declare a test suite
_describe(suiteName) =>
	array.push(_private_suites, suiteName)
//}

// public _it() {
// A function to run a test
_it(specTitle, actual, expected) =>
	array.push(_private_testToSuiteMap, array.size(_private_suites) - 1)
	array.push(_private_tests, specTitle)
	array.push(_private_testStatuses, actual == expected ? 1 : -1)
//}

// public _test() {
// An alias for the _it() function
_test(specTitle, actual, expected) =>
	_it(specTitle, actual, expected)
//}

// public _xit() {
// Any spec declared with `xit` is marked as skipped.
// Their names will show up in the results as skipped
_xit(specTitle, actual, expected) =>
	array.push(_private_testToSuiteMap, array.size(_private_suites) - 1)
	array.push(_private_tests, specTitle)
	array.push(_private_testStatuses, 0)
//}

// public _xtest() {
// An alias for the _xit() function
_xtest(specTitle, actual, expected) =>
	_xit(specTitle, actual, expected)
//}

// _private_factorize() {
// An utility function to convert elements of both <bool|int|float|string|color|line|label|table|box> arrays into integers to make them sortable.
// The arrays must have the same type!
// The idea is partially taken from R: https://www.stat.berkeley.edu/~s133/factors.html
// Example:
//      _factorize(["a", "b", "c"], ["a", "b", "d"])
//      => [0, 1, 2], [0, 1, 3]
_private_factorize(id_1, id_2) =>
	size_1 = array.size(id_1)
	new_id_1 = array.new_int(array.size(id_1), 0)
	new_id_2 = array.new_int(array.size(id_2), 0)

	factors = array.new_int(0)
	elements = array.concat(array.copy(id_1), id_2)
	added_elements = array.copy(elements)
	array.clear(added_elements)
	size = array.size(elements)

	if size > 0
		for i = 0 to size - 1
			el = array.get(elements, i)
			int new_factor = na

			if array.includes(added_elements, el)
				index = array.indexof(added_elements, el)
				new_factor := array.get(factors, index)
			else
				array.push(added_elements, el)
				new_factor := array.size(factors) == 0 ? 0 : 1 + array.get(factors, array.size(factors) - 1)
				array.push(factors, new_factor)
				na

			if i < size_1
				array.set(new_id_1, i, new_factor)
			else
				array.set(new_id_2, i - size_1, new_factor)
	[new_id_1, new_id_2]
//}

// public _isEqual() {
// A function to compare <bool|int|float|string|color|line|label|table|box> arrays.
// Order of elements isn't matter
_isEqual(id_1, id_2) =>
	out = false

	if array.size(id_1) == array.size(id_2)
		out := true

		[factors_1, factors_2] = _private_factorize(id_1, id_2)
		array.sort(factors_1, order.ascending)
		array.sort(factors_2, order.ascending)

		for i = 0 to array.size(factors_1) - 1
			el_1 = array.get(factors_1, i)
			el_2 = array.get(factors_2, i)
			if el_1 != el_2
				out := false
				break
		out
	out
//}

// public _isStrictEqual() {
// A function to compare <bool|int|float|string|color|line|label|table|box> arrays.
// Order of elements is matter
_isStrictEqual(id_1, id_2) =>
	out = false

	if array.size(id_1) == array.size(id_2)
		out := true

		for i = 0 to array.size(id_1) - 1
			el_1 = array.get(id_1, i)
			el_2 = array.get(id_2, i)
			if el_1 != el_2
				out := false
				break
		out
	out
//}

// public _testReporter() {
// A function to output test results
_testReporter(caption = "") =>
	var string configGroup = "Config"
	showSuiteStatuses = input.bool(title="Show test suites statuses", defval=true, group=configGroup)
	showPassedTests = input.bool(title="Show passed tests", defval=true, group=configGroup)
	showFailedTests = input.bool(title="Show failed tests", defval=true, group=configGroup)
	showSkippedTests = input.bool(title="Show skipped tests", defval=true, group=configGroup)

	var string PASSED_ICON = "✔️"
	var string FAILED_ICON = "❌"
	var string SKIPPED_ICON = "⛔"
	
	var string NO_SUITES_WARNING = "Professor, your tests must be grouped into suites!"
	var string NO_TESTS_WARNING = "Write at least 1 test, professor!"
	var string NO_SUITES_AND_TESTS_WARNING = "You haven't write any suite with tests yet"
	var string warningMessage = ""

	string[] report = array.new_string(0)
	suitesCount = array.size(_private_suites)
	passedSuitesCount = 0
	failedSuitesCount = 0
	skippedSuitesCount = 0
	
	testsCount = array.size(_private_tests)
	passedTestsCount = 0
	failedTestsCount = 0
	skippedTestsCount = 0

	if suitesCount > 0
		if testsCount > 0
			lastTestIndex = 0

			for i = 0 to suitesCount - 1
				suite = array.get(_private_suites, i)
				array.push(report, suite + ":")
				suiteIndex = array.size(report) - 1

				passedTestsInSuite = 0
				failedTestsInSuite = 0
				skippedTestsInSuite = 0

				for j = lastTestIndex to testsCount - 1
					suiteId = array.get(_private_testToSuiteMap, j)

					if suiteId == i
						test = array.get(_private_tests, j)
						status = array.get(_private_testStatuses, j)

						if status == 1
							passedTestsInSuite += 1
							passedTestsCount += 1
							if showPassedTests
								array.push(report, "\t\t" + PASSED_ICON + " " + test)
						else if status == -1
							failedTestsInSuite += 1
							failedTestsCount += 1
							if showFailedTests
								array.push(report, "\t\t" + FAILED_ICON + " " + test)
						else
							skippedTestsInSuite += 1
							skippedTestsCount += 1
							if showSkippedTests
								array.push(report, "\t\t" + SKIPPED_ICON + " " + test)
					else
						lastTestIndex := j
						break

				if failedTestsInSuite != 0
					failedSuitesCount += 1
					if showSuiteStatuses
						array.set(report, suiteIndex, FAILED_ICON + " " + array.get(report, suiteIndex))
				else if passedTestsInSuite != 0
					passedSuitesCount += 1
					if showSuiteStatuses
						array.set(report, suiteIndex, PASSED_ICON + " " + array.get(report, suiteIndex))
				else if skippedTestsInSuite != 0
					skippedSuitesCount += 1
					if showSuiteStatuses
						array.set(report, suiteIndex, SKIPPED_ICON + " " + array.get(report, suiteIndex))

				array.push(report, "")
			""
		else
			warningMessage := NO_TESTS_WARNING
	else if testsCount > 0
		warningMessage := NO_SUITES_WARNING
	else
		warningMessage := NO_SUITES_AND_TESTS_WARNING

	reportText =
		 "Unit Testing Framework Version: " + UT_FRAMEWORK_VERSION
		 + "\n\n" + "Suites: "
				 + str.tostring(passedSuitesCount, "#") + " passed"
				 + ", " + str.tostring(failedSuitesCount, "#") + " failed"
				 + ", " + str.tostring(skippedSuitesCount, "#") + " skipped"
				 + ", " + str.tostring(suitesCount, "#") + " total"
		 + "\n" + "Tests: "
				 + str.tostring(passedTestsCount, "#") + " passed"
				 + ", " + str.tostring(failedTestsCount, "#") + " failed"
				 + ", " + str.tostring(skippedTestsCount, "#") + " skipped"
				 + ", " + str.tostring(testsCount, "#") + " total"
		 + "\n" + "-------------------------------------------------------"
		 + "\n\n" + (warningMessage == "" ? (caption != "" ? caption + "\n\n" : "") + array.join(report, "\n") : warningMessage)

	var string positionUp = "Up"
	var string positionDown = "Down"
	var string positionLeft = "Left"
	var string positionRight = "Right"
	var string positionLowerLeft = "Lower Left"
	var string positionLowerRight = "Lower Right"
	var string positionUpperLeft = "Upper Left"
	var string positionUpperRight = "Upper Right"
	var string positionCenter = "Center"

	reporterPositionInput = input.string(title="Reporter Position", defval=positionUpperLeft, options=[positionUp, positionDown, positionLeft, positionRight, positionLowerLeft, positionLowerRight, positionUpperLeft, positionUpperRight, positionCenter], group=configGroup)
	var string reporterPosition = 
		 reporterPositionInput == positionUp ? label.style_label_up :
		 reporterPositionInput == positionDown ? label.style_label_down :
		 reporterPositionInput == positionLeft ? label.style_label_left :
		 reporterPositionInput == positionRight ? label.style_label_right :
		 reporterPositionInput == positionLowerLeft ? label.style_label_lower_left :
		 reporterPositionInput == positionLowerRight ? label.style_label_lower_right :
		 reporterPositionInput == positionUpperLeft ? label.style_label_upper_left :
		 reporterPositionInput == positionUpperRight ? label.style_label_upper_right :
		 label.style_label_center

	var label l = label.new(
		 x=na,
		 y=na,
		 color=input.color(title="Reporter Background Color", defval=color.black, group=configGroup),
		 text="",
		 textalign=text.align_left,
		 textcolor=input.color(title="Reporter Text Color", defval=color.white, group=configGroup),
		 style=reporterPosition,
		 size=size.normal
		 )

	label.set_text(l, reportText)
	label.set_xy(l, bar_index + 1, ohlc4)
//}

//} End of Unit Testing Framework Core

//==============================================================================
//==============================================================================
// YOUR TESTS START HERE !!!

_sum(v1, v2) =>
	out = v1 + v2
	out

// TIP: You can collapse (fold) code fragments with tests reducing them to a single visible line {
_describe("_sum()")
_it("should sum two integers", _sum(1, 2), 3)
_it("should sum two decimals", _sum(1.1, 2.4), 3.5)
_it("should sum integer and decimal numbers", _sum(1, 0.01), 1.01)
// }

//------------------------------------------------------------------------------

_multiply(v1, v2) =>
	out = v1 * v2
	out

// TIP: You can collapse (fold) code fragments with tests reducing them to a single visible line {
_describe("_multiply()")
_it("should multiply two integers", _multiply(2, 3), 6)
_it("should multiply two decimals", _multiply(0.1, 0.2), 0.02)
_it("should multiply integers and decimals", _multiply(2, 0.3), 0.6)
// }

//------------------------------------------------------------------------------

_describe("An example suite with all types of test statuses")
_it("this test is passed", true, true)
_it("this test is failed", true, false)
_xit("this test is skipped", true, true)

//------------------------------------------------------------------------------

_describe("<- A suite with at least one failed test will be marked with the cross icon")
_it("this test is failed", true, false)

//------------------------------------------------------------------------------

_describe("<- A suite with all tests passed will be marked with the check mark icon")
_it("this test is passed", true, true)

//------------------------------------------------------------------------------

_describe("<- A suite with all tests skipped will be marked with the no-entry icon")
_xit("this test is skipped", true, false)

//------------------------------------------------------------------------------

_describe("_isEqual")
_it("int[] Arrays of the different size should not be equal", _isEqual(array.from(1, 2, 3), array.from(3, 1)), false)
_it("int[] Arrays of the same size with the same elements should be equal", _isEqual(array.from(1, 2, 3), array.from(3, 1, 2)), true)
_it("int[] Arrays of the same size with different elements should not be equal", _isEqual(array.from(1, 2, 3), array.from(4, 5, 6)), false)

_it("float[] Arrays of the different size should not be equal", _isEqual(array.from(1.61803, 1.73205, 2.23606), array.from(2.71828, 3.14159)), false)
_it("float[] Arrays of the same size with the same elements should be equal", _isEqual(array.from(1.61803, 1.73205, 2.23606), array.from(2.23606, 1.61803, 1.73205)), true)
_it("float[] Arrays of the same size with different elements should not be equal", _isEqual(array.from(1.61803, 1.73205, 2.23606), array.from(2.71828, 3.14159, 2.289202)), false)

_it("bool[] Arrays of the different size should not be equal", _isEqual(array.from(true), array.from(true, true)), false)
_it("bool[] Arrays of the same size with the same elements should be equal", _isEqual(array.from(true, false, true), array.from(false, true, true)), true)
_it("bool[] Arrays of the same size with different elements should not be equal", _isEqual(array.from(true, true), array.from(false, false)), false)

_it("string[] Arrays of the different size should not be equal", _isEqual(array.from("Jeszcze", "Polska", "nie", "zginęła!"), array.from("Жыве", "Беларусь!")), false)
_it("string[] Arrays of the same size with the same elements should be equal", _isEqual(array.from("kiełba", "bimber", "pierogi"), array.from("pierogi", "kiełba", "bimber")), true)
_it("string[] Arrays of the same size with different elements should not be equal", _isEqual(array.from("a", "b", "c"), array.from("d", "e", "f")), false)

_it("color[] Arrays of the different size should not be equal", _isEqual(array.from(color.red, color.green, color.blue), array.from(#11111f, #000000)), false)
_it("color[] Arrays of the same size with the same elements should be equal", _isEqual(array.from(color.red, color.green, color.blue), array.from(color.blue, color.red, color.green)), true)
_it("color[] Arrays of the same size with different elements should not be equal", _isEqual(array.from(color.red, color.green, color.blue), array.from(color.purple, color.orange, color.teal)), false)

// TIP: If your methods/functions require some setup it is good to wrap tests in a function and then call it
_suite_isEqual_lines() =>
	line line0 = na
	line line1 = na
	line line2 = na
	line line3 = na
	line line4 = na
	line line5 = na

	if barstate.islast
		line0 := line.new(bar_index, na, bar_index, na, color=color.new(color.white, 100))
		line.delete(line0[1])

		line1 := line.new(bar_index + 1, na, bar_index + 2, na, color=color.new(color.white, 100))
		line.delete(line1[1])

		line2 := line.new(bar_index + 2, na, bar_index + 3, na, color=color.new(color.white, 100))
		line.delete(line2[1])

		line3 := line.new(bar_index + 3, na, bar_index + 4, na, color=color.new(color.white, 100))
		line.delete(line3[1])

		line4 := line.new(bar_index + 4, na, bar_index + 5, na, color=color.new(color.white, 100))
		line.delete(line4[1])

		line5 := line.new(bar_index + 5, na, bar_index + 6, na, color=color.new(color.white, 100))
		line.delete(line5[1])

	_it("lines[] Arrays of the different size should not be equal", _isEqual(array.from(line0, line1, line2), array.from(line0, line1)), false)
	_it("lines[] Arrays of the same size with the same elements should be equal", _isEqual(array.from(line0, line1, line2), array.from(line2, line0, line1)), true)
	_it("lines[] Arrays of the same size with different elements should not be equal", _isEqual(array.from(line0, line1, line2), array.from(line3, line4, line5)), false)
_suite_isEqual_lines()

// TIP: If your methods/functions require some setup it is good to wrap tests in a function and then call it
_suite_isEqual_labels() =>
	label label0 = na
	label label1 = na
	label label2 = na
	label label3 = na
	label label4 = na
	label label5 = na

	if barstate.islast
		label0 := label.new(bar_index, na, color=color.new(color.white, 100))
		label.delete(label0[1])

		label1 := label.new(bar_index + 1, na, color=color.new(color.white, 100))
		label.delete(label1[1])

		label2 := label.new(bar_index + 2, na, color=color.new(color.white, 100))
		label.delete(label2[1])

		label3 := label.new(bar_index + 3, na, color=color.new(color.white, 100))
		label.delete(label3[1])

		label4 := label.new(bar_index + 4, na, color=color.new(color.white, 100))
		label.delete(label4[1])

		label5 := label.new(bar_index + 5, na, color=color.new(color.white, 100))
		label.delete(label5[1])

	_it("label[] Arrays of the different size should not be equal", _isEqual(array.from(label0, label1, label2), array.from(label0, label1)), false)
	_it("label[] Arrays of the same size with the same elements should be equal", _isEqual(array.from(label0, label1, label2), array.from(label2, label0, label1)), true)
	_it("label[] Arrays of the same size with different elements should not be equal", _isEqual(array.from(label0, label1, label2), array.from(label3, label4, label5)), false)
_suite_isEqual_labels()

//------------------------------------------------------------------------------

_describe("_isStrictEqual")
_it("int[] Different size", _isStrictEqual(array.from(1, 2, 3), array.from(3, 1)), false)
_it("int[] Same size | same elements | same order", _isStrictEqual(array.from(1, 2, 3), array.from(1, 2, 3)), true)
_it("int[] Same size | same elements | different order", _isStrictEqual(array.from(1, 2, 3), array.from(3, 2, 1)), false)
_it("int[] Same size | different elements", _isStrictEqual(array.from(1, 2, 3), array.from(4, 5, 6)), false)

_it("float[] Different size", _isStrictEqual(array.from(1.61803, 1.73205, 2.23606), array.from(2.71828, 3.14159)), false)
_it("float[] Same size | same elements | same order", _isStrictEqual(array.from(1.61803, 1.73205, 2.23606), array.from(1.61803, 1.73205, 2.23606)), true)
_it("float[] Same size | same elements | different order", _isStrictEqual(array.from(1.61803, 1.73205, 2.23606), array.from(2.23606, 1.61803, 1.73205)), false)
_it("float[] Same size | different elements", _isStrictEqual(array.from(1.61803, 1.73205, 2.23606), array.from(2.71828, 3.14159, 2.289202)), false)

_it("bool[] Different size", _isStrictEqual(array.from(true), array.from(true, true)), false)
_it("bool[] Same size | same elements | same order", _isStrictEqual(array.from(true, false, true), array.from(true, false, true)), true)
_it("bool[] Same size | same elements | different order", _isStrictEqual(array.from(true, false, true), array.from(false, true, true)), false)
_it("bool[] Same size | different elements", _isStrictEqual(array.from(true, true), array.from(false, false)), false)

_it("string[] Different size", _isStrictEqual(array.from("Jeszcze", "Polska", "nie", "zginęła!"), array.from("Жыве", "Беларусь!")), false)
_it("string[] Same size | same elements | same order", _isStrictEqual(array.from("Слава Україні!", "Жыве Беларусь!", "Живела Србија!"), array.from("Слава Україні!", "Жыве Беларусь!", "Живела Србија!")), true)
_it("string[] Same size | same elements | different order", _isStrictEqual(array.from("kiełba", "bimber", "pierogi"), array.from("pierogi", "kiełba", "bimber")), false)
_it("string[] Same size | different elements", _isStrictEqual(array.from("a", "b", "c"), array.from("d", "e", "f")), false)

_it("color[] Different size", _isStrictEqual(array.from(color.red, color.green, color.blue), array.from(#11111f, #000000)), false)
_it("color[] Same size | same elements | same order", _isStrictEqual(array.from(color.red, color.green, color.blue), array.from(color.red, color.green, color.blue)), true)
_it("color[] Same size | same elements | different order", _isStrictEqual(array.from(color.red, color.green, color.blue), array.from(color.blue, color.red, color.green)), false)
_it("color[] Same size | different elements", _isStrictEqual(array.from(color.red, color.green, color.blue), array.from(color.purple, color.orange, color.teal)), false)

// TIP: If your methods/functions require some setup it is good to wrap tests in a function and then call it
_suite_isStrictEqual_lines() =>
	var color noneColor = color.new(color.white, 100)
	line line0 = na
	line line1 = na
	line line2 = na
	line line3 = na
	line line4 = na
	line line5 = na

	if barstate.islast
		line0 := line.new(bar_index, na, bar_index, na, color=noneColor)
		line.delete(line0[1])

		line1 := line.new(bar_index + 1, na, bar_index + 2, na, color=noneColor)
		line.delete(line1[1])

		line2 := line.new(bar_index + 2, na, bar_index + 3, na, color=noneColor)
		line.delete(line2[1])

		line3 := line.new(bar_index + 3, na, bar_index + 4, na, color=noneColor)
		line.delete(line3[1])

		line4 := line.new(bar_index + 4, na, bar_index + 5, na, color=noneColor)
		line.delete(line4[1])

		line5 := line.new(bar_index + 5, na, bar_index + 6, na, color=noneColor)
		line.delete(line5[1])

	_it("lines[] Different size", _isStrictEqual(array.from(line0, line1, line2), array.from(line2, line0)), false)
	_it("lines[] Same size | same elements | same order", _isStrictEqual(array.from(line0, line1, line2), array.from(line0, line1, line2)), true)
	_it("lines[] Same size | same elements | different order", _isStrictEqual(array.from(line0, line1, line2), array.from(line2, line1, line0)), false)
	_it("lines[] Same size | different elements", _isStrictEqual(array.from(line0, line1, line2), array.from(line3, line4, line5)), false)
_suite_isStrictEqual_lines()

// TIP: If your methods/functions require some setup it is good to wrap tests in a function and then call it
_suite_isStrictEqual_labels() =>
	var color noneColor = color.new(color.white, 100)
	label label0 = na
	label label1 = na
	label label2 = na
	label label3 = na
	label label4 = na
	label label5 = na

	if barstate.islast
		label0 := label.new(bar_index, na, color=noneColor)
		label.delete(label0[1])

		label1 := label.new(bar_index + 1, na, color=noneColor)
		label.delete(label1[1])

		label2 := label.new(bar_index + 2, na, color=noneColor)
		label.delete(label2[1])

		label3 := label.new(bar_index + 3, na, color=noneColor)
		label.delete(label3[1])

		label4 := label.new(bar_index + 4, na, color=noneColor)
		label.delete(label4[1])

		label5 := label.new(bar_index + 5, na, color=noneColor)
		label.delete(label5[1])

	_it("labels[] Different size", _isStrictEqual(array.from(label0, label1, label2), array.from(label2, label0)), false)
	_it("labels[] Same size | same elements | same order", _isStrictEqual(array.from(label0, label1, label2), array.from(label0, label1, label2)), true)
	_it("labels[] Same size | same elements | different order", _isStrictEqual(array.from(label0, label1, label2), array.from(label2, label1, label0)), false)
	_it("labels[] Same size | different elements", _isStrictEqual(array.from(label0, label1, label2), array.from(label3, label4, label5)), false)
_suite_isStrictEqual_labels()

//==============================================================================
//==============================================================================

// ATTENTION: We need to call the reporter function to see test resuts
_testReporter("<This is an optional caption that may contain your library name and version.\nUse empty string if you don't need the caption\nor call the _testReporter function without any arguments>")


/* --- FILE: tradingview-pinescript-indicators-master/volatility/damping_index.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Damping Index script may be freely distributed under the terms of GPL-3.0 license.
study("Damping Index", shorttitle="DI")

smaLength = input(title="SMA Length", type=integer, defval=5)
threshold = input(title="Threshold", type=float, step=0.1, defval=1.5)

sma = sma(high - low, smaLength)

di = sma[1] / sma[6]

diColor = di >= threshold ? #ff9800 : #3c78d8
plot(di, color=diColor, transp=0)

hline(threshold, title="Threshold", linestyle=dotted)

breakoutFillColor = di >= threshold ? #ff9800 : color(white, 100)
bgcolor(breakoutFillColor, transp=90)


/* --- FILE: tradingview-pinescript-indicators-master/volatility/gopalakrishnan_range_index.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Gopalakrishnan Range Index script may be freely distributed under the terms of GPL-3.0 license.
study("Gopalakrishnan Range Index", shorttitle="GAPO")

length = input(title="Length", type=integer, defval=5)

gapo = log(highest(length) - lowest(length)) / log(length)

gapoColor = gapo >= gapo[1] ? #0ebb23 : red
plot(gapo, title="GAPO", linewidth=2, color=gapoColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/volatility/mayer_multiple.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Mayer Multiple script may be freely distributed under the terms of GPL-3.0 license.
study("Mayer Multiple", shorttitle="MM")

smaLength = input(title="SMA Length", type=integer, defval=200)
threshold = input(title="Threshold", type=float, step=0.1, defval=2.4)

price = nz(security("BTCUSD", period, close))

mm = price / sma(price, smaLength)

mmColor = mm > threshold ? #ff9800 : #3c78d8
plot(mm, color=mmColor, transp=0)

hline(threshold, title="Threshold", linestyle=dotted)

breakoutFillColor = mm > threshold ? #ff9800 : color(white, 100)
bgcolor(breakoutFillColor, transp=90)


/* --- FILE: tradingview-pinescript-indicators-master/volatility/normalized_average_true_range.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Normalized Average True Range script may be freely distributed under the terms of GPL-3.0 license.
study("Normalized Average True Range", shorttitle="NATR")

length = input(title="Length", type=integer, defval=14)

natr = 100 * atr(length) / close

plot(natr, color=#ff9800, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/volatility/ulcer_index.pine --- */
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Ulcer Index script may be freely distributed under the terms of GPL-3.0 license.
study("Ulcer Index")

length = input(title="Length", type=input.integer, defval=14)
smoothLength = input(title="Smoothing Length", type=input.integer, defval=14)
breakout = input(title="Breakout Level", type=input.float, step=0.1, defval=1.5)
signalType = input(title="Signal Smoothing Type", defval="SMA", options=["EMA", "SMA"])
signalLength = input(title="Signal Smoothing Length", type=input.integer, defval=52)
src = input(title="Source", type=input.source, defval=close)
showSignal = input(title="Show Signal ?", type=input.bool, defval=true)
highlightCrossovers = input(title="Highlight Signal Crossovers ?", type=input.bool, defval=true)
applyRibbonFilling = input(title="Apply Ribbon Filling ?", type=input.bool, defval=true)

highest = highest(src, length)
drawdown = 100 * (src - highest) / highest
ulcer = sqrt(sma(pow(drawdown, 2), smoothLength))
signal = signalType == "SMA" ? sma(ulcer, signalLength) : ema(ulcer, signalLength)

trendColor = ulcer > signal ? #0ebb23 : color.red
ulcerColor = applyRibbonFilling ? trendColor : (ulcer >= ulcer[1] ? #0ebb23 : color.red)
signalColor = applyRibbonFilling ? trendColor : #1155cc

ulcerPlot = plot(ulcer, title="Ulcer", linewidth=2, color=ulcerColor, transp=0)
signalPlot = plot(showSignal ? signal : na, title="Signal", color=signalColor, transp=0)

ribbonFillColor = applyRibbonFilling ? trendColor : na
fill(ulcerPlot, signalPlot, title="Ribbon", color=ribbonFillColor, transp=70)

plotshape(crossover(ulcer, signal) and highlightCrossovers ? signal : na, title="Crossover", location=location.absolute, style=shape.circle, size=size.tiny, color=color.green, transp=0)
plotshape(crossunder(ulcer, signal) and highlightCrossovers ? signal : na, title="Crossunder", location=location.absolute, style=shape.circle, size=size.tiny, color=color.red, transp=0)

hline(breakout, title="Breakout Level", linestyle=hline.style_dotted, linewidth=2)
breakoutFillColor = ulcer > breakout ? #ff9800 : na
bgcolor(breakoutFillColor, transp=90)


/* --- FILE: tradingview-pinescript-indicators-master/volatility/volatility_ratio.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Volatility Ratio script may be freely distributed under the terms of the GPL-3.0 license.
study("Volatility Ratio", shorttitle="VR")

length = input(title="Length", type=integer, minval=1, defval=14)
breakoutLevel = input(title="Breakout Level", type=float, step=0.1, defval=0.5)

max = max(highest(high, length), close[length + 1])
min = min(lowest(low, length), close[length + 1])

vr = tr(true) / (max - min)

vrColor = vr >= breakoutLevel ? #39b361 : #cc4125

plot(vr, title="VR", linewidth=2, color=vrColor, transp=0)

hline(title="Breakout Level", price=breakoutLevel, linestyle=dotted, color=gray)


/* --- FILE: tradingview-pinescript-indicators-master/volume/accumulation_distribution_line.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Accumulation/Distribution Line script may be freely distributed under the terms of GPL-3.0 license.
study("Accumulation/Distribution Line", shorttitle="Accum/Dist", precision=0)

showSignal = input(title="Show Signal ?", type=bool, defval=true)
signalType = input(title="Signal Smoothing Type", defval="SMA", options=["EMA", "SMA"])
signalLength = input(title="Signal Smoothing Length", type=integer, defval=21)
highlightCrossovers = input(title="Highlight Crossovers ?", type=bool, defval=false)
applyFilling = input(title="Apply Ribbon Filling ?", type=bool, defval=true)

signal = signalType == "EMA" ? ema(accdist, signalLength) : sma(accdist, signalLength)

trendColor = accdist > signal ? #0ebb23 : red

adColor = applyFilling ? trendColor : #0094ff
signalColor = applyFilling ? trendColor : #ff6a00

adPlot = plot(accdist, title="Accum/Dist", linewidth=2, color=adColor, transp=0)
signalPlot = plot(showSignal ? signal : na, title="Signal", color=signalColor, transp=0)

transparent = color(white, 100)

fillColor = applyFilling ? trendColor : transparent
fill(adPlot, signalPlot, color=fillColor, transp=70)

plotshape(crossover(accdist, signal) and highlightCrossovers ? accdist : na, title="Crossover", location=location.absolute, style=shape.circle, size=size.tiny, color=green, transp=0)
plotshape(crossunder(accdist, signal) and highlightCrossovers ? accdist : na, title="Crossunder", location=location.absolute, style=shape.circle, size=size.tiny, color=red, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/volume/klinger_volume_oscillator.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Klinger Volume Oscillator script may be freely distributed under the terms of GPL-3.0 license.
study(title="Klinger Volume Oscillator", shorttitle="KVO", precision=0)

fastLength = input(title="Fast Length", type=integer, defval=34)
slowLength = input(title="Slow Length", type=integer, defval=55)
showSignal = input(title="Show Signal ?", type=bool, defval=true)
signalType = input(title="Signal Smoothing Type", defval="EMA", options=["EMA", "SMA"])
signalLength = input(title="Signal Smoothing Length", type=integer, defval=13)
showHistogram = input(title="Show Histogram ?", type=bool, defval=false)
highlightCrossovers = input(title="Highlight KVO/Signal Crossovers ?", type=bool, defval=true)
highlightZeroCrossovers = input(title="Highlight Zero Line Crossovers ?", type=bool, defval=true)
applyFilling = input(title="Apply Ribbon Filling ?", type=bool, defval=false)

mom = change(hlc3)

trend = 0.0
trend := na(trend[1]) ? 0.0 : (mom > 0 ? 1 : mom < 0 ? -1 : trend[1])

// Daily Measurement
dm = high - low

// Cumulative Measurement
cm = 0.0
cm := na(cm[1]) ? 0.0 : (trend == trend[1] ? cm[1] + dm : dm + dm[1])

// Volume Force
vf = cm != 0 ? 100 * volume * trend * abs(2 * dm / cm - 1) : 0

kvo = ema(vf, fastLength) - ema(vf, slowLength)
signal = signalType == "EMA" ? ema(kvo, signalLength) : sma(kvo, signalLength)

hist = kvo - signal
histColor = hist >= 0 ? (hist[1] < hist ? #26A69A : #B2DFDB) : (hist[1] < hist ? #FFCDD2 : #EF5350)
plot(showHistogram ? hist : na, title="Histogram", style=columns, color=histColor, transp=0)
hline(0, title="Zero Level", linestyle=dotted)

trendColor = kvo > signal ? #0ebb23 : red

kvoColor = applyFilling ? trendColor : (kvo > 0 ? #0ebb23 : red)
signalColor = applyFilling ? trendColor : #512da8

kvoPlot = plot(kvo, title="KVO", linewidth=2, color=kvoColor, transp=0)
signalPlot = plot(showSignal ? signal : na, title="Signal", color=signalColor, transp=0)

transparent = color(white, 100)

fillColor = applyFilling ? trendColor : transparent
fill(kvoPlot, signalPlot, title="Ribbon", color=fillColor, transp=70)

zeroCrossBgColor = highlightZeroCrossovers ? (kvo > 0 ? green : red) : transparent
bgcolor(zeroCrossBgColor, title="Background", transp=85)

plotshape(crossover(kvo, signal) and highlightCrossovers ? signal : na, title="Crossover", location=location.absolute, style=shape.circle, size=size.tiny, color=green, transp=20)
plotshape(crossunder(kvo, signal) and highlightCrossovers ? signal : na, title="Crossunder", location=location.absolute, style=shape.circle, size=size.tiny, color=red, transp=20)


/* --- FILE: tradingview-pinescript-indicators-master/volume/negative_volume_index.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Negative Volume Index script may be freely distributed under the terms of GPL-3.0 license.
study("Negative Volume Index", shorttitle="NVI")

initial = input(title="Initial Value", type=integer, defval=100)
signalType = input(title="Signal Smoothing Type", defval="EMA", options=["EMA", "SMA"])
signalLength = input(title="Signal Length", type=integer, defval=255)
highlightCrossovers = input(title="Highlight Crossovers", type=bool, defval=false)
applyFilling = input(title="Apply Ribbon Filling ?", type=bool, defval=true)

nvi = 0.0
nvi := na(nvi[1]) ? initial : (change(volume) < 0 ? nvi[1] * close / close[1] : nvi[1])
signal = signalType == "EMA" ? ema(nvi, signalLength) : sma(nvi, signalLength)

trendColor = nvi > signal ? #0ebb23 : red

nviColor = applyFilling ? trendColor : #0094ff
signalColor = applyFilling ? trendColor : #ff6a00

nviPlot = plot(nvi, title="NVI", color=nviColor, transp=0)
signalPlot = plot(signal, title="Signal", color=signalColor, transp=0)

transparent = color(white, 100)

fillColor = applyFilling ? trendColor : transparent
fill(nviPlot, signalPlot, color=fillColor, transp=70)

plotshape(crossover(nvi, signal) and highlightCrossovers ? nvi : na, title="Crossover", location=location.absolute, style=shape.circle, size=size.tiny, color=green, transp=0)
plotshape(crossunder(nvi, signal) and highlightCrossovers ? nvi : na, title="Crossunder", location=location.absolute, style=shape.circle, size=size.tiny, color=red, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/volume/net_volume.pine --- */
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// Net Volume script may be freely distributed under the terms of GPL-3.0 license.
study("Net Volume", precision=0)

src = input(title="Source", type=source, defval=close)

nv = sign(change(src)) * volume

nvColor = nv >= 0 ? (nv[1] < nv ? #26A69A : #B2DFDB) : (nv[1] < nv ? #FFCDD2 : #EF5350)

plot(nv, title="Net Volume", style=columns, linewidth=2, color=nvColor, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/volume/on_balance_volume.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// On Balance Volume script may be freely distributed under the terms of GPL-3.0 license.
study("On Balance Volume", shorttitle="OBV", precision=0)

showSignal = input(title="Show Signal ?", type=bool, defval=true)
signalType = input(title="Signal Smoothing Type", defval="SMA", options=["EMA", "SMA"])
signalLength = input(title="Signal Smoothing Length", type=integer, defval=21)
highlightCrossovers = input(title="Highlight Crossovers ?", type=bool, defval=false)
applyFilling = input(title="Apply Ribbon Filling ?", type=bool, defval=true)
src = input(title="Source", type=source, defval=close)

obv = cum(sign(change(src)) * volume)
signal = signalType == "EMA" ? ema(obv, signalLength) : sma(obv, signalLength)

trendColor = obv > signal ? #0ebb23 : red

obvColor = applyFilling ? trendColor : #0094ff
signalColor = applyFilling ? trendColor : #ff6a00

obvPlot = plot(obv, title="OBV", linewidth=2, color=obvColor, transp=0)
signalPlot = plot(showSignal ? signal : na, title="Signal", color=signalColor, transp=0)

transparent = color(white, 100)

fillColor = applyFilling ? trendColor : transparent
fill(obvPlot, signalPlot, color=fillColor, transp=70)

plotshape(crossover(obv, signal) and highlightCrossovers ? obv : na, title="Crossover", location=location.absolute, style=shape.circle, size=size.tiny, color=green, transp=0)
plotshape(crossunder(obv, signal) and highlightCrossovers ? obv : na, title="Crossunder", location=location.absolute, style=shape.circle, size=size.tiny, color=red, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/volume/percent_volume.pine --- */
//@version=3
// Copyright (c) 2019-present, Alex Orekhov (everget)
// % Volume script may be freely distributed under the terms of GPL-3.0 license.
study("% Volume", precision=2)

length = input(title="SMA Length", type=integer, defval=21)

pv = 100 * volume / sma(volume, length)

pvColor = close > open ? #92df8bff : #fe9695ff
plot(pv, title="%V", style=columns, linewidth=2, color=pvColor, transp=0)

// purple = #674ea7
// yellow = #f9ce02

labelColor = #f9ce02
levelColor = #674ea7

plot(50, title="", style=circles, linewidth=0, color=labelColor)
hline(50, title="50% Level", linestyle=dotted, color=levelColor)

plot(100, title="", style=circles, linewidth=0, color=labelColor)
hline(100, title="100% Level", linestyle=dotted, color=levelColor)

plot(150, title="", style=circles, linewidth=0, color=labelColor)
hline(150, title="150% Level", linestyle=dotted, color=levelColor)

plot(200, title="", style=circles, linewidth=0, color=labelColor)
hline(200, title="200% Level", linestyle=dotted, color=levelColor)

plot(250, title="", style=circles, linewidth=0, color=labelColor)
hline(250, title="250% Level", linestyle=dotted, color=levelColor)

plot(300, title="", style=circles, linewidth=0, color=labelColor)
hline(300, title="300% Level", linestyle=dotted, color=levelColor)

// show300 = input(title="Show 300% Level ?", type=bool, defval=false)
// plot(show300 ? 300 : na, title="", style=circles, linewidth=0, color=#F9CE02)
// hline(show300 ? 300 : na, title="300% Level", linestyle=dotted, color=#F9CE02)


/* --- FILE: tradingview-pinescript-indicators-master/volume/positive_volume_index.pine --- */
//@version=3
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Positive Volume Index script may be freely distributed under the terms of GPL-3.0 license.
study("Positive Volume Index", shorttitle="PVI")

initial = input(title="Initial Value", type=integer, defval=100)
signalType = input(title="Signal Smoothing Type", defval="EMA", options=["EMA", "SMA"])
signalLength = input(title="Signal Length", type=integer, defval=255)
highlightCrossovers = input(title="Highlight Crossovers ?", type=bool, defval=false)
applyFilling = input(title="Apply Ribbon Filling ?", type=bool, defval=true)

pvi = 0.0
pvi := na(pvi[1]) ? initial : (change(volume) > 0 ? pvi[1] * close / close[1] : pvi[1])
signal = signalType == "EMA" ? ema(pvi, signalLength) : sma(pvi, signalLength)

trendColor = pvi > signal ? #0ebb23 : red

pviColor = applyFilling ? trendColor : #0094ff
signalColor = applyFilling ? trendColor : #ff6a00

pviPlot = plot(pvi, title="PVI", color=pviColor, transp=0)
signalPlot = plot(signal, title="Signal", color=signalColor, transp=0)

transparent = color(white, 100)

fillColor = applyFilling ? trendColor : transparent
fill(pviPlot, signalPlot, color=fillColor, transp=70)

plotshape(crossover(pvi, signal) and highlightCrossovers ? pvi : na, title="Crossover", location=location.absolute, style=shape.circle, size=size.tiny, color=green, transp=0)
plotshape(crossunder(pvi, signal) and highlightCrossovers ? pvi : na, title="Crossunder", location=location.absolute, style=shape.circle, size=size.tiny, color=red, transp=0)


/* --- FILE: tradingview-pinescript-indicators-master/volume/price_volume_trend.pine --- */
//@version=4
// Copyright (c) 2018-present, Alex Orekhov (everget)
// Price Volume Trend script may be freely distributed under the terms of GPL-3.0 license.
study("Price Volume Trend", shorttitle="PVT", format=format.volume)

showSignal = input(title="Show Signal ?", type=input.bool, defval=true)
signalType = input(title="Signal Smoothing Type", defval="SMA", options=["EMA", "SMA"])
signalLength = input(title="Signal Smoothing Length", type=input.integer, defval=21)
src = input(title="Source", type=input.source, defval=close)
highlightCrossovers = input(title="Highlight Crossovers ?", type=input.bool, defval=false)
applyFilling = input(title="Apply Ribbon Filling ?", type=input.bool, defval=true)

signal = signalType == "EMA" ? ema(pvt, signalLength) : sma(pvt, signalLength)

trendColor = pvt > signal ? #0ebb23 : color.red
pvtColor = applyFilling ? trendColor : #0094ff
signalColor = applyFilling ? trendColor : #ff6a00

pvtPlot = plot(pvt, title="PVT", linewidth=2, color=pvtColor, transp=0)
signalPlot = plot(showSignal ? signal : na, title="Signal", color=signalColor, transp=0)

transparent = color.new(color.white, 100)

fillColor = applyFilling ? trendColor : transparent
fill(pvtPlot, signalPlot, color=fillColor, transp=70)

buyAlert = crossover(pvt, signal)
sellAlert = crossunder(pvt, signal)

plotshape(buyAlert and highlightCrossovers ? pvt : na, title="Crossover", location=location.absolute, style=shape.circle, size=size.tiny, color=color.green, transp=0)
plotshape(sellAlert and highlightCrossovers ? pvt : na, title="Crossunder", location=location.absolute, style=shape.circle, size=size.tiny, color=color.red, transp=0)

alertcondition(buyAlert, title="Alert: Buy", message="Buy\nSymbol: {{exchange}}:{{ticker}}\nPrice: {{close}}")
alertcondition(sellAlert, title="Alert: Sell", message="Sell\nSymbol: {{exchange}}:{{ticker}}\nPrice: {{close}}")


/* --- FILE: tradingview-pinescript-indicators-master/volume/volume_accumulation.pine --- */
//@version=6
// Copyright (c) 2020-present, Alex Orekhov (everget)
indicator('Volume Accumulation', format = format.volume)

accumulationType = input.string('Daily', title = 'Type', options = ['Minutely', 'Hourly', 'Session', 'Daily', 'Monthly', 'Quarterly', 'Yearly'])
sessionInput = input.session('0900-1530', title = 'Session (only for \'Session\' type)')
includeWeekends = input(true, title = 'Include Weekends')
var session = sessionInput + (includeWeekends ? ':1234567' : '')

applyBarColors = input(true, title = 'Apply Bar Colors')

//---

_inSession(res, sess) => not na(time(res, sess))

min = minute(time)
h = hour(time)
s = _inSession(timeframe.period, session) ? 1 : 0
d = dayofmonth(time)
m = month(time)
q = int(math.ceil(m / 3))
y = year(time)

int period = switch accumulationType
    'Minutely' => min
    'Hourly' => h
    'Session' => s
    'Daily' => d
    'Monthly' => m
    'Quarterly' => q
    'Yearly' => y
    => d

var acc = 0.0
acc := period != period[1] ? volume : nz(acc[1]) + volume

var accPrev = 0.0
accPrev := period != period[1] ? acc[1] : accPrev

accColor = acc > accPrev ? #92df8bff : #fe9695ff
plot(acc, title = 'Accumulation', style = plot.style_columns, color = accColor)
barcolor(applyBarColors ? accColor : na, title = 'Bar Color')

var periodChangeColor = color.new(#ffcc80, 60)
var noneColor = #ffffff00

bgcolor(period != period[1] ? periodChangeColor : noneColor, title = 'Separator')

higherAlert = acc > accPrev
alertcondition(higherAlert, title = 'Higher Accumulation', message = 'Higher Accumulation')


